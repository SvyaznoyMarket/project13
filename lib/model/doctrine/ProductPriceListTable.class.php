<?php

/**
 * ProductPriceListTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ProductPriceListTable extends myDoctrineTable
{

  /**
   * Returns an instance of this class.
   *
   * @return object ProductPriceListTable
   */
  public static function getInstance()
  {
    return Doctrine_Core::getTable('ProductPriceList');
  }

  public function getCoreMapping()
  {
    return array(
      'id'         => 'core_id',
      'name'       => 'name',
      'is_primary' => 'is_default',
      'is_active'  => 'is_active',
    );
  }

  public function getDefault()
  {
    return $this->createQuery('list')
      ->leftJoin('list.Region as r on list.id=r.product_price_list_id')
      ->where('r.is_default = ?', 1)
      ->addWhere('region.type = ?', 'city')
      ->fetchOne()
    ;
  }

  public function getCurrent()
  {
    $region = sfContext::getInstance()->getUser()->getRegion();
    if (isset($region->id))
    {
      return $this->createQuery('list')
        ->leftJoin('list.Region as r on list.id=r.product_price_list_id')
        ->where('r.id = ?', $region->id)
        ->fetchOne()
      ;
    }
    else
    {
      return $this->getDefault();
    }
  }

}