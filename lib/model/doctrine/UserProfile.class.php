<?php

/**
 * UserProfile
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    enter
 * @subpackage model
 * @author     Связной Маркет
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class UserProfile extends BaseUserProfile
{
  public function importFromCore(array $data)
  {
    parent::importFromCore($data);

    foreach (sfConfig::get('app_open_auth_provider') as $k => $v)
    {
      if ($v['core_id'] == $this->core_network_id)
      {
        $this->type = $k;
        break;
      }
    }
  }

  public function __toString()
  {
    $content = sfYaml::load($this->content);

    $return = null;
    switch ($this->type)
    {
      case 'vkontakte':
        $return = $content['first_name'];
        break;
      case 'facebook':
        $return = $content['first_name'];
        break;
      case 'twitter':
        $return = $content['name'];
        break;
      case 'odnoklassniki':
        $return = $content['first_name'];
        break;
      case 'mailru':
        $return = $content['first_name'];
        break;
    }

    return $return;
  }

  public function getEmail()
  {
    $content = sfYaml::load($this->content);

    $value = array(
      'vkontakte'     => false,
      'facebook'      => 'email',
      'twitter'       => false,
      'odnoklassniki' => false,
      'mailru'        => 'email',
    );

    return !empty($content[$value[$this->type]]) ? $content[$value[$this->type]] : null;
  }

  public function getLastName()
  {
    $content = sfYaml::load($this->content);

    $value = array(
      'vkontakte'     => 'last_name',
      'facebook'      => 'last_name',
      'twitter'       => 'name',
      'odnoklassniki' => 'last_name',
      'mailru'        => 'last_name',
    );

    $return = !empty($content[$value[$this->type]]) ? $content[$value[$this->type]] : null;
    if ('twitter' == $this->type)
    {
      $pair = explode(' ', $return);
      $return = !empty($pair[1]) ? $pair[1] : $return;
    }

    return $return;
  }

  public function getFirstName()
  {
    $content = sfYaml::load($this->content);

    $value = array(
      'vkontakte'     => 'first_name',
      'facebook'      => 'first_name',
      'twitter'       => 'name',
      'odnoklassniki' => 'first_name',
      'mailru'        => 'first_name',
    );

    $return = !empty($content[$value[$this->type]]) ? $content[$value[$this->type]] : null;
    if ('twitter' == $this->type)
    {
      $pair = explode(' ', $return);
      $return = !empty($pair[0]) ? $pair[0] : $return;
    }

    return $return;
  }

  public function getPhoto()
  {
    $content = sfYaml::load($this->content);

    $value = array(
      'vkontakte'     => 'photo',
      'facebook'      => false,
      'twitter'       => 'profile_image_url',
      'odnoklassniki' => 'pic_1',
      'mailru'        => 'pic_small',
    );

    return !empty($content[$value[$this->type]]) ? $content[$value[$this->type]] : null;
  }

  public function getNickname()
  {
    $content = sfYaml::load($this->content);

    $value = array(
      'vkontakte'     => false,
      'facebook'      => false,
      'twitter'       => false,
      'odnoklassniki' => false,
      'mailru'        => false,
    );

    return !empty($content[$value[$this->type]]) ? $content[$value[$this->type]] : null;
  }

  public function exportToCore()
  {
    $data = parent::exportToCore();

    $providers = sfConfig::get('app_open_auth_provider');

    // TODO: remove and test
    $data['network_id'] = $providers[$this->type]['core_id'];
    $data['user_id'] = $this->User->core_id;

    return $data;
  }

}
