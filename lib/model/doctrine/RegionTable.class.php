<?php

/**
 * RegionTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class RegionTable extends myDoctrineTable
{

  /**
   * Returns an instance of this class.
   *
   * @return object RegionTable
   */
  public static function getInstance()
  {
    return Doctrine_Core::getTable('Region');
  }

  public function getCoreMapping()
  {
    return array(
      'id'        => 'core_id',
      'parent_id' => 'core_parent_id',
      'name'      => 'name',
    );
  }

  public function createBaseQuery(array $params = array())
  {
    $this->applyDefaultParameters($params);

    $q = $this->createQuery('region');

    $q->where('region.level > ?', 0);
    $q->orderBy('region.root_id, region.lft');

    return $q;
  }

  public function getDefault()
  {
    return $this->createBaseQuery()
      //->where('region.token = ?', sfConfig::get('app_default_region', 'moscow'))
      ->where('region.is_default = ?', 1)
      ->fetchOne()
    ;
  }
}