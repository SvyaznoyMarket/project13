$(document).ready(function(){function j(){for(var a=0,c=0;a<d.length;a++)!d[a].noview&&$.contains(document.body,d[a].hasnodes[0])&&(c+=1*d[a].sum);c||location.reload(!0);g.html(printPrice(c));g.typewriter(800)}function h(a,c){var b=this;this.hasnodes=$(a.drop);$(a.less).data("run",!1);$(a.more).data("run",!1);var i=$(a.line),e=$(a.more).parent().attr("href"),d=$(a.drop).attr("href");this.sum=$(a.sum).html().replace(/\s/,"");var f=a.limit;this.quantum=1*$(a.quan).html().replace(/\D/g,"");var g=(1*
(1*b.sum/b.quantum)).toFixed(2);"price"in a&&(g=$(a.price).html().replace(/\s/,""));this.noview=!1;var h=null;this.calculate=function(c){clearTimeout(h);b.quantum=c;b.sum=g*c;$(a.sum).html(printPrice(b.sum));$(a.sum).typewriter(800);h=setTimeout(function(){j()})};this.clear=function(){i.remove();b.noview=!0;c&&c();$.getJSON(d,function(b){$(a.drop).data("run",!1);b.success?j():location.href=location.href})};this.update=function(c,i){if(0<i&&f<b.quantum+i)$(c).data("run",!1);else{var d=e;b.quantum+=
i;d+=b.quantum;$(a.quan).html(b.quantum+" шт.");b.calculate(b.quantum);$.getJSON(d,function(a){$(c).data("run",!1);if(!a.success)location.href=location.href})}};$(a.drop).click(function(){$(a.drop).data("run")||($(a.drop).data("run",!0),b.clear());return!1});$(a.less).click(function(){$(this).data("run")||($(this).data("run",!0),1<b.quantum?b.update(this,-1):b.clear());return!1});$(a.more).click(function(){$(this).data("run")||($(this).data("run",!0),b.update(this,1));return!1})}function k(a,c){var b=
new h({line:a,less:a.find(".ajaless"),more:a.find(".ajamore"),quan:a.find(".ajaquant"),sum:a.find(".price"),drop:a.find(".whitelink")},function(){for(var a=$("td.bF1Block_eBuy",c),b=$("div.bBacketServ.mBig",c),d=0,e=$(a).length;d<e;d++)$("tr[ref="+$(a[d]).attr("ref")+"]",b).length||$(a[d]).find("input").val("Купить услугу").removeClass("active");$("div.bBacketServ.mBig .ajaquant",c).length||($("div.bBacketServ.mBig",c).hide(),$("div.bBacketServ.mSmall",c).show())});d.push(b)}function m(a,c){$("div.bBacketServ.mSmall",
a).hide();$("div.bBacketServ.mBig",a).show();var b=$("div.bBacketServ.mBig tr:first",a),d=tmpl("f1cartline",c),d=d.replace(/F1ID/g,c.fid).replace(/F1TOKEN/g,c.f1token).replace(/PRID/g,a.attr("ref"));b.after(d);k($("div.bBacketServ.mBig tr:eq(1)",a));j()}var g=$(".allpageinner > .basketinfo .price"),d=[];$(".basketline").each(function(){var a=$(this),c=new h({line:a,less:a.find(".ajaless:first"),more:a.find(".ajamore:first"),quan:a.find(".ajaquant:first"),price:a.find(".basketinfo .price:first"),sum:a.find(".basketinfo .sum:first"),
drop:a.find(".basketinfo .whitelink:first"),limit:a.find(".numerbox").data("limit")});d.push(c);$("div.bBacketServ.mBig",a).length&&$("div.bBacketServ.mBig tr",a).each(function(){$(".ajaquant",$(this)).length&&k($(this),a)});a.find("a.link1").click(function(){var b=$("div.bF1Block",a);b.show().find(".close").click(function(){b.hide()});b.find("input.button").click(function(){if($(this).hasClass("active"))return!1;$(this).val("В корзине").addClass("active");var c=$(this).data();$.getJSON(c.url,function(){});
m(a,c);b.hide()});return!1})});if($(".bBacketServ.extWarr").length&&$(".bBacketServ.extWarr").is(":visible")){var n=$(".bBacketServ.extWarr"),l=$("div.bBacketServ.mSmall.extWarr"),f=$("div.bBacketServ.mBig.extWarr"),e=$(".hideblock.mGoods.extWarranty");f.is(":visible")&&l.hide();$("a.link_extWarr",n).click(function(){e.show();return!1});$(".close",e).click(function(){e.hide()});e.find("input.button").bind("click",function(){$("input.button",e).hasClass("active")&&$("input.button",e).val("Выбрать").removeClass("active");
$(this).val("Выбрана").addClass("active");var a=$(this).data();console.log("data from extWarr element /");console.log(a);e.fadeOut();$(".ew_title",f).text(a.ewtitle);$(".price",f).text(a.ewprice);l.hide();f.show()})}});
