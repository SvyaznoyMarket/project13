$(document).ready(function(){function T(){function t(e,t,n){for(var r=0,i=e.length;r<i;r++)if(e[r][t]==n)return!0;return!1}function r(e,t,n){var r=[];for(var i=0,s=e.length;i<s;i++)if(e[i][t]==n){for(var o in e[i].intervals)r.push("c "+e[i].intervals[o].start_at+" по "+e[i].intervals[o].end_at);return r}return!1}function i(e){var t=e[0];if(e.length>1)for(var n=1,r=e.length;n<r;n++)e[n][0]>t[0]&&(t[0]=e[n][0]),e[n][1]<t[1]&&(t[1]=e[n][1]);return t}function s(e){var t=new Date(e);if(t.getDay()!==1){var n=t.getDay()?t.getDay()*1-1:6;t.setTime(t.getTime()*1-n*24*60*60*1e3)}return t}function o(e){var t=new Date(e);return t.getDay()!==0&&t.setTime(t.getTime()*1+(7-t.getDay())*24*60*60*1e3),t}function u(e){var t=e.substr(0,4)*1,n=e.substr(5,2)*1,r=e.substr(8,2)*1,i=new Date(t,n-1,r),s=Date.parse(i);return s}function a(e){e.caclDates=[];var n=e.token,a=[];for(var f=0,l=e.itemList().length;f<l;f++){for(var c in e.itemList()[f].deliveries[n].dates)e.itemList()[f].deliveries[n].dates[c].timestamp=u(e.itemList()[f].deliveries[n].dates[c].value);var h=e.itemList()[f].deliveries[n].dates;a.push([h[0],h[h.length-1]])}var p=i(a),d=s(p[0].timestamp),v=o(p[1].timestamp),m=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],g=1;while(d.getTime()*1<=v.getTime()*1){var y={dayOfWeek:m[d.getDay()*1],day:d.getDate()*1,tstamp:d.getTime()*1,week:g,enable:ko.observable(!1)};d.getDay()||g++,e.caclDates.push(y),y=null,d.setTime(d.getTime()*1+864e5)}e.nweeks=g-1;e:for(var b in e.caclDates){var h=[];for(var f=0,l=e.itemList().length;f<l;f++){var n=e.token;h=e.itemList()[f].deliveries[n].dates;if(!t(h,"timestamp",e.caclDates[b].tstamp)){e.caclDates[b].enable(!1);continue e}e.caclDates[b].enable(!0)}e.caclDates[b].intervals=r(h,"timestamp",e.caclDates[b].tstamp)}}function f(t,n,r,i){var s={};s.type=t,s.token=n,s.curWeek=ko.observable(1),s.itemList=ko.observableArray([]);for(var o in r)s.itemList.push(g.items[r[o]]);s.shop=ko.observable(i),a(s),s.chosenDate=ko.observable(0),s.chosenInterval=ko.observable("none"),s.currentIntervals=ko.observableArray([]);var u=0;for(var f in s.caclDates){u++;if(s.caclDates[f].enable()){s.chosenDate(s.caclDates[f].tstamp),s.chosenInterval(s.caclDates[f].intervals[0]);for(var l in s.caclDates[f].intervals)s.currentIntervals.push(s.caclDates[f].intervals[l]);break}u==7&&(u=0,s.curWeek(s.curWeek()+1))}s.dlvrPrice=ko.computed(function(){var e=0,t=this.token;for(var n=0,r=this.itemList().length;n<r;n++){var i=this.itemList()[n].deliveries[t].price;i>e&&(e=i)}return e},s),s.supplied=ko.computed(function(){var e=this.token;for(var t=0,n=this.itemList().length;t<n;t++){var r=this.itemList()[t].deliveries[e].isSupplied;if(r)return r}return r},s),s.totalPrice=ko.computed(function(){var e=0;for(var t=0,n=this.itemList().length;t<n;t++)e+=this.itemList()[t].total;return e+=this.dlvrPrice()*1,e},s),e.dlvrBoxes.push(s)}function l(){e.dlvrBoxes.removeAll();for(var t in g.deliveryTypes)g.deliveryTypes[t].items.length&&f(g.deliveryTypes[t].type,g.deliveryTypes[t].token,g.deliveryTypes[t].items,g.deliveryTypes[t].shop)}function c(){e.shopsInPopup.removeAll();for(var t in g.shops)e.shopsInPopup.push(g.shops[t])}function h(e){var t=new Date(e),n=t.getMonth()+1,r=t.getDate();return t.getFullYear()+"-"+(n>9?n:"0"+n)+"-"+(r>9?r:"0"+r)}var e=this;e.cssForDate=$(".order-delivery_date").css("display"),e.stolenItems=ko.observableArray([]),g.unavailable.length,e.showForm=ko.observable(!1),e.dlvrCourierEnable=ko.observable(!1),e.dlvrShopEnable=ko.observable(!1),e.chosenBox=ko.observable(null),e.step2=ko.observable(!1),e.dlvrBoxes=ko.observableArray([]),l(),e.shopsInPopup=ko.observableArray([]),c(),e.chosenShop=ko.observable(null),e.shopButtonEnable=ko.observable(!1),e.changeWeek=function(e,t,n){if(e>0){if(t.nweeks==t.curWeek())return;t.curWeek(t.curWeek()+1)}if(e<0){if(t.curWeek()==1)return;t.curWeek(t.curWeek()-1)}},e.clickDate=function(e,t,n){if(!t.enable())return;var r=e.chosenDate();e.chosenDate(t.tstamp);var i=e.chosenDate(),s=(i-r)/60/60/24/1e3;typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","Order card","Date changed",s]),e.currentIntervals.removeAll();for(var o in t.intervals)e.currentIntervals.push(t.intervals[o]);$.inArray(e.chosenInterval(),e.currentIntervals())||e.chosenInterval(e.currentIntervals()[0])},e.clickInterval=function(e,t,n){e.chosenInterval(t)},e.deleteItem=function(t,n,r){$.get(n.deleteUrl,function(){toKISS_del={"Checkout Step 1 SKU Quantity":n.quantity,"Checkout Step 1 SKU Total":n.price,"Checkout Step 1 F1 Quantity":n.serviceQ,"Checkout Step 1 Warranty Quantity":n.warrantyQ,"Checkout Step 1 F1 Total":n.total-n.price,"Checkout Step 1 Order Total":t.totalPrice()-n.total},typeof _kmq!="undefined"&&_kmq.push(["set",toKISS_del]),typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","Order card","Item deleted"]),t.itemList.remove(n),t.itemList().length||e.dlvrBoxes.remove(t);e:for(var r in g.deliveryTypes){var i=g.deliveryTypes[r];for(var s=0,o=i.items.length;s<o;s++)if(i.items[s]===n.token){i.items.splice(s,1);break e}}e.dlvrBoxes().length||document.location.reload()})},e.totalSum=ko.computed(function(){var t=0;for(var n=0,r=e.dlvrBoxes().length;n<r;n++)t+=e.dlvrBoxes()[n].totalPrice()*1;return t},this),e.pickCourier=function(){n="standart",l(),e.step2(!0),e.shopButtonEnable(!1);var t={type:"courier",boxQuantity:e.dlvrBoxes().length};PubSub.publish("DeliveryChanged",t)},e.pickShops=function(){n="self",e.step2(!1),e.shopButtonEnable(!0);var t={type:"shops",boxQuantity:e.dlvrBoxes().length};PubSub.publish("DeliveryChanged",t)},e.showShopPopup=function(t,n,r){e.chosenBox(t);var i=[];for(var s=0,o=t.itemList().length;s<o;s++){var u=t.itemList()[s].deliveries;for(var a in u)a.match("self_")&&i.push(a.replace("self_","")*1)}c();for(var s=0;s<e.shopsInPopup().length;)$.inArray(e.shopsInPopup()[s].id,i)===-1?e.shopsInPopup.remove(e.shopsInPopup()[s]):s++},e.showAllShops=function(){e.shopsInPopup.removeAll();for(var t in g.shops)e.shopsInPopup.push(g.shops[t])},e.selectShop=function(t){if(e.step2()){var n=[{shop:e.chosenBox().token.replace("self_",""),items:[]},{shop:t.id,items:[]}];e:for(var r=0,i=e.chosenBox().itemList();r<i.length;){for(var s in i[r].deliveries)if(s==="self_"+t.id){n[1].items.push(i[r].token),e.chosenBox().itemList.remove(i[r]);continue e}n[0].items.push(i[r].token),e.chosenBox().itemList.remove(i[r]),r++}for(var o in n)if(n[o].items.length>0){var u=g.shops[n[o].shop];f("self","self_"+n[o].shop,n[o].items,u)}e.chosenBox().itemList().length||e.dlvrBoxes.remove(e.chosenBox())}else{var a=[{shop:t.id,items:[]}];for(var l in e.dlvrBoxes()){var c=e.dlvrBoxes()[l];for(var r=0;r<c.itemList().length;)"self_"+t.id in c.itemList()[r].deliveries?(c.itemList()[r].deliveries["self_"+t.id].dates.length>1?a[0].items.push(c.itemList()[r].token):a.push({shop:t.id,items:[c.itemList()[r].token]}),c.itemList.remove(c.itemList()[r])):r++}var h={},p=[];for(var l in e.dlvrBoxes()){var c=e.dlvrBoxes()[l];for(var r=0,d=c.itemList();r<d.length;){p=[];for(y in d[r].deliveries)d[r].deliveries[y].token.match("self_")&&p.push(d[r].deliveries[y].token.replace("self_",""));h[d[r].token+""]=p,p.length?c.itemList.remove(c.itemList()[r]):r++}}var n=C(h);for(var v=0,m=a.length;v<m;v++)a[v].items.length>0&&n.push(a[v]);for(var y in n){var u=g.shops[n[y].shop];f("self","self_"+n[y].shop,n[y].items,u)}for(var l=0;l<e.dlvrBoxes().length;)e.dlvrBoxes()[l].itemList().length?l++:e.dlvrBoxes.remove(e.dlvrBoxes()[l]);e.shopButtonEnable(!1);var h={type:"shops",boxQuantity:e.dlvrBoxes().length};for(var l in e.dlvrBoxes())if(e.dlvrBoxes()[l].type==="standart"){h.type="courier";break}PubSub.publish("DeliveryChanged",h)}e.chosenShop(t),e.step2(!0),PubSub.publish("ShopSelected",t)},e.printDate=function(e){var t=new Date(e),n=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];return t.getDate()+" "+n[t.getMonth()]},e.getServerModel=function(){var t={deliveryTypes:{}};for(var n in e.dlvrBoxes()){var r=e.dlvrBoxes()[n],i={id:g.deliveryTypes[r.token].id,token:r.token,type:r.type,date:h(r.chosenDate()),interval:r.chosenInterval().match(/\d{2}:\d{2}/g).join(","),shop:{id:r.token.replace("self_","")}},s=[];for(var o in r.itemList())s.push(r.itemList()[o].token);i.items=s,t.deliveryTypes[r.token+"_"+h(r.chosenDate())+"_"+r.itemList()[0].id]=i}return t},e.showForm(!0);var p=(new Date).getTime(),d=p-startTime;typeof _gaq!="undefined"&&_gaq.push(["_trackTiming","New order","JS response",d]);for(var v in g.deliveryTypes)g.deliveryTypes[v].type==="standart"?e.dlvrCourierEnable(!0):e.dlvrShopEnable(!0);e.dlvrCourierEnable()&&!e.dlvrShopEnable()&&e.pickCourier(),!e.dlvrCourierEnable()&&e.dlvrShopEnable()&&e.pickShops()}function N(e){var t=0,n="none";for(var r in e)e[r].length>t&&(t=e[r].length,n=r);return n}function C(e){var t=[];for(;;){var n={},r=0;for(var i in e)for(var s=0,o=e[i].length;s<o;s++)n[e[i][s]]?n[e[i][s]].push(i):(n[e[i][s]]=[i],r++);if(!r)break;var u=N(n);t.push({shop:u,items:n[u]});for(var i in n[u])e[n[u][i]]=[]}return t}function O(e,t){A++,$("body").delegate('input[name="'+e+'"]',"change",function(){A--,$('input[name="'+e+'"]').removeClass("mRed"),$('input[name="'+e+'"]').prev(".placeholder").removeClass("mRed");var t=$('input[name="'+e+'"]').closest(".bBuyingLine");t.find(".mRed").length||t.find(".bFormError").remove()});var n=$('input[name="'+e+'"]:first');if(n.hasClass("mRed"))return;switch(n.attr("type")){case"text":n.addClass("mRed"),n.prev(".placeholder").addClass("mRed");var r=n.parent().parent();r.find(".bFormError").length||r.append('<span class="bFormError mb10 pt5">'+t+"</span>");break;default:n.addClass("mRed"),n.prev(".placeholder").addClass("mRed"),n.parent().parent().parent().append('<span class="bFormError mb10 pt5">'+t+"</span>")}}function M(e){for(var t in e)O(t,e[t]);A>0&&$.scrollTo(".mRed:first",500)}function P(){var e={};for(var t in MVM.shopsInPopup())e[MVM.shopsInPopup()[t].id]=MVM.shopsInPopup()[t];return e}function B(e){D.html(tmpl("mapInfoBlock",e)),H.id=e.id}function j(e){var t=$(e).parent().find(".shopnum").text(),n=g.shops[t];MVM.selectShop(n)}function F(e,t){MapInterface.ready(e,{yandex:$("#mapInfoBlock"),google:$("#map-info_window-container")});var n=calcMCenter(t),r=function(){window.regionMap.showMarkers(t),window.regionMap.addHandler(".shopchoose",j)};MapInterface.init(n,"mapPopup",r,B)}var e=0,t=0,n=0;$("body").delegate(".bBuyingLine label","click",function(){if($(this).find("input").attr("type")=="radio"){var e=$('.mChecked input[name="'+$(this).find("input").attr("name")+'"]');e.length&&e.each(function(e,t){$(t).parent("label").removeClass("mChecked")}),$(this).addClass("mChecked");return}$(this).find("input").attr("type")=="checkbox"&&$(this).toggleClass("mChecked")}),$("body").delegate(".bBuyingLine input:radio, .bBuyingLine input:checkbox","click",function(e){e.stopPropagation()}),$("body").delegate('input[name="order[payment_method_id]"]',"click",function(){$(".innerType").hide(),$(this).parent().parent().find(".innerType").show()});if($(".orderFinal__certificate").length){var r=$(".cardNumber"),i=$(".cardPin"),s=$("#sertificateFields"),o="/certificate-check",u=function(){function u(){return r.val().replace(/[^0-9]/g,"")}function a(){return i.val().replace(/[^0-9]/g,"")}function f(){return{code:u(),pin:a()}}function l(){return t&&u()!==""&&u().length===14&&a()!==""&&a().length===4?!0:!1}function c(){h("orange","Проверка по номеру карты"),$.post(o,f(),function(e){if(!1 in e)return!1;if(!e.success){var t=typeof e.error!="undefined"?e.error:"ERROR";return h("red",t),!1}h("green",e.data)})}function h(e,r){var i=$(".process").first();i.hasClass("picked")||i.remove();var o={typeNum:e};switch(e){case"orange":o.text=r,t=!1;break;case"red":o.text="Произошла ошибка: "+r,t=!1;break;case"green":"activated"in r?o.text="Карта "+r.code+" на сумму "+r.sum+" активирована!":o.text="Карта "+r.code+" имеет номинал "+r.sum,t=!0}s.after(tmpl(n,o)),typeof r["activated"]!="undefined"&&$(".process").first().addClass("picked")}var e=$("#paymentWithCard").text()*1,t=!1,n="processBlock";return{checkCard:c,setProcessingStatus:h,isActive:l,getCode:u,getPIN:a}}();r.bind("keyup",function(e){if(e.which>=48&&e.which<=57||e.which==8)i.val().length==4&&u.checkCard();else{var t=$(this).val().replace(/\D/g,"");$(this).val(t)}}),i.mask("9999",{completed:u.checkCard,placeholder:"*"})}if($(".bankWrap").length){var a=$(".bankWrap .bSelect").data("value"),f=$(".bankWrap > .creditHref"),l=$(".bankWrap .bSelect"),c=function(){var e=$("option:selected",l).attr("ref");$(".bankWrap .bSelectWrap_eText").text(a[e].name),$('input[name="order[credit_bank_id]"]').val(e),f.find("a").attr("href",a[e].href),f.find("span").text("("+a[e].name+")")};for(var h in a){var p=$("<option>").attr("ref",h).addClass("bSelect_eItem").text(a[h].name);l.append(p)}$("option",l).eq(0).attr("selected","selected"),c(),l.change(c),DirectCredit.init($("#tsCreditCart").data("value"),$("#creditPrice"))}PubSub.subscribe("authorize",function(e,t){$("#order_recipient_first_name").val(t.first_name),$("#order_recipient_last_name").val(t.last_name),$("#order_recipient_phonenumbers").val(t.phonenumber+""),$("#user-block").hide()}),$(".auth-link").bind("click",function(e){e.preventDefault();var t=$(this);$("#login-form, #register-form").data("redirect",!1),$("#auth-block").lightbox_me({centered:!0,onLoad:function(){$("#auth-block").find("input:first").focus()}})}),typeof $.mask!="undefined"&&($("#order_recipient_phonenumbers").mask("(999) 999-99-99"),$("#order_recipient_phonenumbers").val($("#order_recipient_phonenumbers").val()),$.mask.definitions["*"]="[0-9*]",$("#order_sclub_card_number").mask("* ****** ******",{placeholder:"*"}),$("#order_sclub_card_number")[0].getAttribute("value")&&$("#order_sclub_card_number").val($("#order_sclub_card_number")[0].getAttribute("value")),$("#order_sclub_card_number").blur(function(){$(this).val()==="* ****** ******"&&($(this).trigger("unmask").val(""),$(this).focus(function(){$("#order_sclub_card_number").mask("* ****** ******",{placeholder:"*"})}))})),$(".placeholder-input").focus(function(e){var t=$(e.target);t.prev(".placeholder").hasClass("mRed")||t.prev(".placeholder").css("border-color","#FFA901")}).focusout(function(e){var t=$(e.target);t.prev(".placeholder").hasClass("mRed")||t.prev(".placeholder").css("border-color","#DDDDDD")}),$(".placeholder").click(function(e){$(this).next(".placeholder-input").focus()});var d=[];if($("#metrostations").length){d=$("#metrostations").data("name");if($("#order_subway_id").val().length){var v=$("#order_subway_id").val()*1;for(var m in d)d[m].val*1==v&&$("#order_address_metro").val(d[m].label)}}$("#order_address_metro").autocomplete({source:d,appendTo:"#metrostations",minLength:2,select:function(e,t){$("#order_subway_id").val(t.item.val)}}).change(function(){for(var e=0,t=d.length;e<t;e++)if($(this).val()===d[e].label)return!0;$(this).val("")}),window.blockScreen=function(e){$('<img src="/images/ajaxnoti.gif" />').css("display","none").appendTo("body");var t=$("<div>").addClass("noti").html('<div><img src="/images/ajaxnoti.gif" /></br></br> '+e+"</div>");t.appendTo("body"),this.block=function(){t.is(":hidden")&&t.lightbox_me({centered:!0,closeClick:!1,closeEsc:!1})},this.unblock=function(){t.trigger("close")},this.bye=function(){t.find("img").remove()}},Blocker=new blockScreen("Ваш заказ оформляется"),PubSub.subscribe("DeliveryChanged",function(e,t){t.type==="courier"?($("#order-submit").removeClass("disable"),$("#order-form").show(),$("#addressField").show()):($("#addressField").hide(),$("#order-form").hide(),$("#order-submit").addClass("disable")),t.boxQuantity>1?($("#payTypes > div").hide(),$("#payment_method_1-field").show(),$("#payment_method_2-field").show()):$("#payTypes > div").show()}),PubSub.subscribe("ShopSelected",function(e,t){$("#orderMapPopup").trigger("close"),$("#order-form").show(),$("#order-submit").removeClass("disable")});var g=$("#order-delivery_map-data").data("value"),e=0,y=0,b=0,w=0,E=0,S=0;$.each(g.items,function(t,n){e+=n.quantity,y+=n.price,b+=n.total,w+=n.quantity,E+=n.serviceQ,S+=n.warrantyQ});var x={"Checkout Step 1 SKU Quantity":w,"Checkout Step 1 SKU Total":y,"Checkout Step 1 F1 Quantity":E,"Checkout Step 1 Warranty Quantity":S,"Checkout Step 1 F1 Total":b-y,"Checkout Step 1 Order Total":b,"Checkout Step 1 Order Type":"cart order"};typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","New order","Items",e]),typeof _kmq!="undefined"&&_kmq.push(["record","Checkout Step 1",x]);var k=$("#order-form"),L=!1,A=0;$("#order-submit").click(function(r){A=0,r.preventDefault();if(L)return;if($(this).hasClass("disable"))return!1;var i=k.serializeArray(),s=$("#order-validator").data("value");e:for(field in s){if(!k.find('[name="'+field+'"]:visible').length)continue;if(field=="order[recipient_phonenumbers]"){var o=$("#order_recipient_phonenumbers").val();o.length<10&&O(field,"Маловато цифр")}if(field=="order[recipient_email]"){var a=$("#order_recipient_email").val();a.length>0&&a.search("@")==-1&&O(field,"Некорректный e-mail")}for(var f=0,l=i.length;f<l;f++)if(i[f].name==field){i[f].value==""&&field!="order[recipient_email]"&&O(field,s[field]);continue e}O(field,s[field])}if(A>0){$.scrollTo(".mRed:first",500);return}var c=$(this);c.text("Оформляется..."),Blocker.block(),L=!0;var h=k.serializeArray(),p=$('label.mChecked input[name="order[delivery_type_id]"]').val();p||(p=$('input[name="order[delivery_type_id]"]').val()),h.push({name:"order[delivery_type_id]",value:p}),h.push({name:"delivery_map",value:JSON.stringify(MVM.getServerModel())}),typeof u!="undefined"&&u.isActive()&&(h.push({name:"order[card]",value:u.getCode()}),h.push({name:"order[pin]",value:u.getPIN()}));var d=(new Date).getTime();$.ajax({url:k.attr("action"),timeout:12e4,type:"POST",data:h,success:function(r){L=!1;if(!r.success){Blocker.unblock(),c.text("Завершить оформление"),"errors"in r&&M(r.errors);return}Blocker.bye();if(typeof _gaq!="undefined"){for(var i in MVM.getServerModel().deliveryTypes){var s="выбрана "+n+" доставят "+MVM.getServerModel().deliveryTypes[i].type;_gaq.push(["_trackEvent","Order card","Completed",s]),t++}_gaq.push(["_trackEvent","Order complete",t,e]);var o=(new Date).getTime(),u=o-d;_gaq.push(["_trackTiming","Order complete","DB response",u])}var a="8"+$("#order_recipient_phonenumbers").val().replace(/\D/g,""),f=$("#order_recipient_email").val(),l=0;$.each(MVM.dlvrBoxes(),function(e,t){l+=t.dlvrPrice()});var h=0,p=0,v=0,m=0,g=0,y=0;for(var b in MVM.dlvrBoxes()){var w=MVM.dlvrBoxes()[b];for(var i in w.itemList())h+=w.itemList()[i].quantity,p+=w.itemList()[i].price,v+=w.itemList()[i].serviceQ,m+=w.itemList()[i].serviceTotal,g+=w.itemList()[i].warrantyQ,y+=w.itemList()[i].warrantyTotal}var E={"Checkout Complete Order ID":r.orderNumber,"Checkout Complete SKU Quantity":h,"Checkout Complete SKU Total":p,"Checkout Complete F1 Quantity":v,"Checkout Complete F1 Total":m,"Checkout Complete Warranty Quantity":g,"Checkout Complete Warranty Total":y,"Checkout Complete Order Subtotal":p+m+y,"Checkout Complete Delivery Total":parseInt(l),"Checkout Complete Order Total":MVM.totalSum(),"Checkout Complete Order Type":"cart order","Checkout Complete Delivery":n,"Checkout Complete Payment":r.paymentMethodId};if(typeof _kmq!="undefined"&&KM!=="undefined"){_kmq.push(["alias",a,KM.i()]),_kmq.push(["alias",f,KM.i()]),_kmq.push(["identify",a]),_kmq.push(["record","Checkout Complete",E]);for(var b in MVM.dlvrBoxes()){var w=MVM.dlvrBoxes()[b];for(var i in w.itemList()){var S={"Checkout Complete SKU":w.itemList()[i].article,"Checkout Complete SKU Quantity":w.itemList()[i].quantity,"Checkout Complete SKU Price":w.itemList()[i].price,"Checkout Complete F1 Quantity":w.itemList()[i].serviceQ,"Checkout Complete F1 Total":w.itemList()[i].serviceTotal,"Checkout Complete Warranty Quantity":w.itemList()[i].warrantyQ,"Checkout Complete Warranty Total":w.itemList()[i].warrantyTotal,"Checkout Complete Parent category":w.itemList()[i].parent_category,"Checkout Complete Category name":w.itemList()[i].categoty,_t:KM.ts()+b+i,_d:1};_kmq.push(["set",S])}}}typeof yaCounter10503055!="undefined"&&yaCounter10503055.reachGoal("orderscomplete"),"redirect"in r.data&&(window.location=r.data.redirect)},error:function(){c.text("Попробовать еще раз"),Blocker.unblock(),L=!1}})}),MVM=new T,ko.applyBindings(MVM,$("#MVVM")[0]);var _=$("#mapPopup_shopInfo"),D=$("#map-info_window-container");$("#OrderView").delegate(".selectShop","click",function(){return $("#orderMapPopup").lightbox_me({centered:!0,onLoad:function(){$("#mapPopup").empty(),shops=P(),$.isEmptyObject(shops)||F("yandex",shops)}}),!1});var H={timer:null,id:0};_.delegate("li","hover",function(){var e=$(this).attr("ref");H.timer&&clearTimeout(H.timer),e&&e!=H.id&&(H.id=e,H.timer=setTimeout(function(){window.regionMap.showInfobox(e)},350))})});