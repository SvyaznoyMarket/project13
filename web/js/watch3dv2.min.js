var cnvCompatible=document.createElement("canvas").getContext;
function likemovie(c,b,l,j){this.mvblock=$(c);if(!this.mvblock.length)return false;if(!l||l.length!=40||j&&j.length!=40)return false;var b=b?b:{},a=this,n=null,m=null,o=null;this.completenessIntrvl=600;this.rollingIntrvl=400;var i=[500,1200,2500];this.initres=i[0];var e=[1,11,21,31],h=e;this.howmany=40;this.zoom=1;this.imgzoom=0;this.mode="slow";var d=null,q=null,x=null,g=null,w=null,F=[[110,28],[121,28],[132,27],[143,26],[154,25],[165,24],[176,23],[187,21],[198,19],[209,16],[220,13],[209,10],[198,
7],[187,6],[176,5],[165,4],[154,3],[143,2],[132,1],[121,0],[110,0],[99,0],[88,1],[77,2],[66,3],[55,4],[44,5],[33,6],[22,7],[11,10],[0,13],[11,16],[22,19],[33,21],[44,23],[55,24],[66,25],[77,26],[88,27],[99,28]],t=0,p=1,y=1,C=false,k=false;j||(k=true);var G=0,D="roll",z=0,A=0,r={x:0,y:0},u=null,B=true,E=false;this.prefx="ib";for(var s=[],v=0,c=0;c<a.howmany;c++)s[c]=0;this.api=function(){b.zoomer&&(x=$(b.zoomer));q=new loadbar;q.create(b.loadbar?b.loadbar:0);this.makeLite();b.rollindex&&(w=$(b.rollindex));
this.toggle()};this.toggle=function(){if(!b.propriate)return false;for(var a in b.propriate)B?$(b.propriate[a]).show():$(b.propriate[a]).hide();B=!B};this.hideVersions=function(){b&&b.makeLite&&$(b.makeLite).hide();b&&b.makeFull&&$(b.makeFull).hide()};this.makeLite=function(){var f=null;b&&b.makeLite?f=$(b.makeLite):(f=$("<div>").attr("id","ml").html("make lite").appendTo("body"),b.makeLite="#ml");f.css("cursor","pointer").bind({click:function(){a.turnVersion();f.hide();a.makeFull()}})};this.makeFull=
function(){var f=null;b&&b.makeFull?f=$(b.makeFull):(f=$("<div>").attr("id","mf").html("make full").appendTo("body"),b.makeFull="#mf");f.css("cursor","pointer").show().bind({click:function(){a.turnVersion();f.hide()}})};this.rollshift=function(a){a=a-5<0?34+a:a-5;w.css("left",F[a][0]).css("top",F[a][1])};this.manualRollEnable=function(){w.bind({mousedown:function(f){f.preventDefault();a.stopRolling();E=true;w.offset()}});$(document).mousemove(function(f){if(E){var d=f.pageX,f=f.pageY,b=w.offset();
Math.abs(b.left-d)>11&&(mouseIsLeft=b.left>d?true:false,mouseIsTop=b.top>f?true:false,p-1-5<a.howmany/4||p-1-5>=a.howmany/4*3?p-1-5==a.howmany/4*3?(!mouseIsLeft&&!mouseIsTop&&a.nextSrc(1),!mouseIsLeft&&mouseIsTop&&a.nextSrc(-1)):mouseIsLeft?a.nextSrc(-1):a.nextSrc(1):p-1-5==a.howmany/4?(mouseIsLeft&&mouseIsTop&&a.nextSrc(1),mouseIsLeft&&!mouseIsTop&&a.nextSrc(-1)):!mouseIsLeft?a.nextSrc(-1):a.nextSrc(1))}});$(document).mouseup(function(){E=false})};this.breakPreload=function(){clearInterval(m);if(k)for(var f=
0;f<a.howmany;f++)s[f]===1&&(s[f]=0);for(f=h.length;f>0;f--)document.getElementById(a.prefx+h[f-1])&&(document.getElementById(a.prefx+h[f-1]).complete||$("#"+a.prefx+h[f-1]).remove());a.prefx=k?"is":"ib"};this.preloadImages=function(f){if(!k&&$("#"+a.prefx+"1").length)for(var f=[],d=0;f.length<5;d++)s[d]!=2&&f.push(d+1);for(var d=k?l:j,b=$("<div>"),c=0;c<f.length;c++)$("<img>").attr("src",d[f[c]-1]).attr("id",a.prefx+f[c]).appendTo(b).bind("load",function(){a.preloadOnebyone($(this).attr("id").replace(/\D/g,
""))});k?$("#nvis500").append(b):$("#nvis").append(b)};this.preloadOnebyone=function(d){if(k||B)return false;s[d-1]=2;for(var b=0,c=0;c<a.howmany;c++)s[c]==2&&b++;q.update(b/a.howmany*100);if(b==a.howmany){for(b=0;b<a.howmany;b++)e[b]=b+1;a.hideVersions();a.manualRollEnable();a.stop4slides();a.createFrontier();a.mode="medium";a.startRolling(70)}else{v=99;for(b=d;b<a.howmany+d*1;b++)if(!s[b%a.howmany]){v=b%a.howmany;break}v<99&&(s[v]=1,$("<img>").attr("src",j[v]).attr("id",a.prefx+(v*1+1)).appendTo($("#nvis")).bind("load",
function(){a.preloadOnebyone($(this).attr("id").replace(/\D/g,""))}))}};this.checkComplete=function(){for(var d=0,b=0;b<h.length;b++)document.getElementById(a.prefx+h[b]).complete&&d++;k&&q.update((e.length-h.length+d)/a.howmany*100);d==h.length&&(k?a.nextLoad():(clearInterval(m),a.show4slides()))};this.nextLoad=function(){if(e.length==this.howmany)clearInterval(m),this.hideVersions(),this.manualRollEnable(),this.speedupRolling(70);else{switch(e.length){case 4:this.startRolling();h=[6,16,26,36];break;
case 8:h=[3,9,13,19,23,29,33,39];break;case 16:h=[4,8,14,18,24,28,34,38];break;case 24:h=[2,10,12,20,22,30,32,40];break;case 32:h=[5,7,15,17,25,27,35,37]}this.preloadImages(h);e=e.concat(h);e.sort(function(a,d){return a-d})}};this.turnVersion=function(){k=!k;q.update(0);k?(this.stop4slides(),this.breakPreload(),this.preloadImages(h),this.createFrontier(),g.setDimensionProps(i[0]),this.zoom=1,g.zoom=1,g.noZoom(),g.addDrag(),m=setInterval(a.checkComplete,a.completenessIntrvl),e.length>4&&this.startRolling()):
(this.stopRolling(),d.hide(),this.breakPreload(),h=[1,11,21,31],this.preloadImages(h),m=setInterval(a.checkComplete,a.completenessIntrvl),this.getInitSize(),g.setDimensionProps(i[this.zoom-1]),g.zoom=this.zoom,g.addZoom(r),g.addDrag())};this.startRolling=function(d){C=true;if(d)a.rollingIntrvl=d;n=setInterval(function(){a.nextSrc(1)},a.rollingIntrvl)};this.stopRolling=function(){C=false;clearInterval(n)};this.speedupRolling=function(d){a.rollingIntrvl=d;C&&(clearInterval(n),n=setInterval(function(){a.nextSrc(1)},
a.rollingIntrvl))};this.nextSrc=function(b){switch(a.mode){case "medium":var c=0;a:for(;c<e.length;c++)if(e[c]==p){p=!c&&b<0?e[e.length-1]:e[(c+1*b)%e.length];break a}break;case "slow":p==31&&e.length>4?a.mode="medium":p=(p+10)%this.howmany}cnvCompatible&&!k?(d.attr("ref",p),u.clearRect(0,0,2500,2500),u.drawImage(document.getElementById(a.prefx+p),r.x,r.y,i[g.zoom-1],i[g.zoom-1])):(b=k?l:j,a.mvblock.hide(),d.attr("src",b[p-1]),a.mvblock.show());a.rollshift(p-1)};this.show4slides=function(){for(var b=
true;b;)y=(y+10)%a.howmany,document.getElementById(a.prefx+y).complete&&(b=false);d.fadeOut(1E3);setTimeout(function(){d.attr("src",j[y-1])},1E3);d.fadeIn(1E3);o=setTimeout(a.show4slides,3E3)};this.stop4slides=function(){o&&clearTimeout(o)};this.start=function(){z=a.mvblock.innerWidth();A=a.mvblock.innerHeight();$("<div>").hide().attr("id","nvis500").appendTo("body");$("<div>").hide().attr("id","nvis").appendTo("body");this.preloadImages(e);m=setInterval(a.checkComplete,a.completenessIntrvl);a.api();
this.initres=this.getInitSize();var c=k?l[0]:j[0];d=$("<img>").attr({src:c,width:a.initres,height:a.initres}).attr("id","ivn").css({position:"relative",left:Math.round((a.mvblock.innerWidth()-a.initres)/2),top:Math.round((a.mvblock.innerHeight()-a.initres)/2)});d.appendTo(a.mvblock);k&&($(b.makeLite).hide(),d.bind({mousedown:function(a){t=a.pageX},click:function(){a.stopRolling()},dblclick:function(){a.startRolling()}}),g=new gigaimage(d,a.zoom,x,a.rollanddrop))};this.createFrontier=function(){!cnvCompatible||
k?(this.mvblock.die(".cnve"),d.bind({mousedown:function(a){t=a.pageX},click:function(){a.stopRolling()},dblclick:function(){a.startRolling()}}),this.mvblock.css("text-align","left"),g=new gigaimage(d,a.zoom,x,a.rollanddrop),g.addZoom(),$(window).resize(function(){a.zoom==1&&d.css("left",Math.round((a.mvblock.innerWidth()-a.initres)/2)).css("top",Math.round((a.mvblock.innerHeight()-a.initres)/2))})):($("#ivn").remove(),g&&g.destroy(),d=$("<canvas>").attr({id:"ivn",width:z,height:A}),d.appendTo(this.mvblock),
u=document.getElementById("ivn").getContext("2d"),u.drawImage(document.getElementById(a.prefx+"1"),Math.round((z-a.initres)/2),Math.round((A-a.initres)/2),a.initres,a.initres),r={x:Math.round((z-a.initres)/2),y:Math.round((A-a.initres)/2)},this.mvblock.live({"mousedown.cnve":function(a){t=a.pageX},"click.cnve":function(){a.stopRolling()},"dblclick.cnve":function(){a.startRolling()}}),g=new gigaimage(d,a.zoom,x,a.rollanddrop),g.addZoom(r),$(window).resize(function(){document.getElementById("ivn").width=
a.mvblock.innerWidth();document.getElementById("ivn").height=a.mvblock.innerHeight()}))};this.hide=function(){$(d).hide();e.length!=this.howmany&&this.breakPreload();k||e.length==this.howmany?this.stopRolling():this.stop4slides();this.toggle()};this.show=function(){$(d).show();k&&g.addZoom(r);g.addDrag();e.length!=this.howmany&&(this.preloadImages(h),k&&(m=setInterval(a.checkComplete,a.completenessIntrvl)));k||e.length==this.howmany?this.startRolling():this.show4slides();this.toggle()};this.rollanddrop=
function(b,c,h){G!=h&&(G=h,D=Math.abs(c.x)>Math.abs(c.y)?"roll":"drop");D=="roll"&&Math.abs(b.pageX-t)>20*g.zoom?(c=b.pageX-t>0?1:-1,t=b.pageX,a.nextSrc(c)):D=="drop"&&(!cnvCompatible||k?(b=parseInt(d.css("top"),10),d.css("top",c.y+b)):(r.y+=c.y,u.clearRect(0,0,2500,2500),u.drawImage(document.getElementById(a.prefx+p),r.x,r.y,i[g.zoom-1],i[g.zoom-1])))};this.getInitSize=function(){if(k)this.zoom=1;else{var a=$(window).width();this.zoom=a<1030?1:a<1590?2:3}return this.imgzoom=i[this.zoom-1]}}
function gigaimage(c,b,l,j){var a=this,n=c[0].tagName=="CANVAS",m=false,o=[500,1200,2500],i=0,e=null;this.zoom=b;l&&(e=new zoomer(l,a));if(cnvCompatible&&n)var h=document.getElementById(c.attr("id")).getContext("2d");this.cursorHand=function(){c.css("cursor","url(/css/skin/cursor/cursor_1.png), url(/css/skin/cursor/cursor_1.gif), url(/css/skin/cursor/cursor_ie_1.cur), crosshair")};a.cursorHand();this.cursorDrag=function(){c.css("cursor","url(/css/skin/cursor/cursor_2.png), url(/css/skin/cursor/cursor_2.gif), url(/css/skin/cursor/cursor_ie_2.cur), move")};
this.setDimensionProps=function(b){b=b?b:o[a.zoom-1];c.attr("width",b).attr("height",b).css("left",Math.round((c.parent().innerWidth()-b)/2)).css("top",Math.round(($("body").height()-60-b)/2))};(!cnvCompatible||!n)&&this.setDimensionProps();this.zoomIn=function(){var a=c.parent(),b=a.offset();this.fixzoom(1,Math.round(a.width()/2)+b.left,Math.round($("#bigpopup").height()/2)+b.top)};this.zoomOut=function(){var a=c.parent(),b=a.offset();this.fixzoom(-1,Math.round(a.width()/2)+b.left,Math.round($("#bigpopup").height()/
2)+b.top)};c.parent();this.fixzoom=function(b,q,i){var g=this.zoom;if(!(a.zoom==1&&b<0||a.zoom==3&&b>0)){b>0?a.zoom++:a.zoom--;b/=Math.abs(b);g=o[a.zoom-1]/o[g-1];if(!cnvCompatible||!n){var j=c.parent().offset(),l=parseInt(c.css("left"),10),m=parseInt(c.css("top"),10);q-=j.left+l;i-=j.top+m;l-=b*Math.abs(Math.round(q*(1-g)));m-=b*Math.abs(Math.round(i*(1-g)));c.attr("width",o[a.zoom-1]).attr("height",o[a.zoom-1]).css({left:l,top:m})}else j=c.parent().offset(),q-=j.left+cnvimg.x,i-=j.top+cnvimg.y,
cnvimg.x-=b*Math.abs(Math.round(q*(1-g))),cnvimg.y-=b*Math.abs(Math.round(i*(1-g))),q=c.attr("ref"),h.clearRect(0,0,2500,2500),h.drawImage(document.getElementById(lkmv.prefx+q),cnvimg.x,cnvimg.y,o[a.zoom-1],o[a.zoom-1]);e&&(b>0?e.plus():e.minus())}};this.addZoom=function(b){cnvimg=b;c.bind({mousewheel:function(b,c){b.preventDefault();a.fixzoom(c,b.pageX,b.pageY)}});e.show()};this.noZoom=function(){c.unbind("mousewheel");e.hide()};this.addDrag=function(){function b(c){init={pageX:c.pageX,pageY:c.pageY};
i=c.timeStamp;m=true;a.cursorDrag()}c.bind({mousedown:function(a){a.preventDefault();b(a)}});typeof window.addEventListener!=="undefined"&&(c[0].addEventListener("touchstart",function(a){a.preventDefault();b(a)},false),c[0].addEventListener("touchmove",function(b){if(m)b.preventDefault(),a.action(b,{x:b.pageX-init.pageX,y:b.pageY-init.pageY},i,a.zoom),init.pageX=b.pageX,init.pageY=b.pageY},false),c[0].addEventListener("touchend",function(){m=false;a.cursorHand()},false))};this.addDrag();$(document).bind("mousemove.zoomer",
function(b){if(m)b.preventDefault(),a.action(b,{x:b.pageX-init.pageX,y:b.pageY-init.pageY},i,a.zoom),init.pageX=b.pageX,init.pageY=b.pageY});$(document).bind("mouseup.zoomer",function(){m=false;a.cursorHand()});this.dropping=function(a,b){var h=parseInt(c.css("left"),10),e=parseInt(c.css("top"),10);c.css("top",b.y+e).css("left",b.x+h)};this.action=j?j:this.dropping;this.destroy=function(){c.unbind("mousedown");c.unbind("mousewheel");c.unbind("touchstart");c.unbind("touchmove");c.unbind("touchend");
c.remove();$(document).unbind(".zoomer");for(var b in this)delete this[b];a=null}}function loadbar(){this.percentage=0;var c=null;this.create=function(b){b?c=$(b):(c=$("<div>").attr("id","loadbar").html("0%"),c.appendTo("body"));return c};this.update=function(b){this.percentage=b?Math.round(b):0;c.html(this.percentage+"%");this.percentage==100&&this.destroy()};this.destroy=function(){setTimeout(function(){c.fadeOut("slow")},2E3)}}
function zoomer(c,b){if(!c)return false;var l=$(".zoomind",c),j=false,a=[54,28,-2],n=function(b){return b<a[2]+6?1:b<a[1]-4?2:b<a[1]+4?3:b<a[0]-6?4:5},m=l.parent().offset().top,o=3,i=3,e=[5,3,1];l.css("top",a[b.zoom-1]);this.hide=function(){c.hide()};this.show=function(){c.show()};$("b.plus",c).bind("click",function(){b.zoomIn&&b.zoomIn()});$("b.minus",c).bind("click",function(){b.zoomOut&&b.zoomOut()});l.bind({mousedown:function(a){j=true;a.preventDefault();a.stopPropagation()},mouseup:function(){j=
false}});$("b.zoomind",c).parent().bind({mousemove:function(a){if(j&&(a.preventDefault(),a.stopPropagation(),a=a.pageY-m-3,a<55&&a>-3)){l.css("top",a);var c=o-n(a);Math.abs(c)&&n(a)!=i&&n(a)%2&&(n(a)-i<0?b.zoomIn():b.zoomOut(),i=n(a));Math.abs(c)==2?(c<0?b.zoomIn():b.zoomOut(),i=n(a)):Math.abs(c)>=3&&(c<0?(b.zoomIn(),b.zoomIn()):(b.zoomOut(),b.zoomOut()),i=n(a));o=n(a)}},mouseleave:function(){}});this.minus=function(){j||(l.css("top",a[b.zoom-1]),i=e[b.zoom-1],o=e[b.zoom-1])};this.plus=function(){j||
(l.css("top",a[b.zoom-1]),i=e[b.zoom-1],o=e[b.zoom-1])}};
