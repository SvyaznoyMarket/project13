$(function(){function n(e,t){var n=parseInt(e.prop("class").replace(/\D/g,""));t.find("div.current").width(n*30).html(n),t.find("div:last").text(e.attr("title")),t.find("input").val(n)}function r(e,t){t||($("#auth-link").length&&($("#auth-block").length&&$("#auth-block h2").text("Чтобы оставить отзыв, авторизуйтесь!"),$("#auth-link").trigger("click")),$("#rating_form").bind("submit.access",function(e){$("#auth-link").trigger("click"),e.preventDefault()}))}var e=$(".filter .filterlink:first"),t=$(".filter .filterlist");e.mouseenter(function(){e.hide(),t.show()}),t.mouseleave(function(){t.hide(),e.show()}),$(".sharebox .sharelink").mouseenter(function(){$(this).next().show()}),$(".sharebox .sharelist").mouseleave(function(){$(this).hide()}),$(".subcomments-trigger").click(function(){$(this).toggleClass("commentlinkopen commentlink"),$(this).next().toggle()}),$(".subcomments-add-trigger").click(function(){$(this).next().toggle()}),$(".addcomment form").submit(function(e){e.preventDefault();var t=$(this),n=t.parent().parent(),r=n.find(".subcomments-trigger"),i=parseInt(r.html().replace(/Комментарии \((\d+)\)/,"$1"));return $.post(t.prop("action"),t.serializeArray(),function(e){var s=['<div class="answer">','<div class="answerleft">','<div class="avatar">.....&nbsp;&nbsp;<img src="/css/skin/img/avatar.png" alt="" width="54" height="54" /></div>',e.data.user_name,"<br/>",'<span class="gray">',e.data.created_at,"</span>","</div>",'<div class="answerright">',e.data.content,"</div>","</div>"];t.find("textarea").val(""),r.html("Комментарии ("+(i+1)+")"),n.find(".commentanswer").append(s.join("")),n.find(".subcomments-add-trigger").click()},"json"),!1}),$("div.ratingscale").each(function(){var e=$(this);e.delegate("a","click",function(){n($(this),e.parent())})}),$("div.ratingbox").delegate("a","click",function(){var e=$("div.ratingbig").parent();n($(this),e)});var i=PubSub.subscribe("auth try",r);$("#rating_form").bind("submit.check",function(e){var t=$("<div>").css({color:"red",clear:"both"});$(this).find(".ratingvalue").val()*1==0&&($(this).find(".ratingresult").after(t.clone().text("Укажите свою оценку")),e.preventDefault()),$(this).find("[name=content_resume]").val()===""&&($(this).find("[name=content_resume]").after(t.clone().text("Заполните поле")),e.preventDefault())})});