$(function(){function f(a,b){var c=parseInt(a.prop("class").replace(/\D/g,""));b.find("div.current").width(30*c).html(c);b.find("div:last").text(a.attr("title"));b.find("input").val(c)}var d=$(".filter .filterlink:first"),e=$(".filter .filterlist");d.mouseenter(function(){d.hide();e.show()});e.mouseleave(function(){e.hide();d.show()});$(".sharebox .sharelink").mouseenter(function(){$(this).next().show()});$(".sharebox .sharelist").mouseleave(function(){$(this).hide()});$(".subcomments-trigger").click(function(){$(this).toggleClass("commentlinkopen commentlink");
$(this).next().toggle()});$(".subcomments-add-trigger").click(function(){$(this).next().toggle()});$(".addcomment form").submit(function(a){a.preventDefault();var b=$(this),c=b.parent().parent(),d=c.find(".subcomments-trigger"),e=parseInt(d.html().replace(/Комментарии \((\d+)\)/,"$1"));$.post(b.prop("action"),b.serializeArray(),function(a){a=['<div class="answer">','<div class="answerleft">','<div class="avatar">.....&nbsp;&nbsp;<img src="/css/skin/img/avatar.png" alt="" width="54" height="54" /></div>',
a.data.user_name,"<br/>",'<span class="gray">',a.data.created_at,"</span>","</div>",'<div class="answerright">',a.data.content,"</div>","</div>"];b.find("textarea").val("");d.html("Комментарии ("+(e+1)+")");c.find(".commentanswer").append(a.join(""));c.find(".subcomments-add-trigger").click()},"json");return!1});$("div.ratingscale").each(function(){var a=$(this);a.delegate("a","click",function(){f($(this),a.parent())})});$("div.ratingbox").delegate("a","click",function(){var a=$("div.ratingbig").parent();
f($(this),a)});PubSub.subscribe("auth try",function(a,b){b||($("#auth-link").length&&($("#auth-block").length&&$("#auth-block h2").text("Чтобы оставить отзыв, авторизуйтесь!"),$("#auth-link").trigger("click")),$("#rating_form").bind("submit.access",function(a){$("#auth-link").trigger("click");a.preventDefault()}))});$("#rating_form").bind("submit.check",function(a){var b=$("<div>").css({color:"red",clear:"both"});0==1*$(this).find(".ratingvalue").val()&&($(this).find(".ratingresult").after(b.clone().text("Укажите свою оценку")),
a.preventDefault());""===$(this).find("[name=content_resume]").val()&&($(this).find("[name=content_resume]").after(b.clone().text("Заполните поле")),a.preventDefault())})});
