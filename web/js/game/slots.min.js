!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){function b(a){if(a in l.style)return a;for(var b=["Moz","Webkit","O","ms"],c=a.charAt(0).toUpperCase()+a.substr(1),d=0;d<b.length;++d){var e=b[d]+c;if(e in l.style)return e}}function c(){return l.style[m.transform]="",l.style[m.transform]="rotateY(90deg)",""!==l.style[m.transform]}function d(a){return"string"==typeof a&&this.parse(a),this}function e(a,b,c){b===!0?a.queue(c):b?a.queue(b,c):a.each(function(){c.call(this)})}function f(b){var c=[];return a.each(b,function(b){b=a.camelCase(b),b=a.transit.propertyMap[b]||a.cssProps[b]||b,b=i(b),m[b]&&(b=i(m[b])),-1===a.inArray(b,c)&&c.push(b)}),c}function g(b,c,d,e){var g=f(b);a.cssEase[d]&&(d=a.cssEase[d]);var h=""+k(c)+" "+d;parseInt(e,10)>0&&(h+=" "+k(e));var i=[];return a.each(g,function(a,b){i.push(b+" "+h)}),i.join(", ")}function h(b,c){c||(a.cssNumber[b]=!0),a.transit.propertyMap[b]=m.transform,a.cssHooks[b]={get:function(c){var d=a(c).css("transit:transform");return d.get(b)},set:function(c,d){var e=a(c).css("transit:transform");e.setFromString(b,d),a(c).css({"transit:transform":e})}}}function i(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function j(a,b){return"string"!=typeof a||a.match(/^[\-0-9\.]+$/)?""+a+b:a}function k(b){var c=b;return"string"!=typeof c||c.match(/^[\-0-9\.]+/)||(c=a.fx.speeds[c]||a.fx.speeds._default),j(c,"ms")}a.transit={version:"0.9.11",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var l=document.createElement("div"),m={},n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;m.transition=b("transition"),m.transitionDelay=b("transitionDelay"),m.transform=b("transform"),m.transformOrigin=b("transformOrigin"),m.filter=b("Filter"),m.transform3d=c();var o={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},p=m.transitionEnd=o[m.transition]||null;for(var q in m)m.hasOwnProperty(q)&&"undefined"==typeof a.support[q]&&(a.support[q]=m[q]);return l=null,a.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeInCubic:"cubic-bezier(.550,.055,.675,.190)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},a.cssHooks["transit:transform"]={get:function(b){return a(b).data("transform")||new d},set:function(b,c){var e=c;e instanceof d||(e=new d(e)),b.style[m.transform]="WebkitTransform"!==m.transform||n?e.toString():e.toString(!0),a(b).data("transform",e)}},a.cssHooks.transform={set:a.cssHooks["transit:transform"].set},a.cssHooks.filter={get:function(a){return a.style[m.filter]},set:function(a,b){a.style[m.filter]=b}},a.fn.jquery<"1.8"&&(a.cssHooks.transformOrigin={get:function(a){return a.style[m.transformOrigin]},set:function(a,b){a.style[m.transformOrigin]=b}},a.cssHooks.transition={get:function(a){return a.style[m.transition]},set:function(a,b){a.style[m.transition]=b}}),h("scale"),h("scaleX"),h("scaleY"),h("translate"),h("rotate"),h("rotateX"),h("rotateY"),h("rotate3d"),h("perspective"),h("skewX"),h("skewY"),h("x",!0),h("y",!0),d.prototype={setFromString:function(a,b){var c="string"==typeof b?b.split(","):b.constructor===Array?b:[b];c.unshift(a),d.prototype.set.apply(this,c)},set:function(a){var b=Array.prototype.slice.apply(arguments,[1]);this.setter[a]?this.setter[a].apply(this,b):this[a]=b.join(",")},get:function(a){return this.getter[a]?this.getter[a].apply(this):this[a]||0},setter:{rotate:function(a){this.rotate=j(a,"deg")},rotateX:function(a){this.rotateX=j(a,"deg")},rotateY:function(a){this.rotateY=j(a,"deg")},scale:function(a,b){void 0===b&&(b=a),this.scale=a+","+b},skewX:function(a){this.skewX=j(a,"deg")},skewY:function(a){this.skewY=j(a,"deg")},perspective:function(a){this.perspective=j(a,"px")},x:function(a){this.set("translate",a,null)},y:function(a){this.set("translate",null,a)},translate:function(a,b){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==a&&void 0!==a&&(this._translateX=j(a,"px")),null!==b&&void 0!==b&&(this._translateY=j(b,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var a=(this.scale||"1,1").split(",");return a[0]&&(a[0]=parseFloat(a[0])),a[1]&&(a[1]=parseFloat(a[1])),a[0]===a[1]?a[0]:a},rotate3d:function(){for(var a=(this.rotate3d||"0,0,0,0deg").split(","),b=0;3>=b;++b)a[b]&&(a[b]=parseFloat(a[b]));return a[3]&&(a[3]=j(a[3],"deg")),a}},parse:function(a){var b=this;a.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(a,c,d){b.setFromString(c,d)})},toString:function(a){var b=[];for(var c in this)if(this.hasOwnProperty(c)){if(!m.transform3d&&("rotateX"===c||"rotateY"===c||"perspective"===c||"transformOrigin"===c))continue;"_"!==c[0]&&b.push(a&&"scale"===c?c+"3d("+this[c]+",1)":a&&"translate"===c?c+"3d("+this[c]+",0)":c+"("+this[c]+")")}return b.join(" ")}},a.fn.transition=a.fn.transit=function(b,c,d,f){var h=this,i=0,j=!0,l=jQuery.extend(!0,{},b);"function"==typeof c&&(f=c,c=void 0),"object"==typeof c&&(d=c.easing,i=c.delay||0,j="undefined"==typeof c.queue?!0:c.queue,f=c.complete,c=c.duration),"function"==typeof d&&(f=d,d=void 0),"undefined"!=typeof l.easing&&(d=l.easing,delete l.easing),"undefined"!=typeof l.duration&&(c=l.duration,delete l.duration),"undefined"!=typeof l.complete&&(f=l.complete,delete l.complete),"undefined"!=typeof l.queue&&(j=l.queue,delete l.queue),"undefined"!=typeof l.delay&&(i=l.delay,delete l.delay),"undefined"==typeof c&&(c=a.fx.speeds._default),"undefined"==typeof d&&(d=a.cssEase._default),c=k(c);var n=g(l,c,d,i),o=a.transit.enabled&&m.transition,q=o?parseInt(c,10)+parseInt(i,10):0;if(0===q){var r=function(a){h.css(l),f&&f.apply(h),a&&a()};return e(h,j,r),h}var s={},t=function(c){var d=!1,e=function(){d&&h.unbind(p,e),q>0&&h.each(function(){this.style[m.transition]=s[this]||null}),"function"==typeof f&&f.apply(h),"function"==typeof c&&c()};q>0&&p&&a.transit.useTransitionEnd?(d=!0,h.bind(p,e)):window.setTimeout(e,q),h.each(function(){q>0&&(this.style[m.transition]=n),a(this).css(b)})},u=function(a){this.offsetWidth,t(a)};return e(h,j,u),this},a.transit.getTransitionValue=g,a}),$.fn.slots=function(a,b){a||(a={labels:{messageBox:{demo:["!!! играйте на скидку !!!","Это просто текст","Внезапный текст"],win:["!!! выигрышь !!!","ДЖЕКПОТ!!!!!","Мама мыла раму"],nowin:["ничего не вышло {tryRemain}","то ли еще будет {tryRemain}","попробуйте еще {tryRemain}","осталось {tryRemain} попыток"],spinning:["трах тиби дох","абра кадабра","кручу верчу"]},notAvailable:{message:"Автомат временно не работает. Приходите завтра",optionPrize:"Утешительный приз",optionRemind:"Напомнить мне"}},handlers:{userUnauthorized:function(a){alert("userUnauthorized: "+a)}},api_url:{init:location.origin+"/init",play:"/play",img_led_off:"/img/slot_led_off.png"},userAutoPlay:!1}),String.prototype.format=function(a){if(!a)return this.toString();var b=this;return b.replace(String.prototype.format.regex,function(b){var c=b.substring(1,b.length-1);return a[c]?a[c]:""})},String.prototype.format.regex=new RegExp("{-?[0-9A-z]*}","g"),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}();var c=this;return c.slotMachine={canvas:null,context:null,maxX:null,maxY:null,lamps:[],lamps2:[],isStopped:!1,slot_config:a,options:{type:"random",speed:3,n:0,m:0,color:"58,209,255"},reels:c.find("#reelsWrapper .chips"),$notAvailableMessageText:c.find("#notAvailable .message"),$notAvailablePrizeText:c.find("#notAvailable .option.prize"),$notAvailableRemindText:c.find("#notAvailable .option.remind"),$slotMachine:c.find("#slotsMachine"),$winChipContainerChip:c.find("#winContainer .chip"),$winContainer:c.find("#winContainer"),$lb_overlay:c.find(".lbOverlay"),initialize:function(){var d=this;d.slot_config=a,d.config=b?b:{},d.renderMarkup(),d.$winChipContainerChip.click(function(){c.find(".winChip").removeClass("winChip"),c.find(".lbOverlay").hide(),c.find("#winContainer").hide().removeClass("winner bigwinner"),d.setLedPanelOptions("default"),d.messageBox.stopAnimation(),d.messageBox.setRandomText("demo"),d.messageBox.animateText("defaultAnimation")}),setTimeout(function(){c.find("#slotsBack").css("top",$("#slotsWrapper").offset().top+"px").show()},1e3),d.config.isAvailable?(d.initLedPanel(),d.messageBox.init()):d.notAvailableState(),d.send({type:"GET",url:d.slot_config.api_url.init,data:{},cb:function(a){a.success?(d.game.init(a.reels),d.game.bindAll(),d.demoMode=!a.user):d.notAvailableState(a.error)},err:function(){d.notAvailableState()}})},send:function(a){var b=this;a.data.t=(new Date).getTime(),$.ajax({type:a.type,url:a.url,data:a.data,success:function(c){return!c.success&&c.error?(b.slot_config.handlers[c.error.code]&&b.slot_config.handlers[c.error.code](c.error),clearTimeout(b.spinningTimeout),b.ledAnimations.animationHandler.stopAnimation(),void b.stopReels()):void(a.cb&&a.cb(c))},error:function(){a.err&&a.err()}})},notAvailableState:function(){var a=this;a.ledAnimations.animationHandler.stopAnimation(),a.$notAvailableMessageText.text(a.slot_config.labels.notAvailable.message),a.$notAvailablePrizeText.text(a.slot_config.labels.notAvailable.optionPrize),a.$notAvailableRemindText.text(a.slot_config.labels.notAvailable.optionRemind),a.$slotMachine.addClass("notavailable"),a.messageBox.stopAnimation()},renderMarkup:function(){c.append('<div class="lbOverlay" style="display:none;height: 100%; position: fixed; width: 100%; top: 0px; left: 0px; z-index: 1001; opacity: 0.4; background: black;"></div>'),c.append('<div id="slotsBack"></div>'),c.append('<div id="slotsWrapper"> <div id="slotsMachine"> <div id="slotsGame"> <div id="slotsHeader"></div> <div id="notAvailable"> <div class="message"></div> <a href="#" class="option prize"></a> <a href="#" class="option remind"></a> <div class="plast br"></div> <div class="plast bl"></div> <div class="plast tr"></div> <div class="plast tl"></div> </div> <div id="slotsMessageBox"> <div id="slotsMessageReel"> <div id="messages" class="messageRow"></div> <div id="pixelOverlay"></div> </div> </div> <div id="reelsWrapper"> <div id="reel1" class="reel"> <div class="chips "> </div> <div class="slot-shadow-overlay overlay-top"></div> <div class="slot-shadow-overlay overlay-bottom"></div> </div> <div id="reel2" class="reel"> <div class="chips"> </div> <div class="slot-shadow-overlay overlay-top"></div> <div class="slot-shadow-overlay overlay-bottom"></div> </div> <div id="reel3" class="reel"> <div class="chips"> </div> <div class="slot-shadow-overlay overlay-top"></div> <div class="slot-shadow-overlay overlay-bottom"></div> </div> </div> <div id="winContainer" class=""> <div class="tile"> <div class="rulesText"> Фишка со скидкой <strong class="dicount">10 %</strong> на <strong class="category"><a target="_blank" style="text-decoration: underline;" href="/catalog/children">Детские товары</a></strong><br> Минимальная сумма заказа 499 руб<br> Действует c 28.05.2014 по 30.06.2014 </div> </div> <div class="confetil"></div> <div class="blue_shine"></div> <div class="shine"></div> <div class="chip "> <div class="border lime"> <div class="cuponImg__inner"> <div class="cuponIco"> <img src="http://content.enter.ru/wp-content/uploads/2014/03/kids.png"> </div> <div class="cuponDesc">Детские товары</div> <div class="cuponPrice">15% </div> </div> </div> </div> <div class=""></div> </div> <canvas height="388" width="588" id="canvas"></canvas> <div id="buttonsRow" class="toplay"> <div class="play btn_wrapper"> <div class="step_dots"> <div class="reel_dot first on"></div> <div class="reel_dot second on"></div> <div class="reel_dot third on"></div> </div> <div class="button">Играть</div> </div> <div class="stop btn_wrapper"> <div class="step_dots"> <div class="reel_dot first"></div> <div class="reel_dot second"></div> <div class="reel_dot third"></div> </div> <div class="button">Стоп</div> </div> </div> </div> </div> <div id="slotsBottomLine"></div> </div>'),this.canvas=document.getElementById("canvas"),this.context=canvas.getContext("2d"),this.reels=c.find("#reelsWrapper .chips"),this.$notAvailableMessageText=c.find("#notAvailable .message"),this.$notAvailablePrizeText=c.find("#notAvailable .option.prize"),this.$notAvailableRemindText=c.find("#notAvailable .option.remind"),this.$slotMachine=c.find("#slotsMachine"),this.$winChipContainerChip=c.find("#winContainer .chip"),this.$winContainer=c.find("#winContainer"),this.$lb_overlay=c.find(".lbOverlay")},game:{reelStoped:!1,inGame:!1,init:function(a){for(var b=this,d=0;d<a.length;d++){c.find("#reel"+(d+1)+" .chips").html("");for(var e=0;e<a[d].length;e++){var f=a[d][e];c.find("#reel"+(d+1)+" .chips").append('<div class="chip"> <span class="border " style="background-image: url('+f.background+');  background-position: center; background-repeat: no-repeat; background-size: 100%; "> <span class="cuponImg__inner"> <span class="cuponIco"> <img src="'+f.icon+'"> </span> <span class="cuponDesc">'+f.label+'</span> <span class="cuponPrice">'+f.value+"</span> </span> </span> </div>")}}c.slotMachine.reels.addClass("spinning"),c.slotMachine.config.userAutoPlay&&(c.slotMachine.spinningTimeout=setTimeout(function(){b.start()},3e4))},bindAll:function(){var a=this;a.buttonsRow=c.find("#buttonsRow"),a.play_button=a.buttonsRow.find(".play .button"),a.stop_button=a.buttonsRow.find(".stop .button"),a.play_button.click(function(){a.inGame||(a.start(),a.buttonsRow.removeClass("toplay").addClass("stopplay"))}),a.stop_button.click(function(){a.stop(a)})},start:function(){var a=c.slotMachine,b=this;b.inGame=!0,a.setLedPanelOptions("spining"),a.ledAnimations.animationHandler.startAnimation(),c.find(".winChip").removeClass("winChip"),a.reels.addClass("spinning"),a.messageBox.stopAnimation(),a.messageBox.setRandomText("spinning"),a.messageBox.animateText("spiningAnimation"),clearTimeout(a.spinningTimeout),a.spinningTimeout=setTimeout(function(){b.stopAll(),clearTimeout(a.spinningTimeout),a.spinningTimeout=null},a.config.game.maxTimeSpinning),b.result=null,a.send({type:"GET",url:a.slot_config.api_url.play,data:{},cb:function(d){if(!d.success&&!d.result)return void(a.slot_config.handlers[r.error.code]?a.slot_config.handlers[r.error.code](r.error):a.notAvailableState(r.error));if(d.spin&&!d.spin.isAvailable)return void a.notAvailableState();b.result=d.result,b.user=d.user;var e=c.find(a.reels[0]).find(".chip:nth-child(2)"),f=c.find(a.reels[1]).find(".chip:nth-child(2)"),g=c.find(a.reels[2]).find(".chip:nth-child(2)"),h=c.find("#winContainer .chip"),i=d.result.line;e.find(".border").attr("style","background-image: url("+i[0].background+");  background-position: center; background-repeat: no-repeat; background-size: 100%; "),f.find(".border").attr("style","background-image: url("+i[1].background+");  background-position: center; background-repeat: no-repeat; background-size: 100%; "),g.find(".border").attr("style","background-image: url("+i[2].background+");  background-position: center; background-repeat: no-repeat; background-size: 100%; "),h.find(".border").attr("style","background-image: url("+i[1].background+");  background-position: center; background-repeat: no-repeat; background-size: 100%; "),e.find(".cuponPrice").text(i[0].value),f.find(".cuponPrice").text(i[1].value),g.find(".cuponPrice").text(i[2].value),h.find(".cuponPrice").text(i[1].value),e.find(".cuponIco img").attr("src",i[0].icon),f.find(".cuponIco img").attr("src",i[1].icon),g.find(".cuponIco img").attr("src",i[2].icon),h.find(".cuponIco img").attr("src",i[1].icon),e.find(".cuponDesc").text(i[0].label),f.find(".cuponDesc").text(i[1].label),g.find(".cuponDesc").text(i[2].label),h.find(".cuponDesc").text(i[1].label)},err:function(){a.notAvailableState()}})},stopAll:function(){var a=c.slotMachine,b=this;a.stopReels(),b.buttonsRow.removeClass("stopplay").addClass("toplay"),a.config.game.usedUserAttempts++,b.isWin()},stop:function(a){var b=c.slotMachine;a.reelStoped===!1?a.reelStoped=0:a.reelStoped++,b.stopReelSpin($(b.reels[a.reelStoped])),$(a.buttonsRow.find(".stop .reel_dot")[a.reelStoped]).addClass("on"),2==a.reelStoped&&(a.stopAll(),clearTimeout(b.spinningTimeout),a.reelStoped=!1,a.buttonsRow.find(".stop .reel_dot").removeClass("on"))},isWin:function(){var a=c.slotMachine,b=this;b.result?b.result.prizes?setTimeout(function(){a.ledAnimations.stopAnimation(500),a.setLedPanelOptions("stop"),a.ledAnimations.animationHandler.startAnimation(),a.messageBox.stopAnimation(),a.messageBox.animateText("winAnimation"),b.buttonsRow.find(".stop .reel_dot").removeClass("on"),a["regular"==b.result.prizes.type?"winChipAnimation":"winBigChipAnimation"](b.result.prizes.message)},50):(b.buttonsRow.find(".stop .reel_dot").removeClass("on"),a.ledAnimations.stopAnimation(500),a.setLedPanelOptions("stop"),a.ledAnimations.animationHandler.startAnimation(),a.messageBox.stopAnimation(),a.messageBox.animateText("loseAnimation"),a.messageBox.setRandomText("nowin",null,b.user),b.inGame=!1):a.notAvailableState()}},setLedPanelOptions:function(a){var b=this,c=b.config.ledPanel[a+"Animation"];b.options.type=c[0].type,b.options.speed=c[0].speed,b.options.n=c[0].n,b.options.m=c[0].m,b.options.color=c[0].color},initLedPanel:function(){this.setLedPanelOptions("default"),this.ledAnimations.initLampArrays()},ledAnimations:{currentAnimation:null,leds:null,params:{},initLampArrays:function(){var a=c.slotMachine;a.$canvas=c.find("#canvas"),a.maxX=parseInt(a.$canvas.width()-48)/10,a.maxY=parseInt(a.$canvas.height()-48)/10;for(var b=0;b<a.maxY;b++){a.lamps2[b]=[];for(var d=0;d<a.maxX;d++){var e=!0;if((0==b&&0==d||b==a.maxY-1&&0==d||b==a.maxY-1&&d==a.maxX-1||0==b&&d==a.maxX-1)&&(e=!1),b>2&&b<a.maxY-3&&d>2&&d<a.maxX-3&&(e=!1),b>=a.maxY-3&&d>15&&d<a.maxX-16&&(e=!1),e){var f={};f.y=10*b+5,f.x=10*d+5,f.isGlowing=!1,a.lamps.push(f),a.lamps2[b].push(f)}}}this.step()},initAnimation:function(a){var b=this;$.each(a,function(a,c){b.setAnimation(c.type)})},setAnimation:function(a){var b=c.slotMachine;a&&(this.render(b.options),this.step())},animationHandler:{i:0,row:0,rowCol:0,clean:function(){var a=c.slotMachine;this.i>=a.lamps.length&&(this.i=0,this.turnOff()),this.row=0,this.rowCol=0},turnOff:function(){for(var a=c.slotMachine,b=0;b<a.lamps.length;b++)a.lamps[b].isGlowing=!1},clearParams:function(){var a=c.slotMachine;this.turnOff(),a.options.type=!1,a.options.speed=0,a.options.n=0,a.options.m=0,this.i=0,this.row=0,this.rowCol=0},random:function(a){var b=c.slotMachine,d=parseInt(2*Math.random()+1)%2==0;d&&(b.lamps[a].isGlowing=!b.lamps[a].isGlowing)},toggle:function(a){var b=c.slotMachine;b.lamps[a].isGlowing=!b.lamps[a].isGlowing},leftToRight:function(a,b){for(var d=c.slotMachine,e=0;b>e;e++)this.i+e<d.lamps.length&&(d.lamps[this.i+e].isGlowing=!0)},doubleRow:function(a,b,d){for(var e=this.rowCol,f=c.slotMachine,g=this.row;g<this.row+d;g++)for(var h=e;b+e>h;h++)f.lamps2[g]&&f.lamps2[g][h]&&(f.lamps2[g][h].isGlowing=!0),f.lamps2[g]&&this.rowCol>=f.lamps2[g].length&&(this.rowCol=0,this.row+=d)},startAnimation:function(){var a=c.slotMachine;this.turnOff(),this.i=0,this.row=0,this.rowCol=0,a.isStopped=!1,a.ledAnimations.step()},stopAnimation:function(){var a=c.slotMachine;a.isStopped=!0,this.clearParams()}},render:function(a,b,d){var e=c.slotMachine,f=this;b=b||1,d=d||1,e.led_off_loaded||e.led_off_load_started||(e.led_off=new Image);var g=function(){e.canvas.width=e.canvas.width,e.led_off_loaded=!0;for(var c=e.lamps,g=e.lamps2,h=e.options,i=e.context,j=0;j<c.length;j++){f.animationHandler[a]&&f.animationHandler[a](j,b,d);var k=12,l=i.createRadialGradient(c[j].x+2*k,c[j].y+2*k,4,c[j].x+2*k,c[j].y+2*k,2*k),m=c[j].isGlowing?l:"rgba("+h.color+",0)",n=c[j].isGlowing?"rgba("+h.color+",1)":"rgba("+h.color+",0)";l.addColorStop(1,"rgba("+h.color+",0)"),l.addColorStop(0,"rgba("+h.color+",0.2)"),i.save(),i.fillStyle=m,i.beginPath(),i.arc(c[j].x+2*k,c[j].y+2*k,2*k,0,2*Math.PI,!0),i.closePath(),i.fill(),i.fillStyle=n,i.beginPath(),i.arc(c[j].x+2*k,c[j].y+2*k,4,0,2*Math.PI,!0),i.closePath(),i.fill(),i.restore(),i.drawImage(e.led_off,c[j].x,c[j].y)}f.animationHandler.rowCol+=b,f.animationHandler.i+=b,"doubleRow"!=a?f.animationHandler.clean():f.animationHandler.row>=g.length&&f.animationHandler.clean()};e.led_off_loaded?g():e.led_off_load_started||(e.led_off.onload=g,e.led_off.src=e.slot_config.api_url.img_led_off||"/css/game/slots/img/slot_led_off.png",e.led_off_load_started=!0)},step:function(){var a=c.slotMachine;a.isStopped||setTimeout(function(){a.ledAnimations.render(a.options.type,a.options.n,a.options.m),requestAnimationFrame(a.ledAnimations.step)},1e3/a.options.speed)},stopAnimation:function(a){setTimeout(function(){},a||400)}},stopReelSpin:function(a){a.removeClass("spinning")},stopReels:function(){var a=this;$.each(a.reels,function(b,c){setTimeout(function(){a.stopReelSpin($(c))},500*b+500)})},winChipAnimation:function(a){var b=this;b.$winContainer.find(".tile .rulesText").html(a),b.$winContainer.show(),$.each(b.reels,function(a,b){setTimeout(function(){$($(b).find(".chip")[1]).find(".border").addClass("winChip")},500*a+500)}),setTimeout(function(){b.$winContainer.addClass("winner"),b.$lb_overlay.show(),b.game.inGame=!1},500*b.reels.length+200)},winBigChipAnimation:function(a){var b=this;b.$winContainer.find(".tile .rulesText").html(a),b.$winContainer.show(),$.each(b.reels,function(a,b){setTimeout(function(){$($(b).find(".chip")[1]).find(".border").addClass("winChip")},500*a+500)}),setTimeout(function(){b.$winContainer.addClass("bigwinner"),b.$lb_overlay.show(),b.game.inGame=!1},500*b.reels.length+200)},stopChipAnimation:function(){c.find(".winChip").removeClass("winChip")},messageBox:{textBox:c.find("#slotsMessageReel #messages"),textInterval:{},left:0,isShowing:!1,getRandomText:function(a){var b=c.slotMachine,d=b.slot_config.labels.messageBox[a];return d[parseInt(Math.random()*d.length)]},setRandomText:function(a,b,d){c.slotMachine;this.textBox=c.find("#slotsMessageReel #messages"),this.textBox.text(b?b:this.getRandomText(a).format(d))},init:function(){this.stopAnimation(),this.setRandomText("demo"),this.animateText("defaultAnimation")},animateText:function(a){var b=c.slotMachine,d=b.config.textPanel[a];this.applyAnimation(d.animationType,d.step,d.delay,d.speed)},leftToRight:function(a,b,c){var d=this;d.isShowing=!0,d.textBox.css("left",d.left+"px"),$({left:d.left}).animate({left:600},{duration:c?c*(Math.abs(d.left)+600)/3:3e4,easing:"linear",step:function(){d.isShowing&&(d.left+=3,d.textBox.css("left",d.left))},complete:function(){d.textBox.css("left","-600px"),d.left=-600,d.isShowing&&d.applyAnimation("leftToRight",a,b,c)}})},rightToLeft:function(a,b,c){var d=this;d.textBox.css("left",d.left+"px"),$({left:d.left}).animate({left:-600},{duration:c?c*(Math.abs(d.left)+600)/3:3e4,easing:"linear",step:function(){d.isShowing&&(d.left-=3,d.textBox.css("left",d.left))},complete:function(){d.textBox.css("left","600px"),d.left=600,d.isShowing&&d.applyAnimation("leftToRight",a,b,c)}})},toggle:function(a,b,c){this.textBox.attr("style",""),this.textBox.transition({x:"0px",delay:1,duration:1});var d=0!=this.textBox.css("opacity");this.textBox.transition({opacity:d?0:1,delay:b?b:0,duration:c?c:100})},random:function(){},applyAnimation:function(a,b,d,e){var f=this;f.clearIntervals();c.slotMachine;this.textBox.transition({x:"0px",delay:1,duration:1}),this.textBox.attr("style",""),f[a]&&f[a](b,d,e)},stopAnimation:function(){var a=(c.slotMachine,this);a.clearIntervals(),this.textBox.attr("style",""),this.isShowing=!1,this.textBox.stop(!0,!1),this.textBox.transition({x:"0px",delay:0,duration:0})},clearIntervals:function(){var a=this;clearInterval(a.textInterval.toggle),clearInterval(a.textInterval.leftToRight),clearInterval(a.textInterval.rightToLeft),a.textInterval={}}}},c.slotMachine.initialize(),c.data("slotMachine",c.slotMachine),c};