$(document).ready(function(){function k(a){$("#ajaxgoods").lightbox_me({centered:!0,closeClick:!1,closeEsc:!1});$.get(a,function(b){$("#ajaxgoods").hide();"undefined"!==typeof b.success&&b.success&&($("#order1click-form").html(b.data.form),"undefined"!==typeof b.data.shop.name&&(console.info(typeof b.data.shop.name),$("#order1click-container h2").text("Оформить и забрать в магазине").after($("<div>").addClass("pb10").addClass("sLocation").html(b.data.shop.name+". Время работы: "+b.data.shop.regime))),
$("#order1click-container").lightbox_me({centered:!0}),l=!0,n())})}function n(){function a(a){if(!(1==b&&0>a)){b+=a;var a=(d*b+"").split("."),c=a[0],e=a[0].length;6<e?c=c.substr(0,e-6)+" "+c.substr(e-6,e-4)+" "+c.substr(e-3,e):3<e&&(c=c.substr(0,e-3)+" "+c.substr(e-3,e));2==a.length&&(c+="."+a[1]);a=c;$(".c1quant").html(b+" шт.");$("#order_product_quantity").val(b);$(".b1Click__ePriceBig .price").html(a)}}var b=1,d=$(".b1Click__ePriceBig .price").html().replace(/\s/g,"");$(".c1less").live("click",
function(){a(-1)});$(".c1more").live("click",function(){a(1)})}var g=$(".filter .filterlink:first"),j=$(".filter .filterlist"),h=navigator.userAgent.toLowerCase(),i=-1<h.indexOf("android"),h=-1<h.indexOf("ipad")||-1<h.indexOf("iphone");i||h?g.click(function(){g.hide();j.show();return!1}):(g.mouseenter(function(){g.hide();j.show()}),j.mouseleave(function(){j.hide();g.show()}));$(".bDropMenu").each(function(){var a=$(this).find("span:first"),b=$(this).find("div");a.css("display","block");a.width()+
60<b.width()?a.width(b.width()-70):b.width(a.width()+70)});$(".product_rating-form").live({"form.ajax-submit.prepare":function(){$(this).find("input:submit").attr("disabled",!0)},"form.ajax-submit.success":function(a,b){!0==b.success&&$(".product_rating-form").effect("highlight",{},2E3)}});$(".product_comment-form").live({"form.ajax-submit.prepare":function(){$(this).find("input:submit").attr("disabled",!0)},"form.ajax-submit.success":function(a,b){$(this).find("input:submit").attr("disabled",!1);
!0==b.success&&($($(this).data("listTarget")).replaceWith(b.data.list),$.scrollTo("."+b.data.element_id,500,{onAfter:function(){$("."+b.data.element_id).effect("highlight",{},2E3)}}))}});$(".product_comment_response-link").live({"content.update.prepare":function(){$(".product_comment_response-block").html("")},"content.update.success":function(){$(".product_comment_response-block").find("textarea:first").focus()}});$(".product_filter-block").bind("change",function(a){a=$(a.target);a.is("input")&&
-1!=$.inArray(a.attr("type"),["radio","checkbox"])&&a.trigger("preview")}).bind("preview",function(a){var b=$(a.target),d=$(this);$.when(function(){var a=$.Deferred();d.ajaxSubmit({url:d.data("action-count"),success:a.resolve,error:a.reject});return a.promise()}()).then(function(a){if(!0===a.success){$(".product_count-block").remove();switch(a.data%10){case 1:ending="ь";break;case 2:case 3:case 4:ending="и";break;default:ending="ей"}switch(a.data%100){case 11:case 12:case 13:case 14:ending="ей"}var c=
null,c=b.is("div")?b:b.parent().find("> label").first();c.after('<div class="filterresult product_count-block" style="display:block; padding: 4px; margin-top: -30px; cursor: pointer;"><i class="corner"></i>Выбрано '+a.data+" модел"+ending+"<br /><a>Показать</a></div>");$(".product_count-block").hover(function(){$(this).stopTime("hide")},function(){$(this).oneTime(2E3,"hide",function(){$(this).remove()})}).click(function(){d.submit()}).trigger("mouseout")}}).fail(function(){})});var l=!1;$(".order1click-link").bind("click",
function(a){a.preventDefault();l?$("#order1click-container").lightbox_me({centered:!0}):k($(this).attr("href"))});$("#order1click-form").bind("submit",function(a){a.preventDefault();$(this).ajaxSubmit({beforeSubmit:function(){var a=$("#order1click-form").find("input:submit");a.attr("disabled",!0);a.val("Оформляю заказ...")},success:function(a){a.success?a.data&&($("#order1click-container").find("h2").html(a.data.title),$("#order1click-form").replaceWith(a.data.content),runAnalitics&&runAnalitics()):
(a.data&&$("#order1click-form").html(a.data.form),a=$("#order1click-form").find("input:submit"),a.attr("disabled",!1),a.val("Оформить заказ"),$("#warn").length||(a=$('<span id="warn" style="color:red">').html("Не удалось оформить заказ. Приносим свои извинения! Повторите попытку или обратитесь с заказом в контакт cENTER&nbsp;8&nbsp;(800)&nbsp;700&nbsp;00&nbsp;09"),$(".bFormB2").before(a)))},error:function(){var a=$("#order1click-form").find("input:submit");a.attr("disabled",!1);a.val("Попробовать еще раз")}})});
if($("#gMap").length){$("#gMap").bind({create:function(a,b,d,f){var c=$(this),a={zoom:11,center:new google.maps.LatLng(b.latitude,b.longitude),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},e=new google.maps.Map(document.getElementById(c.attr("id")),a),a=new InfoBox({disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-11,-108),zIndex:null,boxStyle:{opacity:0.85,width:"280px"},closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",
infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatShadow",enableEventPropagation:!0}),g=function(){var a=d[this.id];c.trigger("showMarkers");c.trigger("infoWindow",[this,a])};c.data("markers",[]);$.each(d,function(a,b){var d=new google.maps.Marker({position:new google.maps.LatLng(b.latitude,b.longitude),map:e,title:b.name,icon:"/images/marker.png",id:b.id});google.maps.event.addListener(d,"click",g);c.data("markers").push(d)});google.maps.event.addListener(e,"bounds_changed",function(){});
google.maps.event.addListener(e,"click",function(){});google.maps.event.addListener(a,"closeclick",function(){c.trigger("showMarkers")});c.data("map",e);c.data("infoWindow",a);c.data("infoWindowTemplate",f)},move:function(){$(this).data("map")},infoWindow:function(a,b,d){var f=$(this),a=f.data("map"),c=f.data("infoWindow"),f=f.data("infoWindowTemplate");b.setMap(null);$.each(f.find("[data-name]"),function(a,b){b.innerHTML=d[$(b).data("name")]});c.setContent(f.prop("innerHTML"));c.open(a,b)},showMarkers:function(){var a=
$(this);$.each(a.data("markers"),function(b,d){null==d.map&&d.setMap(a.data("map"))})}});i=$("#gMap");i.trigger("create",[$("#map-center").data("content"),$("#map-markers").data("content"),$("#map-info_window-container")]);i.delegate(".shopchoose","click",function(a){m(a.target)});i[0].addEventListener("touchstart",function(a){a.target.className.match("shopchoose")&&m(a.target)},!1);var m=function(a){k($(a).parent().find(".shopnum").text())};$(".bInShopLine__eButton a").bind("click",function(a){a.preventDefault();
k($(this).attr("href"))});$(".bInShop__eCurrent a").click(function(){$.getJSON("/region/init",function(a){if(!a.success)return!1;var a=a.data,b=$("<div>").addClass("graying").css({opacity:"0.5"}),d=$('<div class="bCityPopupWrap">').html('<div class="hideblock bCityPopup"><i title="Закрыть" class="close">Закрыть</i><div class="title">Привет, из какого ты города?</div></div></div>');d.find(".close").click(function(){$(".graying").remove();$(".bCityPopupWrap").hide()});for(var f=0,c=a.length;f<c;f++)if(!("undefined"===
typeof a[f].link||"undefined"===typeof a[f].name)){var e=$("<div>").append($("<a>").attr("href",a[f].link).text(a[f].name));"undefined"!==typeof a[f].is_active?(e.addClass("bCityPopup__eCurrent"),d.find(".title").after(e)):(e.addClass("bCityPopup__eBlock"),d.find("div:first").append(e))}$("body").append(b).append(d)});return!1})}});
