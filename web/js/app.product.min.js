var Planner3dKupeConstructor=null;$(document).ready(function(){function e(e,t,i){var n=w[t]+1;$.get("/product-reviews/"+e,{page:n,type:t},function(e){$("."+i).html($("."+i).html()+e.content),w[t]++,C[t]=e.pageCount,w[t]+1>=C[t]?$("#getMoreReviewsButton").hide():$("#getMoreReviewsButton").show()})}if($("#planner3D").length){try{Planner3dKupeConstructor=new DKupe3dConstructor(document.getElementById("planner3D"),"/css/item/coupe_img/","/css/item/coupe_tex/"),Planner3dKupeConstructor.Initialize("/js/KupeConstructorData.json")}catch(t){var n=$(body).data(id),a={event:"Kupe3dConstructor error",type:"ошибка загрузки Kupe3dConstructor",pageID:n,err:t};logError(a)}Planner3d_Init=function(){},Planner3d_UpdatePrice=function(e){for(var t=$("#planner3D").data("cart-sum-url"),i={},n=function(e){return e.success?($(".bProductCardRightCol__ePrice").html(e.sum),$(".bProductCardRightCol__ePrice").html(e.sum),void 0):!1},a=0,r=e.length;r>a;a++){var o=e[a].id;if(""!==e[a].error)return console.log(e[a].error),$(".cart-add").addClass("disabled"),!1;$(".cart-add").removeClass("disabled"),void 0!==i[o+""]?i[o+""].quantity++:i[o+""]={id:o,quantity:1}}$.ajax({type:"POST",url:t,data:i,success:n})}}if($("#availableShops").length&&(vitrin={shopStack:0,initText:"",init:function(){vitrin.initText=$("#slideAvalShop").html(),$("#slideAvalShop").bind("click",function(){return $("#listAvalShop .hidden").toggle(150),$(this).toggleClass("showedShop"),$(this).hasClass("showedShop")?$(this).html("Свернуть"):$(this).html(vitrin.initText),!1}),shopFromModel=$("#availableShops").data("shops"),vitrin.shopStack={};for(i in shopFromModel){var e=tmpl("itemAvalShop_tmplPopup",shopFromModel[i]);$("#mapPopup_shopInfo").append(e),vitrin.shopStack[shopFromModel[i].id]=shopFromModel[i]}$("#listAvalShop").delegate(".shopLookAtMap","click",function(){return $("#orderMapPopup").lightbox_me({centered:!0,onLoad:function(){$("#mapPopup").empty(),vitrin.showPopup()}}),!1})},showPopup:function(){vitrin.loadMap(),$("#mapPopup_shopInfo").delegate("li","hover",function(){var e=$(this).attr("ref");hoverTimer.timer&&clearTimeout(hoverTimer.timer),e&&e!=hoverTimer.id&&(hoverTimer.id=e,hoverTimer.timer=setTimeout(function(){window.regionMap.showInfobox(e)},350))})},updateI:function(e){$("#map-info_window-container").html(tmpl("mapInfoBlock",e)),hoverTimer.id=e.id},loadMap:function(){MapInterface.ready("yandex",{yandex:$("#mapInfoBlock"),google:$("#map-info_window-container")});var e=calcMCenter(vitrin.shopStack),t=function(){window.regionMap.showMarkers(vitrin.shopStack)};MapInterface.init(e,"mapPopup",t,vitrin.updateI)}},vitrin.init()),$(".goodsphoto_eVideoShield").length){var r=0,o=0,s=document.location.href,l=$(".goodsphoto_eVideoShield"),c=$("#productVideo .productVideo_iframe").html();$("#productVideo .productVideo_iframe").empty(),l.bind("click",function(){return $("#productVideo .productVideo_iframe").append(c),$(".productVideo_iframe iframe").attr("src",$(".productVideo_iframe iframe").attr("src")+"?autoplay=1"),$("#productVideo").lightbox_me({centered:!0,onLoad:function(){r=(new Date).getTime(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Play",s])},onClose:function(){$("#productVideo .productVideo_iframe").empty(),o=(new Date).getTime();var e=o-r;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Stop",s,e])}}),!1})}if($(".bHint").length&&($(".bHint_eLink").bind("click",function(){$(".bHint_ePopup").hide(),$(this).parent().find(".bHint_ePopup").show();var e=$(this).html(),t=window.location.href;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Hints",e,t])}),$(".bHint_ePopup .close").bind("click",function(){$(".bHint_ePopup").hide()})),$(".otherRegion").length&&$(".expander").click(function(){return $(".otherRegion").find("ul").toggle(),!1}),$(".creditbox").length&&(window.creditBox={cookieTimeout:null,toggleCookie:function(e){clearTimeout(this.cookieTimeout),this.cookieTimeout=setTimeout(function(){docCookies.setItem(!1,"credit_on",e?1:0,3600,"/")},200)},init:function(){var e=this;$(".creditbox label").click(function(t){var i=$(t.target);return t.stopPropagation(),i.is("input")?!1:($(this).toggleClass("checked"),e.toggleCookie($(this).hasClass("checked")),void 0)}),1==this.getState()&&$(".creditbox label").addClass("checked");var t=$("input[name=dc_buy_on_credit]").data("model");t.count=1,t.cart="/cart",dc_getCreditForTheProduct(4427,docCookies.getItem("enter_auth"),"getPayment",{price:t.price,count:t.count,type:t.product_type},function(e){false in e||e.payment>0&&($(".creditboxinner .price").html(printPrice(Math.ceil(e.payment))),$(".creditbox").show())})},getState:function(){return docCookies.hasItem("credit_on")?docCookies.getItem("credit_on"):0}},creditBox.init()),$("#rating").length){var d=1*$("#rating").next().html().replace(/[^\d\.]/g,"");$("#rating img").remove(),$("#rating span").remove(),$("#rating").raty({start:d,showHalf:!0,path:"/css/skin/img/",readOnly:$("#rating").data("readonly"),starHalf:"star_h.png",starOn:"star_a.png",starOff:"star_p.png",hintList:["плохо","удовлетворительно","нормально","хорошо","отлично"],click:function(e){$.getJSON($("#rating").attr("data-url").replace("score",e),function(e){e.success===!0&&e.data.rating&&($.fn.raty.start(e.data.rating,"#rating"),$("#rating").next().html(e.data.rating))}),$.fn.raty.readOnly(!0,"#rating")}})}if($("#page .bCountSet").length){var u=$(".bCountSet"),h=u.parent().find(".link1"),p=h.attr("href"),f=$("a.order1click-link"),m=f.attr("href");u.data("hm",u.first().find("span").text().replace(/\D/g,""));var v=$(".goodsbarbig:first").data("value");if(v!==void 0)var g="jsstock"in v?v.jsstock:1;u.bind("update",function(){var e=$(this).data("hm");return e>g?($(this).data("hm",g),void 0):(e===g?$(".bCountSet__eP",u).addClass("disabled"):$(".bCountSet__eP",u).hasClass("disabled")&&$(".bCountSet__eP",u).removeClass("disabled"),u.find("span").text(e+"  шт."),h.attr("href",p+"/"+e),f.attr("href",m+"&quantity"+e),void 0)}),$(".bCountSet__eP",u).click(function(){return $(this).hasClass("disabled")?!1:(u.data("hm",1*u.data("hm")+1),u.trigger("update"),!1)}),$(".bCountSet__eM",u).click(function(){if($(this).hasClass("disabled"))return!1;var e=u.data("hm");return 1==e?!1:(u.data("hm",1*u.data("hm")-1),u.trigger("update"),!1)})}$(".viewstock").bind("mouseover",function(){var e=$('#stock img[ref="'+$(this).attr("ref")+'"]'),t=e.attr("src"),i=e.attr("data-url");e[0].complete&&($("#goodsphoto img").attr("src",t),$("#goodsphoto img").attr("href",i))});var b={makeLite:"#turnlite",makeFull:"#turnfull",loadbar:"#percents",zoomer:"#bigpopup .scale",rollindex:".scrollbox div b",propriate:[".versioncontrol",".scrollbox"]};if("undefined"!=typeof product_3d_small&&"undefined"!=typeof product_3d_big&&(lkmv=new likemovie("#photobox",b,product_3d_small,product_3d_big)),$("#bigpopup").length)var y=new mediaLib($("#bigpopup"));if($(".viewme").click(function(){if($(this).hasClass("maybe3d")){var e=$("#maybe3dModelPopup").data("value");try{swfobject.embedSWF(e.init.swf,e.init.container,e.init.width,e.init.height,e.init.version,e.init.install,e.flashvars,e.params,e.attributes),$("#maybe3dModelPopup").lightbox_me({centered:!0,closeSelector:".close"})}catch(t){var i=$(body).data(id),n={event:"swfobject_error",type:"ошибка загрузки swf maybe3d",pageID:i,err:t};logError(n)}return!1}if($(this).hasClass("3dimg")){var a=$("#3dModelImg"),e=a.data("value"),r=a.data("host");try{if(!$("#3dImgContainer").length){var o=new DAnimFramePlayer(document.getElementById("3dModelImg"),r);o.DoLoadModel(e)}$("#3dModelImg").lightbox_me({centered:!0,closeSelector:".close"})}catch(t){var i=$(body).data(id),n={event:"3dimg",type:"ошибка загрузки 3dimg для мебели",pageID:i,err:t};logError(n)}return!1}return y&&y.show($(this).attr("ref"),$(this).attr("href")),!1}),$(".product_rating-form").live({"form.ajax-submit.prepare":function(){$(this).find("input:submit").attr("disabled",!0)},"form.ajax-submit.success":function(e,t){1==t.success&&$(".product_rating-form").effect("highlight",{},2e3)}}),$(".product_comment-form").live({"form.ajax-submit.prepare":function(){$(this).find("input:submit").attr("disabled",!0)},"form.ajax-submit.success":function(e,t){$(this).find("input:submit").attr("disabled",!1),1==t.success&&($($(this).data("listTarget")).replaceWith(t.data.list),$.scrollTo("."+t.data.element_id,500,{onAfter:function(){$("."+t.data.element_id).effect("highlight",{},2e3)}}))}}),$(".product_comment_response-link").live({"content.update.prepare":function(){$(".product_comment_response-block").html("")},"content.update.success":function(){$(".product_comment_response-block").find("textarea:first").focus()}}),$("#productInfo").length){var k=$("#productInfo").data("value"),_={"Viewed Product SKU":k.article,"Viewed Product Product Name":k.name,"Viewed Product Product Status":k.stockState};"undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Product",_])}$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")});var w={user:-1,pro:-1},C={user:0,pro:0},x=null,S=null,M=null;if($(".reviewsTab").length){var I=$("#reviewsWrapper").attr("data-reviews-type");w[I]++,C[I]=$("#reviewsWrapper").attr("data-page-count"),C[I]>1&&$("#getMoreReviewsButton").show(),x=$("#reviewsWrapper").attr("data-product-id"),S=$("#reviewsWrapper").attr("data-reviews-type"),M=$("#reviewsWrapper").attr("data-container"),$(".reviewsTab").click(function(){M=$(this).attr("data-container"),S=$(this).attr("data-reviews-type"),$(".reviewsTab").removeClass("active"),$(this).addClass("active"),$(".reviewsTabContent").hide(),$("."+M).show(),$("#getMoreReviewsButton").hide(),"user"==S?$("#getMoreReviewsButton").html("Показать ещё отзывы"):"pro"==S&&$("#getMoreReviewsButton").html("Показать ещё обзоры"),$("."+M).html()?w[S]+1>=C[S]?$("#getMoreReviewsButton").hide():$("#getMoreReviewsButton").show():e(x,S,M)}),$("#getMoreReviewsButton").click(function(){e(x,S,M)})}$(".categoriesmenu").length&&$(".acess-box-section").addClass("acess-box")});