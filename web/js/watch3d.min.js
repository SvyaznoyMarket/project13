/*
	360-degree Slideshow 
	'Watch 3d'
	Ivan Kotov
	enter.ru 2011 copyright
	v 2.1

	jQuery is prohibited
							*/
var cnvCompatible=document.createElement("canvas").getContext;
function likemovie(e,c,j,h){this.mvblock=$(e);if(!this.mvblock.length)return false;if(!j||!h||j.length!=40||h.length!=40)return false;var c=c?c:{},f=null,a=this,p=null,l=null,m=null;this.completenessIntrvl=2E3;this.rollingIntrvl=400;var k=[500,1200,2500];this.initres=k[0];var d=[1,11,21,31],b=d,F=[];this.howmany=40;this.zoom=1;this.imgzoom=0;this.mode="slow";var g=null,x=null,y=null,i=null,s=null,D=[[110,28],[121,28],[132,27],[143,26],[154,25],[165,24],[176,23],[187,21],[198,19],[209,16],[220,13],
[209,10],[198,7],[187,6],[176,5],[165,4],[154,3],[143,2],[132,1],[121,0],[110,0],[99,0],[88,1],[77,2],[66,3],[55,4],[44,5],[33,6],[22,7],[11,10],[0,13],[11,16],[22,19],[33,21],[44,23],[55,24],[66,25],[77,26],[88,27],[99,28]],t=0,n=1,u=1,z=false,o=false,E=0,A="roll",v=0,w=0,q={x:0,y:0},r=null,B=true,C=false;this.api=function(){c.zoomer&&(y=$(c.zoomer));x=new loadbar;x.create(c.loadbar?c.loadbar:0);this.makeLite();c.rollindex&&(s=$(c.rollindex));this.toggle()};this.toggle=function(){if(!c.propriate)return false;
for(var a in c.propriate)B?$(c.propriate[a]).show():$(c.propriate[a]).hide();B=!B};this.hideVersions=function(){c&&c.makeLite&&$(c.makeLite).hide();c&&c.makeFull&&$(c.makeFull).hide()};this.makeLite=function(){var b=null;c&&c.makeLite?b=$(c.makeLite):(b=$("<div>").attr("id","ml").html("make lite").appendTo("body"),c.makeLite="#ml");b.css("cursor","pointer").bind({click:function(){a.turnVersion();b.hide();a.makeFull()}})};this.makeFull=function(){var b=null;c&&c.makeFull?b=$(c.makeFull):(b=$("<div>").attr("id",
"mf").html("make full").appendTo("body"),c.makeFull="#mf");b.css("cursor","pointer").show().bind({click:function(){a.turnVersion();b.hide()}})};this.rollshift=function(a){a=a-5<0?34+a:a-5;s.css("left",D[a][0]).css("top",D[a][1])};this.manualRollEnable=function(){s.bind({mousedown:function(b){b.preventDefault();a.stopRolling();C=true;s.offset()}});$(document).mousemove(function(b){if(C){var c=b.pageX,b=b.pageY,d=s.offset();Math.abs(d.left-c)>11&&(mouseIsLeft=d.left>c?true:false,mouseIsTop=d.top>b?
true:false,n-1-5<a.howmany/4||n-1-5>=a.howmany/4*3?n-1-5==a.howmany/4*3?(!mouseIsLeft&&!mouseIsTop&&a.nextSrc(1),!mouseIsLeft&&mouseIsTop&&a.nextSrc(-1)):mouseIsLeft?a.nextSrc(-1):a.nextSrc(1):n-1-5==a.howmany/4?(mouseIsLeft&&mouseIsTop&&a.nextSrc(1),mouseIsLeft&&!mouseIsTop&&a.nextSrc(-1)):!mouseIsLeft?a.nextSrc(-1):a.nextSrc(1))}});$(document).mouseup(function(){C=false})};this.breakPreload=function(){clearInterval(l);for(var a=b.length;a>0;a--)document.getElementById("ivn"+b[a-1]).complete||$("#ivn"+
b[a-1]).remove()};this.preloadImages=function(a){f=o?j:h;for(var b=$("<div>"),c=0;c<a.length;c++)$("<img>").attr("src",f[a[c]-1]).attr("id","ivn"+a[c]).appendTo(b);o?$("#nvis500").append(b):$("#nvis").append(b)};this.checkComplete=function(){for(var c=0,e=0;e<b.length;e++)document.getElementById("ivn"+b[e]).complete&&(o||F.push(b[e]),c++);x.update((d.length-b.length+c)/a.howmany*100);c==b.length&&a.nextLoad()};this.nextLoad=function(){if(d.length==this.howmany)clearInterval(l),this.hideVersions(),
this.manualRollEnable(),o?this.speedupRolling(70):(this.stop4slides(),this.createFrontier(),this.mode="medium",this.startRolling(70));else{switch(d.length){case 4:o?this.startRolling():this.show4slides();b=[6,16,26,36];break;case 8:b=[3,9,13,19,23,29,33,39];break;case 16:b=[4,8,14,18,24,28,34,38];break;case 24:b=[2,10,12,20,22,30,32,40];break;case 32:b=[5,7,15,17,25,27,35,37]}this.preloadImages(b);d=d.concat(b);d.sort(function(a,b){return a-b})}};this.turnVersion=function(){(o=!o)?(this.stop4slides(),
this.breakPreload(),this.preloadImages(b),this.createFrontier(),i.setDimensionProps(k[0]),this.zoom=1,i.zoom=1,i.noZoom(),l=setInterval(a.checkComplete,a.completenessIntrvl),d.length>4&&this.startRolling()):(this.stopRolling(),g.hide(),this.breakPreload(),$("#nvis500").empty(),d=[1,11,21,31],b=[1,11,21,31],this.preloadImages(d),l=setInterval(a.checkComplete,a.completenessIntrvl),this.getInitSize(),i.setDimensionProps(k[this.zoom-1]),i.zoom=this.zoom,i.addZoom())};this.startRolling=function(b){z=true;
if(b)a.rollingIntrvl=b;p=setInterval(function(){a.nextSrc(1)},a.rollingIntrvl)};this.stopRolling=function(){z=false;clearInterval(p)};this.speedupRolling=function(b){a.rollingIntrvl=b;z&&(clearInterval(p),p=setInterval(function(){a.nextSrc(1)},a.rollingIntrvl))};this.nextSrc=function(b){switch(a.mode){case "medium":var c=0;a:for(;c<d.length;c++)if(d[c]==n){n=!c&&b<0?d[d.length-1]:d[(c+1*b)%d.length];break a}break;case "slow":n==31&&d.length>4?a.mode="medium":n=(n+10)%this.howmany}cnvCompatible&&!o?
(g.attr("ref",n),r.clearRect(0,0,2500,2500),r.drawImage(document.getElementById("ivn"+n),q.x,q.y,k[i.zoom-1],k[i.zoom-1])):(b=o?j:h,a.mvblock.hide(),g.attr("src",b[n-1]),a.mvblock.show());a.rollshift(n-1)};this.show4slides=function(){for(var b=true;b;)u=(u+10)%a.howmany,document.getElementById("ivn"+u).complete&&(b=false);g.fadeOut(1E3);setTimeout(function(){g.attr("src",h[u-1])},1E3);g.fadeIn(1E3);m=setTimeout(a.show4slides,3E3)};this.stop4slides=function(){m&&clearTimeout(m)};this.start=function(){v=
a.mvblock.innerWidth();w=a.mvblock.innerHeight();$("<div>").hide().attr("id","nvis500").appendTo("body");$("<div>").hide().attr("id","nvis").appendTo("body");this.preloadImages(d);l=setInterval(a.checkComplete,a.completenessIntrvl);a.api();this.initres=this.getInitSize();g=$("<img>").attr({src:h[0],width:a.initres,height:a.initres}).attr("id","ivn").css({position:"relative",left:Math.round((a.mvblock.innerWidth()-a.initres)/2),top:Math.round((a.mvblock.innerHeight()-a.initres)/2)});g.appendTo(a.mvblock)};
this.createFrontier=function(){!cnvCompatible||o?(g.bind({mousedown:function(a){t=a.pageX},click:function(){a.stopRolling()},dblclick:function(){a.startRolling()}}),this.mvblock.css("text-align","left"),i=new gigaimage(g,a.zoom,y,a.rollanddrop),i.addZoom(),$(window).resize(function(){a.zoom==1&&g.css("left",Math.round((a.mvblock.innerWidth()-a.initres)/2)).css("top",Math.round((a.mvblock.innerHeight()-a.initres)/2))})):($("#ivn").remove(),i&&i.destroy(),g=$("<canvas>").attr({id:"ivn",width:v,height:w}),
g.appendTo(this.mvblock),r=document.getElementById("ivn").getContext("2d"),r.drawImage(document.getElementById("ivn1"),Math.round((v-a.initres)/2),Math.round((w-a.initres)/2),a.initres,a.initres),q={x:Math.round((v-a.initres)/2),y:Math.round((w-a.initres)/2)},this.mvblock.bind({mousedown:function(a){t=a.pageX},click:function(){a.stopRolling()},dblclick:function(){a.startRolling()}}),i=new gigaimage(g,a.zoom,y,a.rollanddrop),i.addZoom(q),$(window).resize(function(){document.getElementById("ivn").width=
a.mvblock.innerWidth();document.getElementById("ivn").height=a.mvblock.innerHeight()}))};this.hide=function(){$(g).hide();this.breakPreload();o||d.length==this.howmany?this.stopRolling():this.stop4slides();this.toggle()};this.show=function(){$(g).show();d.length!=this.howmany&&(this.preloadImages(b),l=setInterval(a.checkComplete,a.completenessIntrvl));o||d.length==this.howmany?this.startRolling():this.show4slides();this.toggle()};this.rollanddrop=function(b,c,d){E!=d&&(E=d,A=Math.abs(c.x)>Math.abs(c.y)?
"roll":"drop");A=="roll"&&Math.abs(b.pageX-t)>20*i.zoom?(c=b.pageX-t>0?1:-1,t=b.pageX,a.nextSrc(c)):A=="drop"&&(!cnvCompatible||o?(b=parseInt(g.css("top"),10),g.css("top",c.y+b)):(q.y+=c.y,r.clearRect(0,0,2500,2500),r.drawImage(document.getElementById("ivn"+n),q.x,q.y,k[i.zoom-1],k[i.zoom-1])))};this.getInitSize=function(){var b=$(window).width();this.zoom=b<1030?1:b<1590?2:3;return this.imgzoom=k[this.zoom-1]}}
function gigaimage(e,c,j,h){var f=this,a=e[0].tagName=="CANVAS",p=false,l=[500,1200,2500],m=0,k=null;this.zoom=c;j&&(k=new zoomer(j,f));if(cnvCompatible&&a)var d=document.getElementById(e.attr("id")).getContext("2d");this.cursorHand=function(){e.css("cursor","url(/css/skin/cursor/cursor_1.png), url(/css/skin/cursor/cursor_1.gif), url(/css/skin/cursor/cursor_ie_1.cur), crosshair")};f.cursorHand();this.cursorDrag=function(){e.css("cursor","url(/css/skin/cursor/cursor_2.png), url(/css/skin/cursor/cursor_2.gif), url(/css/skin/cursor/cursor_ie_2.cur), move")};
this.setDimensionProps=function(b){b=b?b:l[f.zoom-1];e.attr("width",b).attr("height",b).css("left",Math.round((e.parent().innerWidth()-b)/2)).css("top",Math.round((e.parent().innerHeight()-b)/2))};(!cnvCompatible||!a)&&this.setDimensionProps();this.zoomIn=function(){var b=e.parent(),a=b.offset();this.fixzoom(1,Math.round(b.width()/2)+a.left,Math.round(b.height()/2)+a.top)};this.zoomOut=function(){var b=e.parent(),a=b.offset();this.fixzoom(-1,Math.round(b.width()/2)+a.left,Math.round(b.height()/2)+
a.top)};e.parent();this.fixzoom=function(b,c,g){var h=this.zoom;if(!(f.zoom==1&&b<0||f.zoom==3&&b>0)){b>0?f.zoom++:f.zoom--;b/=Math.abs(b);h=l[f.zoom-1]/l[h-1];if(!cnvCompatible||!a){var j=e.parent().offset(),i=parseInt(e.css("left"),10),m=parseInt(e.css("top"),10);c-=j.left+i;g-=j.top+m;i-=b*Math.abs(Math.round(c*(1-h)));m-=b*Math.abs(Math.round(g*(1-h)));e.attr("width",l[f.zoom-1]).attr("height",l[f.zoom-1]).css({left:i,top:m})}else j=e.parent().offset(),c-=j.left+cnvimg.x,g-=j.top+cnvimg.y,cnvimg.x-=
b*Math.abs(Math.round(c*(1-h))),cnvimg.y-=b*Math.abs(Math.round(g*(1-h))),c=e.attr("ref"),d.clearRect(0,0,2500,2500),d.drawImage(document.getElementById("ivn"+c),cnvimg.x,cnvimg.y,l[f.zoom-1],l[f.zoom-1]);k&&(b>0?k.plus():k.minus())}};this.addZoom=function(a){cnvimg=a;e.bind({mousewheel:function(a,b){a.preventDefault();f.fixzoom(b,a.pageX,a.pageY)}});k.show()};this.noZoom=function(){e.unbind("mousewheel");k.hide()};e.bind({mousedown:function(a){a.preventDefault();init={pageX:a.pageX,pageY:a.pageY};
m=a.timeStamp;p=true;f.cursorDrag()}});$(document).bind("mousemove.zoomer",function(a){if(p)a.preventDefault(),f.action(a,{x:a.pageX-init.pageX,y:a.pageY-init.pageY},m,f.zoom),init.pageX=a.pageX,init.pageY=a.pageY});$(document).bind("mouseup.zoomer",function(){p=false;f.cursorHand()});this.dropping=function(a,c){var d=parseInt(e.css("left"),10),f=parseInt(e.css("top"),10);e.css("top",c.y+f).css("left",c.x+d)};this.action=h?h:this.dropping;this.destroy=function(){e.unbind("mousedown");e.unbind("mousewheel");
e.remove();$(document).unbind(".zoomer");for(var a in this)delete this[a]}}function loadbar(){this.percentage=0;var e=null;this.create=function(c){c?e=$(c):(e=$("<div>").attr("id","loadbar").html("0%"),e.appendTo("body"));return e};this.update=function(c){this.percentage=c?Math.round(c):0;e.html(this.percentage+"%");this.percentage==100&&this.destroy()};this.destroy=function(){setTimeout(function(){e.fadeOut("slow")},2E3)}}
function zoomer(e,c){if(!e)return false;var j=$(".zoomind",e),h=false,f=[54,28,-2],a=function(a){return a<f[2]+6?1:a<f[1]-4?2:a<f[1]+4?3:a<f[0]-6?4:5},p=j.parent().offset().top,l=3,m=3,k=[5,3,1];j.css("top",f[c.zoom-1]);this.hide=function(){e.hide()};this.show=function(){e.show()};$("b.plus",e).bind("click",function(){c.zoomIn&&c.zoomIn()});$("b.minus",e).bind("click",function(){c.zoomOut&&c.zoomOut()});j.bind({mousedown:function(a){h=true;a.preventDefault();a.stopPropagation()},mouseup:function(){h=
false}});$("b.zoomind",e).parent().bind({mousemove:function(d){if(h&&(d.preventDefault(),d.stopPropagation(),d=d.pageY-p-3,d<55&&d>-3)){j.css("top",d);var b=l-a(d);Math.abs(b)&&a(d)!=m&&a(d)%2&&(a(d)-m<0?c.zoomIn():c.zoomOut(),m=a(d));Math.abs(b)==2?(b<0?c.zoomIn():c.zoomOut(),m=a(d)):Math.abs(b)>=3&&(b<0?(c.zoomIn(),c.zoomIn()):(c.zoomOut(),c.zoomOut()),m=a(d));l=a(d)}},mouseleave:function(){}});this.minus=function(){h||(j.css("top",f[c.zoom-1]),m=k[c.zoom-1],l=k[c.zoom-1])};this.plus=function(){h||
(j.css("top",f[c.zoom-1]),m=k[c.zoom-1],l=k[c.zoom-1])}};
