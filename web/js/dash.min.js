$(document).ready(function(){function e(e,t){if(!e.length)return null;var i=this,r=t,a=!1,n=null,o=25,s=30,l=$(".dropbox");if(!l.length)return null;var d=[],c=0,u=null,p=$("<div>").addClass("dragbox").css("display","none"),n=$("<div>");p.append(n),$(e).append(p);var f=$("<div>").addClass("graying").css({display:"none",opacity:"0.5"});$(e).append(f);var h=0;this.cancel=function(){$(document).unbind("mousemove.dragitem")},$(document).bind("mouseup",function(e){"dragimg"==e.target.id&&i.cancel()}),this.prepare=function(e,t,p){u=p,$(".goodsbox__inner[ref="+u.id+"] a.link1").hasClass("active")||$(document).bind("mousemove.dragitem",function(u){u.preventDefault(),a?(n.css({left:u.pageX-s,top:u.pageY-h-s}),c=$(l[0]).offset().top,u.pageY+s>c-o&&u.pageX+s>d[0]-o&&u.pageX-30<d[0]+70+o?r.toFire(3):r.putOutBoxes()):(Math.abs(e-u.pageX)>o||Math.abs(t-u.pageY)>o)&&(i.turnon(u.pageX,u.pageY),a=!0)})},this.turnon=function(e,t){r.clear(),f.show(),h=f.offset().top,n.html($("<img>").css({width:60,height:60}).attr({id:"dragimg",width:60,height:60,alt:"",src:u.img})),n.css({left:e-s,top:t-h-s}),p.show(),r.getContainers();for(var a=0;l.length>a;a++)d[a]=$(l[a]).offset().left;$(document).bind("mouseup.dragitem",function(){(fbox=r.gravitation())?($(document).unbind(".dragitem"),n.animate({left:d[0]+5,top:c-h+5},400,function(){i.finalize(fbox)})):i.turnoff()})},this.turnoff=function(){a=!1,f.fadeOut(),p.hide(),r.hideContainers(),$(document).unbind(".dragitem")},this.finalize=function(e){setTimeout(function(){switch(i.turnoff(),e){case 1:r.getComparing(u);break;case 2:r.getWishes(u);break;case 3:$.getJSON($(".goodsbox__inner[ref="+u.id+"] a.link1").attr("href"),function(e){if(e.success&&t){var i=u;i.vitems=e.data.full_quantity,i.sum=e.data.full_price,t.getBasket(i)}})}},400)}}function t(e){var t=$("div[ref="+e+"]"),i={id:$(t).attr("ref"),title:$("h3 a",t).html(),price:$(".price",t).html(),img:$(".photo img.mainImg",t).attr("src")};return i}function i(e){"undefined"!=typeof MyThings&&"undefined"!=e.data("product")&&MyThings.Track({EventType:MyThings.Event.Visit,Action:"1013",ProductId:e.data("product")}),($("#adriverProduct").length||$("#adriverCommon").length)&&"undefined"!=e.data("product")&&function(e){var t=document,i=t.createElement("IMG"),r=t.body;e=e.replace(/![rnd]/,Math.round(9999999*Math.random()))+"&tail256="+escape(t.referrer||"unknown"),i.style.position="absolute",i.style.width=i.style.height="0px",i.onload=i.onerror=function(){r.removeChild(i),i=r=null},i.src=e,r.insertBefore(i,r.firstChild)}("http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=add_basket&custom=10="+e.data("product")+";11="+e.data("category")+"&bt=55&pz=0&rnd=![rnd]")}function r(){this.push=function(e,t,r){if($(e).length){var a=$(".lightboxinner .point2").attr("href");$("body").delegate(e,"click",function(e){e.preventDefault();var n=$(this);if(t||(t=n.data("value")),!t)return!1;if($("body").hasClass("bought"))return document.location=a,!1;if(n.hasClass("disabled"))return!1;var o="/404.html";if(n.is("a")){var s=n.text().replace(/\s/g,"");""!==s&&"&nbsp;"!==s&&n.text("В корзине"),o=n.attr("href")}n.is("input")&&(n.val("В корзине"),o=t.url);var l=docCookies.getItem("switch");return null!==l&&"default"!==l?(window.location.href=o,!1):($("body").addClass("bought"),$.getJSON(o,function(e){if(e.success&&ltbx){var a={id:t.jsref,title:t.jstitle,price:t.jsprice,img:t.jsimg?t.jsimg:"/images/logo.png",vitems:e.data.full_quantity,sum:e.data.full_price,link:e.data.link};ltbx.getBasket(a),r&&r(),PubSub.publish("productBought",a),i($(n))}}),!1)})}}}if($("#similarGoodsSlider").length){var a=$("#similarGoodsSlider"),n=a.find(".bSimilarGoodsSlider_eWrap"),o=a.find(".bSimilarGoodsSlider_eArrow"),s=0,l=0,d=0,c=0,u=0,p=function(){var e=document.location,t=$(this).attr("href");"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","AdvisedCrossss",e,t])},f=function(e){for(var t in e){var i=tmpl("similarGoodTmpl",e[t]);n.append(i)}var r=a.find(".bSimilarGoodsSlider_eGoods");s=r.width()+2*parseInt(r.css("paddingLeft")),d=r.length,c=s*d,n.width(c),d>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()}),4>d&&$(".bSimilarGoodsSlider_eArrow.mRight").hide()};$.getJSON($("#similarGoodsSlider").data("url"),function(e){if(!$.isEmptyObject(e)){var t=e;f(t)}}).done(function(){var e=a.find(".bSimilarGoodsSlider_eGoods");d=e.length,c=s*d,n.width(c),d>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()})}),o.bind("click",function(){return $(this).hasClass("mLeft")?u+=2*s:u-=2*s,l-c>=u?(u=l-c,$(".bSimilarGoodsSlider_eArrow.mRight").hide(),$(".bSimilarGoodsSlider_eArrow.mLeft").show()):u>=0?(u=0,$(".bSimilarGoodsSlider_eArrow.mLeft").hide(),$(".bSimilarGoodsSlider_eArrow.mRight").show()):o.show(),n.animate({left:u}),!1}),$(".bSimilarGoods.mCatalog .bSimilarGoodsSlider_eGoods a").live("click",p)}var h=function(e){var t=$(".bSubscribeLightboxPopupNotNow"),i=$(".bSubscribeLightboxPopup"),r=$(".bSubscribeLightboxPopup__eInput");r.placeholder();var a=function(){var e=$(this).data("url"),t=r.val();return-1!==t.search("@")?$.post(e,{email:t},function(e){return e.success?(i.html('<span class="bSubscribeLightboxPopup__eTitle mType">Спасибо! подтверждение подписки отправлено на указанный e-mail</span>'),docCookies.setItem(!1,"subscribed",1,15768e4,"/"),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Account","Emailing sign up","Page top"]),setTimeout(function(){i.slideUp(300)},3e3),void 0):!1}):r.addClass("mError"),!1},n=function(){i.slideDown(300),r.keydown(function(){$(this).removeClass("mError")}),$(".bSubscribeLightboxPopup__eBtn").bind("click",a),$(".bSubscribeLightboxPopup__eNotNow").bind("click",function(){var e=$(this).data("url");return i.slideUp(300,o),docCookies.setItem(!1,"subscribed",0,15768e4,"/"),$.post(e),!1})},o=function(){t.slideDown(300),t.bind("click",function(){$(this).slideUp(300),n()})};return e.show?(n(),void 0):(e.agrred||o(),!1)},m=function(e){void 0!==e.subscribe&&h(e.subscribe)},v=$(".lightboxinner .point2").attr("href"),g="/user/shortinfo";docCookies.hasItem("enter")&&docCookies.hasItem("enter_auth")||(g+="?ts="+(new Date).getTime()+Math.floor(1e3*Math.random()));var b={};if(!$(".lightbox").length)return $(".lightboxinner").hide(),$.getJSON(g,function(e){if(e.success)if(e.data.vitems>0&&$("#topBasket").text("("+e.data.vitems+")"),e.data.name){var t={};t.user=e.data.name;var i=tmpl("auth_tmpl",t);$("#auth-link").hide(),$("#auth-link").after(i)}else $("#auth-link").show()}),!1;ltbx=new Lightbox($(".lightboxinner"),b),$.getJSON(g,function(e){if(e.success){b=e.data,ltbx.update(b),w(b);var t=$("div.lightboxinner > .dropbox");if(t.length&&t.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left),PubSub.publish("auth try",e.data.name),e.data.name){var i={};i.user=e.data.name;var r=tmpl("auth_tmpl",i);$("#auth-link").hide(),$("#auth-link").after(r)}else $("#auth-link").show();$("#upsale").length&&($("#upsaleCounter").html(e.data.vitems),$("#upsalePrice").html(e.data.sum)),void 0!==e.data.action&&m(e.data.action)}});var k=!1,w=function(e){if(!e||!e.productsInCart)return!1;for(var t in e.productsInCart){var i=$("div.boxhover[ref="+t+"]");if(i.length){var r=$("a.link1",i);r.attr("href",$(".lightboxinner .point2").attr("href")),r.addClass("active")}if(i=$("div.goodsbarbig[ref="+t+"]"),i.length){var r=$("a.link1",i);if(r.attr("href",$(".lightboxinner .point2").attr("href")),$("body").addClass("bought"),r.unbind("click"),k=!0,e.servicesInCart)for(var a in e.servicesInCart)if(t in e.servicesInCart[a]){var r=$("div.mServ[ref="+a+"] a.link1");r.length&&r.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),r=$("td.bF1Block_eBuy[ref="+a+"] input.button"),r.length&&r.addClass("active").val("В корзине").attr("href",v)}}}if(e.servicesInCart)for(var a in e.servicesInCart)if(e.servicesInCart[a][0]){var r=$("div.mServ[ref="+a+"] a.link1");r.length&&r.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),r=$("div.bServiceCard[ref="+a+"] input"),r.length&&r.val("В корзине").addClass("active").attr("href",v)}};window.navigator.userAgent.indexOf("MSIE")>=0&&$(".allpageinner").delegate(".goodsbox__inner","hover",function(){$(this).toggleClass("hover")}),$(".allpageinner").delegate(".goodsbox","mouseenter",function(){currentItem=$(this).attr("ref")}),$(".goodsbox__inner").live("click",function(){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var y={uri:window.location.pathname,atcl:$(".bGood__eArticle span:last").text().replace(/[^0-9\-]/g,"")};if($(".bigcarousel").eq(0).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_up",y.atcl,y.uri])}),$(".bigcarousel").eq(1).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_down",y.atcl,y.uri])}),$("div.bF1Info").length){var _=$("div.bF1Info"),x=$("div.bF1Block");$(".link1, .bF1Info_Logo",_).click(function(){return $("div.hideblock.extWarranty").is(":visible")&&$("div.hideblock.extWarranty").hide(),x.show(),!1}),$(".close",x).click(function(){x.hide()}),x.find("input.button").bind("click",function(){if($(this).hasClass("active"))return window.location.href=$(this).attr("href"),!1;$(this).val("В корзине").addClass("active").attr("href",v);var e=$(this).data();return x.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;_.find("h3").text("Вы добавили услуги:");var i=tmpl("f1look",e);i=i.replace("F1ID",e.fid),_.find(".link1").before(i);var r={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};r.f1=e,k&&(r.f1.only="yes"),ltbx.getBasket(r),k||(k=!0,I())}),!1}),$("a.bBacketServ__eMore",_).live("click",function(){var e=this;return $.getJSON($(this).attr("href"),function(t){if(!t.success)return!0;var i=$(e).parent();x.find("td[ref="+i.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),i.remove(),ltbx.update({sum:t.data.full_price}),$("a.bBacketServ__eMore",_).length||_.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var C=new e($(".allpageinner"),ltbx);if($(".goodsbox__inner[ref] .mainImg").live("mousedown",function(e){e.stopPropagation(),e.preventDefault(),1==e.which&&C.prepare(e.pageX,e.pageY,t(currentItem))}),$(".goodsbox__inner[ref] .mainImg").live("mouseup",function(){C.cancel()}),$("div.bBlueButton.extWarranty").length&&$("div.bBlueButton.extWarranty").is(":visible")){var S=$("div.bBlueButton.extWarranty"),M=$("div.hideblock.extWarranty"),D=$("#ew_look");$(".link1",S).click(function(){return $("div.bF1Block").is(":visible")&&$("div.bF1Block").hide(),M.show(),!1}),$(".close",M).click(function(){M.hide()}),M.find("input.button").bind("click",function(){$("input.button",M).hasClass("active")&&$("input.button",M).val("Выбрать").removeClass("active"),$(this).val("Выбрана").addClass("active");var e=$(this).data();return M.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;$(".link1",S).text("Изменить гарантию"),S.find("h3").text("Вы выбрали гарантию:"),$(".ew_title",D).text(e.f1title),$(".ew_price",D).text(e.f1price),$(".bBacketServ__eMore",D).attr("href",e.deleteurl),D.show();var i={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};i.f1=e,k&&(i.f1.only="yes"),ltbx.getBasket(i),k||(k=!0,I())}),!1}),$(".bBacketServ__eMore",D).live("click",function(e){e.preventDefault();var t=this;return $.getJSON($(this).attr("href"),function(e){if(!e.success)return!0;var i=$(t).parent();$("input.button",M).val("Выбрать").removeClass("active"),$(".link1",S).text("Выбрать гарантию"),i.hide(),ltbx.update({sum:e.data.full_price}),D.hide(),$("a.bBacketServ__eMore",S).length||S.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var I=function(){var e=$(".lightboxinner .point2").attr("href");$("body").addClass("bought"),$(".goodsbarbig .link1").attr("href",e),$("#bigpopup a.link1").attr("href",e),$(".bSet__ePrice .link1").unbind("click"),$(".goodsbar .link1").die("click")};$(".goodsbox a.link1").live("click",function(e){var r=docCookies.getItem("switch");if(null!==r&&"default"!==r){var a=$(this).attr("href");return window.location.href=a,!1}e.stopPropagation();var n=this;if($(n).hasClass("disabled"))return!1;if($(n).hasClass("active"))return!0;if("undefined"==typeof currentItem)return!1;if(ltbx){var o=$(this).parent().parent().parent().find(".photo img.mainImg");o.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:o.attr("src")},500)}var s=currentItem,l=$(n).attr("href");return $.getJSON(l,function(e){if(e.success&&ltbx){var r=t(s);r.vitems=e.data.full_quantity,r.sum=e.data.full_price,r.link=e.data.link,ltbx.getBasket(r),$(n).attr("href",$(".lightboxinner .point2").attr("href")),$(n).addClass("active"),PubSub.publish("productBought",currentItem),i($(n))}}),!1});var T=new r;T.push("div.bServiceCardWrap input"),T.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),I),T.push("div.bSet a.link1",$("div.bSet").data("value"),I),T.push("div.mServ a.link1",$("div.mServ").data("value")),T.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),function(){var e=$("div.bInShop__eButton a.link1");e.html("<i> </i>"+e.html())}),T.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value")),"ANALYTICS"in window&&PubSub.subscribe("productBought",function(){})});