$(document).ready(function(){function n(a){a=$("div[ref="+a+"]");return{id:$(a).attr("ref"),title:$("h3 a",a).html(),price:$(".price",a).html(),img:$(".photo img.mainImg",a).attr("src")}}var j=$(".lightboxinner .point2").attr("href"),e="/user/shortinfo";if(!docCookies.hasItem("enter")||!docCookies.hasItem("enter_auth"))e+="?ts="+(new Date).getTime()+Math.floor(1E3*Math.random());var k={};if(void 0===window.Lightbox)return $(".lightboxinner").hide(),$.getJSON(e,function(a){if(a.success)if(a.data.name){var b=
{};b.user=a.data.name;a=tmpl("auth_tmpl",b);$("#auth-link").hide();$("#auth-link").after(a)}else $("#auth-link").show()}),!1;ltbx=new Lightbox($(".lightboxinner"),k);var o=new DDforLB($(".allpageinner"),ltbx);$(".boxhover[ref] .photo img").live("mousedown",function(a){a.stopPropagation();a.preventDefault();1==a.which&&o.prepare(a.pageX,a.pageY,n(f))});$(".boxhover[ref] .photo img").live("mouseup",function(){o.cancel()});$.getJSON(e,function(a){if(a.success){k=a.data;ltbx.update(k);var b=k;if(b&&b.productsInCart){for(var d in b.productsInCart){var c=
$("div.boxhover[ref="+d+"]");c.length&&(c=$("a.link1",c),c.attr("href",$(".lightboxinner .point2").attr("href")),c.addClass("active"));c=$("div.goodsbarbig[ref="+d+"]");if(c.length&&(c=$("a.link1",c),c.attr("href",$(".lightboxinner .point2").attr("href")),c.unbind("click").addClass("active"),l=!0,b.servicesInCart))for(var g in b.servicesInCart)d in b.servicesInCart[g]&&(c=$("div.mServ[ref="+g+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),c=$("td.bF1Block_eBuy[ref="+
g+"] input.button"),c.length&&c.addClass("active").val("В корзине").attr("href",j))}if(b.servicesInCart)for(g in b.servicesInCart)b.servicesInCart[g][0]&&(c=$("div.mServ[ref="+g+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),c=$("div.bServiceCard[ref="+g+"] input"),c.length&&c.val("В корзине").addClass("active").attr("href",j))}b=$("div.lightboxinner > .dropbox");b.length&&b.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-
$("div.lightboxinner").offset().left);PubSub.publish("auth try",a.data.name);a.data.name?(b={},b.user=a.data.name,a=tmpl("auth_tmpl",b),$("#auth-link").hide(),$("#auth-link").after(a)):$("#auth-link").show()}});var l=!1,p=null,f=0;$("b.rt:first").css("background-image");$(".goodsbox").live({mouseenter:function(){var a=this;if($(this).hasClass("goodsline"))f=$(".goodsboxlink",a).attr("ref");else if($(this).parent().hasClass("bigcarousel"))f=$(".boxhover",a).attr("ref");else{$(a).css("cursor","pointer");
var b=$(".boxhover .photo img",$(a));$(a).data("run",!0);f=$(".boxhover",a).attr("ref");p=setTimeout(function(){if($(a).data("run")){var d=1*b.attr("width"),c=1*b.attr("height");$(".boxhover .photo img",$(a)).css({width:d+3,height:c+3,top:"-1px"});$(a).css({position:"relative","z-index":2});$(a).children().fadeOut();$(".boxhover",a).fadeIn(200)}},200)}},mouseleave:function(){if(!$(this).hasClass("goodsline")&&!$(this).parent().hasClass("bigcarousel")){var a=$(".boxhover .photo img",this);if($(this).data("run")){clearTimeout(p);
$(this).data("run",!1);var b=1*a.attr("width"),a=1*a.attr("height");$(".boxhover .photo img",this).css({width:b+3,height:a+3});$(this).css("z-index",1);$(this).children().not(".boxhover").fadeIn();$(".boxhover",this).fadeOut("slow")}}}});$(".boxhover .lt").live("click",function(){if($(this).attr("data-url"))window.location.href=$(this).attr("data-url")});if($("div.bF1Info").length){var h=$("div.bF1Info"),i=$("div.bF1Block");$(".link1, .bF1Info_Logo",h).click(function(){i.show();return!1});$(".close",
i).click(function(){i.hide()});i.find("input.button").bind("click",function(){if($(this).hasClass("active"))return!1;$(this).val("В корзине").addClass("active").attr("href",j);var a=$(this).data();i.fadeOut();$.getJSON(a.url,function(b){if(!b.success)return!0;h.find("h3").text("Вы добавили услуги:");var d=tmpl("f1look",a),d=d.replace("F1ID",a.fid);h.find(".link1").before(d);b={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:b.data.full_quantity,sum:b.data.full_price,link:b.data.link,
price:$(".goodsinfo .price").html(),img:$(".goodsphoto img").attr("src")};b.f1=a;if(l)b.f1.only="yes";ltbx.getBasket(b);l||(l=!0,m())});return!1});$("a.bBacketServ__eMore",h).live("click",function(){var a=this;$.getJSON($(this).attr("href"),function(b){if(!b.success)return!0;var d=$(a).parent();i.find("td[ref="+d.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active");d.remove();ltbx.update({sum:b.data.full_price});$("a.bBacketServ__eMore",h).length||h.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")});
return!1})}var m=function(){$(".goodsbarbig .link1").attr("href",j).addClass("active");$("#bigpopup a.link1").attr("href",j).html("в корзине");$(".bSet__ePrice .link1").unbind("click");$(".goodsbar .link1").die("click");$(".bCountSet__eP").html("&nbsp;").addClass("disabled");$(".bCountSet__eM").html("&nbsp;").addClass("disabled")};$(".goodsbox a.link1").live("click",function(a){var b=this;if($(b).hasClass("disabled"))return!1;if($(b).hasClass("active"))return!0;if(!f)return!1;if(ltbx){var d=$(this).parent().parent().parent().find(".photo img.mainImg");
d.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:d.attr("src")},500)}var c=f;$.getJSON($(b).attr("href")+"1",function(a){if(a.success&&ltbx){var d=n(c);d.vitems=a.data.full_quantity;d.sum=a.data.full_price;d.link=a.data.link;ltbx.getBasket(d);$(b).attr("href",$(".lightboxinner .point2").attr("href"));$(b).addClass("active");PubSub.publish("productBought",f)}});a.stopPropagation();return!1});e=new function(){this.push=function(a,b,d){var c=$(".lightboxinner .point2").attr("href");
$("body").delegate(a,"click",function(){var a=$(this);b||(b=a.data("value"));if(!b)return!1;if(a.hasClass("active"))return document.location=a.attr("href"),!1;if(a.hasClass("disabled"))return!1;var e="/404.html";a.is("a")&&(e=a.text().replace(/\s/g,""),""!==e&&"&nbsp;"!==e&&a.text("В корзине"),e=a.attr("href"));if(a.is("input"))a.val("В корзине"),e=b.url;a.addClass("active").attr("href",c);$.getJSON(e,function(a){a.success&&ltbx&&(a={id:b.jsref,title:b.jstitle,price:b.jsprice,img:b.jsimg?b.jsimg:
"/images/logo.png",vitems:a.data.full_quantity,sum:a.data.full_price,link:a.data.link},ltbx.getBasket(a),d&&d(),PubSub.publish("productBought",a))});return!1})}};e.push("div.bServiceCardWrap input");e.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),m);e.push("#bigpopup a.link1",$("div.popup_leftpanel").data("value"),m);e.push("div.bSet a.link1",$("div.bSet").data("value"),m);e.push("div.mServ a.link1",$("div.mServ").data("value"));e.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),
function(){var a=$("div.bInShop__eButton a.link1");a.html("<i> </i>"+a.html())});e.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value"));"ANALYTICS"in window&&PubSub.subscribe("productBought",function(){"gooReMaBuy"in ANALYTICS&&ANALYTICS.gooReMaBuy()})});
