$(document).ready(function(){function e(e,t){if(!e.length)return null;var i=this,n=t,a=!1,r=null,o=25,s=30,l=$(".dropbox");if(!l.length)return null;var c=[],u=0,d=null,h=$("<div>").addClass("dragbox").css("display","none"),r=$("<div>");h.append(r),$(e).append(h);var p=$("<div>").addClass("graying").css({display:"none",opacity:"0.5"});$(e).append(p);var f=0;this.cancel=function(){$(document).unbind("mousemove.dragitem")},$(document).bind("mouseup",function(e){"dragimg"==e.target.id&&i.cancel()}),this.prepare=function(e,t,h){d=h,$(".goodsbox__inner[ref="+d.id+"] a.link1").hasClass("active")||$(document).bind("mousemove.dragitem",function(d){d.preventDefault(),a?(r.css({left:d.pageX-s,top:d.pageY-f-s}),u=$(l[0]).offset().top,d.pageY+s>u-o&&d.pageX+s>c[0]-o&&d.pageX-30<c[0]+70+o?n.toFire(3):n.putOutBoxes()):(Math.abs(e-d.pageX)>o||Math.abs(t-d.pageY)>o)&&(i.turnon(d.pageX,d.pageY),a=!0)})},this.turnon=function(e,t){n.clear(),p.show(),f=p.offset().top,r.html($("<img>").css({width:60,height:60}).attr({id:"dragimg",width:60,height:60,alt:"",src:d.img})),r.css({left:e-s,top:t-f-s}),h.show(),n.getContainers();for(var a=0;l.length>a;a++)c[a]=$(l[a]).offset().left;$(document).bind("mouseup.dragitem",function(){(fbox=n.gravitation())?($(document).unbind(".dragitem"),r.animate({left:c[0]+5,top:u-f+5},400,function(){i.finalize(fbox)})):i.turnoff()})},this.turnoff=function(){a=!1,p.fadeOut(),h.hide(),n.hideContainers(),$(document).unbind(".dragitem")},this.finalize=function(e){setTimeout(function(){switch(i.turnoff(),e){case 1:n.getComparing(d);break;case 2:n.getWishes(d);break;case 3:$.getJSON($(".goodsbox__inner[ref="+d.id+"] a.link1").attr("href"),function(e){if(e.success&&t){var i=d;i.vitems=e.data.full_quantity,i.sum=e.data.full_price,t.getBasket(i),x(e)}})}},400)}}function t(e){var t=$("div[ref="+e+"]"),i={id:$(t).attr("ref"),title:$("h3 a",t).html(),price:$(".price",t).html(),img:$(".photo img.mainImg",t).attr("src")};return i}function i(e){"undefined"!=typeof MyThings&&"undefined"!=e.data("product")&&MyThings.Track({EventType:MyThings.Event.Visit,Action:"1013",ProductId:e.data("product")}),($("#adriverProduct").length||$("#adriverCommon").length)&&"undefined"!=e.data("product")&&function(e){var t=document,i=t.createElement("IMG"),n=t.body;e=e.replace(/![rnd]/,Math.round(9999999*Math.random()))+"&tail256="+escape(t.referrer||"unknown"),i.style.position="absolute",i.style.width=i.style.height="0px",i.onload=i.onerror=function(){n.removeChild(i),i=n=null},i.src=e,n.insertBefore(i,n.firstChild)}("http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=add_basket&custom=10="+e.data("product")+";11="+e.data("category")+"&bt=55&pz=0&rnd=![rnd]")}var n=function(e){e.stopPropagation();var t=$(this);if(t.hasClass("disabled"))return!1;if(t.hasClass("active"))return!1;var n=t.attr("href"),a=t.data("product"),r=function(e){if(e.success&&(t.addClass("mBought"),x(e),i(t),console.log("ништяк погнали"),console.log(typeof blackBox),blackBox)){var n=e.data,r=e.result.product,o={id:a.id,title:r.name,price:r.price,imgSrc:"need image link",totalQuan:n.full_quantity,totalSum:n.full_price,linkToOrder:n.link};blackBox.basket().add(o)}};return $.get(n,r),!1};if($(".jsBuyButton").live("click",n),$("#similarGoodsSlider").length){var a=$("#similarGoodsSlider"),r=a.find(".bSimilarGoodsSlider_eWrap"),o=a.find(".bSimilarGoodsSlider_eArrow"),s=0,l=0,c=0,u=0,d=0,h=function(){var e=document.location,t=$(this).attr("href");"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","AdvisedCrossss",e,t])},p=function(){var e=$(this),t={"Recommended Item Clicked Similar Recommendation Place":"product","Recommended Item Clicked Similar Clicked SKU":e.data("article"),"Recommended Item Clicked Similar Clicked Product Name":e.data("name"),"Recommended Item Clicked Similar Product Position":e.data("pos")};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Similar",t])},f=function(e){for(var t in e){var i=tmpl("similarGoodTmpl",e[t]);r.append(i)}var n=a.find(".bSimilarGoodsSlider_eGoods");s=n.width()+2*parseInt(n.css("paddingLeft")),c=n.length,u=s*c,r.width(u),c>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()}),4>c&&$(".bSimilarGoodsSlider_eArrow.mRight").hide()};$.getJSON($("#similarGoodsSlider").data("url"),function(e){if(!$.isEmptyObject(e)){var t=e;f(t)}}).done(function(){var e=a.find(".bSimilarGoodsSlider_eGoods");c=e.length,u=s*c,r.width(u),c>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()})}),o.bind("click",function(){return $(this).hasClass("mLeft")?d+=2*s:d-=2*s,l-u>=d?(d=l-u,$(".bSimilarGoodsSlider_eArrow.mRight").hide(),$(".bSimilarGoodsSlider_eArrow.mLeft").show()):d>=0?(d=0,$(".bSimilarGoodsSlider_eArrow.mLeft").hide(),$(".bSimilarGoodsSlider_eArrow.mRight").show()):o.show(),r.animate({left:d}),!1}),$(".bSimilarGoods.mProduct .bSimilarGoodsSlider_eGoods").live("click",p),$(".bSimilarGoods.mCatalog .bSimilarGoodsSlider_eGoods a").live("click",h)}var m=!1;window.navigator.userAgent.indexOf("MSIE")>=0&&$(".allpageinner").delegate(".goodsbox__inner","hover",function(){$(this).toggleClass("hover")}),$(".goodsbox__inner").live("click",function(){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var v={uri:window.location.pathname,atcl:$(".bGood__eArticle span:last").text().replace(/[^0-9\-]/g,"")};if($(".bigcarousel").eq(0).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_up",v.atcl,v.uri])}),$(".bigcarousel").eq(1).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_down",v.atcl,v.uri])}),$(".bigcarousel .goodsbox__inner").bind("click",function(){var e=$(this).data("product");switch(e.type){case"Accessorize":var t={"Recommended Item Clicked Accessorize Recommendation Place":"product","Recommended Item Clicked Accessorize Clicked SKU":e.article,"Recommended Item Clicked Accessorize Clicked Product Name":e.name,"Recommended Item Clicked Accessorize Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Accessorize",t]);break;case"Also Bought":var t={"Recommended Item Clicked Also Bought Recommendation Place":"product","Recommended Item Clicked Also Bought Clicked SKU":e.article,"Recommended Item Clicked Also Bought Clicked Product Name":e.name,"Recommended Item Clicked Also Bought Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Bought",t]);break;case"Also Viewed":var t={"Recommended Item Clicked Also Viewed Recommendation Place":"product","Recommended Item Clicked Also Viewed Clicked SKU":e.article,"Recommended Item Clicked Also Viewed Clicked Product Name":e.name,"Recommended Item Clicked Also Viewed Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Viewed",t])}}),$("div.bF1Info").length){var g=$("div.bF1Info"),b=$("div.bF1Block");$(".link1, .bF1Info_Logo",g).click(function(){return $("div.hideblock.extWarranty").is(":visible")&&$("div.hideblock.extWarranty").hide(),b.show(),!1}),$(".close",b).click(function(){b.hide()}),b.find("input.button").bind("click",function(){if($(this).hasClass("active"))return window.location.href=$(this).attr("href"),!1;$(this).val("В корзине").addClass("active").attr("href",carturl);var e=$(this).data();return b.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;g.find("h3").text("Вы добавили услуги:");var i=tmpl("f1look",e);i=i.replace("F1ID",e.fid),g.find(".link1").before(i);var n={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};n.f1=e,m&&(n.f1.only="yes"),ltbx.getBasket(n),x(t),m||(m=!0,C())}),!1}),$("a.bBacketServ__eMore",g).live("click",function(){var e=this;return $.getJSON($(this).attr("href"),function(t){if(!t.success)return!0;var i=$(e).parent();b.find("td[ref="+i.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),i.remove(),ltbx.update({sum:t.data.full_price}),$("a.bBacketServ__eMore",g).length||g.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var y=new e($(".allpageinner"),ltbx);if($(".goodsbox__inner[ref] .mainImg").live("mousedown",function(e){e.stopPropagation(),e.preventDefault(),1==e.which&&y.prepare(e.pageX,e.pageY,t(currentItem))}),$(".goodsbox__inner[ref] .mainImg").live("mouseup",function(){y.cancel()}),$("div.bBlueButton.extWarranty").length&&$("div.bBlueButton.extWarranty").is(":visible")){var k=$("div.bBlueButton.extWarranty"),_=$("div.hideblock.extWarranty"),w=$("#ew_look");$(".link1",k).click(function(){return $("div.bF1Block").is(":visible")&&$("div.bF1Block").hide(),_.show(),!1}),$(".close",_).click(function(){_.hide()}),_.find("input.button").bind("click",function(){$("input.button",_).hasClass("active")&&$("input.button",_).val("Выбрать").removeClass("active"),$(this).val("Выбрана").addClass("active");var e=$(this).data();return _.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;$(".link1",k).text("Изменить гарантию"),k.find("h3").text("Вы выбрали гарантию:"),$(".ew_title",w).text(e.f1title),$(".ew_price",w).text(e.f1price),$(".bBacketServ__eMore",w).attr("href",e.deleteurl),w.show();var i={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};i.f1=e,m&&(i.f1.only="yes"),ltbx.getBasket(i),x(t),m||(m=!0,C())}),!1}),$(".bBacketServ__eMore",w).live("click",function(e){e.preventDefault();var t=this;return $.getJSON($(this).attr("href"),function(e){if(!e.success)return!0;var i=$(t).parent();$("input.button",_).val("Выбрать").removeClass("active"),$(".link1",k).text("Выбрать гарантию"),i.hide(),ltbx.update({sum:e.data.full_price}),w.hide(),$("a.bBacketServ__eMore",k).length||k.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var C=function(){var e=$(".lightboxinner .point2").attr("href");$("body").addClass("bought"),$(".goodsbarbig .link1").attr("href",e),$("#bigpopup a.link1").attr("href",e),$(".bSet__ePrice .link1").unbind("click"),$(".goodsbar .link1").die("click")},x=function(e){if(e.result.product){var t=e.result.product,i=window.location.href,n={"Add to Cart SKU":t.article,"Add to Cart SKU Quantity":t.quantity,"Add to Cart Product Name":t.name,"Add to Cart Root category":t.category[0].name,"Add to Cart Root ID":t.category[0].id,"Add to Cart Category name":t.category[t.category.length-1].name,"Add to Cart Category ID":t.category[t.category.length-1].id,"Add to Cart SKU Price":t.price,"Add to Cart Page URL":i,"Add to Cart F1 Quantity":t.serviceQuantity};"undefined"!=typeof _kmq&&_kmq.push(["record","Add to Cart",n])}if(e.result.service){var a=e.result.service,t=e.result.product,r={"Add F1 F1 Name":a.name,"Add F1 F1 Price":a.price,"Add F1 SKU":t.article,"Add F1 Product Name":t.name,"Add F1 Root category":t.category[0].name,"Add F1 Root ID":t.category[0].id,"Add F1 Category name":t.category[t.category.length-1].name,"Add F1 Category ID":t.category[t.category.length-1].id};"undefined"!=typeof _kmq&&_kmq.push(["record","Add F1",r])}if(e.result.warranty){var o=e.result.warranty,t=e.result.product,s={"Add Warranty Warranty Name":o.name,"Add Warranty Warranty Price":o.price,"Add Warranty SKU":t.article,"Add Warranty Product Name":t.name,"Add Warranty Root category":t.category[0].name,"Add Warranty Root ID":t.category[0].id,"Add Warranty Category name":t.category[t.category.length-1].name,"Add Warranty Category ID":t.category[t.category.length-1].id};"undefined"!=typeof _kmq&&_kmq.push(["record","Add Warranty",s])}};if("ANALYTICS"in window&&PubSub.subscribe("productBought",function(){}),$("#_categoryData").length){var S=$("#_categoryData").data("category"),M={"Viewed Category Category Type":S.type,"Viewed Category Category Level":S.level,"Viewed Category Parent category":S.parent_category,"Viewed Category Category name":S.category,"Viewed Category Category ID":S.id};"undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Category",M])}if($("#_searchKiss").length){var S=$("#_searchKiss").data("search"),M={"Search String":S.query,"Search Page URL":S.url,"Search Items Found":S.count};"undefined"!=typeof _kmq&&_kmq.push(["record","Search",M]);var I=function(){var e=$(this).data("add");({"Search Results Clicked Search String":S.query,"Search Results Clicked SKU":e.article,"Search Results Clicked Product Name":e.name,"Search Results Clicked Page Number":e.page,"Search Results Clicked Product Position":e.position}),"undefined"!=typeof _kmq&&_kmq.push(["record","Search Results Clicked",M])};$(".goodsbox__inner").live("click",I),$(".goodsboxlink").live("click",I)}});