$(document).ready(function(){function n(a){for(var b,d,c=document.cookie.split(";"),e=0,f=c.length;e<f;e++)if(b=c[e].substr(0,c[e].indexOf("=")),d=c[e].substr(c[e].indexOf("=")+1),b=b.replace(/^\s+|\s+$/g,""),b===a)return unescape(d);return!1}function o(a){a=$(".boxhover[ref="+a+"]");return{id:$(a).attr("ref"),title:$("h3 a",a).html(),price:$(".price",a).html(),img:$(".photo img",a).attr("src")}}var g="/user/shortinfo";n("enter")||(g+="?ts="+(new Date).getTime()+Math.floor(1E3*Math.random()));n("geoshop")||
$.getJSON("/region/init",function(a){if(!a.success)return!1;var a=a.data,b=$("<div>").addClass("graying").css({opacity:"0.5"}),d=$('<div class="bCityPopupWrap">').html('<div class="hideblock bCityPopup"><i title="Закрыть" class="close">Закрыть</i><div class="title">Привет, из какого ты города?</div></div></div>');d.find(".close").click(function(){$(".graying").remove();$(".bCityPopupWrap").hide()});for(var c=0,e=a.length;c<e;c++)if(!("undefined"===typeof a[c].link||"undefined"===typeof a[c].name)){var f=
$("<div>").append($("<a>").attr("href",a[c].link).text(a[c].name));"undefined"!==typeof a[c].is_active?(f.addClass("bCityPopup__eCurrent"),d.find(".title").after(f)):(f.addClass("bCityPopup__eBlock"),d.find("div:first").append(f))}$("body").append(b).append(d)});var j={};if(void 0===window.Lightbox)return $(".lightboxinner").hide(),$.getJSON(g,function(a){if(a.success)if(a.data.name){var b={};b.user=a.data.name;a=tmpl("auth_tmpl",b);$("#auth-link").hide();$("#auth-link").after(a)}else $("#auth-link").show()}),
!1;ltbx=new Lightbox($(".lightboxinner"),j);var p=new DDforLB($(".allpageinner"),ltbx);$(".boxhover[ref] .photo img").live("mousedown",function(a){a.stopPropagation();a.preventDefault();1==a.which&&p.prepare(a.pageX,a.pageY,o(k))});$(".boxhover[ref] .photo img").live("mouseup",function(){p.cancel()});$.getJSON(g,function(a){if(a.success){j=a.data;ltbx.update(j);var b=j;if(b&&b.productsInCart){for(var d in b.productsInCart){var c=$("div.boxhover[ref="+d+"]");c.length&&(c=$("a.link1",c),c.attr("href",
$(".lightboxinner .point2").attr("href")),c.addClass("active"));c=$("div.goodsbarbig[ref="+d+"]");if(c.length&&(c=$("a.link1",c),c.attr("href",$(".lightboxinner .point2").attr("href")),c.unbind("click").addClass("active"),l=!0,b.servicesInCart))for(var e in b.servicesInCart)d in b.servicesInCart[e]&&(c=$("div.mServ[ref="+e+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),c=$("td.bF1Block_eBuy[ref="+e+"] input.button"),c.length&&c.addClass("active").val("В корзине"))}if(b.servicesInCart)for(e in b.servicesInCart)b.servicesInCart[e][0]&&
(c=$("div.mServ[ref="+e+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),c=$("div.bServiceCard[ref="+e+"] input"),c.length&&c.val("В корзине").addClass("active"))}b=$("div.lightboxinner > .dropbox");b.length&&b.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left);a.data.name?(b={},b.user=a.data.name,a=tmpl("auth_tmpl",b),$("#auth-link").hide(),$("#auth-link").after(a)):$("#auth-link").show()}});
var l=!1,q=null,k=0;$("b.rt:first").css("background-image");$(".goodsbox").live({mouseenter:function(){var a=this;$(a).css("cursor","pointer");var b=$(".boxhover .photo img",$(a));$(a).data("run",!0);k=$(".boxhover",a).attr("ref");q=setTimeout(function(){if($(a).data("run")){var d=1*b.attr("width"),c=1*b.attr("height");$(".boxhover .photo img",$(a)).css({width:d+3,height:c+3,top:"-1px"});$(a).css({position:"relative","z-index":2});$(a).children().fadeOut();$(".boxhover",a).fadeIn(200)}},200)},mouseleave:function(){var a=
$(".boxhover .photo img",this);if($(this).data("run")){clearTimeout(q);$(this).data("run",!1);var b=1*a.attr("width"),a=1*a.attr("height");$(".boxhover .photo img",this).css({width:b+3,height:a+3});$(this).css("z-index",1);$(this).children().not(".boxhover").fadeIn();$(".boxhover",this).fadeOut("slow")}}});$(".boxhover .lt").live("click",function(){if($(this).attr("data-url"))window.location.href=$(this).attr("data-url")});if($("div.bF1Info").length){var h=$("div.bF1Info"),i=$("div.bF1Block");$(".link1",
h).click(function(){i.show();return!1});$(".close",i).click(function(){i.hide()});i.find("input.button").bind("click",function(){if($(this).hasClass("disabled"))return!1;$(this).val("В корзине").addClass("disabled");var a=$(this).data();i.fadeOut();$.getJSON(a.url,function(b){if(!b.success)return!0;h.find("h3").text("Вы добавили услуги:");var d=tmpl("f1look",a),d=d.replace("F1ID",a.fid);h.find(".link1").before(d);b={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:b.data.full_quantity,
sum:b.data.full_price,link:b.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img").attr("src")};b.f1=a;if(l)b.f1.only="yes";ltbx.getBasket(b);l||(l=!0,m())});return!1});$("a.bBacketServ__eMore",h).live("click",function(){var a=this;$.getJSON($(this).attr("href"),function(b){if(!b.success)return!0;var d=$(a).parent();i.find("td[ref="+d.attr("ref")+"]").find("input").val("Купить услугу").removeClass("disabled");d.remove();ltbx.update({sum:b.data.full_price});$("a.bBacketServ__eMore",
h).length||h.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")});return!1})}var m=function(){var a=$(".lightboxinner .point2").attr("href");$(".goodsbarbig .link1").attr("href",a).addClass("active");$("#bigpopup a.link1").attr("href",a).html("в корзине");$(".bSet__ePrice .link1").unbind("click");$(".goodsbar .link1").die("click")};$(".goodsbar .link1").live("click",function(a){var b=this;if($(b).hasClass("disabled"))return!1;if($(b).hasClass("active"))return!0;if(!k)return!1;if(ltbx){var d=
$(this).parent().parent().find(".photo img");d.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:d.attr("src")},500)}var c=k;$.getJSON($(b).attr("href")+"/1",function(a){if(a.success&&ltbx){var d=o(c);d.vitems=a.data.full_quantity;d.sum=a.data.full_price;d.link=a.data.link;ltbx.getBasket(d);$(b).attr("href",$(".lightboxinner .point2").attr("href"));$(b).addClass("active")}});a.stopPropagation();return!1});g=new function(){this.push=function(a,b,d){var c=$(".lightboxinner .point2").attr("href");
$("body").delegate(a,"click",function(){var a=$(this);b||(b=a.data("value"));if(!b)return!1;if(a.hasClass("active"))return!0;var f="/404.html";a.is("a")&&(f=a.text().replace(/\s/g,""),""!==f&&"&nbsp;"!==f&&a.text("В корзине"),f=a.attr("href"));if(a.is("input"))a.val("В корзине"),f=b.url;a.addClass("active").attr("href",c);$.getJSON(f,function(a){a.success&&ltbx&&(ltbx.getBasket({id:b.jsref,title:b.jstitle,price:b.jsprice,img:b.jsimg?b.jsimg:"/images/logo.png",vitems:a.data.full_quantity,sum:a.data.full_price,
link:a.data.link}),d&&d())});return!1})}};g.push("div.bServiceCardWrap input");g.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),m);g.push("#bigpopup a.link1",$("div.popup_leftpanel").data("value"),m);g.push("div.bSet a.link1",$("div.bSet").data("value"),m);g.push("div.mServ a.link1",$("div.mServ").data("value"));$(".goodsbarbig .link2, .goodsbarbig .link3").addClass("disabled").attr("href","#").click(function(){return!1});$(".goodsbar .link2").click(function(){return!1});$(".goodsbar .link3").click(function(){return!1})});
