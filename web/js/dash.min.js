$(document).ready(function(){function m(e){var t=$("div[ref="+e+"]"),n={id:$(t).attr("ref"),title:$("h3 a",t).html(),price:$(".price",t).html(),img:$(".photo img.mainImg",t).attr("src")};return n}function y(){this.push=function(e,t,n){if(!$(e).length)return;var r=$(".lightboxinner .point2").attr("href");$("body").delegate(e,"click",function(){var e=$(this);t||(t=e.data("value"));if(!t)return!1;if(e.hasClass("active"))return document.location=e.attr("href"),!1;if(e.hasClass("disabled"))return!1;var i="/404.html";if(e.is("a")){var s=e.text().replace(/\s/g,"");s!==""&&s!=="&nbsp;"&&e.text("В корзине"),i=e.attr("href")}return e.is("input")&&(e.val("В корзине"),i=t.url),e.addClass("active").attr("href",r),$.getJSON(i,function(e){if(e.success&&ltbx){var r={id:t.jsref,title:t.jstitle,price:t.jsprice,img:t.jsimg?t.jsimg:"/images/logo.png",vitems:e.data.full_quantity,sum:e.data.full_price,link:e.data.link};ltbx.getBasket(r),n&&n(),PubSub.publish("productBought",r)}}),!1})}}var e=$(".lightboxinner .point2").attr("href"),t="/user/shortinfo";if(!docCookies.hasItem("enter")||!docCookies.hasItem("enter_auth"))t+="?ts="+(new Date).getTime()+Math.floor(Math.random()*1e3);var n={};if(window.Lightbox===undefined)return $(".lightboxinner").hide(),$.getJSON(t,function(e){if(e.success)if(e.data.name){var t={};t.user=e.data.name;var n=tmpl("auth_tmpl",t);$("#auth-link").hide(),$("#auth-link").after(n)}else $("#auth-link").show()}),!1;ltbx=new Lightbox($(".lightboxinner"),n);var r=new DDforLB($(".allpageinner"),ltbx);$(".boxhover[ref] .photo img").live("mousedown",function(e){e.stopPropagation(),e.preventDefault(),e.which==1&&r.prepare(e.pageX,e.pageY,m(u))}),$(".boxhover[ref] .photo img").live("mouseup",function(e){r.cancel()}),$.getJSON(t,function(e){if(e.success){n=e.data,ltbx.update(n),s(n);var t=$("div.lightboxinner > .dropbox");t.length&&t.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left),PubSub.publish("auth try",e.data.name);if(e.data.name){var r={};r.user=e.data.name;var i=tmpl("auth_tmpl",r);$("#auth-link").hide(),$("#auth-link").after(i)}else $("#auth-link").show()}});var i=!1,s=function(t){if(!t||!t.productsInCart)return!1;for(var n in t.productsInCart){var r=$("div.boxhover[ref="+n+"]");if(r.length){var s=$("a.link1",r);s.attr("href",$(".lightboxinner .point2").attr("href")),s.addClass("active")}r=$("div.goodsbarbig[ref="+n+"]");if(r.length){var s=$("a.link1",r);s.attr("href",$(".lightboxinner .point2").attr("href")),s.unbind("click").addClass("active"),i=!0;if(t.servicesInCart)for(var o in t.servicesInCart)if(n in t.servicesInCart[o]){var s=$("div.mServ[ref="+o+"] a.link1");s.length&&s.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),s=$("td.bF1Block_eBuy[ref="+o+"] input.button"),s.length&&s.addClass("active").val("В корзине").attr("href",e)}}}if(t.servicesInCart)for(var o in t.servicesInCart)if(t.servicesInCart[o][0]){var s=$("div.mServ[ref="+o+"] a.link1");s.length&&s.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),s=$("div.bServiceCard[ref="+o+"] input"),s.length&&s.val("В корзине").addClass("active").attr("href",e)}},o=null,u=0,a=$("b.rt:first").css("background-image");$(".goodsbox").live({mouseenter:function(){function n(){if($(e).data("run")){var n=t.attr("width")*1,r=t.attr("height")*1;$(".boxhover .mainImg",$(e)).css({width:n+3,height:r+3,top:"-1px"}),$(e).css({position:"relative","z-index":2}),$(e).children().fadeOut(),$(".boxhover",e).fadeIn(200)}}var e=this;if($(this).hasClass("goodsline")){u=$(".goodsboxlink",e).attr("ref");return}if($(this).parent().hasClass("bigcarousel")){u=$(".boxhover",e).attr("ref");return}$(e).css("cursor","pointer");var t=$(".boxhover .mainImg",$(e));$(e).data("run",!0),u=$(".boxhover",e).attr("ref"),o=setTimeout(n,200)},mouseleave:function(){if($(this).hasClass("goodsline")||$(this).parent().hasClass("bigcarousel"))return;var e=this,t=$(".boxhover .mainImg",e);if($(e).data("run")){clearTimeout(o),$(e).data("run",!1);var n=t.attr("width")*1,r=t.attr("height")*1;$(".boxhover .mainImg",e).css({width:n+3,height:r+3}),$(e).css("z-index",1),$(e).children().not(".boxhover").fadeIn(),$(".boxhover",e).fadeOut("slow")}}}),$(".boxhover .lt").live("click",function(e){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var f={uri:window.location.pathname,atcl:$(".bGood__eArticle span:last").text().replace(/[^0-9\-]/g,"")};$(".bigcarousel").eq(0).bind("click",function(e){_gaq&&_gaq.push(["_trackEvent","accessories_up",f.atcl,f.uri])}),$(".bigcarousel").eq(1).bind("click",function(e){_gaq&&_gaq.push(["_trackEvent","accessories_down",f.atcl,f.uri])});if($("div.bF1Info").length){var l=$("div.bF1Info"),c=$("div.bF1Block");$(".link1, .bF1Info_Logo",l).click(function(){return $("div.hideblock.extWarranty").is(":visible")&&$("div.hideblock.extWarranty").hide(),c.show(),!1}),$(".close",c).click(function(){c.hide()}),c.find("input.button").bind("click",function(){if($(this).hasClass("active"))return!1;$(this).val("В корзине").addClass("active").attr("href",e);var t=$(this).data();return c.fadeOut(),$.getJSON(t.url,function(e){if(!e.success)return!0;l.find("h3").text("Вы добавили услуги:");var n=tmpl("f1look",t);n=n.replace("F1ID",t.fid),l.find(".link1").before(n);var r={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:e.data.full_quantity,sum:e.data.full_price,link:e.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};r.f1=t,i&&(r.f1.only="yes"),ltbx.getBasket(r),i||(i=!0,v())}),!1}),$("a.bBacketServ__eMore",l).live("click",function(){var e=this;return $.getJSON($(this).attr("href"),function(t){if(!t.success)return!0;var n=$(e).parent();c.find("td[ref="+n.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),n.remove(),ltbx.update({sum:t.data.full_price}),$("a.bBacketServ__eMore",l).length||l.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}if($("div.bBlueButton.extWarranty").length&&$("div.bBlueButton.extWarranty").is(":visible")){var h=$("div.bBlueButton.extWarranty"),p=$("div.hideblock.extWarranty"),d=$("#ew_look");$(".link1",h).click(function(){return $("div.bF1Block").is(":visible")&&$("div.bF1Block").hide(),p.show(),!1}),$(".close",p).click(function(){p.hide()}),p.find("input.button").bind("click",function(){$("input.button",p).hasClass("active")&&$("input.button",p).val("Выбрать").removeClass("active"),$(this).val("Выбрана").addClass("active");var e=$(this).data();return p.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;$(".link1",h).text("Изменить гарантию"),h.find("h3").text("Вы выбрали гарантию:"),$(".ew_title",d).text(e.f1title),$(".ew_price",d).text(e.f1price),$(".bBacketServ__eMore",d).attr("href",e.deleteurl),d.show();var n={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};n.f1=e,i&&(n.f1.only="yes"),ltbx.getBasket(n),i||(i=!0,v())}),!1}),$(".bBacketServ__eMore",d).live("click",function(e){e.preventDefault();var t=this;return $.getJSON($(this).attr("href"),function(e){if(!e.success)return!0;var n=$(t).parent();p.find("td[ref="+n.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),n.hide(),ltbx.update({sum:e.data.full_price}),d.hide(),$("a.bBacketServ__eMore",h).length||h.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var v=function(){var e=$(".lightboxinner .point2").attr("href");$(".goodsbarbig .link1").attr("href",e).addClass("active"),$("#bigpopup a.link1").attr("href",e).html("в корзине"),$(".bSet__ePrice .link1").unbind("click"),$(".goodsbar .link1").die("click"),$(".bCountSet__eP").html("&nbsp;").addClass("disabled"),$(".bCountSet__eM").html("&nbsp;").addClass("disabled")};$(".goodsbox a.link1").live("click",function(e){var t=this;if($(t).hasClass("disabled"))return!1;if($(t).hasClass("active"))return!0;if(!u)return!1;if(ltbx){var n=$(this).parent().parent().parent().find(".photo img.mainImg");n.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:n.attr("src")},500)}var r=u,i=$(t).attr("href");return $.getJSON(i,function(e){if(e.success&&ltbx){var n=m(r);n.vitems=e.data.full_quantity,n.sum=e.data.full_price,n.link=e.data.link,ltbx.getBasket(n),$(t).attr("href",$(".lightboxinner .point2").attr("href")),$(t).addClass("active"),PubSub.publish("productBought",u)}}),e.stopPropagation(),!1});var g=new y;g.push("div.bServiceCardWrap input"),g.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),v),g.push("#bigpopup a.link1",$("div.popup_leftpanel").data("value"),v),g.push("div.bSet a.link1",$("div.bSet").data("value"),v),g.push("div.mServ a.link1",$("div.mServ").data("value")),g.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),function(){var e=$("div.bInShop__eButton a.link1");e.html("<i> </i>"+e.html())}),g.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value")),"ANALYTICS"in window&&PubSub.subscribe("productBought",function(){"gooReMaBuy"in ANALYTICS&&ANALYTICS.gooReMaBuy(),"myThingsBuy"in ANALYTICS&&ANALYTICS.myThingsBuy(arguments[1])})});