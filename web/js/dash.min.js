$(document).ready(function(){function m(a){a=$("div[ref="+a+"]");return{id:$(a).attr("ref"),title:$("h3 a",a).html(),price:$(".price",a).html(),img:$(".photo img.mainImg",a).attr("src")}}var d="/user/shortinfo";if(!docCookies.hasItem("enter")||!docCookies.hasItem("enter_auth"))d+="?ts="+(new Date).getTime()+Math.floor(1E3*Math.random());var j={};if(void 0===window.Lightbox)return $(".lightboxinner").hide(),$.getJSON(d,function(a){if(a.success)if(a.data.name){var b={};b.user=a.data.name;a=tmpl("auth_tmpl",
b);$("#auth-link").hide();$("#auth-link").after(a)}else $("#auth-link").show()}),!1;ltbx=new Lightbox($(".lightboxinner"),j);var n=new DDforLB($(".allpageinner"),ltbx);$(".boxhover[ref] .photo img").live("mousedown",function(a){a.stopPropagation();a.preventDefault();1==a.which&&n.prepare(a.pageX,a.pageY,m(g))});$(".boxhover[ref] .photo img").live("mouseup",function(){n.cancel()});$.getJSON(d,function(a){if(a.success){j=a.data;ltbx.update(j);var b=j;if(b&&b.productsInCart){for(var e in b.productsInCart){var c=
$("div.boxhover[ref="+e+"]");c.length&&(c=$("a.link1",c),c.attr("href",$(".lightboxinner .point2").attr("href")),c.addClass("active"));c=$("div.goodsbarbig[ref="+e+"]");if(c.length&&(c=$("a.link1",c),c.attr("href",$(".lightboxinner .point2").attr("href")),c.unbind("click").addClass("active"),k=!0,b.servicesInCart))for(var f in b.servicesInCart)e in b.servicesInCart[f]&&(c=$("div.mServ[ref="+f+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),c=$("td.bF1Block_eBuy[ref="+
f+"] input.button"),c.length&&c.addClass("active").val("В корзине"))}if(b.servicesInCart)for(f in b.servicesInCart)b.servicesInCart[f][0]&&(c=$("div.mServ[ref="+f+"] a.link1"),c.length&&c.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),c=$("div.bServiceCard[ref="+f+"] input"),c.length&&c.val("В корзине").addClass("active"))}b=$("div.lightboxinner > .dropbox");b.length&&b.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left);
PubSub.publish("auth try",a.data.name);a.data.name?(b={},b.user=a.data.name,a=tmpl("auth_tmpl",b),$("#auth-link").hide(),$("#auth-link").after(a)):$("#auth-link").show()}});var k=!1,o=null,g=0;$("b.rt:first").css("background-image");$(".goodsbox").live({mouseenter:function(){var a=this;if($(this).hasClass("goodsline"))g=$(".goodsboxlink",a).attr("ref");else if($(this).parent().hasClass("bigcarousel"))g=$(".boxhover",a).attr("ref");else{$(a).css("cursor","pointer");var b=$(".boxhover .photo img",$(a));
$(a).data("run",!0);g=$(".boxhover",a).attr("ref");o=setTimeout(function(){if($(a).data("run")){var e=1*b.attr("width"),c=1*b.attr("height");$(".boxhover .photo img",$(a)).css({width:e+3,height:c+3,top:"-1px"});$(a).css({position:"relative","z-index":2});$(a).children().fadeOut();$(".boxhover",a).fadeIn(200)}},200)}},mouseleave:function(){if(!$(this).hasClass("goodsline")&&!$(this).parent().hasClass("bigcarousel")){var a=$(".boxhover .photo img",this);if($(this).data("run")){clearTimeout(o);$(this).data("run",
!1);var b=1*a.attr("width"),a=1*a.attr("height");$(".boxhover .photo img",this).css({width:b+3,height:a+3});$(this).css("z-index",1);$(this).children().not(".boxhover").fadeIn();$(".boxhover",this).fadeOut("slow")}}}});$(".boxhover .lt").live("click",function(){if($(this).attr("data-url"))window.location.href=$(this).attr("data-url")});if($("div.bF1Info").length){var h=$("div.bF1Info"),i=$("div.bF1Block");$(".link1, .bF1Info_Logo",h).click(function(){i.show();return!1});$(".close",i).click(function(){i.hide()});
i.find("input.button").bind("click",function(){if($(this).hasClass("active"))return!1;$(this).val("В корзине").addClass("active");var a=$(this).data();i.fadeOut();$.getJSON(a.url,function(b){if(!b.success)return!0;h.find("h3").text("Вы добавили услуги:");var e=tmpl("f1look",a),e=e.replace("F1ID",a.fid);h.find(".link1").before(e);b={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:b.data.full_quantity,sum:b.data.full_price,link:b.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img").attr("src")};
b.f1=a;if(k)b.f1.only="yes";ltbx.getBasket(b);k||(k=!0,l())});return!1});$("a.bBacketServ__eMore",h).live("click",function(){var a=this;$.getJSON($(this).attr("href"),function(b){if(!b.success)return!0;var e=$(a).parent();i.find("td[ref="+e.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active");e.remove();ltbx.update({sum:b.data.full_price});$("a.bBacketServ__eMore",h).length||h.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")});return!1})}var l=function(){var a=$(".lightboxinner .point2").attr("href");
$(".goodsbarbig .link1").attr("href",a).addClass("active");$("#bigpopup a.link1").attr("href",a).html("в корзине");$(".bSet__ePrice .link1").unbind("click");$(".goodsbar .link1").die("click");$(".bCountSet__eP").html("&nbsp;").addClass("disabled");$(".bCountSet__eM").html("&nbsp;").addClass("disabled")};$(".goodsbox a.link1").live("click",function(a){var b=this;if($(b).hasClass("disabled"))return!1;if($(b).hasClass("active"))return!0;if(!g)return!1;if(ltbx){var e=$(this).parent().parent().parent().find(".photo img.mainImg");
e.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:e.attr("src")},500)}var c=g;$.getJSON($(b).attr("href")+"/1",function(a){if(a.success&&ltbx){var e=m(c);e.vitems=a.data.full_quantity;e.sum=a.data.full_price;e.link=a.data.link;ltbx.getBasket(e);$(b).attr("href",$(".lightboxinner .point2").attr("href"));$(b).addClass("active")}});a.stopPropagation();return!1});d=new function(){this.push=function(a,b,e){var c=$(".lightboxinner .point2").attr("href");$("body").delegate(a,"click",function(){var a=
$(this);b||(b=a.data("value"));if(!b)return!1;if(a.hasClass("active"))return!0;if(a.hasClass("disabled"))return!1;var d="/404.html";a.is("a")&&(d=a.text().replace(/\s/g,""),""!==d&&"&nbsp;"!==d&&a.text("В корзине"),d=a.attr("href"));if(a.is("input"))a.val("В корзине"),d=b.url;a.addClass("active").attr("href",c);"creditBox"in window&&(d.match(/_quantity\/[0-9]+/)||(d+="/1"),d=creditBox.getState()?d+"/1":d+"/0");$.getJSON(d,function(a){a.success&&ltbx&&(ltbx.getBasket({id:b.jsref,title:b.jstitle,price:b.jsprice,
img:b.jsimg?b.jsimg:"/images/logo.png",vitems:a.data.full_quantity,sum:a.data.full_price,link:a.data.link}),e&&e())});return!1})}};d.push("div.bServiceCardWrap input");d.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),l);d.push("#bigpopup a.link1",$("div.popup_leftpanel").data("value"),l);d.push("div.bSet a.link1",$("div.bSet").data("value"),l);d.push("div.mServ a.link1",$("div.mServ").data("value"));d.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),function(){var a=
$("div.bInShop__eButton a.link1");a.html("<i> </i>"+a.html())});d.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value"))});
