$(document).ready(function(){function E(e,t){if(!e.length)return null;var n=this,r=t,i=!1,s=null,o=25,u=30,a=$(".dropbox");if(!a.length)return null;var f=[],l=0,c=null,h=$("<div>").addClass("dragbox").css("display","none"),s=$("<div>");h.append(s),$(e).append(h);var p=$("<div>").addClass("graying").css({display:"none",opacity:"0.5"});$(e).append(p);var d=0;this.cancel=function(){$(document).unbind("mousemove.dragitem")},$(document).bind("mouseup",function(e){e.target.id=="dragimg"&&n.cancel()}),this.prepare=function(e,t,h){c=h;if($(".goodsbox__inner[ref="+c.id+"] a.link1").hasClass("active"))return;$(document).bind("mousemove.dragitem",function(c){c.preventDefault();if(!i){if(Math.abs(e-c.pageX)>o||Math.abs(t-c.pageY)>o)n.turnon(c.pageX,c.pageY),i=!0}else s.css({left:c.pageX-u,top:c.pageY-d-u}),l=$(a[0]).offset().top,c.pageY+u>l-o&&c.pageX+u>f[0]-o&&c.pageX-30<f[0]+70+o?r.toFire(3):r.putOutBoxes()})},this.turnon=function(e,t){r.clear(),p.show(),d=p.offset().top,s.html($("<img>").css({width:60,height:60}).attr({id:"dragimg",width:60,height:60,alt:"",src:c.img})),s.css({left:e-u,top:t-d-u}),h.show(),r.getContainers();for(var i=0;i<a.length;i++)f[i]=$(a[i]).offset().left;$(document).bind("mouseup.dragitem",function(){(fbox=r.gravitation())?($(document).unbind(".dragitem"),s.animate({left:f[0]+5,top:l-d+5},400,function(){n.finalize(fbox)})):n.turnoff()})},this.turnoff=function(){i=!1,p.fadeOut(),h.hide(),r.hideContainers(),$(document).unbind(".dragitem")},this.finalize=function(e){setTimeout(function(){n.turnoff();switch(e){case 1:r.getComparing(c);break;case 2:r.getWishes(c);break;case 3:$.getJSON($(".goodsbox__inner[ref="+c.id+"] a.link1").attr("href"),function(e){if(e.success&&t){var n=c;n.vitems=e.data.full_quantity,n.sum=e.data.full_price,t.getBasket(n),O(e)}})}},400)}}function C(e){var t=$("div[ref="+e+"]"),n={id:$(t).attr("ref"),title:$("h3 a",t).html(),price:$(".price",t).html(),img:$(".photo img.mainImg",t).attr("src")};return n}function k(e){typeof MyThings!="undefined"&&e.data("product")!="undefined"&&MyThings.Track({EventType:MyThings.Event.Visit,Action:"1013",ProductId:e.data("product")}),($("#adriverProduct").length||$("#adriverCommon").length)&&e.data("product")!="undefined"&&function(e){var t=document,n=t.createElement("IMG"),r=t.body;e=e.replace(/![rnd]/,Math.round(Math.random()*9999999))+"&tail256="+escape(t.referrer||"unknown"),n.style.position="absolute",n.style.width=n.style.height="0px",n.onload=n.onerror=function(){r.removeChild(n),n=r=null},n.src=e,r.insertBefore(n,r.firstChild)}("http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=add_basket&custom=10="+e.data("product")+";11="+e.data("category")+"&bt=55&pz=0&rnd=![rnd]")}function A(){this.push=function(e,t,n){if(!$(e).length)return;var r=$(".lightboxinner .point2").attr("href");$("body").delegate(e,"click",function(e){e.preventDefault();var i=$(this);t||(t=i.data("value"));if(!t)return!1;if($("body").hasClass("bought"))return document.location=r,!1;if(i.hasClass("disabled"))return!1;var s="/404.html";if(i.is("a")){var o=i.text().replace(/\s/g,"");o!==""&&o!=="&nbsp;"&&i.text("В корзине"),s=i.attr("href")}i.is("input")&&(i.val("В корзине"),s=t.url);var u=docCookies.getItem("switch");return u!==null&&u!=="default"?(window.location.href=s,!1):($("body").addClass("bought"),$.getJSON(s,function(e){if(e.success&&ltbx){var r={id:t.jsref,title:t.jstitle,price:t.jsprice,img:t.jsimg?t.jsimg:"/images/logo.png",vitems:e.data.full_quantity,sum:e.data.full_price,link:e.data.link};ltbx.getBasket(r),O(e),n&&n(),PubSub.publish("productBought",r),k($(i))}}),!1)})}}if($("#similarGoodsSlider").length){var e=$("#similarGoodsSlider"),t=e.find(".bSimilarGoodsSlider_eWrap"),n=e.find(".bSimilarGoodsSlider_eArrow"),r=0,i=0,s=0,o=0,u=0,a=function(){var e=document.location,t=$(this).attr("href");typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","AdvisedCrossss",e,t])},f=function(n){for(var u in n){var a=tmpl("similarGoodTmpl",n[u]);t.append(a)}var f=e.find(".bSimilarGoodsSlider_eGoods");r=f.width()+parseInt(f.css("paddingLeft"))*2,s=f.length,o=r*s,t.width(o),s>0&&$(".bSimilarGoods").fadeIn(300,function(){i=e.width()}),s<4&&$(".bSimilarGoodsSlider_eArrow.mRight").hide()};$.getJSON($("#similarGoodsSlider").data("url"),function(e){if(!$.isEmptyObject(e)){var t=e;f(t)}}).done(function(){var n=e.find(".bSimilarGoodsSlider_eGoods");s=n.length,o=r*s,t.width(o),s>0&&$(".bSimilarGoods").fadeIn(300,function(){i=e.width()})}),n.bind("click",function(){return $(this).hasClass("mLeft")?u+=r*2:u-=r*2,u<=i-o?(u=i-o,$(".bSimilarGoodsSlider_eArrow.mRight").hide(),$(".bSimilarGoodsSlider_eArrow.mLeft").show()):u>=0?(u=0,$(".bSimilarGoodsSlider_eArrow.mLeft").hide(),$(".bSimilarGoodsSlider_eArrow.mRight").show()):n.show(),t.animate({left:u}),!1}),$(".bSimilarGoods.mCatalog .bSimilarGoodsSlider_eGoods a").live("click",a)}var l=function(e){var t=$(".bSubscribeLightboxPopupNotNow"),n=$(".bSubscribeLightboxPopup"),r=$(".bSubscribeLightboxPopup__eInput");r.placeholder();var i=function(){var e=$(this).data("url"),t=r.val();return t.search("@")!==-1?$.post(e,{email:t},function(e){if(!e.success)return!1;n.html('<span class="bSubscribeLightboxPopup__eTitle mType">Спасибо! подтверждение подписки отправлено на указанный e-mail</span>'),docCookies.setItem(!1,"subscribed",1,15768e4,"/"),typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","Account","Emailing sign up","Page top"]),setTimeout(function(){n.slideUp(300)},3e3)}):r.addClass("mError"),!1},s=function(){n.slideDown(300),r.keydown(function(){$(this).removeClass("mError")}),$(".bSubscribeLightboxPopup__eBtn").bind("click",i),$(".bSubscribeLightboxPopup__eNotNow").bind("click",function(){var e=$(this).data("url");return n.slideUp(300,o),docCookies.setItem(!1,"subscribed",0,15768e4,"/"),$.post(e),!1})},o=function(){t.slideDown(300),t.bind("click",function(){$(this).slideUp(300),s()})};if(!e.show)return e.agrred||o(),!1;s()},c=function(e){e.subscribe!==undefined&&l(e.subscribe)},h=$(".lightboxinner .point2").attr("href"),p="/user/shortinfo";if(!docCookies.hasItem("enter")||!docCookies.hasItem("enter_auth"))p+="?ts="+(new Date).getTime()+Math.floor(Math.random()*1e3);var d={};if(!$(".lightbox").length)return $(".lightboxinner").hide(),$.getJSON(p,function(e){if(e.success){e.data.vitems>0&&$("#topBasket").text("("+e.data.vitems+")");if(e.data.name){var t={};t.user=e.data.name;var n=tmpl("auth_tmpl",t);$("#auth-link").hide(),$("#auth-link").after(n)}else $("#auth-link").show()}}),!1;ltbx=new Lightbox($(".lightboxinner"),d),$.getJSON(p,function(e){if(e.success){d=e.data,ltbx.update(d),m(d);var t=$("div.lightboxinner > .dropbox");t.length&&t.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left),PubSub.publish("auth try",e.data.name);if(e.data.name){var n={};n.user=e.data.name;var r=tmpl("auth_tmpl",n);$("#auth-link").hide(),$("#auth-link").after(r)}else $("#auth-link").show();$("#upsale").length&&($("#upsaleCounter").html(e.data.vitems),$("#upsalePrice").html(e.data.sum)),e.data.action!==undefined&&c(e.data.action)}});var v=!1,m=function(e){if(!e||!e.productsInCart)return!1;for(var t in e.productsInCart){var n=$("div.boxhover[ref="+t+"]");if(n.length){var r=$("a.link1",n);r.attr("href",$(".lightboxinner .point2").attr("href")),r.addClass("active")}n=$("div.goodsbarbig[ref="+t+"]");if(n.length){var r=$("a.link1",n);r.attr("href",$(".lightboxinner .point2").attr("href")),$("body").addClass("bought"),r.unbind("click"),v=!0;if(e.servicesInCart)for(var i in e.servicesInCart)if(t in e.servicesInCart[i]){var r=$("div.mServ[ref="+i+"] a.link1");r.length&&r.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),r=$("td.bF1Block_eBuy[ref="+i+"] input.button"),r.length&&r.addClass("active").val("В корзине").attr("href",h)}}}if(e.servicesInCart)for(var i in e.servicesInCart)if(e.servicesInCart[i][0]){var r=$("div.mServ[ref="+i+"] a.link1");r.length&&r.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),r=$("div.bServiceCard[ref="+i+"] input"),r.length&&r.val("В корзине").addClass("active").attr("href",h)}};window.navigator.userAgent.indexOf("MSIE")>=0&&$(".allpageinner").delegate(".goodsbox__inner","hover",function(){$(this).toggleClass("hover")}),$(".allpageinner").delegate(".goodsbox","mouseenter",function(){currentItem=$(this).attr("ref")}),$(".goodsbox__inner").live("click",function(e){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var g={uri:window.location.pathname,atcl:$(".bGood__eArticle span:last").text().replace(/[^0-9\-]/g,"")};$(".bigcarousel").eq(0).bind("click",function(e){typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","accessories_up",g.atcl,g.uri])}),$(".bigcarousel").eq(1).bind("click",function(e){typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","accessories_down",g.atcl,g.uri])}),$(".bigcarousel .goodsbox__inner").bind("click",function(){var e=$(this).data("product");switch(e.type){case"Accessorize":var t={"Recommended Item Clicked Accessorize Recommendation Place":"product","Recommended Item Clicked Accessorize Clicked SKU":e.article,"Recommended Item Clicked Accessorize Clicked Product Name":e.name,"Recommended Item Clicked Accessorize Product Position":e.position};typeof _kmq!="undefined"&&_kmq.push(["record","Recommended Item Clicked Accessorize",t]);break;case"Also Bought":var t={"Recommended Item Clicked Also Bought Recommendation Place":"product","Recommended Item Clicked Also Bought Clicked SKU":e.article,"Recommended Item Clicked Also Bought Clicked Product Name":e.name,"Recommended Item Clicked Also Bought Product Position":e.position};typeof _kmq!="undefined"&&_kmq.push(["record","Recommended Item Clicked Also Bought",t]);break;case"Also Viewed":var t={"Recommended Item Clicked Also Viewed Recommendation Place":"product","Recommended Item Clicked Also Viewed Clicked SKU":e.article,"Recommended Item Clicked Also Viewed Clicked Product Name":e.name,"Recommended Item Clicked Also Viewed Product Position":e.position};typeof _kmq!="undefined"&&_kmq.push(["record","Recommended Item Clicked Also Viewed",t])}});if($("div.bF1Info").length){var y=$("div.bF1Info"),b=$("div.bF1Block");$(".link1, .bF1Info_Logo",y).click(function(){return $("div.hideblock.extWarranty").is(":visible")&&$("div.hideblock.extWarranty").hide(),b.show(),!1}),$(".close",b).click(function(){b.hide()}),b.find("input.button").bind("click",function(){if($(this).hasClass("active"))return window.location.href=$(this).attr("href"),!1;$(this).val("В корзине").addClass("active").attr("href",h);var e=$(this).data();return b.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;y.find("h3").text("Вы добавили услуги:");var n=tmpl("f1look",e);n=n.replace("F1ID",e.fid),y.find(".link1").before(n);var r={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};r.f1=e,v&&(r.f1.only="yes"),ltbx.getBasket(r),O(t),v||(v=!0,N())}),!1}),$("a.bBacketServ__eMore",y).live("click",function(){var e=this;return $.getJSON($(this).attr("href"),function(t){if(!t.success)return!0;var n=$(e).parent();b.find("td[ref="+n.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),n.remove(),ltbx.update({sum:t.data.full_price}),$("a.bBacketServ__eMore",y).length||y.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var w=new E($(".allpageinner"),ltbx);$(".goodsbox__inner[ref] .mainImg").live("mousedown",function(e){e.stopPropagation(),e.preventDefault(),e.which==1&&w.prepare(e.pageX,e.pageY,C(currentItem))}),$(".goodsbox__inner[ref] .mainImg").live("mouseup",function(e){w.cancel()});if($("div.bBlueButton.extWarranty").length&&$("div.bBlueButton.extWarranty").is(":visible")){var S=$("div.bBlueButton.extWarranty"),x=$("div.hideblock.extWarranty"),T=$("#ew_look");$(".link1",S).click(function(){return $("div.bF1Block").is(":visible")&&$("div.bF1Block").hide(),x.show(),!1}),$(".close",x).click(function(){x.hide()}),x.find("input.button").bind("click",function(){$("input.button",x).hasClass("active")&&$("input.button",x).val("Выбрать").removeClass("active"),$(this).val("Выбрана").addClass("active");var e=$(this).data();return x.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;$(".link1",S).text("Изменить гарантию"),S.find("h3").text("Вы выбрали гарантию:"),$(".ew_title",T).text(e.f1title),$(".ew_price",T).text(e.f1price),$(".bBacketServ__eMore",T).attr("href",e.deleteurl),T.show();var n={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};n.f1=e,v&&(n.f1.only="yes"),ltbx.getBasket(n),O(t),v||(v=!0,N())}),!1}),$(".bBacketServ__eMore",T).live("click",function(e){e.preventDefault();var t=this;return $.getJSON($(this).attr("href"),function(e){if(!e.success)return!0;var n=$(t).parent();$("input.button",x).val("Выбрать").removeClass("active"),$(".link1",S).text("Выбрать гарантию"),n.hide(),ltbx.update({sum:e.data.full_price}),T.hide(),$("a.bBacketServ__eMore",S).length||S.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var N=function(){var e=$(".lightboxinner .point2").attr("href");$("body").addClass("bought"),$(".goodsbarbig .link1").attr("href",e),$("#bigpopup a.link1").attr("href",e),$(".bSet__ePrice .link1").unbind("click"),$(".goodsbar .link1").die("click")};$(".goodsbox a.link1").live("click",function(e){var t=docCookies.getItem("switch");if(t!==null&&t!=="default"){var n=$(this).attr("href");return window.location.href=n,!1}e.stopPropagation();var r=this;if($(r).hasClass("disabled"))return!1;if($(r).hasClass("active"))return!0;if(typeof currentItem=="undefined")return!1;if(ltbx){var i=$(this).parent().parent().parent().find(".photo img.mainImg");i.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:i.attr("src")},500)}var s=currentItem,o=$(r).attr("href");return $.getJSON(o,function(e){if(e.success&&ltbx){var t=C(s);t.vitems=e.data.full_quantity,t.sum=e.data.full_price,t.link=e.data.link,ltbx.getBasket(t),O(e),$(r).attr("href",$(".lightboxinner .point2").attr("href")),$(r).addClass("active"),PubSub.publish("productBought",currentItem),k($(r))}}),!1});var L=new A;L.push("div.bServiceCardWrap input"),L.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),N),L.push("div.bSet a.link1",$("div.bSet").data("value"),N),L.push("div.mServ a.link1",$("div.mServ").data("value")),L.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),function(){var e=$("div.bInShop__eButton a.link1");e.html("<i> </i>"+e.html())}),L.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value"));var O=function(e){if(e.result.product){var t=e.result.product,n=window.location.href,r={"Add to Cart SKU":t.article,"Add to Cart SKU Quantity":t.quantity,"Add to Cart Product Name":t.name,"Add to Cart Root category":t.category[0].name,"Add to Cart Category name":t.category[t.category.length-1].name,"Add to Cart SKU Price":t.price,"Add to Cart Page URL":n,"Add to Cart F1 Quantity":t.serviceQuantity};typeof _kmq!="undefined"&&_kmq.push(["record","Add to Cart",r])}if(e.result.service){var i=e.result.service,t=e.result.product,s={"Add F1 F1 Name":i.name,"Add F1 F1 Price":i.price,"Add F1 SKU":t.article,"Add F1 Product Name":t.name,"Add F1 Root category":t.category[0].name,"Add F1 Category name":t.category[t.category.length-1].name};typeof _kmq!="undefined"&&_kmq.push(["record","Add F1",s])}if(e.result.warranty){var o=e.result.warranty,t=e.result.product,u={"Add Warranty Warranty Name":o.name,"Add Warranty Warranty Price":o.price,"Add Warranty SKU":t.article,"Add Warranty Product Name":t.name,"Add Warranty Root category":t.category[0].name,"Add Warranty Category name":t.category[t.category.length-1].name};typeof _kmq!="undefined"&&_kmq.push(["record","Add Warranty",u])}};"ANALYTICS"in window&&PubSub.subscribe("productBought",function(){});if($("#_categoryData").length){var M=$("#_categoryData").data("category"),_={"Viewed Category Category Type":M.type,"Viewed Category Category Level":M.level,"Viewed Category Parent category":M.parent_category,"Viewed Category Category name":M.category,"Viewed Category Category ID":M.id};typeof _kmq!="undefined"&&_kmq.push(["record","Viewed Category",_])}});