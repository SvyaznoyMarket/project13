$(document).ready(function(){function e(e,t){if(!e.length)return null;var i=this,n=t,a=!1,r=null,o=25,s=30,l=$(".dropbox");if(!l.length)return null;var c=[],u=0,d=null,h=$("<div>").addClass("dragbox").css("display","none"),r=$("<div>");h.append(r),$(e).append(h);var p=$("<div>").addClass("graying").css({display:"none",opacity:"0.5"});$(e).append(p);var f=0;this.cancel=function(){$(document).unbind("mousemove.dragitem")},$(document).bind("mouseup",function(e){"dragimg"==e.target.id&&i.cancel()}),this.prepare=function(e,t,h){d=h,$(".goodsbox__inner[ref="+d.id+"] a.link1").hasClass("active")||$(document).bind("mousemove.dragitem",function(d){d.preventDefault(),a?(r.css({left:d.pageX-s,top:d.pageY-f-s}),u=$(l[0]).offset().top,d.pageY+s>u-o&&d.pageX+s>c[0]-o&&d.pageX-30<c[0]+70+o?n.toFire(3):n.putOutBoxes()):(Math.abs(e-d.pageX)>o||Math.abs(t-d.pageY)>o)&&(i.turnon(d.pageX,d.pageY),a=!0)})},this.turnon=function(e,t){n.clear(),p.show(),f=p.offset().top,r.html($("<img>").css({width:60,height:60}).attr({id:"dragimg",width:60,height:60,alt:"",src:d.img})),r.css({left:e-s,top:t-f-s}),h.show(),n.getContainers();for(var a=0;l.length>a;a++)c[a]=$(l[a]).offset().left;$(document).bind("mouseup.dragitem",function(){(fbox=n.gravitation())?($(document).unbind(".dragitem"),r.animate({left:c[0]+5,top:u-f+5},400,function(){i.finalize(fbox)})):i.turnoff()})},this.turnoff=function(){a=!1,p.fadeOut(),h.hide(),n.hideContainers(),$(document).unbind(".dragitem")},this.finalize=function(e){setTimeout(function(){switch(i.turnoff(),e){case 1:n.getComparing(d);break;case 2:n.getWishes(d);break;case 3:$.getJSON($(".goodsbox__inner[ref="+d.id+"] a.link1").attr("href"),function(e){if(e.success&&t){var i=d;i.vitems=e.data.full_quantity,i.sum=e.data.full_price,t.getBasket(i)}})}},400)}}function t(e){var t=$("div[ref="+e+"]"),i={id:$(t).attr("ref"),title:$("h3 a",t).html(),price:$(".price",t).html(),img:$(".photo img.mainImg",t).attr("src")};return i}function i(e){"undefined"!=typeof MyThings&&"undefined"!=e.data("product")&&MyThings.Track({EventType:MyThings.Event.Visit,Action:"1013",ProductId:e.data("product")}),($("#adriverProduct").length||$("#adriverCommon").length)&&"undefined"!=e.data("product")&&function(e){var t=document,i=t.createElement("IMG"),n=t.body;e=e.replace(/![rnd]/,Math.round(9999999*Math.random()))+"&tail256="+escape(t.referrer||"unknown"),i.style.position="absolute",i.style.width=i.style.height="0px",i.onload=i.onerror=function(){n.removeChild(i),i=n=null},i.src=e,n.insertBefore(i,n.firstChild)}("http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=add_basket&custom=10="+e.data("product")+";11="+e.data("category")+"&bt=55&pz=0&rnd=![rnd]")}function n(){this.push=function(e,t,n){if($(e).length){var a=$(".lightboxinner .point2").attr("href");$("body").delegate(e,"click",function(e){e.preventDefault();var r=$(this);if(t||(t=r.data("value")),!t)return!1;if($("body").hasClass("bought"))return document.location=a,!1;if(r.hasClass("disabled"))return!1;var o="/404.html";if(r.is("a")){var s=r.text().replace(/\s/g,"");""!==s&&"&nbsp;"!==s&&r.text("В корзине"),o=r.attr("href")}r.is("input")&&(r.val("В корзине"),o=t.url);var l=docCookies.getItem("switch");return null!==l&&"default"!==l?(window.location.href=o,!1):($("body").addClass("bought"),$.getJSON(o,function(e){if(e.success&&ltbx){var a={id:t.jsref,title:t.jstitle,price:t.jsprice,img:t.jsimg?t.jsimg:"/images/logo.png",vitems:e.data.full_quantity,sum:e.data.full_price,link:e.data.link};ltbx.getBasket(a),n&&n(),PubSub.publish("productBought",a),i($(r))}}),!1)})}}}if($("#similarGoodsSlider").length){var a=$("#similarGoodsSlider"),r=a.find(".bSimilarGoodsSlider_eWrap"),o=a.find(".bSimilarGoodsSlider_eArrow"),s=0,l=0,c=0,u=0,d=0,h=function(){var e=document.location,t=$(this).attr("href");"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","AdvisedCrossss",e,t])},p=function(e){for(var t in e){var i=tmpl("similarGoodTmpl",e[t]);r.append(i)}var n=a.find(".bSimilarGoodsSlider_eGoods");s=n.width()+2*parseInt(n.css("paddingLeft")),c=n.length,u=s*c,r.width(u),c>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()}),4>c&&$(".bSimilarGoodsSlider_eArrow.mRight").hide()};$.getJSON($("#similarGoodsSlider").data("url"),function(e){if(!$.isEmptyObject(e)){var t=e;p(t)}}).done(function(){var e=a.find(".bSimilarGoodsSlider_eGoods");c=e.length,u=s*c,r.width(u),c>0&&$(".bSimilarGoods").fadeIn(300,function(){l=a.width()})}),o.bind("click",function(){return $(this).hasClass("mLeft")?d+=2*s:d-=2*s,l-u>=d?(d=l-u,$(".bSimilarGoodsSlider_eArrow.mRight").hide(),$(".bSimilarGoodsSlider_eArrow.mLeft").show()):d>=0?(d=0,$(".bSimilarGoodsSlider_eArrow.mLeft").hide(),$(".bSimilarGoodsSlider_eArrow.mRight").show()):o.show(),r.animate({left:d}),!1}),$(".bSimilarGoods.mCatalog .bSimilarGoodsSlider_eGoods a").live("click",h)}var f=function(e){var t=$(".bSubscribeLightboxPopupNotNow"),i=$(".bSubscribeLightboxPopup"),n=$(".bSubscribeLightboxPopup__eInput");n.placeholder();var a=function(){var e=$(this).data("url"),t=n.val();return-1!==t.search("@")?$.post(e,{email:t},function(e){return e.success?(i.html('<span class="bSubscribeLightboxPopup__eTitle mType">Спасибо! подтверждение подписки отправлено на указанный e-mail</span>'),docCookies.setItem(!1,"subscribed",1,15768e4,"/"),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Account","Emailing sign up","Page top"]),setTimeout(function(){i.slideUp(300)},3e3),void 0):!1}):n.addClass("mError"),!1},r=function(){i.slideDown(300),n.keydown(function(){$(this).removeClass("mError")}),$(".bSubscribeLightboxPopup__eBtn").bind("click",a),$(".bSubscribeLightboxPopup__eNotNow").bind("click",function(){var e=$(this).data("url");return i.slideUp(300,o),docCookies.setItem(!1,"subscribed",0,15768e4,"/"),$.post(e),!1})},o=function(){t.slideDown(300),t.bind("click",function(){$(this).slideUp(300),r()})};return e.show?(r(),void 0):(e.agrred||o(),!1)},m=function(e){void 0!==e.subscribe&&f(e.subscribe)},v=$(".lightboxinner .point2").attr("href"),g="/user/shortinfo";docCookies.hasItem("enter")&&docCookies.hasItem("enter_auth")||(g+="?ts="+(new Date).getTime()+Math.floor(1e3*Math.random()));var b={};if(!$(".lightbox").length)return $(".lightboxinner").hide(),$.getJSON(g,function(e){if(e.success)if(e.data.vitems>0&&$("#topBasket").text("("+e.data.vitems+")"),e.data.name){var t={};t.user=e.data.name;var i=tmpl("auth_tmpl",t);$("#auth-link").hide(),$("#auth-link").after(i)}else $("#auth-link").show()}),!1;ltbx=new Lightbox($(".lightboxinner"),b),$.getJSON(g,function(e){if(e.success){b=e.data,ltbx.update(b),k(b);var t=$("div.lightboxinner > .dropbox");if(t.length&&t.css("left",$("ul.lightboxmenu > li").eq(1).offset().left-$("div.lightboxinner").offset().left),PubSub.publish("auth try",e.data.name),e.data.name){var i={};i.user=e.data.name;var n=tmpl("auth_tmpl",i);$("#auth-link").hide(),$("#auth-link").after(n)}else $("#auth-link").show();$("#upsale").length&&($("#upsaleCounter").html(e.data.vitems),$("#upsalePrice").html(e.data.sum)),void 0!==e.data.action&&m(e.data.action)}});var y=!1,k=function(e){if(!e||!e.productsInCart)return!1;for(var t in e.productsInCart){var i=$("div.boxhover[ref="+t+"]");if(i.length){var n=$("a.link1",i);n.attr("href",$(".lightboxinner .point2").attr("href")),n.addClass("active")}if(i=$("div.goodsbarbig[ref="+t+"]"),i.length){var n=$("a.link1",i);if(n.attr("href",$(".lightboxinner .point2").attr("href")),$("body").addClass("bought"),n.unbind("click"),y=!0,e.servicesInCart)for(var a in e.servicesInCart)if(t in e.servicesInCart[a]){var n=$("div.mServ[ref="+a+"] a.link1");n.length&&n.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине"),n=$("td.bF1Block_eBuy[ref="+a+"] input.button"),n.length&&n.addClass("active").val("В корзине").attr("href",v)}}}if(e.servicesInCart)for(var a in e.servicesInCart)if(e.servicesInCart[a][0]){var n=$("div.mServ[ref="+a+"] a.link1");n.length&&n.attr("href",$(".lightboxinner .point2").attr("href")).text("В корзине").addClass("active"),n=$("div.bServiceCard[ref="+a+"] input"),n.length&&n.val("В корзине").addClass("active").attr("href",v)}};window.navigator.userAgent.indexOf("MSIE")>=0&&$(".allpageinner").delegate(".goodsbox__inner","hover",function(){$(this).toggleClass("hover")}),$(".allpageinner").delegate(".goodsbox","mouseenter",function(){currentItem=$(this).attr("ref")}),$(".goodsbox__inner").live("click",function(){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var w={uri:window.location.pathname,atcl:$(".bGood__eArticle span:last").text().replace(/[^0-9\-]/g,"")};if($(".bigcarousel").eq(0).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_up",w.atcl,w.uri])}),$(".bigcarousel").eq(1).bind("click",function(){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","accessories_down",w.atcl,w.uri])}),$("div.bF1Info").length){var _=$("div.bF1Info"),x=$("div.bF1Block");$(".link1, .bF1Info_Logo",_).click(function(){return $("div.hideblock.extWarranty").is(":visible")&&$("div.hideblock.extWarranty").hide(),x.show(),!1}),$(".close",x).click(function(){x.hide()}),x.find("input.button").bind("click",function(){if($(this).hasClass("active"))return window.location.href=$(this).attr("href"),!1;$(this).val("В корзине").addClass("active").attr("href",v);var e=$(this).data();return x.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;_.find("h3").text("Вы добавили услуги:");var i=tmpl("f1look",e);i=i.replace("F1ID",e.fid),_.find(".link1").before(i);var n={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};n.f1=e,y&&(n.f1.only="yes"),ltbx.getBasket(n),y||(y=!0,I())}),!1}),$("a.bBacketServ__eMore",_).live("click",function(){var e=this;return $.getJSON($(this).attr("href"),function(t){if(!t.success)return!0;var i=$(e).parent();x.find("td[ref="+i.attr("ref")+"]").find("input").val("Купить услугу").removeClass("active"),i.remove(),ltbx.update({sum:t.data.full_price}),$("a.bBacketServ__eMore",_).length||_.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var C=new e($(".allpageinner"),ltbx);if($(".goodsbox__inner[ref] .mainImg").live("mousedown",function(e){e.stopPropagation(),e.preventDefault(),1==e.which&&C.prepare(e.pageX,e.pageY,t(currentItem))}),$(".goodsbox__inner[ref] .mainImg").live("mouseup",function(){C.cancel()}),$("div.bBlueButton.extWarranty").length&&$("div.bBlueButton.extWarranty").is(":visible")){var S=$("div.bBlueButton.extWarranty"),M=$("div.hideblock.extWarranty"),D=$("#ew_look");$(".link1",S).click(function(){return $("div.bF1Block").is(":visible")&&$("div.bF1Block").hide(),M.show(),!1}),$(".close",M).click(function(){M.hide()}),M.find("input.button").bind("click",function(){$("input.button",M).hasClass("active")&&$("input.button",M).val("Выбрать").removeClass("active"),$(this).val("Выбрана").addClass("active");var e=$(this).data();return M.fadeOut(),$.getJSON(e.url,function(t){if(!t.success)return!0;$(".link1",S).text("Изменить гарантию"),S.find("h3").text("Вы выбрали гарантию:"),$(".ew_title",D).text(e.f1title),$(".ew_price",D).text(e.f1price),$(".bBacketServ__eMore",D).attr("href",e.deleteurl),D.show();var i={id:$(".goodsbarbig .link1").attr("href"),title:$("h1").html(),vitems:t.data.full_quantity,sum:t.data.full_price,link:t.data.link,price:$(".goodsinfo .price").html(),img:$(".goodsphoto img.mainImg").attr("src")};i.f1=e,y&&(i.f1.only="yes"),ltbx.getBasket(i),y||(y=!0,I())}),!1}),$(".bBacketServ__eMore",D).live("click",function(e){e.preventDefault();var t=this;return $.getJSON($(this).attr("href"),function(e){if(!e.success)return!0;var i=$(t).parent();$("input.button",M).val("Выбрать").removeClass("active"),$(".link1",S).text("Выбрать гарантию"),i.hide(),ltbx.update({sum:e.data.full_price}),D.hide(),$("a.bBacketServ__eMore",S).length||S.find("h3").html("Выбирай услуги F1<br/>вместе с этим товаром")}),!1})}var I=function(){var e=$(".lightboxinner .point2").attr("href");$("body").addClass("bought"),$(".goodsbarbig .link1").attr("href",e),$("#bigpopup a.link1").attr("href",e),$(".bSet__ePrice .link1").unbind("click"),$(".goodsbar .link1").die("click")};$(".goodsbox a.link1").live("click",function(e){var n=docCookies.getItem("switch");if(null!==n&&"default"!==n){var a=$(this).attr("href");return window.location.href=a,!1}e.stopPropagation();var r=this;if($(r).hasClass("disabled"))return!1;if($(r).hasClass("active"))return!0;if("undefined"==typeof currentItem)return!1;if(ltbx){var o=$(this).parent().parent().parent().find(".photo img.mainImg");o.effect("transfer",{to:$(".point2 b"),easing:"easeInOutQuint",img:o.attr("src")},500)}var s=currentItem,l=$(r).attr("href");return $.getJSON(l,function(e){if(e.success&&ltbx){var n=t(s);n.vitems=e.data.full_quantity,n.sum=e.data.full_price,n.link=e.data.link,ltbx.getBasket(n),$(r).attr("href",$(".lightboxinner .point2").attr("href")),$(r).addClass("active"),PubSub.publish("productBought",currentItem),i($(r))}}),!1});var T=new n;T.push("div.bServiceCardWrap input"),T.push("div.goodsbarbig a.link1",$("div.goodsbarbig").data("value"),I),T.push("div.bSet a.link1",$("div.bSet").data("value"),I),T.push("div.mServ a.link1",$("div.mServ").data("value")),T.push("div.bInShop__eButton a.link1",$("div.bInShop__eButton").data("value"),function(){var e=$("div.bInShop__eButton a.link1");e.html("<i> </i>"+e.html())}),T.push("div.goodsinfosmall a.link1",$("div.goodsinfosmall").data("value")),"ANALYTICS"in window&&PubSub.subscribe("productBought",function(){})});