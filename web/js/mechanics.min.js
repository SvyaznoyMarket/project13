function Lightbox(d,e){function f(a){var a=(a+"").split("."),b=a[0],c=a[0].length;6<c?b=b.substr(0,c-6)+" "+b.substr(c-6,c-4)+" "+b.substr(c-3,c):3<c&&(b=b.substr(0,c-3)+" "+b.substr(c-3,c));2==a.length&&(b+="."+a[1]);return b}if(!$(d).length)return null;var i=this,b=e,g=null,c=null,h=0;this.save=function(){var a=b;a.basket={};$.jCookies({name:"Lightbox",value:a,minutes:20})};this.restore=function(){return $.jCookies({get:"Lightbox"})};b.name||b||(b={name:!1,vcomp:0,vwish:0,vitems:0,sum:0,bingo:{}});
this.getBasket=function(a){a.price+="";var e=$(".goodsbarbig").length?"product":"catalog";"undefined"!==typeof _gaq&&_gaq.push(["_trackEvent","Add2Basket",e,a.title+" "+a.id,Math.round(a.price.replace(/\D/g,""))]);c.clear();a.price=a.price.replace(/\s+/,"");b.basket=a;b.sum=1*a.sum;$(".total").show();a.sum=f(b.sum);a.price=f(a.price);b.vitems=a.vitems;c.updateItem(a);$("#sum",d).html(a.sum);$(".point2 b",d).html(a.vitems);this.fillTopBlock();"f1"in a?"only"in a.f1?c.showBasketF1(a.f1):c.showBasket(a.f1):
c.showBasket()};this.getWishes=function(a){c.clear();a.price=a.price.replace(/\s/,"");a.price=f(a.price);b.wishes=a;b.vwish++;a.vwish=b.vwish;c.updateItem(a);$(".point3 b",d).html(b.vwish);c.showWishes()};this.bingo=function(a){c&&c.clear();a.price=f(a.price);b.bingo=a;g.updateItem(a);g.showBingo()};this.getComparing=function(){c.clear();g&&g.clear();c.showComparing()};this.clear=function(){c.clear();g&&g.clear()};this.getContainers=function(){$(".dropbox",d).show()};this.hideContainers=function(){$(".dropbox",
d).hide()};this.toFire=function(a){h=a;$(".dropbox",d).addClass("active").find("p").html("Отпустите мышь")};this.putOut=function(a){$($(".dropbox",d)[a-1]).removeClass("active").find("p").html("Перетащите сюда")};this.putOutBoxes=function(){if(h){for(var a=1;4>a;a++)i.putOut(a);h=0}};this.gravitation=function(){return h?h:!1};this.fillTopBlock=function(){$("#topBasket")&&$("#topBasket").text("("+b.vitems+")")};this.update=function(a){a&&(b=a);b&&(b.name&&$(".fl .point",d).removeClass("point1").addClass("point6").html("<b></b>"+
b.name),b.link&&$(".point6",d).attr("href",b.link),b.vcomp&&$(".point4 b",d).html(b.vcomp),b.vwish&&$(".point3 b",d).html(b.vwish),b.sum&&($("#sum",d).html(f(b.sum)),$(".total").show()),b.vitems&&($(".point2",d).addClass("orangeme"),$(".point2 b",d).html(b.vitems),this.fillTopBlock()),b.bingo&&b.bingo.id&&(a=$("<li>").addClass("fl").html('<a class="point point5" href=""><b></b></a>'),$(".lightboxmenu").prepend(a),a.bind("click",function(){i.bingo(b.bingo);return!1}),g=new Flybox(d),i.bingo(b.bingo)))};
this.authorized=function(){return b.name?!0:!1};this.update();c=new Flybox(d)}
function Flybox(d){if(!$(d).length)return null;var e=$("<div>").addClass("flybox").css("display","none"),f=$("<i>").addClass("corner").appendTo(e),i=$("<i>").addClass("close").attr("title","Закрыть").html("Закрыть").appendTo(e);e.appendTo(d);var b=this,g=0,c=null;i.bind("click",function(){clearTimeout(g);b.jinny()});this.updateItem=function(a){c=a};var h="",a="",k="";this.showWishes=function(){a='<div class="font16 pb20">Только что был добавлен в список желаний</div><div class="fl width70"><a href=""><img width="60" height="60" alt="" src="'+c.img+
'"></a></div><div class="ml70"><div class="pb5"><a href="">'+c.title+"</a></div><strong>"+c.price+'<span class="rubl">p</span></strong></div><div class="clear pb10"></div><div class="line pb5"></div><div class="ar pb10">Всего товаров: '+c.vwish+'</div><div class="ar"><a class="button bigbuttonlink" value="" href="">Перейти в список желаний</a></div>\t';e.css({left:"400px",width:"290px"});f.css("left","132px");this.fillup(a);e.fadeIn(1E3);g=setTimeout(b.jinny,5E3)};this.showBingo=function(){k='<div class="font16 pb20">Этот товар может пригодиться!</div><div class="fl width70"><a href=""><img width="60" height="60" alt="" src="'+
c.img+'"></a></div><div class="ml70"><div class="pb5"><a href="">'+c.title+'</a></div><div class="pb10"><strong>'+c.price+'<span class="rubl">p</span></strong></div><input class="button yellowbutton" type="button" value="Купить"></div>';e.css({left:"3px",width:"250px"});f.css("left","27px");this.fillup(k);e.fadeIn(1E3);g=setTimeout(b.jinny,5E3)};this.showComparing=function(){e.css({left:"3px",width:"874px"});f.css("left","374px");this.fillup($("#zaglu").html());e.fadeIn(1E3);g=setTimeout(b.jinny,
7E3)};var j=$(".point2",d).attr("href");this.showBasket=function(a){if("undefined"!==typeof c.link)j=c.link;var d="";"undefined"!==typeof a&&(d='<br/><div class="bLiteboxF1"><div class="fl width70 bLiteboxF1__eWrap"><div class="bLiteboxF1__ePlus">+</div><a href=""><img src="/images/f1info1.png" alt="" width="60" height="60" /></a></div><div class="ml70"><div class="pb5 bLiteboxF1__eG"><a href>'+a.f1title+"</a></div><strong>"+a.f1price+' <span class="rubl">p</span></strong></div></div>');h='<div class="font16 pb20">Только что был добавлен в корзину:</div><div class="fl width70"><a href=""><img width="60" height="60" alt="" src="'+
c.img+'"></a></div><div class="ml70"><div class="pb5"><a href="">'+c.title+"</a></div><strong>"+c.price+'<span> &nbsp;</span><span class="rubl">p</span></strong></div>'+d+'<div class="clear pb10"></div><div class="line pb5"></div><div class="fr">Сумма: '+c.sum+" Р</div>Всего товаров: "+c.vitems+'<div class="clear pb10"></div><div class="ar"><a class="button bigbuttonlink" value="" href="'+j+'">Оформить заказ</a></div>';e.css({left:"588px",width:"290px"});f.css("left","132px");this.fillup(h);e.fadeIn(500);
g=setTimeout(b.jinny,5E3)};this.showBasketF1=function(a){if("undefined"===typeof a)return!1;h='<div class="font16 pb20">Только что был добавлен в корзину:</div>'+('<div class="bLiteboxF1"><div class="fl width70 bLiteboxF1__eWrap"><div class="bLiteboxF1__ePlus"></div><a href=""><img src="/images/f1info1.png" alt="" width="60" height="60" /></a></div><div class="ml70"><div class="pb5 bLiteboxF1__eG"><a href>'+a.f1title+"</a></div><strong>"+a.f1price+' <span class="rubl">p</span></strong></div></div>')+
'<div class="clear pb10"></div><div class="line pb5"></div><div class="fr">Сумма: '+c.sum+" Р</div>Всего товаров: "+c.vitems+'<div class="clear pb10"></div><div class="ar"><a class="button bigbuttonlink" value="" href="'+j+'">Оформить заказ</a></div>';e.css({left:"588px",width:"290px"});f.css("left","132px");this.fillup(h);e.fadeIn(500);g=setTimeout(b.jinny,5E3)};this.fillup=function(a){a=$("<div>").addClass("fillup").html(a);e.append(a)};this.jinny=function(){e.fadeOut(500);setTimeout(function(){$(".fillup",
e).remove()},550)};this.clear=function(){clearTimeout(g);e.hide();$(".fillup",e).remove()}}
function DDforLB(d,e){if(!d.length)return null;var f=this,i=!1,b=null,g=$(".dropbox");if(!g.length)return null;var c=[],h=0,a=null,k=$("<div>").addClass("dragbox").css("display","none"),b=$("<div>");k.append(b);$(d).append(k);var j=$("<div>").addClass("graying").css({display:"none",opacity:"0.5"});$(d).append(j);var m=0;this.cancel=function(){$(document).unbind("mousemove.dragitem")};$(document).bind("mouseup",function(a){"dragimg"==a.target.id&&f.cancel()});this.prepare=function(d,j,l){a=l;$(".boxhover[ref="+
a.id+"] a.link1").hasClass("active")||$(document).bind("mousemove.dragitem",function(a){a.preventDefault();if(i)b.css({left:a.pageX-30,top:a.pageY-m-30}),h=$(g[0]).offset().top,a.pageY+30>h-25&&a.pageX+30>c[0]-25&&a.pageX-30<c[0]+70+25?e.toFire(3):e.putOutBoxes();else if(25<Math.abs(d-a.pageX)||25<Math.abs(j-a.pageY))f.turnon(a.pageX,a.pageY),i=!0})};this.turnon=function(d,i){e.clear();j.show();m=j.offset().top;b.html($("<img>").css({width:60,height:60}).attr({id:"dragimg",width:60,height:60,alt:"",
src:a.img}));b.css({left:d-30,top:i-m-30});k.show();e.getContainers();for(var l=0;l<g.length;l++)c[l]=$(g[l]).offset().left;$(document).bind("mouseup.dragitem",function(){(fbox=e.gravitation())?($(document).unbind(".dragitem"),b.animate({left:c[0]+5,top:h-m+5},400,function(){f.finalize(fbox)})):f.turnoff()})};this.turnoff=function(){i=!1;j.fadeOut();k.hide();e.hideContainers();$(document).unbind(".dragitem")};this.finalize=function(b){setTimeout(function(){f.turnoff();switch(b){case 1:e.getComparing(a);
break;case 2:e.getWishes(a);break;case 3:$.getJSON($(".boxhover[ref="+a.id+"] a.link1").attr("href")+"/1",function(b){if(b.success&&e){var c=a;c.vitems=b.data.full_quantity;c.sum=b.data.full_price;e.getBasket(c)}})}},400)}}var ltbx=null;
function mediaLib(d){if(d.length){var e=this,f=null,i=!1,b=!1;this.show=function(g,c){if(b)switch(e.close(),g){case "image":$("<img>").attr("src",c).attr("id","gii").appendTo($(".photobox",d));f=new gigaimage($("#gii"),2,$(".scale",d));f.addZoom();break;case "360":i?"undefined"!==typeof lkmv.show&&lkmv.show():("undefined"!==typeof lkmv.start&&lkmv.start(),i=!0)}else{var h=function(){};switch(g){case "image":h=e.openEnormous;break;case "360":h=e.open360}$(d).lightbox_me({centered:!0,onLoad:function(){h(c)},
onClose:function(){e.close();b=!1},reallyBig:!0});b=!0}return!1};this.close=function(){f&&(f.destroy(),f=null,$("#gii").remove());i&&lkmv&&"undefined"!==typeof lkmv.hide&&lkmv.hide()};this.openEnormous=function(b){$("<img>").attr("src",b).attr("id","gii").appendTo($(".photobox",d));f=new gigaimage($("#gii"),2,$(".scale",d));f.addZoom()};this.open360=function(){i?"undefined"!==typeof lkmv.show&&lkmv.show():("undefined"!==typeof lkmv.start&&lkmv.start(),i=!0)}}};
