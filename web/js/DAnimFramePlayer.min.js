var DAnimFramePlayer=function(e,t){function i(e){for(var t=0;j.length>t;t++)if(j[t]==e)return;j[j.length]=e}function n(e){return a(e)?C+e:e}function a(e){return 7>e.length||"http://"!=e.substring(0,7)}function r(){if(j.length&&-1==T){for(var e=0,t=0;j.length>t;t++)(!E&&j[t].complete||E&&"complete"==j[t].readyState)&&e++;1*e/j.length,q&&q.doDraw(e*q.width/j.length),e>=j.length&&o()}}function o(){q&&q.Uninitialize(),T=0,M.animation&&M.animation.length&&(B.draggable=!1,B.style.position="absolute",B.style.cursor="pointer",B.ontouchstart=s,B.onclick=s,B.style.left=D-90+"px",B.style.top=P-90+"px",B.style.display="block",I.src=n(M.animation[0].img)),M.view360&&M.view360.length&&(F.style.position="absolute",F.style.left="10px",F.style.top=P-50+"px",F.style.display="block",F.style.cursor="pointer",F.onmousedown=h,E&&(F.onmouseup=b),R.style.position="absolute",R.style.left=D-140+"px",R.style.top=P-50+"px",R.style.display="block",R.style.cursor="pointer",R.onmousedown=p,E&&(R.onmouseup=b))}function s(){0==T&&M.animation&&M.animation.length&&(W&&(clearInterval(W),W=null),B.style.display="none",M.view360&&M.view360.length&&(F.style.display="none",R.style.display="none"),T=1,x=M.view360&&0!=M.view360.length&&0!=Math.floor(.5+f(A)/(6.2831852/M.view360.length))%M.view360.length?-1:0,l())}function l(){if(-1==x){var e=Math.floor(.5+f(A)/(6.2831852/M.view360.length));.5*M.view360.length>e?e--:e++,0==e%M.view360.length?(I.src=n(M.animation[0].img),x=0):(A=e*(6.2831852/M.view360.length),m()),setTimeout(l,30)}else x++,M.animation.length>x?(I.src=n(M.animation[x].img),setTimeout(l,M.animation[x].interval)):(T=0,I.src=n(M.animation[0].img),B.style.display="block",M.view360&&M.view360.length&&(F.style.display="block",R.style.display="block"),A=0)}function c(){if(M){if(D=M.width,P=M.height,I=document.createElement("img"),I.width=M.width,I.height=M.height,M.splash&&(I.src=n(M.splash)),E?I.ondragStart=d:I.addEventListener("dragStart",d,!1),I.draggable=!1,L.appendChild(I),M.view360)for(var e=0;M.view360.length>e;e++)i(n(M.view360[e]));if(M.animation)for(var e=0;M.animation.length>e;e++)i(n(M.animation[e].img));if(j.length>0){q=new DAnimProgressBar(E),q.Initialize(L,D,P);for(var e=0;j.length>e;e++){var t=j[e];j[e]=new Image,E?j[e].onreadystatechange=r:j[e].onload=r,j[e].src=t}}}}function d(e){e.preventDefault(),e.stopPropagation()}function u(){return!1}function h(){2!=(E?window.event.button:event.button)&&(W&&(clearInterval(W),W=null),E?F.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",b,!0)),v(),W=setInterval(v,30))}function p(){2!=(E?window.event.button:event.button)&&(W&&(clearInterval(W),W=null),E?R.setCapture():(document.addEventListener("mouseup",b,!0),event.preventDefault(),event.stopPropagation()),g(),W=setInterval(g,30))}function f(e){for(;0>e||e>=6.2831854;)e>0?e-=6.2831852:e+=6.2831852;return e}function m(){if(M.view360&&M.view360.length){var e=Math.floor(.5+f(A)/(6.2831852/M.view360.length));I.src=n(M.view360[e%M.view360.length])}}function v(){A-=.2,m()}function g(){A+=.2,m()}function b(){null!=W&&(clearInterval(W),W=null),E?R.releaseCapture():document.removeEventListener("mouseup",b,!0)}function $(e){if(0==T){var t=(E?window.event.offsetX:e.clientX)-L.offsetLeft;2==(E?window.event.button:e.button)&&(E?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),M.view360&&M.view360.length&&(E?(L.onmouseup=k,L.onmousemove=y,L.setCapture()):(document.addEventListener("mouseup",k,!0),document.addEventListener("mousemove",y,!0)),O=t-D/2,S=A))}}function y(e){var t=(E?window.event.offsetX:e.clientX)-L.offsetLeft,i=t-D/2;A=S+.02*(i-O),m(),E||e.stopPropagation()}function k(e){2==(E?window.event.button:e.button)&&(E?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),E?(L.releaseCapture(),L.onmouseup=null,L.onmousemove=null):(document.removeEventListener("mouseup",k,!0),document.removeEventListener("mousemove",y,!0)))}function w(e){0==T&&1==e.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),O=e.touches[0].pageX-D/2,S=f(A))}function _(e){if(0==T&&1==e.touches.length){e.preventDefault();var t=e.touches[0].pageX-D/2;A=S+.05*(t-O),m()}}var C,x,S,M=null,I=null,D=300,P=300,T=-1,A=0,O=0,E=0,q=null,L=document.createElement("DIV");L.setAttribute("id","3dImgContainer"),L.style.position="relative",e.appendChild(L);var B=document.createElement("DIV");B.style.display="none",B.innerHTML='<img draggable="false" src="'+t+'/images/icon_play.png" width=80 height=80 border=0>',L.appendChild(B);var F=document.createElement("DIV");F.style.display="none",F.innerHTML='<img draggable="false" src="'+t+'/images/rotate_l.png" width=51 height=47 border=0>',L.appendChild(F);var R=document.createElement("DIV");R.style.display="none",R.innerHTML='<img draggable="false" src="'+t+'/images/rotate_r.png" width=55 height=47 border=0>',L.appendChild(R);var j=[],N=function(e){if(navigator.userAgent.indexOf("MSIE")>0){var t=navigator.userAgent.match(/MSIE ([\d\.]+)/);t&&9>parseFloat(t[1])&&(E=1)}E?(L.onselectstart=u,L.onmousedown=$):(L.onselectstart=u,L.addEventListener("mousedown",$,!1),L.addEventListener("touchstart",w,!1),L.addEventListener("touchmove",_,!1)),L.oncontextmenu=u,M=e,C="",c()},W=null;return{DoLoadModel:N}},DAnimProgressBar=function(e){function t(e,t,i,n,a,r){e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+n-r,i),e.arc(t+n-r,i+r,r,-Math.PI/2,Math.PI/2,!1),e.lineTo(t+r,i+a),e.arc(t+r,i+r,r,Math.PI/2,3*Math.PI/2,!1),e.closePath(),e.fill()}function i(e,i,n,a,r,o){e.save(),e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=5,e.shadowColor="#666",e.fillStyle="rgba(189,189,189,1)",t(e,i,n,a,r,o),e.shadowColor="rgba(0,0,0,0)";var s=e.createLinearGradient(0,n+r,0,0);s.addColorStop(0,"rgba(255,255,255, 0.1)"),s.addColorStop(.4,"rgba(255,255,255, 0.7)"),s.addColorStop(1,"rgba(255,255,255,0.4)"),e.fillStyle=s,t(e,i,n,a,r,o),e.fillStyle="white",e.restore()}function n(e,t,i,n,a,r,o){var s=0;e.beginPath(),r>n?(s=r-Math.sqrt(Math.pow(r,2)-Math.pow(r-n,2)),e.moveTo(t+n,i+s),e.lineTo(t+n,i+a-s),e.arc(t+r,i+r,r,Math.PI-Math.acos((r-n)/r),Math.PI+Math.acos((r-n)/r),!1)):n+r>o?(s=r-Math.sqrt(Math.pow(r,2)-Math.pow(r-(o-n),2)),e.moveTo(t+r,i),e.lineTo(t+n,i),e.arc(t+o-r,i+r,r,-Math.PI/2,-Math.acos((r-(o-n))/r),!1),e.lineTo(t+n,i+a-s),e.arc(t+o-r,i+r,r,Math.acos((r-(o-n))/r),Math.PI/2,!1),e.lineTo(t+r,i+a),e.arc(t+r,i+r,r,Math.PI/2,3*Math.PI/2,!1)):(e.moveTo(t+r,i),e.lineTo(t+n,i),e.lineTo(t+n,i+a),e.lineTo(t+r,i+a),e.arc(t+r,i+r,r,Math.PI/2,3*Math.PI/2,!1)),e.closePath(),e.fill(),o-1>n&&(e.save(),e.shadowOffsetX=1,e.shadowBlur=1,e.shadowColor="#666",n+r>o&&(s+=1),e.fillRect(t+n,i+s,1,l-2*s),e.restore())}function a(e,t,i,n,a,r,o){e.save(),e.fillStyle="white";var s=Math.floor(100*(n/o))+"%",l=e.measureText(s).width,c=t+n-l-r/2;r+l>=n&&(c=t+r/2),e.fillText(s,c,i+22),e.restore()}var r=null,o=null,s=300,l=34,c=20,d=20,u=l/2,h=e,p=function(){r.style.display="none"},f=function(e,t,i){if(r=document.createElement(h?"DIV":"canvas"),h||(r.width=500,r.height=150),r.style.position="absolute",r.style.left=Math.floor((t-s)/2)+"px",r.style.top=Math.floor((i-l)/2)+"px",e.appendChild(r),h&&(r.style.width=s+"px",r.style.height=l/2+"px",r.style.overflow="hidden",r.style.borderColor="#000000",r.style.borderWidth="1px",r.style.borderStyle="solid",r.style.backgroundColor="#FFFFFF",r.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+l/2+'px;"></DIV>'),!h){if(!r||!r.getContext)return;if(o=r.getContext("2d"),!o)return;o.font="16px Verdana";var n=o.createLinearGradient(0,d+l,0,0);n.addColorStop(0,"#4DA4F3"),n.addColorStop(.4,"#ADD9FF"),n.addColorStop(1,"#9ED1FF"),o.fillStyle=n}m(0)},m=function(e){if(h){var t=r.children(0);t&&(t.style.width=e+"px")}else o.clearRect(c-5,d-5,s+15,l+15),i(o,c,d,s,l,u),n(o,c,d,e,l,u,s),a(o,c,d,e,l,u,s)};return{width:s,height:l,Initialize:f,Uninitialize:p,doDraw:m}};