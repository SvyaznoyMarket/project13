$(document).ready(function(){function i(a){var e=$('<span class="rubl">p</span>'),c=a.split(","),b=0;"undefined"!==typeof c[1]&&c[1].match(/\d+/)&&(b=c[1].match(/\d+/)[0]);a=1*$("div.cheque div.total").find("strong").text().replace(/\D+/g,"")+1*b;$("#dlvrbill").length&&(a-=1*$("#dlvrbill").find("strong").text().replace(/\D+/g,""),$("#dlvrbill").remove());b&&(c=$("<li>").attr("id","dlvrbill").append($("<div>").text(c[0])).append($("<strong>").text(printPrice(b)+" ").append('<span class="rubl">p</span>')),
$("div.cheque ul").append(c));$("div.cheque div.total").find("strong").empty().text(printPrice(a)+" ").append(e)}function g(a){3==a?($(".shop_block").show(),$(".delivery_block").hide(),$(".deliverytext").html("Представьтесь:"),$("#delivered_at_block label").html("Выберите дату:")):($(".shop_block").hide(),$(".delivery_block").show(),$(".deliverytext").html("Кому и куда доставить:"),$("#delivered_at_block label").html("Выберите дату доставки:"));4==a?($("#order_payment_method_id_1").parent().hide(),
$("#order_payment_method_id_2").parent().hide()):$(".checkboxlist2 li:hidden").show();$("#order_shop_id").trigger("change")}$("#order_delivery_type_id_4").parent().css("color","#E8303A").find("div").removeClass("font11");var b=$(".order-form").find('[name="order[delivery_type_id]"]:checked');g(b.val());$('<img src="/images/ajaxnoti.gif" />').css("display","none").appendTo("body");$("<div>").html('<div><img src="/images/ajaxnoti.gif" /></br></br> Ваш заказ оформляется</div>').attr("id","noti").appendTo("body");
var h=!1;$(".order-form").submit(function(a){if(h)return!0;a.preventDefault();h=!0;$(this).find(":submit").val("Оформляется...");$("#noti").lightbox_me({centered:!0,closeClick:!1,closeEsc:!1});setTimeout(function(){$(".order-form").trigger("submit")},500)});$(".order-form").change(function(a){var b=$(this);if("order[shop_id]"==$(a.target).attr("name")){var c=$(a.target).find("option:selected");if(!c.length)return;$.post(b.data("updateFieldUrl"),{order:{delivery_type_id:b.find('[name="order[delivery_type_id]"]:checked').val(),
shop_id:c.val()},field:"delivered_at"},function(a){var c=b.find('[name="order[delivered_at]"]');c.empty();$.each(a.data.content,function(a,b){c.append('<option value="'+a+'">'+b+"</option>")});c.find(":first").attr("selected","selected");c.change()})}if("order[region_id]"==$(a.target).attr("name")){var c=$(a.target).find("option:selected"),d=$("form#region");d.attr("action",c.data("url"));d.submit()}"order[delivery_type_id]"==$(a.target).attr("name")&&(c=b.find('[name="order[delivery_type_id]"]:checked'),
c.length&&(i(c.next().find("strong").text()),g(c.val()),a=c.val(),$.post(b.data("updateFieldUrl"),{order:{delivery_type_id:a},field:"delivery_period_id"},function(a){if("undefined"!==typeof a.success&&a.success){var c=$('[name="order[delivery_period_id]"]'),a=a.data.content;c.empty();$.each(a,function(a,b){c.append('<option value="'+b[0]+'">'+b[1]+"</option>")});c.find(":first").attr("selected","selected");c.change()}},"json")))});$("#order_shop_id").trigger("change");$(".order_user_address").bind("change",
function(){var a=$(this);$('[name="order[address]"]').val(a.val())});$(".auth-link").bind("click",function(a){a.preventDefault();var b=$(this);$("#login-form, #register-form").data("redirect",!1);$("#auth-block").lightbox_me({centered:!0,onLoad:function(){$("#auth-block").find("input:first").focus()},onClose:function(){$.get(b.data("updateUrl"),function(a){if(!0===a.success){var b=$(".order-form");$("#user-block").replaceWith(a.data.content);$.each(a.data.fields,function(a,c){var e=b.find('[name="'+
a+'"]');2>e.val().length&&e.val(c)})}})}})});(function(){var a=$(".timer");if(!a.length)return!1;var b=window.setInterval(function(){1===c&&(clearInterval(b),$("form").submit());c-=1;a.html(c)},1E3),c=1*a.html().replace(/\D/g,"")})();b=$("#credit-widget").data("value");if(!(!1 in b)){if("direct-credit"===b.widget){console.info("direct-credit");for(var f=b.vars.items.length-1;0<=f;f--){var d=b.vars.items[f];console.info(d);dc_getCreditForTheProduct("4427",b.vars.number,"addProductToBuyOnCredit",{name:d.articul,
count:d.quantity,articul:d.articul,price:d.price,type:d.type},function(a){console.info(a)})}console.info(b.vars.number);window.onbeforeunload=function(){return!1};dc_getCreditForTheProduct("4427",b.vars.number,"orderProductToBuyOnCredit",{order_id:b.vars.number})}"kupivkredit"===b.widget&&(console.info("kupivkredit"),(new VkreditWidget(1,b.vars.sum,{order:b.vars.order,sig:b.vars.order,callbackUrl:window.location.href,onClose:function(a){var b="";switch(a){case "ver":b="Ваша заявка предварительно одобрена.";
break;case "agr":b="Ваша заявка одобрена! Поздравляем!";break;case "rej":b="К сожалению, заявка отклонена банком.";break;case "":b="Вы не заполнили заявку до конца";break;default:b="Ваша заявка находится на рассмотрении"}alert(b)},onDecision:function(a){alert("Пришел статус: "+a)}})).openWidget())}});
