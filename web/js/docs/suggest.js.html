<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: common/suggest.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: common/suggest.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Саджест для поля поиска
 * Нужен рефакторинг
 *
 * @author		Zaytsev Alexandr
 * @requires	jQuery
 */
;(function(){
	var nowSelectSuggest = -1;
	var suggestLen = 0;

	/**
	 * Хандлер на поднятие клавиши в поле поиска
	 * @param  {event} e
	 */
	var suggestUp = function(e){
        var text = $(this).attr('value');

        if (!text.length){
            if($(this).siblings('.searchtextClear').length) {
                $(this).siblings('.searchtextClear').addClass('vh');
            }
        }
        else {
            if($(this).siblings('.searchtextClear').length) {
                $(this).siblings('.searchtextClear').removeClass('vh');
            }
        }

		var authFromServer = function(response){
			$('#searchAutocomplete').html(response);
			suggestLen = $('.bSearchSuggest__eRes').length;
		};

        if ((e.which &lt; 37 || e.which>40) && (nowSelectSuggest = -1)){
            if (!text.length){ 
                return false;
            }

            if($(this).siblings('.searchtextClear').length) {
                $(this).siblings('.searchtextClear').removeClass('vh');
            }
			
			$('.bSearchSuggest__eRes').removeClass('hover');
			nowSelectSuggest = -1;

			var url = '/search/autocomplete?q='+encodeURI(text);

			$.ajax({
				type: 'GET',
				url: url,
				success: authFromServer
			});
		}
	};

	/**
	 * Хандлер на нажатие клавиши в поле поиска
	 * @param  {event} e
	 */
	var suggestDown = function(e){
		/**
		 * маркировка пункта
		 */
		var markSuggest = function(){
			$('.bSearchSuggest__eRes').removeClass('hover').eq(nowSelectSuggest).addClass('hover');
		};

		/**
		 * стрелка вверх
		 */
		var upSuggestItem = function(){
			if (nowSelectSuggest-1 >= 0){
				nowSelectSuggest--;
				markSuggest();
			}
			else{
				nowSelectSuggest = -1;
				$('.bSearchSuggest__eRes').removeClass('hover');
				$(this).focus();
			}
			
		};

		/**
		 * стрелка вниз
		 */
		var downSuggestItem = function(){
			if (nowSelectSuggest+1 &lt;= suggestLen-1){
				nowSelectSuggest++;
				markSuggest();
			}			
		};

		/**
		 * нажатие клавиши 'enter'
		 */
		var enterSuggest = function(){
			// suggest analitycs
			var link = $('.bSearchSuggest__eRes').eq(nowSelectSuggest).attr('href');
			var type = ($('.bSearchSuggest__eRes').eq(nowSelectSuggest).hasClass('bSearchSuggest__eCategoryRes')) ? 'suggest_category' : 'suggest_product';
			
			if ( typeof(_gaq) !== 'undefined' ){	
				_gaq.push(['_trackEvent', 'Search', type, link]);
			}
			document.location.href = link;
		};

		if (e.which === 38){
			upSuggestItem();
		}
		else if (e.which === 40){
			downSuggestItem();
		}
		else if (e.which === 13 && nowSelectSuggest !== -1){
			e.preventDefault();
			enterSuggest();
		}
		// console.log(nowSelectSuggest)
	};

	var suggestInputFocus = function(){
		nowSelectSuggest = -1;
		$('.bSearchSuggest__eRes').removeClass('hover');
	};

	var suggestInputClick = function(){
		$('#searchAutocomplete').show();
	};

	$(document).ready(function() {
		/**
		 * навешивание хандлеров на поле поиска
		 */
		$('.searchbox .searchtext').keydown(suggestDown).keyup(suggestUp).mouseenter(suggestInputFocus).focus(suggestInputFocus).click(suggestInputClick).placeholder();

		$('.searchbox .search-form').submit(function(){
			var text = $('.searchbox .searchtext').attr('value');
			if (!text.length){
				return false;
			}
		});

		$('.bSearchSuggest__eRes').on('mouseover', function(){
			$('.bSearchSuggest__eRes').removeClass('hover');
			var index = $(this).addClass('hover').index();
			nowSelectSuggest = index - 1;
		});

		$('body').click(function(e){		
			var targ = e.target.className;
			if (!(targ.indexOf('bSearchSuggest')+1 || targ.indexOf('searchtext')+1)) {
				$('#searchAutocomplete').hide();
			}
		});

		/**
		 * suggest analitycs
		 */
		$('.bSearchSuggest__eRes').on('click', function(){
			if ( typeof(_gaq) !== 'undefined' ){
				var type = ($(this).hasClass('bSearchSuggest__eCategoryRes')) ? 'suggest_category' : 'suggest_product';
				var url = $(this).attr('href');

				_gaq.push(['_trackEvent', 'Search', type, url]);
			}
		});
	});
}());</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="BlackBox.html">BlackBox</a></li></ul><h3>Global</h3><ul><li><a href="global.html#activateItemLvl1">activateItemLvl1</a></li><li><a href="global.html#activateItemLvl2">activateItemLvl2</a></li><li><a href="global.html#add">add</a></li><li><a href="global.html#buildTriangle">buildTriangle</a></li><li><a href="global.html#checkHoverLvl2">checkHoverLvl2</a></li><li><a href="global.html#createTriangle">createTriangle</a></li><li><a href="global.html#docCookies">docCookies</a></li><li><a href="global.html#flyboxcloser">flyboxcloser</a></li><li><a href="global.html#flyboxDestroy">flyboxDestroy</a></li><li><a href="global.html#getDimensions">getDimensions</a></li><li><a href="global.html#isTrueEmail">isTrueEmail</a></li><li><a href="global.html#menuCheckTriangle">menuCheckTriangle</a></li><li><a href="global.html#menuHoverInLvl1">menuHoverInLvl1</a></li><li><a href="global.html#menuHoverInLvl2">menuHoverInLvl2</a></li><li><a href="global.html#menuMouseLeaveLvl1">menuMouseLeaveLvl1</a></li><li><a href="global.html#menuMouseLeaveLvl2">menuMouseLeaveLvl2</a></li><li><a href="global.html#menuMoveLvl2">menuMoveLvl2</a></li><li><a href="global.html#pageConfig">pageConfig</a></li><li><a href="global.html#Planner3d_Init">Planner3d_Init</a></li><li><a href="global.html#Planner3d_UpdatePrice">Planner3d_UpdatePrice</a></li><li><a href="global.html#Planner3dKupeConstructor">Planner3dKupeConstructor</a></li><li><a href="global.html#printPrice">printPrice</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#UpdateUrlString">UpdateUrlString</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Mon Jul 15 2013 19:20:00 GMT+0400 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
