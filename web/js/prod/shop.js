
+function($){var $mapContainer=$('#jsDeliveryMap'),points=$.parseJSON($('#pointsJSON').html()),partners=$.parseJSON($('#partnersJSON').html()),$partnersList=$('.jsPartnerListItem'),activePartners=[],map;if($mapContainer.length==0)return;console.log('Список точек',points);console.log('Список партнеров',partners);ymaps.ready(function(){var geoColl=new ymaps.GeoObjectCollection();map=new ymaps.Map("jsDeliveryMap",{center:[68,68],zoom:11,controls:['geolocationControl','zoomControl']},{autoFitToViewport:'always',suppressMapOpenBlock:true,suppressObsoleteBrowserNotifier:true});$.each(points,function(i,point){geoColl.add(new ymaps.Placemark([point.latitude,point.longitude],{eUid:point.uid,ePartner:point.partner},{iconLayout:'default#image',iconImageHref:point.icon,iconImageSize:[23,30]}));});geoColl.events.add('click',function(e){var placemark=e.get('target'),uid=placemark.properties.get('eUid'),$listItem=$('#uid-'+uid);$listItem.addClass('current');});map.geoObjects.add(geoColl);map.setBounds(geoColl.getBounds());});$partnersList.on('click',function(){var activeClass='active';$(this).toggleClass(activeClass);activePartners=$.map($partnersList.filter(function(){return $(this).hasClass(activeClass)}),function(obj){return $(obj).data('value')});if(typeof map!='undefined'){map.geoObjects.each(function(GeoObjColl){GeoObjColl.each(function(point){point.options.set('visible',activePartners.length==0?true:$.inArray(point.properties.get('ePartner'),activePartners)!==-1)})});}});}(jQuery);
;(function($){var $container=$('.bMapShops').first(),cities=$container.find('.bMapShops__eMapCityList_city'),markers=$('#map-markers').data('content'),render=tmpl,enterPlacemark={iconLayout:'default#image',iconImageHref:'/images/map/marker-shop.png',iconImageSize:[28,39],iconImageOffset:[-14,-39]},availableShops,map;if($('#region_map-container').length==1){if(!$.isArray(markers)||markers.length===0)return;availableShops=$.grep(markers,function(elem){return elem.is_reconstruction},true);cities.each(function(){var id=$(this).attr('ref');if($.grep(availableShops,function(elem){return elem.region_id==id}).length===0)$(this).remove();});$container.on('click','.bMapShops__eMapCityList_city',function(e){var $this=$(this),$shopsContainer=$this.find('ul'),id=$this.attr('ref'),shops=$.grep(availableShops,function(elem){return elem.region_id==id}),shopsHTML='';if(shops.length>0){if($this.hasClass('chosedCity')){$this.removeClass('chosedCity');$shopsContainer.hide();cities.show();$container.trigger('cityClose')}else{cities.hide().removeClass('chosedCity');$this.addClass('chosedCity').show();if($shopsContainer.find('li').length==0){$.each(shops,function(i,val){shopsHTML+=render('shopInCity',val)});$shopsContainer.html(shopsHTML)}
$shopsContainer.show();$container.trigger('cityOpen',[id])}}
e.stopPropagation();});$container.on('click','.shopInCity',function(e){$container.trigger('shopClick',[$(this).attr('ref')]);e.stopPropagation();});ymaps.ready(function(){var yandexClusterer=new ymaps.Clusterer({hasBaloon:false,hasHint:false,minClusterSize:3,preset:'islands#orangeClusterIcons'});$.each(availableShops,function(i,elem){var point=new ymaps.Placemark([elem.latitude,elem.longitude],{balloonContent:'<h3>'+elem.name+'</h3><span>'+elem.regtime+'</span><br><a href="'+elem.link+'" class="bGrayButton shopchoose">Перейти к магазину</a>'},enterPlacemark);yandexClusterer.add(point);});map=new ymaps.Map("region_map-container",{center:[55.76,37.64],zoom:10});map.geoObjects.add(yandexClusterer);map.setBounds(yandexClusterer.getBounds());$container.on('cityOpen',function(e,regionId){var shops=$.grep(availableShops,function(elem){return elem.region_id==regionId}),yandexGeoObjectCollection=new ymaps.GeoObjectCollection(),objects=map.geoObjects;$.each(shops,function(i,elem){var point=new ymaps.Placemark([elem.latitude,elem.longitude],{balloonContent:'<h3>'+elem.address+'</h3><span>'+elem.regtime+'</span><br><a href="'+elem.link+'" class="bGrayButton shopchoose">Перейти к магазину</a>'},enterPlacemark);yandexGeoObjectCollection.add(point);});objects.removeAll();objects.add(yandexGeoObjectCollection);if(objects.get(0).getLength()>1){map.setBounds(yandexGeoObjectCollection.getBounds())}else{console.log(objects.get(0).get(0).geometry.getCoordinates());map.setCenter(objects.get(0).get(0).geometry.getCoordinates(),14)}});$container.on('cityClose',function(){map.geoObjects.removeAll();map.geoObjects.add(yandexClusterer);map.setBounds(yandexClusterer.getBounds());});$container.on('shopClick',function(e,shopId){var shop=$.grep(availableShops,function(elem){return elem.id==shopId})[0];map.setCenter([shop.latitude,shop.longitude],16)})});}
if($('#map-container').length==1){ymaps.ready(function(){var lat=$('input[name=shop\\[latitude\\]]').val(),lon=$('input[name=shop\\[longitude\\]]').val();map=new ymaps.Map("map-container",{center:[lat,lon],zoom:16});map.geoObjects.add(new ymaps.Placemark([lat,lon],{},enterPlacemark))});$('.bMap').on('click','.bMap__eContainer',function(){var $container=$('#map-container'),isImage=$(this).hasClass('map-image-link'),isMap=$(this).hasClass('map-google-link');if(isImage){$container.find('ymaps:first').hide();if($container.find('img').length==0){$container.append($('<img />',{"src":$(this).find('img').data('value'),'width':$container.width()}));}else{$container.find('img').attr('src',$(this).find('img').data('value')).show();}}
if(isMap){$container.find('ymaps:first').show();$container.find('img:first').hide();}});}}(jQuery));
//@ sourceMappingURL=shop.js.map