!function(a){a.ENTER.OrderV31Click={info:{},functions:{},map:{},mapOptions:{},$map:{},kladrCityId:0}}(window),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),function(a){var b=a(document.body),c=window._gaq,d=a(".jsChangeRegion").text().trim(),e=function(a,b,e){var f=e||"",g=b||"";a&&a.data&&(a.data.step&&(g=a.data.step),a.data.action&&(f=a.data.action)),"undefined"==typeof ga&&(ga=window[window.GoogleAnalyticsObject]),"object"==typeof c&&c.push(["_trackEvent","Воронка_1 клик_"+d,g,f]),"function"==typeof ga&&ga("send","event","Воронка_1 клик_"+d,g,f),"function"!=typeof ga,"function"==typeof ga&&"function"==typeof ga.getAll&&0==ga.getAll().length};b.on("trackUserAction.orderV3Tracking",e),"function"==typeof ga&&"function"==typeof ga.getAll&&0==ga.getAll().length&&ga("create","UA-25485956-5","enter.ru")}(jQuery),function(a,b,c){ENTER.OrderV31Click.functions.initAddress=function(){function a(){var a=this,d="Улица";return a.streetShortToLong={"пр-кт":"Проспект","ш":"Шоссе","ул.":"Улица","ул":"Улица","пер":"Переулок","пл":"Площадь","дор":"Дорога"},a.cityName=b.observable(""),a.cityId=b.observable(0),a.streetName=b.observable(""),a.streetType=b.observable(d),a.streetTypeShort=b.observable(""),a.streetId=b.observable(0),a.buildingName=b.observable(""),a.buildingId=b.observable(0),a.apartmentName=b.observable(""),a.inputFocus=b.observable(!0),a.inputPrefix=b.computed(function(){return""==a.streetName()?"Улица:":""==a.buildingName()?"дом:":"квартира:"}),a.getParent=function(){var b=!1;return 0!=a.cityId()&&"Улица:"==a.inputPrefix()?b={type:c.kladr.type.street,parentType:"city",parentId:a.cityId()}:0!=a.streetId()&&"дом:"==a.inputPrefix()&&(b={type:c.kladr.type.building,parentType:"street",parentId:a.streetId()}),b},a.update=function(b){"string"==typeof b?""==a.streetName()?(a.streetName(b),a.streetTypeShort("")):""==a.buildingName()?a.buildingName(b):""==a.apartmentName()&&a.apartmentName(b):"object"==typeof b&&("street"==b.contentType?a.streetName(b.name).streetId(b.id).streetType(b.type).streetTypeShort(b.typeShort):"building"==b.contentType&&a.buildingName(b.name).buildingId(b.id))},a.clearCity=function(){return a.cityName("").cityId(0),a},a.clearStreet=function(){return a.streetName("").streetType(d).streetId(0),a},a.clearBuilding=function(){return a.buildingName("").buildingId(0),a},a.clearApartment=function(){return a.apartmentName(""),a},a}function d(a){c.ajax({type:"POST",url:"/order-1click/delivery",data:{action:"changeAddress",params:{street:a.streetName()+" "+(""==a.streetTypeShort()?a.streetType():a.streetTypeShort()),building:a.buildingName(),apartment:a.apartmentName(),kladr_id:0!=a.buildingId()?a.buildingId():0!=a.streetId()?a.streetId():0!=a.cityId()?a.cityId():""},products:JSON.parse(c("#js-order-content").data("param")).products,update:1}}).fail(function(a){var b=c.parseJSON(a.responseText);b.result})}function e(a,b){if(g.getParent()!==!1){var d=c.extend({},{limit:10,name:a.term},g.getParent());c.kladr.api(d,function(a){b(c.map(a,function(a){return{label:f(a),value:a}}))})}}function f(a){var b=a.name,d=a.typeShort,e="";return-1!=c.inArray(d,["ул","пер","пл","дор"])&&(e="."),"street"===a.contentType?b+" "+d+e:b}var g,h=c("#kladr-config").data("value"),i=c("#page-config").data("value").user.region;ENTER.OrderV31Click.functions.smartAddressInit=function(){var a=c(".jsSmartAddressInput"),f=c(".jsAddressRootNode"),j=c.extend(h,{limit:1,type:c.kladr.type.city,name:i.name});a.autocomplete({source:e,minLength:1,open:function(){c(".ui-autocomplete").css({position:"absolute",top:29,left:0})},select:function(b,c){return this.value="",a.val(""),g.update(c.item.value),d(g),!1},focus:function(a,b){this.value=b.item.label,a.preventDefault(),a.stopPropagation()},change:function(){},messages:{noResults:"",results:function(){}}}),a.on({keypress:function(b){13==b.which&&(b.preventDefault(),c(this).val().length>0&&(g.update(c(this).val()),a.val(""),a.autocomplete("close"),d(g)))},keydown:function(b){var d=b.keyCode||b.charCode;8===d&&0===c(this).val().length&&("дом:"==g.inputPrefix()&&(a.val(g.streetName()),g.clearBuilding().clearStreet()),"квартира:"==g.inputPrefix()&&(a.val(g.buildingName()),g.clearApartment().clearBuilding()),b.preventDefault())},blur:function(){g.update(c(this).val()),a.val(""),d(g)}}),c(".jsSmartAddressEditField").on("click",function(){var b=c(this).data("type");b&&"function"==typeof g[b]&&(a.val(g[b]()),"apartmentName"==b&&g.clearApartment(),"buildingName"==b&&g.clearBuilding().clearApartment(),"streetName"==b&&(g.clearStreet().clearBuilding().clearApartment(),""!=g.streetTypeShort()&&a.val(a.val()+" "+g.streetTypeShort())))}),i.kladrId?g.cityId(i.kladrId):h&&i.name&&c.kladr.api(j,function(a){var b=a.length>0?a[0].id:0;0==b||g.cityId(a[0].id)}),f.length>0&&b.applyBindings(g,f[0])},g=new a,ENTER.OrderV31Click.address=g,ENTER.OrderV31Click.functions.smartAddressInit()}}(window,ko,jQuery),function(a){ENTER.OrderV31Click.functions.initYandexMaps=function(){var b=ENTER.OrderV31Click,c=a("#yandex-map-container"),d=function(){var a=c.data("options");b.map=new ymaps.Map("yandex-map-container",{center:[a.latitude,a.longitude],zoom:a.zoom},{autoFitToViewport:"always"}),b.map.controls.remove("searchControl"),b.mapOptions=a,b.$map=c};c.length&&ymaps.ready(d)}}(jQuery),function(a){var b=document.getElementsByTagName("body")[0],c=a(b);ENTER.OrderV31Click.functions.initDelivery=function(){var d=a("#js-order-content"),e=a("#jsOneClickContent"),f="function"==typeof Spinner?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:62,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null,g=function(a,b){k("changeDelivery",{block_name:a,delivery_method_token:b})},h=function(a,b){k("changeDate",{block_name:a,date:b})},i=function(a,b,c){k("changePoint",{block_name:a,id:b,token:c})},j=function(a,b){k("changeInterval",{block_name:a,interval:b})},k=function(c,e){d.data("shop")&&(e.shopId=d.data("shop")),a.ajax({url:"/order-1click/delivery",type:"POST",data:{action:c,params:e,products:JSON.parse(d.data("param")).products,update:1},beforeSend:function(){d.fadeOut(500),f&&f.spin(b)}}).fail(function(b){var c=a.parseJSON(b.responseText);c.result&&c.result.errorContent&&a("#OrderV3ErrorBlock").html(a(c.result.errorContent).html()).show()}).done(function(b){d.empty().html(a(b.result.page).html()),ENTER.OrderV31Click.functions.initAddress(),d.find("input[name=address]").focus()}).always(function(){d.stop(!0,!0).fadeIn(200),f&&f.stop()})},l=function(b){a.ajax({type:"POST",data:b,url:"/order/log"})},m=function(b,c){var d=b.find(".js-order-map").first(),e=d.data("value"),f=ENTER.OrderV31Click.mapOptions,g=ENTER.OrderV31Click.map;if(c||(c=Object.keys(e.points)[0],d.siblings(".selShop_l").hide(),d.siblings(".selShop_l[data-token="+c+"]").show()),e){b.is(":visible")||b.show(),g.geoObjects.removeAll(),g.setCenter([f.latitude,f.longitude],f.zoom),d.append(ENTER.OrderV31Click.$map.show()),g.container.fitToViewport();for(var h=0;h<e.points[c].length;h++){var i=e.points[c][h],j="Адрес: "+i.address;if(i.latitude&&i.longitude){i.regtime&&(j+="<br /> Время работы: "+i.regtime),j+="<br />"+a("<button />",{text:"Выбрать магазин","class":"btnLightGrey jsChangePoint","data-id":i.id,"data-token":c})[0].outerHTML;var k=new ymaps.Placemark([i.latitude,i.longitude],{balloonContentHeader:i.name,balloonContentBody:j,hintContent:i.name},{iconLayout:"default#image",iconImageHref:i.marker.iconImageHref,iconImageSize:i.marker.iconImageSize,iconImageOffset:i.marker.iconImageOffset});g.geoObjects.add(k)}}1===g.geoObjects.getLength()?g.setCenter(g.geoObjects.get(0).geometry.getCoordinates(),15):g.setBounds(g.geoObjects.getBounds())}},n=function(){var b=a(this).data("token"),c=a(this).closest(".popupFl").attr("id");a(".selShop_l").hide(),a(".selShop_l[data-token="+b+"]").show(),a(".selShop_tab").removeClass("selShop_tab-act"),a(".selShop_tab[data-token="+b+"]").addClass("selShop_tab-act"),m(a("#"+c),b)},o=function(){var b=a(this).data("id"),d=a(this).data("token");b&&d&&(c.trigger("trackUserAction",["2_2 Ввод_данных_Самовывоза|Доставки"]),c.children(".selShop, .lb_overlay").remove(),i(a(this).closest(".selShop").data("block_name"),b,d))};d.on("click",".jsCloseFl",function(b){b.stopPropagation(),a(this).closest(".popupFl").hide(),b.preventDefault()}),d.on("click",".orderCol_date, .js-order-changePlace-link",function(b){var d=a(a(this).data("content"));if(b.stopPropagation(),a(".popupFl").hide(),a(this).hasClass("js-order-changePlace-link")){var e=d.find(".selShop_l:first").data("token");d.find(".selShop_l").hide().first().show(),d.find(".selShop_tab").removeClass("selShop_tab-act").first().addClass("selShop_tab-act"),d.lightbox_me({centered:!0,closeSelector:".jsCloseFl",removeOtherOnCreate:!1}),m(d,e),c.trigger("trackUserAction",["2_1 Место_самовывоза|Адрес_доставки"]),d.off("click",".selShop_tab:not(.selShop_tab-act)",n),d.on("click",".selShop_tab:not(.selShop_tab-act)",n),d.off("click",".jsChangePoint",o),d.on("click",".jsChangePoint",o)}else d.show(),l({action:"view-date"});b.preventDefault()}),d.on("click",".jsShowDiscountForm",function(b){b.stopPropagation(),a(this).hide().parent().next().show()}),d.on("click",".orderCol_delivrLst li",function(){var b=a(this);b.hasClass("orderCol_delivrLst_i-act")||g(a(this).closest(".orderRow").data("block_name"),a(this).data("delivery_method_token"))}),d.on("click",".celedr_col",function(){var b=a(this).data("value");"number"==typeof b&&h(a(this).closest(".orderRow").data("block_name"),b)}),d.on("click",".jsShowDeliveryIntervals",function(){a(this).find(".customSel_lst").show()}),d.on("click",".customSel_lst li",function(){j(a(this).closest(".orderRow").data("block_name"),a(this).data("value"))}),e.on("focus",".jsOrderV3PhoneField",function(){c.trigger("trackUserAction",["1_1 Телефон"])}),e.on("focus",".jsOrderV3EmailField",function(){c.trigger("trackUserAction",["1_3 E-mail"])}),e.on("focus",".jsOrderV3NameField",function(){c.trigger("trackUserAction",["1_2 Имя"])}),e.on("click",".jsOrderOneClickClose",function(b){b.preventDefault(),a(this).closest("#jsOneClickContent").trigger("close")})}}(jQuery),function(a){ENTER.OrderV31Click.functions.initValidate=function(){var b=a("#jsOneClickContentPage"),c=a(".jsOrderValidationErrors"),d=a(".jsOrderV3OneClickForm"),e="textfield-err",f=function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},g=function(){var b=!0,c=a("[name=user_info\\[mobile\\]]"),d=a("[name=user_info\\[email\\]]"),g=(a(".orderCol_delivrLst_i-act span"),c.val().replace(/\s+/g,""));return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(g)?c.removeClass(e).siblings(".errTx").hide():(b=!1,c.addClass(e).siblings(".errTx").show()),0==d.val().length||f(d.val())?d.removeClass(e).siblings(".errTx").hide():(b=!1,d.addClass(e).siblings(".errTx").show()),b};c.length,b.on("blur","input",function(){g()}).on("keyup",".jsOrderV3PhoneField",function(){var b=a(this).val();"_"!=b[b.length-1]&&g()}),d.on("submit",function(b){b.preventDefault();var c=a(this),d=c.find(".orderCompl_btn"),e=c.serializeArray();g()&&a.ajax({type:"POST",url:c.attr("action"),data:e,beforeSend:function(){d.attr("disabled",!0)}}).always(function(){d.attr("disabled",!1)}).done(function(b){"undefined"!=typeof b.result&&(a("#jsOneClickContentPage").hide(),a("#jsOneClickContent").append(b.result.page),a("body").trigger("trackUserAction",["3_1 Оформить_успешно"]),function(){return"blackfridaysale"!=b.result.lastPartner?"":void a.each(b.result.orders,function(b,c){var d=[],e=0;a.each(c.products,function(a,b){d.push({id:b.id+"",price:b.price+"",quantity:parseInt(b.quantity)}),e+=parseFloat(b.price)*parseInt(b.quantity)}),ENTER.counters.callGetIntentCounter({type:"CONVERSION",orderId:c.id+"",orderProducts:d,orderRevenue:e+""})})}(),function(){var a,c;"hubrus"==b.result.lastPartner&&window.smartPixel1&&(a=b.result.orders[0].products[0],c=b.result.orders[0].id,smartPixel1.trackState("oneclick_complete",{cart_items:[{price:a.price,id:a.id}],order_id:c}))}(),function(){"advmaker"==b.result.lastPartner&&a.get("http://am15.net/s2s.php",{ams2s:docCookies.get("ams2s"),orders:b.result.orders[0].id})}(),function(){a.each(b.result.orders,function(b,c){var d=[];a.each(c.products,function(a,b){d.push({id:b.id,qnt:b.quantity,price:b.price})}),ENTER.counters.callRetailRocketCounter("order.complete",{transaction:c.id,items:d})})}());var c=a("#jsOrderV3OneClickOrder");c.length&&a.get(c.data("url")).done(function(b){c.html(b.result.page),"function"==typeof ENTER.utils.sendOrderToGA&&ENTER.utils.sendOrderToGA(a("#jsOrder").data("value"))})}).fail(function(b){var c=a.parseJSON(b.responseText);c.result&&c.result.errorContent&&a("#OrderV3ErrorBlock").html(a(c.result.errorContent).html()).show();var d=c.result&&c.result.error?c.result.error:[];a("body").trigger("trackUserAction",["3_2 Оформить_ошибка","Поле ошибки: "+("undefined"!=typeof d?d.join(", "):"")])})})}}(jQuery);