+function(a){function b(){k.each(function(){-1===a.inArray(this.id.slice(4),s)?a(this).hide():a(this).show()})}function c(a){d&&"function"==typeof d.events.fire&&d.events.fire(a)}var d,e,f=a(".menu-item"),g=a("#jsDeliveryMap"),h=(a.parseJSON(a("#partnersJSON").html()),a.parseJSON(a("#objectManagerDataJSON").html())),i=a(".jsPartnerListItem"),j=a(".jsPointList"),k=a(".jsPointListItem"),l=a(".jsPointListItemPartner"),m="current",n=a("#searchInput"),o=a(".jsSearchClear"),p=a(".jsSearchAutocompleteList"),q=a(".jsSearchAutocompleteHolder"),r=[],s=[];0!=g.length&&(a.each(f,function(){var b=a(this);return b.find("a").attr("href")==location.pathname?(b.addClass("active"),!1):void 0}),n.on("keyup",function(b){var c,e=a(this).val(),f=b.which,g=a(".jsSearchAutocompleteItem"),h=a(".deliv-suggest__list"),i="deliv-suggest__i--active",j=g.index(g.filter("."+i)),k=1;if(0==e.length?o.hide():o.show(),ymaps&&"function"==typeof ymaps.geocode)switch(c=[[d.getBounds()[0][0]-k,d.getBounds()[0][1]-k],[d.getBounds()[1][0]+k,d.getBounds()[1][1]+k]],-1===a.inArray(f,[13,38,40])&&ymaps.geocode(e,{boundedBy:c,strictBounds:!0}).then(function(b){var c=p.empty();b.geoObjects.each(function(b){c.append(a('<li class="deliv-suggest__i jsSearchAutocompleteItem" />').data("bounds",b.geometry.getBounds()).text(b.properties.get("name")+", "+b.properties.get("description")))}),b.geoObjects.getLength()?q.show():q.hide(),g=a(".jsSearchAutocompleteItem")},function(a){}),g.removeClass(i),f){case 13:return j>-1?(g.eq(j).click(),!1):!1;case 38:return-1==j&&(j=g.length),g.eq(j-1).addClass(i),h.scrollTo("."+i),!1;case 40:return g.eq(j+1).addClass(i),h.scrollTo("."+i),!1}}),o.on("click",function(){n.val(""),o.hide(),q.hide()}),a(document.body).on("click",".jsSearchAutocompleteItem",function(){var b=a(this).data("bounds");b&&(d.setCenter(b[0],14),q.hide(),n.val(a(this).text()))}),ymaps.ready(function(){e=window.om=new ymaps.ObjectManager,e.objects.options.set("iconLayout","default#image"),e.objects.options.set("iconImageSize",[23,30]),e.objects.events.add(["click"],function(a){var b=a.get("objectId"),c="#uid-"+b;k.removeClass(m).filter(c).addClass(m),j.scrollTo(c,100,{offset:{top:-100}})}),d=window.omap=new ymaps.Map("jsDeliveryMap",{center:[55.76,37.64],zoom:11,controls:["geolocationControl","zoomControl","searchControl"]},{autoFitToViewport:"always",suppressMapOpenBlock:!0,suppressObsoleteBrowserNotifier:!0});var a=d.controls.get("searchControl");a.options.set("size","small"),a.events.add("click",function(){a.options.set("size","large")}),d.events.add("boundschange",function(a){var c=a.get("newBounds")?a.get("newBounds"):d.getBounds(),f=[];c=a.get("target").getBounds(),e.objects.each(function(a){var b,d=e.getObjectState(a.id),g=a.geometry.coordinates,h=a.properties.eUid;b=c[0][0]<g[0]&&c[0][1]<g[1]&&c[1][0]>g[0]&&c[1][1]>g[1],!d.isFilteredOut&&b&&f.push(h)}),s=f,b()}),e.add(h),d.geoObjects.add(e),d.setBounds(d.geoObjects.getBounds());var c=d.getGlobalPixelCenter();d.setGlobalPixelCenter([c[0]+110,c[1]])}),i.on("click",function(){var b="active";a(this).toggleClass(b),r=a.map(i.filter(function(){return a(this).hasClass(b)}),function(b){return a(b).data("value")}),"undefined"!=typeof e&&e.setFilter(function(b){var c=-1!==a.inArray(b.properties.ePartner,r),d=a("#uid-"+b.properties.eUid);return c&&0!=r.length?d.show():d.hide(),0==r.length?!0:c}),c("boundschange"),1==r.length&&"pickpoint"!=r[0]?l.hide():l.show()}),k.on("click",function(){var b=a(this);if(b.hasClass(m))b.removeClass(m),"undefined"!=typeof e&&e.setFilter(function(b){return 0==r.length?!0:-1!==a.inArray(b.properties.ePartner,r)});else if(k.removeClass(m),b.addClass(m),d){d.setCenter(b.data("geo"),15);var f=d.getGlobalPixelCenter();d.setGlobalPixelCenter([f[0]+110,f[1]])}c("boundschange")}))}(jQuery),function(a){var b,c,d=a(".bMapShops").first(),e=d.find(".bMapShops__eMapCityList_city"),f=a("#map-markers").data("content"),g=tmpl,h={iconLayout:"default#image",iconImageHref:"/images/map/marker-shop.png",iconImageSize:[28,39],iconImageOffset:[-14,-39]};if(1==a("#region_map-container").length){if(!a.isArray(f)||0===f.length)return;b=a.grep(f,function(a){return a.is_reconstruction},!0),e.each(function(){var c=a(this).attr("ref");0===a.grep(b,function(a){return a.region_id==c}).length&&a(this).remove()}),d.on("click",".bMapShops__eMapCityList_city",function(c){var f=a(this),h=f.find("ul"),i=f.attr("ref"),j=a.grep(b,function(a){return a.region_id==i}),k="";j.length>0&&(f.hasClass("chosedCity")?(f.removeClass("chosedCity"),h.hide(),e.show(),d.trigger("cityClose")):(e.hide().removeClass("chosedCity"),f.addClass("chosedCity").show(),0==h.find("li").length&&(a.each(j,function(a,b){k+=g("shopInCity",b)}),h.html(k)),h.show(),d.trigger("cityOpen",[i]))),c.stopPropagation()}),d.on("click",".shopInCity",function(b){d.trigger("shopClick",[a(this).attr("ref")]),b.stopPropagation()}),ymaps.ready(function(){var e=new ymaps.Clusterer({hasBaloon:!1,hasHint:!1,minClusterSize:3,preset:"islands#orangeClusterIcons"});a.each(b,function(a,b){var c=new ymaps.Placemark([b.latitude,b.longitude],{balloonContent:"<h3>"+b.name+"</h3><span>"+b.regtime+'</span><br><a href="'+b.link+'" class="bGrayButton shopchoose">Перейти к магазину</a>'},h);e.add(c)}),c=new ymaps.Map("region_map-container",{center:[55.76,37.64],zoom:10}),c.geoObjects.add(e),c.setBounds(e.getBounds()),d.on("cityOpen",function(d,e){var f=a.grep(b,function(a){return a.region_id==e}),g=new ymaps.GeoObjectCollection,i=c.geoObjects;a.each(f,function(a,b){var c=new ymaps.Placemark([b.latitude,b.longitude],{balloonContent:"<h3>"+b.address+"</h3><span>"+b.regtime+'</span><br><a href="'+b.link+'" class="bGrayButton shopchoose">Перейти к магазину</a>'},h);g.add(c)}),i.removeAll(),i.add(g),i.get(0).getLength()>1?c.setBounds(g.getBounds()):c.setCenter(i.get(0).get(0).geometry.getCoordinates(),14)}),d.on("cityClose",function(){c.geoObjects.removeAll(),c.geoObjects.add(e),c.setBounds(e.getBounds())}),d.on("shopClick",function(d,e){var f=a.grep(b,function(a){return a.id==e})[0];c.setCenter([f.latitude,f.longitude],16)})})}1==a("#map-container").length&&(ymaps.ready(function(){var b=a("input[name=shop\\[latitude\\]]").val(),d=a("input[name=shop\\[longitude\\]]").val();c=new ymaps.Map("map-container",{center:[b,d],zoom:16}),c.geoObjects.add(new ymaps.Placemark([b,d],{},h))}),a(".bMap").on("click",".bMap__eContainer",function(){var b=a("#map-container"),c=a(this).hasClass("map-image-link"),d=a(this).hasClass("map-google-link");c&&(b.find("ymaps:first").hide(),0==b.find("img").length?b.append(a("<img />",{src:a(this).find("img").data("value"),width:b.width()})):b.find("img").attr("src",a(this).find("img").data("value")).show()),d&&(b.find("ymaps:first").show(),b.find("img:first").hide())}))}(jQuery);