+function(a){function b(){l.each(function(){-1===a.inArray(this.id.slice(4),t)?a(this).hide():a(this).show()})}function c(a){d&&"function"==typeof d.events.fire&&d.events.fire(a)}var d,e,f=a(window),g=a(".menu-item"),h=a("#jsDeliveryMap"),i=(a.parseJSON(a("#partnersJSON").html()),a.parseJSON(a("#objectManagerDataJSON").html())),j=a(".jsPartnerListItem"),k=a(".jsPointList"),l=a(".jsPointListItem"),m=a(".jsPointListItemPartner"),n="current",o=a("#searchInput"),p=a(".jsSearchClear"),q=a(".jsSearchAutocompleteList"),r=a(".jsSearchAutocompleteHolder"),s=[],t=[],u=null,v=null;0!=h.length&&(a.each(g,function(){var b=a(this);return b.find("a").attr("href")==location.pathname?(b.addClass("active"),!1):void 0}),o.on("keyup",function(b){var c,e=a(this).val(),f=b.which,g=a(".jsSearchAutocompleteItem"),h=a(".deliv-suggest__list"),i="deliv-suggest__i--active",j=g.index(g.filter("."+i)),k=1;if(0==e.length?p.hide():p.show(),ymaps&&"function"==typeof ymaps.geocode)switch(c=[[d.getBounds()[0][0]-k,d.getBounds()[0][1]-k],[d.getBounds()[1][0]+k,d.getBounds()[1][1]+k]],-1===a.inArray(f,[13,38,40])&&ymaps.geocode(e,{boundedBy:c,strictBounds:!0}).then(function(b){var c=q.empty();b.geoObjects.each(function(b){c.append(a('<li class="deliv-suggest__i jsSearchAutocompleteItem" />').data("bounds",b.geometry.getBounds()).text(b.properties.get("name")+", "+b.properties.get("description")))}),b.geoObjects.getLength()?r.show():r.hide(),g=a(".jsSearchAutocompleteItem")},function(a){}),g.removeClass(i),f){case 13:return j>-1?(g.eq(j).click(),!1):!1;case 38:return-1==j&&(j=g.length),g.eq(j-1).addClass(i),h.scrollTo("."+i),!1;case 40:return g.eq(j+1).addClass(i),h.scrollTo("."+i),!1}}),p.on("click",function(){o.val(""),p.hide(),r.hide()}),a(document.body).on("click",".jsSearchAutocompleteItem",function(){var b=a(this).data("bounds");b&&(d.setCenter(b[0],14),r.hide(),o.val(a(this).text())),a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"search_enter",label:a(this).text()})}),ymaps.ready(function(){e=window.om=new ymaps.ObjectManager,e.objects.options.set("iconLayout","default#image"),e.objects.options.set("iconImageSize",[23,30]),e.objects.events.add(["click"],function(a){var b=a.get("objectId"),c="#uid-"+b;l.removeClass(n).filter(c).addClass(n),k.scrollTo(c,100,{offset:{top:-100}})}),d=window.omap=new ymaps.Map("jsDeliveryMap",{center:[55.76,37.64],zoom:11,controls:["geolocationControl","zoomControl","searchControl"]},{autoFitToViewport:"always",suppressMapOpenBlock:!0,suppressObsoleteBrowserNotifier:!0}),"#full"==location.hash&&(d.controls.add("fullscreenControl"),k.hide());var c=d.controls.get("searchControl");c.options.set("size","small"),c.events.add("click",function(){c.options.set("size","large")}),d.events.add("boundschange",function(a){var c=a.get("newBounds")?a.get("newBounds"):d.getBounds(),f=[];c=a.get("target").getBounds(),e.objects.each(function(a){var b,d=e.getObjectState(a.id),g=a.geometry.coordinates,h=a.properties.eUid;b=c[0][0]<g[0]&&c[0][1]<g[1]&&c[1][0]>g[0]&&c[1][1]>g[1],!d.isFilteredOut&&b&&f.push(h)}),t=f,b()}),e.add(i),d.geoObjects.add(e),d.setBounds(d.geoObjects.getBounds());var f=d.getGlobalPixelCenter();"#full"!=location.hash&&d.setGlobalPixelCenter([f[0]+110,f[1]]);var g;(g=d.controls.get("geolocationControl"))&&g.events.add(["click"],function(b){a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"geo-position",label:""})}),(g=d.controls.get("searchControl"))&&g.events.add(["click"],function(b){a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"search_yandex",label:""})}),(g=d.controls.get("zoomControl"))&&g.events.add(["click"],function(b){a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"scale",label:b.get("target").state.get("zoom")>d.getZoom()?"plus":"minus"})}),e.objects.events.add(["click"],function(b){var c=b.get("objectId"),d="#uid-"+c;a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"map",label:l.filter(d).data("partner")})})}),j.on("click",function(){var b="active";a(this).toggleClass(b),s=a.map(j.filter(function(){return a(this).hasClass(b)}),function(b){return a(b).data("value")}),"undefined"!=typeof e&&e.setFilter(function(b){var c=-1!==a.inArray(b.properties.ePartner,s),d=a("#uid-"+b.properties.eUid);return c&&0!=s.length?d.show():d.hide(),0==s.length?!0:c}),c("boundschange"),1==s.length&&"pickpoint"!=s[0]?m.hide():m.show(),a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"filter",label:a(this).data("value")})}),l.on("click",function(){var b=a(this);if(b.hasClass(n))b.removeClass(n),"undefined"!=typeof e&&e.setFilter(function(b){return 0==s.length?!0:-1!==a.inArray(b.properties.ePartner,s)}),a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"list",label:"click_out_"+a(this).data("partner")});else{if(l.removeClass(n),b.addClass(n),d){d.setCenter(b.data("geo"),15);var f=d.getGlobalPixelCenter();d.setGlobalPixelCenter([f[0]+110,f[1]])}a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"list",label:"click_"+a(this).data("partner")})}c("boundschange")}),k.on("scroll",function(){u||(u=setTimeout(function(){a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"list",label:"scroll"}),u=null},1200))}),f.on("scroll",function(){v||(v=setTimeout(function(){var b,c,d=f.scrollTop(),e=f.scrollTop()+f.height();v=null,b=a("#deliv-free"),b.length&&b.offset()&&(c=b.offset().top+50,(c>d||c>e)&&(d>c||e>c)&&a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"text_free-pickup",label:""})),b=a("#deliv-nonfree"),b.length&&b.offset()&&(c=b.offset().top+50,(c>d||c>e)&&(d>c||e>c)&&a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"text_pickup-points",label:""})),b=a("#postamat-video"),b.length&&b.offset()&&(c=b.offset().top+50,(c>d||c>e)&&(d>c||e>c)&&a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"video_pick-point",label:"reached"}))},2e3))}),a(".delivery-video").find("video").on("play",function(){a("body").trigger("trackGoogleEvent",{action:"pickup_ux_shops",category:"video_pick-point",label:"play"})}))}(jQuery),$(function(a){var b=a(".js-shop-viewport"),c=a(".js-send-popup").clone();b.length&&(ymaps.ready(function(){var a=[b.data("map-latitude"),b.data("map-longitude")],c=new ymaps.Map(b[0],{center:a,zoom:16});c.geoObjects.add(new ymaps.Placemark(a,{},{iconLayout:"default#image",iconImageHref:"/images/map/marker-shop.png",iconImageSize:[28,39],iconImageOffset:[-14,-39]}))}),a(".js-shop-image-opener").click(function(c){c.preventDefault();var d=a(c.currentTarget);if("image"==d.data("type")){var e=d.data("big-url"),f=b.find("img");b.find("ymaps:first").hide(),f.length?f.attr("src",e).show():b.append(a("<img />",{src:e,width:b.width()}))}else"map"==d.data("type")&&(b.find("ymaps:first").show(),b.find("img:first").hide())})),a(".js-tab-head").on("click",function(){var b=a(this),c=a("#"+b.data("target"));a(".js-tab-head").removeClass("active"),b.addClass("active"),a(".js-tab").removeClass("active"),c.addClass("active")}),a(".js-send-popup").remove(),a("body").prepend(c),a(".js-send-popup-show").on("click",function(b){b.preventDefault(),a(".js-send-popup").show(),a("body").prepend('<div class="s-overlay js-overlay"></div>')}),a("body").on("click","js-send-popup-closer, .js-overlay",function(){a(".js-send-popup").hide(),a(".js-overlay").remove()})});