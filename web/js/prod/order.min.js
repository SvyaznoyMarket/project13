(function(){var e=function e(){var e=$("#jsOrder").data("value"),t={},r={};("https:"===document.location.protocol?"https://":"http://")+"eu-sonar.sociomantic.com/js/2010-07-01/adpan/enter-ru",console.info("newOrderAnalytics"),console.log(e);for(var i=e.length-1;i>=0;i--){t={},t={"Checkout Complete Order ID":e[i].number,"Checkout Complete SKU Quantity":e[i].products.length,"Checkout Complete SKU Total":e[i].sum,"Checkout Complete Order Subtotal":e[i].sum,"Checkout Complete Order Type":"cart order","Checkout Complete Delivery":e[i].delivery.id,"Checkout Complete Payment":e[i].paymentMethod.id};for(var n=e[i].products.length-1;n>=0;n--)"undefined"!=typeof _kmq&&"undefined"!=KM&&(r={},r={"Checkout Complete SKU":e[i].products[n].article,"Checkout Complete SKU Quantity":e[i].products[n].quantity,"Checkout Complete SKU Price":e[i].products[n].price,"Checkout Complete Parent category":e[i].products[n].category[e[i].products[n].category.length-1].id,"Checkout Complete Category name":e[i].products[n].category[0].id,_t:KM.ts()+n+i,_d:1},console.log(r),_kmq.push(["set",toKISS_pr]));console.log(t),"undefined"!=typeof _kmq&&"undefined"!==KM&&(_kmq.push(["alias",phoneNumber,KM.i()]),_kmq.push(["alias",emailVal,KM.i()]),_kmq.push(["identify",phoneNumber]),_kmq.push(["record","Checkout Complete",t]))}};$(document).ready(function(){if(e(),"order_complete"==$("body").attr("data-template")&&"undefined"!=typeof orderAnalyticsRun&&orderAnalyticsRun(),$(".socnet-ico-list-link").length&&$(".socnet-ico-list-link").bind("click",function(){var e=$(this).data("type");"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","SMM","Complete order",e])}),$(".orderFinal__certificate").length){var t=$(".cardNumber"),r=$(".cardPin"),i=$(".orderFinal__certificate form"),n=$("#sendCard"),a="/certificate-check",o="/certificate-activate",s=function(){function e(e){e>p?p=0:p-=e,$("#paymentWithCard").text(p)}function o(){t.val(""),r.val(""),n.addClass("mDisabled"),m=!1}function s(){return t.val().replace(/[^0-9]/g,"")}function l(){return r.val().replace(/[^0-9]/g,"")}function c(){return{code:s(),pin:l()}}function u(){m&&""!==s()&&14===s().length&&""!==l()&&4===l().length&&n.removeClass("mDisabled")}function h(e){e.match(/\*/)&&n.addClass("mDisabled")}function d(){f("orange","Проверка по номеру карты"),$.post(a,{code:"23846829634"},function(e){if(false in e)return!1;if(!e.success){var t=e.error!==void 0?e.error:"ERROR";return f("red",t),!1}f("green",e.data)}),u(),r.focus()}function f(e,t){var r=$(".process").first();r.hasClass("picked")||r.remove();var n={typeNum:e};switch(e){case"orange":n.text=t,m=!1;break;case"red":n.text="Произошла ошибка: "+t,m=!1;break;case"green":n.text="activated"in t?"Карта "+t.code+" на сумму "+t.sum+" активирована!":"Карта "+t.code+" имеет номинал "+t.sum,m=!0}i.after(tmpl(v,n)),t.activated!==void 0&&$(".process").first().addClass("picked"),u()}var p=1*$("#paymentWithCard").text(),m=!1,v="processBlock";return{activateButton:u,checkCard:d,setProcessingStatus:f,setPaymentSum:e,prepareNewCard:o,getParams:c,checkForStars:h}}();t.mask("999 999 999 9999 9",{completed:s.checkCard,placeholder:"*"}),r.mask("9999",{completed:s.activateButton,placeholder:"*"}),t.bind("keyup",function(){s.checkForStars($(this).val())}),r.bind("keyup",function(){s.checkForStars($(this).val())}),n.bind("click",function(e){return e.preventDefault(),$(this).hasClass("mDisabled")?!1:(s.setProcessingStatus("orange","Минутку, активация карты..."),$.get(o,s.getParams(),function(e){return false in e?!1:e.success?(e.data.activated=!0,s.setProcessingStatus("green",e.data),s.setPaymentSum(1*e.data.sum),s.prepareNewCard(),void 0):(s.setProcessingStatus("red",e.error),!1)}),!1)}),$.mockjax({url:"/certificate-activate",responseTime:1e3,responseText:{success:!0,error:"alredy activated",data:{sum:1e3,code:"3432432"}}})}if($(".auth-link").bind("click",function(e){e.preventDefault();var t=$(this);$("#login-form, #register-form").data("redirect",!1),$("#auth-block").lightbox_me({centered:!0,onLoad:function(){$("#auth-block").find("input:first").focus()},onClose:function(){$.get(t.data("updateUrl"),function(e){if(!0===e.success){var t=$(".order-form");$("#user-block").replaceWith(e.data.content),$.each(e.data.fields,function(e,r){var i=t.find('[name="'+e+'"]');2>i.val().length&&i.val(r)})}})}})}),function(){if($("#product_errors").length){var e=function(e,t,r){var i="tmpErrPopup"+Math.floor(22*Math.random()),n='<div id="'+i+'" class="popup">'+'<div class="popupbox width290">'+'<div class="font18 pb18"> Непредвиденная ошибка</div>'+"</div>"+'<p style="text-align:center"><a href="#" class="closePopup bBigOrangeButton">OK</a></p>';$("body").append($(n)),$.each(e,function(e,t){$("#"+i).find(".popupbox").append('<div class="font18 pb18"> '+t+"</div>")}),$("#"+i).lightbox_me({centered:!0,closeSelector:".closePopup",onClose:function(){var e=function(t,r){if(t[r]){var i=t[r]+"";$.ajax({url:i}).then(function(){r++,e(t,r)})}else window.location.reload()};$.merge(t,r),e(t,0)}})},t=[],r=[],i=[],n=$("#product_errors").data("value").length;if(n){var a=function(){$.each($("#product_errors").data("value"),function(e,n){n.product.deleteUrl&&r.push(n.product.deleteUrl),n.product.addUrl&&i.push(n.product.addUrl),708==n.code?n.quantity_available>0?("undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","User error","Нет нужного количества товаров"]),t.push("Вы заказали товар "+n.product.name+" в количестве "+n.product.quantity+" шт. <br/ >Доступно только "+n.quantity_available+" шт.<br/ >Будет заказано "+n.quantity_available+"шт"),i.push(n.product.addUrl)):("undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","User error","Нет товара для выбранного способа доставки"]),t.push("Товара "+n.product.name+" нет в наличии для выбранного способа доставки.<br/>Товар будет удален из корзины.")):("undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","User error","Товар недоступен для продажи"]),t.push("Товар "+n.product.name+" недоступен для продажи.<br/>Товар будет удален из корзины."))}),e(t,r,i)};a()}}}(),function(){var e=$(".timer");if(!e.length)return!1;var t=function(e){$.ajax({type:"POST",url:e.data("clear-payment-url"),async:!1,data:{},success:function(){}})},r=function(){1===n&&(clearInterval(i),$("form.paymentUrl").length?(t($("form.paymentUrl")),window.location=$("form.paymentUrl").attr("action")):$(".form").submit()),n-=1,e.html(n)},i=window.setInterval(r,1e3),n=1*e.html().replace(/\D/g,"")}(),$("#credit-widget").length){var l=$("#credit-widget").data("value");if(!(false in l)){"direct-credit"===l.widget&&$LAB.script("JsHttpRequest.min.js").script("http://direct-credit.ru/widget/script_utf.js").wait(function(){function e(){dc_getCreditForTheProduct("4427",l.vars.number,"orderProductToBuyOnCredit",{order_id:l.vars.number,region:l.vars.region})}for(var t=l.vars.items.length-1;t>=0;t--){var r=l.vars.items[t];dc_getCreditForTheProduct("4427",l.vars.number,"addProductToBuyOnCredit",{name:r.articul,count:r.quantity,articul:r.articul,price:r.price,type:r.type},function(){e()})}});var c="http://"+window.location.hostname;if($("#credit-widget").length){var l=$("#credit-widget").data("value");if(!(false in l)){"direct-credit"===l.widget&&$LAB.script("JsHttpRequest.js").script("http://direct-credit.ru/widget/script_utf.js").wait(function(){function e(){dc_getCreditForTheProduct("4427",l.vars.number,"orderProductToBuyOnCredit",{order_id:l.vars.number,region:l.vars.region})}for(var t=l.vars.items.length-1;t>=0;t--){var r=l.vars.items[t];dc_getCreditForTheProduct("4427",l.vars.number,"addProductToBuyOnCredit",{name:r.articul,count:r.quantity,articul:r.articul,price:r.price,type:r.type},function(){e()})}});var c="http://"+window.location.hostname;if("kupivkredit"===l.widget){var u=function(){setTimeout(function(){document.location=c},3e3)},h=function(){};$LAB.script("https://www.kupivkredit.ru/widget/vkredit.js").wait(function(){var e=new VkreditWidget(1,l.vars.sum,{order:l.vars.order,sig:l.vars.sig,callbackUrl:window.location.href,onClose:u,onDecision:h});e.openWidget()})}}}}}})})(this);