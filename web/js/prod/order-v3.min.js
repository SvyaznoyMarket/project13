!function(a){a.ENTER.OrderV3={info:{},constructors:{},map:{},mapOptions:{},$map:{},kladrCityId:0}}(window),function(a){a.kladr={},a.kladr.url="http://kladr.enter.ru/api.php",a.kladr.type={region:"region",district:"district",city:"city",street:"street",building:"building"},a.kladr.api=function(b,c){var d={};b.token&&(d.token=b.token),b.key&&(d.key=b.key),b.type&&(d.contentType=b.type),b.name&&(d.query=b.name),b.parentType&&b.parentId&&(d[b.parentType+"Id"]=b.parentId),b.withParents&&(d.withParent=1),d.limit=b.limit?b.limit:2e3;var e=!1;a.getJSON(a.kladr.url+"?callback=?",d,function(a){e||(e=!0,c&&c(a.result))}),setTimeout(function(){e||(e=!0,c&&c([]))},5e3)},a.kladr.check=function(b,c){b.withParents=!1,b.limit=1,a.kladr.api(b,function(a){a&&a.length?c&&c(a[0]):c&&c(!1)})}}(jQuery),function(a,b){a.fn.kladr=function(c,d){function e(c,d,e){function f(d,e,f){if(x=c.data("kladr-options"),e!==b)return x[d]=e,c.data("kladr-options",x),c;if("string"===a.type(d))return x?x[d]:null;if(x)return c;if(x=y,"object"===a.type(d))for(var g in d)x[g]=d[g];return c.data("kladr-options",x),f&&f(),c}function g(){var b=a(document.getElementById("kladr_autocomplete")),d=c.attr("name");b.length||(b=a('<div id="kladr_autocomplete"></div>').appendTo("body")),c.attr("autocomplete","off"),v=a('<ul class="kladr_autocomplete_'+d+'" style="display: none;"></ul>'),v.appendTo(b),w=a('<div class="spinner kladr_autocomplete_'+d+'_spinner" class="spinner" style="display: none;"></div>'),w.appendTo(b)}function h(b,c){v.empty();for(var d in b){var e=b[d],f=x.valueFormat(e,c),g=x.labelFormat(e,c),h=a('<a data-val="'+f+'">'+g+"</a>");h.data("kladr-object",e);var i=a("<li></li>").append(h);i.appendTo(v)}}function i(){var a=c.offset(),b=c.outerWidth(),d=c.outerHeight();v.css({top:a.top+d+"px",left:a.left});var e=v.outerWidth()-v.width();v.width(b-e);var f=w.width(),g=w.height();w.css({top:a.top+(d-g)/2-1,left:a.left+b-f-2})}function j(b){if(!(b.which>8&&b.which<46)&&l()){var d=q(c.val());if(!a.trim(d))return void k();t(),r("send"),x.source(d,function(b){return u(),r("received"),c.is(":focus")&&a.trim(c.val())&&b.length?(h(b,d),i(),v.slideDown(50),void r("open")):void k()})}}function k(){m(),v.hide(),r("close")}function l(){switch(x.type){case a.kladr.type.region:case a.kladr.type.district:case a.kladr.type.city:if(x.parentType&&!x.parentId)return!1;break;case a.kladr.type.street:if(x.parentType!=a.kladr.type.city)return!1;if(!x.parentId)return!1;break;case a.kladr.type.building:if(x.parentType!=a.kladr.type.street)return!1;if(!x.parentId)return!1;break;default:return!1}return x.limit<1?!1:!0}function m(){var a=v.find(".active a");a.length&&(c.val(a.attr("data-val")),x.current=a.data("kladr-object"),c.data("kladr-options",x),r("select",x.current))}function n(a){var b=v.find("li.active");switch(a.which){case z.up:b.length?(b.removeClass("active"),b=b.prev()):b=v.find("li").last(),b.addClass("active");var c=b.find("a").data("kladr-object");r("preselect",c),x.arrowSelect&&m();break;case z.down:b.length?(b.removeClass("active"),b=b.next()):b=v.find("li").first(),b.addClass("active");var c=b.find("a").data("kladr-object");r("preselect",c),x.arrowSelect&&m();break;case z.esc:b.removeClass("active"),k();break;case z.enter:return x.arrowSelect||m(),b.removeClass("active"),k(),!1}}function o(){return k(),c.focus(),!1}function p(){if(x.verify&&l()){var b=q(c.val());a.trim(b)&&(t(),r("send"),x.source(b,function(a){u(),r("received");for(var d=null,e=0;e<a.length;e++){var f=b.toLowerCase(),g=a[e].name.toLowerCase();if(f==g){d=a[e];break}}d&&c.val(x.valueFormat(d,b)),x.current=d,c.data("kladr-options",x),r("check",x.current)}))}}function q(a){for(var b,c,d="1234567890qazwsxedcrfvtgbyhnujmik,ol.p;[']- QAZWSXEDCRFVTGBYHNUJMIK<OL>P:{\"} ",e="1234567890йфяцычувскамепинртгоьшлбщдюзжхэъ- ЙФЯЦЫЧУВСКАМЕПИНРТГОЬШЛБЩДЮЗЖХЭЪ ",f="",g=0;g<a.length;g++)b=a[g],c=d.indexOf(b),f+=c>-1?e[c]:b;return f}function r(a,b){a&&(c.trigger("kladr_"+a,b),x[a]&&x[a].call(c.get(0),b))}function s(){if(!A){var a=-.2;A=setInterval(function(){return w.is(":visible")?(w.css("background-position","0% "+a+"%"),a+=5.555556,void(a>95&&(a=-.2))):(clearInterval(A),void(A=null))},30)}}function t(){x.showSpinner&&(w.show(),s())}function u(){w.hide()}var v=null,w=null,x=null,y={token:null,key:null,type:null,parentType:null,parentId:null,limit:10,withParents:!1,verify:!1,showSpinner:!0,arrowSelect:!0,current:null,open:null,close:null,send:null,received:null,select:null,check:null,source:function(b,c){var d={token:x.token,key:x.token,type:x.type,name:b,parentType:x.parentType,parentId:x.parentId,withParents:x.withParents,limit:x.limit};a.kladr.api(d,c)},labelFormat:function(a,b){var c="",d=a.name.toLowerCase();b=b.toLowerCase();var e=d.indexOf(b);return e=e>0?e:0,a.typeShort&&(c+=a.typeShort+". "),b.length<a.name.length?(c+=a.name.substr(0,e),c+="<strong>"+a.name.substr(e,b.length)+"</strong>",c+=a.name.substr(e+b.length,a.name.length-b.length-e)):c+="<strong>"+a.name+"</strong>",c},valueFormat:function(a){return a.name}},z={up:38,down:40,esc:27,enter:13},A=null;return f(d,e,function(){var b=!1;g(),i(),c.keyup(j),c.keydown(n),c.change(function(){b||p()}),c.blur(function(){b||k()}),v.on("click","li, a",o),v.on("mouseenter","li",function(){var c=a(this);v.find("li.active").removeClass("active"),c.addClass("active");var d=c.find("a").data("kladr-object");r("preselect",d),b=!0}),v.on("mouseleave","li",function(){a(this).removeClass("active"),b=!1}),a(window).resize(i)})}var f=b;return this.each(function(){var g=e(a(this),c,d);f==b&&(f=g)}),f}}(jQuery),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),function(a){var b=a(document.body),c=window._gaq,d=a(".jsRegion").data("value"),e=function(a,b,e){var f=e||"",g=b||"";a&&a.data&&(a.data.step&&(g=a.data.step),a.data.action&&(f=a.data.action)),"undefined"==typeof ga&&(ga=window[window.GoogleAnalyticsObject]),"object"==typeof c&&c.push(["_trackEvent","Воронка_"+d,g,f]),"function"==typeof ga&&ga("send","event","Воронка_"+d,g,f),"function"==typeof ga&&0==ga.getAll().length};b.on("trackUserAction.orderV3Tracking",e),"function"==typeof ga&&0==ga.getAll().length&&ga("create","UA-25485956-5","enter.ru")}(jQuery),function(a){function b(){}var c=a("#js-order-content");c.on("click",".orderCol_data-count",function(b){var c=a(this);b.stopPropagation(),c.hide().siblings(".orderCol_data-summ, .orderCol_data-price").hide(),c.siblings(".orderCol_data-edit").show()}),c.on("click",".bCountSection__eP, .bCountSection__eM",function(b){var c=a(this),d=c.siblings("input"),e=parseInt(d.data("stock"),10),f=parseInt(d.val(),10);c.hasClass("bCountSection__eP")&&e>f&&d.val(f+1),c.hasClass("bCountSection__eM")&&f>1&&d.val(f-1),b.preventDefault(),b.stopPropagation()}),c.on("change",".bCountSection__eNum",function(a){a.stopPropagation()}),window.ENTER.OrderV3.constructors.counter=b}(jQuery),function(a){function b(){function b(b){return this.city=b,this.street={},this.building={},this.apartment={},this.getParent=function(){return this.street.id&&!this.building.name?{parentType:this.street.contentType,parentId:this.street.id,type:a.kladr.type.building}:this.city.id&&!this.street.name?{parentType:this.city.contentType,parentId:this.city.id}:!1},this.getLastType=function(){return"undefined"==typeof this.street.name?"street":"undefined"==typeof this.building.name?"building":"undefined"==typeof this.apartment.name?"apartment":!1},this.getNextType=function(){return"undefined"!=typeof this.building.name?"apartment":"undefined"!=typeof this.street.name?"building":"undefined"==typeof this.street.name?"street":!1},this.update=function(b){if("undefined"==typeof b.contentType){if(b.type===!1)return;b.contentType=b.type}this[b.contentType]=b,o.autocomplete("close").val(""),e(b),d(a("input:focus").eq(0)),"apartment"==b.contentType&&o.hide(),"street"==b.contentType?l.trigger("trackUserEvent",["10 Адрес_доставки_Доставка_ОБЯЗАТЕЛЬНО"]):"building"==b.contentType&&l.trigger("trackUserEvent",["10_1 Ввод_данных_Доставки_Доставка_ОБЯЗАТЕЛЬНО"]),ENTER.OrderV3.address=this},this.clear=function(b,c){var d=a(".jsAddressItem[data-type="+b+"]");switch(b){case"apartment":this.apartment={};break;case"building":this.apartment={},this.building={};break;case"street":this.apartment={},this.building={},this.street={}}d.nextAll(".jsAddressItem").remove(),c&&a(c).closest(".orderCol_addrs").find("input").val(d.find(".jsAddressItemName").eq(0).text()).show().focus(),d.remove()},this.clearLast=function(b){var c=a(".jsAddressItem:last").data("type");c&&this.clear(c,b)},this}function c(){a.ajax({type:"POST",data:{action:"changeAddress",params:{street:h.street.type+" "+h.street.name,building:h.building.name,apartment:h.apartment.name,kladr_id:h.building.id?h.building.id:h.street.id?h.street.id:h.city.id}}}).fail(function(b){var c=a.parseJSON(b.responseText);c.result}).done(function(a){})}function d(b){var c=h.getLastType(),d=a(b).siblings("#addressInputPrefix");c!==!1&&d.text(q[c]+("apartment"==c?" (необязательно)":"")+":")}function e(b){var c,d=a("<li />",{"class":"orderCol_addrs_fld_i jsAddressItem","data-item":JSON.stringify(b),"data-type":b.contentType});c="undefined"!=typeof b.id?b.type:q[b.contentType],d.append(a("<span />").addClass("orderCol_addrs_fld_n jsAddressItemType").text(c)).append(a("<span />").addClass("orderCol_addrs_fld_val jsAddressItemName").text(b.name)),d.insertBefore(o.parent())}function f(b){var c=b.name,d=b.typeShort,e="";return-1!=a.inArray(d,["ул","пер","пл","дор"])&&(e="."),"street"===b.contentType?c+" "+d+e:c}function g(b){a.each(["street","building","apartment"],function(a,c){("undefined"!=typeof b[c].type||"undefined"!=typeof b[c].contentType)&&e(b[c])})}var h,i,j,k,l=a(document.body),m=a("#kladr-config").data("value"),n=a(".orderCol_addrs"),o=n.find("input"),p=n.find("#addressInputPrefix"),q={street:"Улица",building:"дом",apartment:"квартира"},r="function"==typeof Spinner?new Spinner({lines:7,length:3,width:3,radius:2,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null;0!==o.length&&(k=a("<div />",{"class":"kladr_spinner"}).css({position:"absolute",top:0,right:0,height:"30px",width:"30px"}),n.prepend(k),n.on("click",".jsAddressItem",function(b){b.stopPropagation();var c=a(this).data("type");h.clear(c,this)}),n.on("click",function(b){h.getLastType()!==!1&&a(this).find("input").eq(0).show().focus(),b.preventDefault()}),j=function(b,c){if(h.getParent()!==!1){var d=a.extend(m,{limit:10,type:a.kladr.type.street,name:b.term},h.getParent());r&&r.spin(a(".kladr_spinner")[0]),a.kladr.api(d,function(b){r&&r.stop(),c(a.map(b,function(a){return{label:f(a),value:a}}))})}},o.autocomplete({source:j,minLength:1,select:function(a,b){return this.value="",h.update(b.item.value),!1},focus:function(a,b){this.value=b.item.label,a.preventDefault(),a.stopPropagation()},change:function(){},messages:{noResults:"",results:function(){}}}),o.on({focus:function(){d(this)},blur:function(){p.text(""),c()}}),o.on("keypress",function(b){13==b.which&&a(this).val().length>0&&h.update({type:h.getNextType(),name:a(this).val()})}),o.on("keydown",function(b){var c=b.keyCode||b.charCode;8===c&&0===a(this).val().length&&(h.clearLast(this),b.preventDefault())}),o.data("ui-autocomplete")._renderMenu=function(b,c){var d=this;a.each(c,function(a,c){d._renderItemData(b,c)})},o.data("ui-autocomplete")._renderItem=function(b,c){return a("<li>").attr("data-value",JSON.stringify(c.value)).append(a("<a>").text(c.label)).appendTo(b)},(i=function(){"object"==typeof ENTER.OrderV3.address?(h=ENTER.OrderV3.address,g(h),o.hide()):(r&&r.spin(a(".kladr_spinner")[0]),h=new b({}),a.kladr.api(a.extend(m,{limit:1,type:a.kladr.type.city,name:a("#region-name").data("value")}),function(a){var b=a.length>0?a[0].id:0;0==b||(h.city=a[0]),r&&r.stop()}))})())}ENTER.OrderV3.constructors.smartAddress=b,b()}(jQuery),function(a){var b=ENTER.OrderV3,c=a("#yandex-map-container"),d=function(){var a=c.data("options");b.map=new ymaps.Map("yandex-map-container",{center:[a.latitude,a.longitude],zoom:a.zoom},{autoFitToViewport:"always"}),b.map.controls.remove("searchControl"),b.mapOptions=a,b.$map=c};c.length&&ymaps.ready(d)}(jQuery),function(a){var b=document.getElementsByTagName("body")[0],c=a(b),d=a(".orderCnt"),e=a("#jsOrder"),f="function"==typeof Spinner?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:62,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null,g=function(c,d,e){a.ajax({url:"getPaymentForm/"+c+"/order/"+d+"/number/"+e,success:function(c){var d;""!=c.form&&(d=a(c.form),f&&f.spin(b),d.hasClass("jsPaymentFormPaypal")&&"undefined"!=typeof d.attr("action")?window.location.href=d.attr("action"):a(c.form).submit())}})},h=function(b,c,d,e){1==b&&i(c.kupivkredit),2==b&&j(c["direct-credit"]),a.ajax({type:"POST",url:"/order/update-credit",data:{number_erp:d,bank_id:e}})},i=function(a){var b,c=function(){},d=function(){};$LAB.script("//www.kupivkredit.ru/widget/vkredit.js").wait(function(){b=new VkreditWidget(1,a.vars.sum,{order:a.vars.order,sig:a.vars.sig,callbackUrl:window.location.href,onClose:c,onDecision:d}),b.openWidget()})},j=function(b){var c=[];$LAB.script("//api.direct-credit.ru/JsHttpRequest.js").script("//api.direct-credit.ru/dc.js").wait(function(){a.each(b.vars.items,function(a,b){c.push({id:b.articul,name:b.name,price:b.price,type:b.type,count:b.quantity})}),DCLoans(b.vars.partnerID,"getCredit",{products:c,order:b.vars.number,codeTT:b.vars.region},function(a){},!1)})};d.on("click",".jsPaymentMethod",function(){var c=a(this).data("value"),d=a(this).closest(".orderLn"),e=d.data("order-id"),f=d.data("order-number");switch(c){case 5:g(5,e,f),b.trigger("trackUserAction",["17_2 Оплатить_онлайн_Онлайн_Оплата"]);break;case 8:g(8,e,f),b.trigger("trackUserAction",["17_3 Оплатить_онлайн_Электронный счёт PSB_Оплата"]);break;case 13:g(13,e,f),b.trigger("trackUserAction",["17_1 Оплатить_онлайн_PayPal_Оплата"])}}),d.on("click",".jsOnlinePaymentSpan",function(b){a(this).parent().siblings(".jsOnlinePaymentList").show(),c.trigger("trackUserAction",["17 Оплатить_онлайн_вход_Оплата"]),b.stopPropagation()}),d.on("click",".jsOnlinePaymentBlock",function(b){0==a(this).find(".jsOnlinePaymentList").length?a(this).siblings(".jsOnlinePaymentList").show():a(this).find(".jsOnlinePaymentList").show(),0!=a(this).find(".jsCreditList").length&&a(this).find(".jsCreditList").show(),b.stopPropagation()}),d.on("click",".jsCreditButton",function(b){a(this).siblings(".jsCreditList").show(),b.preventDefault(),b.stopPropagation()}),d.on("click",".jsCreditList li",function(b){var c=a(this).data("bank-provider-id"),d=a(this).data("value"),e=a(this).parent().siblings(".credit-widget").data("value"),f=a(this).closest(".orderLn").data("order-number-erp");b.stopPropagation(),a(this).parent().hide(),h(c,e,f,d)}),a(b).on("click",function(){"/order/complete"==window.location.pathname&&a(".popupFl").hide()}),/order\/complete/.test(window.location.href)&&c.trigger("trackUserAction",["16 Вход_Оплата_ОБЯЗАТЕЛЬНО"]),0!=e.length&&a.each(e.data("value").orders,function(b,d){var e={};e.transaction={id:d.numberErp,affiliation:d.is_partner?"Партнер":"Enter",total:d.paySum,shipping:d.delivery[0].price,city:d.region.name},e.products=a.map(d.products,function(a){return{id:a.id,name:a.name,sku:a.article,category:a.category[a.category.length-1].name,price:a.price,quantity:a.quantity}}),c.trigger("trackGoogleTransaction",[e])})}(jQuery),function(a){ENTER.OrderV3=ENTER.OrderV3||{};var b=document.getElementsByTagName("body")[0],c=a(b),d=a("#js-order-content"),e="",f="function"==typeof Spinner?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:62,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null,g=function(a,b){s("changeDelivery",{block_name:a,delivery_method_token:b})},h=function(a,b){s("changeDate",{block_name:a,date:b})},i=function(a,b,c){s("changePoint",{block_name:a,id:b,token:c})},j=function(a,b){s("changeInterval",{block_name:a,interval:b})},k=function(a,b,c){s("changeProductQuantity",{block_name:a,id:b,quantity:c})},l=function(a,b,c){var d={block_name:a};d[b]=c,s("changePaymentMethod",d)},m=function(a){s("changeOrderComment",{comment:a})},n=function(b,c){var d=a("[data-block_name="+b+"]").find(".jsCertificatePinInput").val();""!=d?q(b,c,d):p(b,c)},o=function(a,b){s("deleteDiscount",{block_name:a,number:b})},p=function(b,c){a.ajax({type:"POST",url:"/certificate-check",data:{code:c,pin:"0000"}}).done(function(d){742==d.error_code?a("[data-block_name="+b+"]").find(".cuponPin").show():743==d.error_code&&s("applyDiscount",{block_name:b,number:c})}).always(function(a){})},q=function(a,b,c){s("applyCertificate",{block_name:a,code:b,pin:c})},r=function(a){s("deleteCertificate",{block_name:a})},s=function(c,e){a.ajax({type:"POST",data:{action:c,params:e},beforeSend:function(){d.fadeOut(500),f&&f.spin(b)}}).fail(function(b){var c=a.parseJSON(b.responseText);c.result,c.result.redirect&&(window.location.href=c.result.redirect)}).done(function(b){d.empty().html(a(b.result.page).find("#js-order-content").html()),ENTER.OrderV3.constructors.smartAddress(),d.find("input[name=address]").focus()}).always(function(){d.stop(!0,!0).fadeIn(200),f&&f.stop()})},t=function(b){a.ajax({type:"POST",data:b,url:"/order/log"})},u=function(b,c){var d=b.find(".js-order-map").first(),e=d.data("value"),f=ENTER.OrderV3.mapOptions,g=ENTER.OrderV3.map;if(c||(c=Object.keys(e.points)[0],d.siblings(".selShop_l").hide(),d.siblings(".selShop_l[data-token="+c+"]").show()),e){b.is(":visible")||b.show(),g.geoObjects.removeAll(),g.setCenter([f.latitude,f.longitude],f.zoom),d.append(ENTER.OrderV3.$map.show()),g.container.fitToViewport();for(var h=0;h<e.points[c].length;h++){var i=e.points[c][h],j="Адрес: "+i.address;if(i.latitude&&i.longitude){i.regtime&&(j+="<br /> Время работы: "+i.regtime),j+="<br />"+a("<button />",{text:"Выбрать магазин","class":"btnLightGrey jsChangePoint","data-id":i.id,"data-token":c})[0].outerHTML;var k=new ymaps.Placemark([i.latitude,i.longitude],{balloonContentHeader:i.name,balloonContentBody:j,hintContent:i.name},{iconLayout:"default#image",iconImageHref:i.marker.iconImageHref,iconImageSize:i.marker.iconImageSize,iconImageOffset:i.marker.iconImageOffset});g.geoObjects.add(k)}}1===g.geoObjects.getLength()?g.setCenter(g.geoObjects.get(0).geometry.getCoordinates(),15):g.setBounds(g.geoObjects.getBounds())}};d.on("click",".jsCloseFl",function(b){b.stopPropagation(),a(this).closest(".popupFl").hide(),b.preventDefault()}),d.on("click",".orderCol_date, .js-order-changePlace-link",function(b){var d=a(this).data("content");if(b.stopPropagation(),a(".popupFl").hide(),a(d).show(),a(this).hasClass("js-order-changePlace-link")){var e=a(d).find(".selShop_l:first").data("token");a(d).find(".selShop_l").hide().first().show(),a(d).find(".selShop_tab").removeClass("selShop_tab-act").first().addClass("selShop_tab-act"),u(a(d),e),c.trigger("trackUserAction",["10 Место_самовывоза_Доставка_ОБЯЗАТЕЛЬНО"]),a(d).lightbox_me({centered:!0,closeSelector:".jsCloseFl"})}else t({action:"view-date"}),c.trigger("trackUserAction",["11 Срок_доставки_Доставка"]);b.preventDefault()}),d.on("click",".selShop_tab:not(.selShop_tab-act)",function(){var b=a(this).data("token"),c=a(this).closest(".popupFl").attr("id");a(".selShop_l").hide(),a(".selShop_l[data-token="+b+"]").show(),a(".selShop_tab").removeClass("selShop_tab-act"),a(".selShop_tab[data-token="+b+"]").addClass("selShop_tab-act"),u(a("#"+c),b)}),d.on("click",".jsShowDiscountForm",function(b){b.stopPropagation(),a(this).hide().parent().next().show()}),d.on("click",".orderCol_delivrLst li",function(){var b=a(this);b.hasClass("orderCol_delivrLst_i-act")||g(a(this).closest(".orderRow").data("block_name"),a(this).data("delivery_method_token"))}),d.on("click",".celedr_col",function(){var b=a(this).data("value");"number"==typeof b&&(c.trigger("trackUserAction",["11_1 Срок_Изменил_дату_Доставка"]),h(a(this).closest(".orderRow").data("block_name"),b))}),c.on("click",".jsChangePoint",function(){var b=a(this).data("id"),d=a(this).data("token");b&&d&&(c.trigger("trackUserAction",["10_1 Ввод_данных_Самовывоза_Доставка_ОБЯЗАТЕЛЬНО"]),c.children(".selShop, .lb_overlay").remove(),i(a(this).closest(".selShop").data("block_name"),b,d))}),d.on("click",".customSel_def",function(){a(this).next(".customSel_lst").show()}),d.on("click",".customSel_lst li",function(){j(a(this).closest(".orderRow").data("block_name"),a(this).data("value"))}),d.on("click",".jsChangeProductQuantity",function(b){var c=a(this),d=c.parent().find("input").val();k(c.data("block_name"),c.data("id"),d),b.preventDefault()}),d.on("click",".jsDeleteProduct",function(b){var c=a(this);k(c.data("block_name"),c.data("id"),0),b.preventDefault()}),d.on("change",".jsCreditCardPayment",function(){var b=a(this),d=b.closest(".orderRow").data("block_name");b.is(":checked")&&c.trigger("trackUserAction",["13_1 Оплата_банковской_картой_Доставка"]),l(d,"by_credit_card",b.is(":checked"))}),d.on("change",".jsCreditPayment",function(){var b=a(this),d=b.closest(".orderRow").data("block_name");b.is(":checked")&&c.trigger("trackUserAction",["13_2 Оплата_в_кредит_Доставка"]),l(d,"by_online_credit",a(this).is(":checked"))}),d.on("blur focus",".orderComment_fld",function(){e!=a(this).val()&&(e=a(this).val(),m(a(this).val()))}),d.on("click",".orderComment_t",function(){a(".orderComment_fld").show()}),d.on("click",".jsApplyDiscount",function(b){var c=a(this),d=c.closest(".orderRow").data("block_name"),e=c.parent().siblings("input").val();""!=e&&n(d,e),b.preventDefault()}),d.on("click",".jsDeleteDiscount",function(b){var c=a(this),d=c.closest(".orderRow").data("block_name"),e=c.data("value");o(d,e),b.preventDefault()}),d.on("click",".jsWanna",function(){var b='<span style="margin: 5px 0 17px 10px; display: inline-block; color: #878787;">Спасибо за участие в опросе.</span>';a(b).insertAfter(a(this)),a(this).hide(),window.docCookies.setItem("enter_order_v3_wanna",1,0,"/order"),c.trigger("trackUserAction",["1_2 Срок_Хочу_быстрее_Доставка"]),t({action:"wanna"})}),d.on("click",".jsDeleteCertificate",function(){var b=a(this).closest(".orderRow").data("block_name");r(b)}),d.on("click",".jsAcceptTerms",function(){c.trigger("trackUserAction",["14 Согласен_оферта_Доставка_ОБЯЗАТЕЛЬНО"])}),/order\/delivery/.test(window.location.href)&&(c.trigger("trackUserAction",["6_1 Далее_успешно_Получатель_ОБЯЗАТЕЛЬНО"]),c.trigger("trackUserAction",["7 Вход_Доставка_ОБЯЗАТЕЛЬНО","Количество заказов: "+a(".orderRow").length])),c.on("click","a.jsChangeRegionAnalytics",function(b){var c=a(this).text(),d=a(".jsRegion").data("value"),e=a(this).attr("href");b.preventDefault(),ga("send","event",{eventCategory:"Воронка_"+d,eventAction:"8 Регион_Доставка",eventLabel:"Было: "+d+", Стало: "+c,hitCallback:function(){window.location.href=e}})})}(jQuery),function(a){var b=a(document.body),c=a(".orderCnt"),d=c.find("input");a.mask.definitions.x="[0-9]",a.mask.placeholder="_",a.map(d,function(b){"undefined"!=typeof a(b).data("mask")&&a(b).mask(a(b).data("mask"))}),c.on("click",".bonusCnt_i",function(b){b.stopPropagation();var c=a(this),d=c.data("eq"),e=a(".bonusCnt_it");c.hasClass("bonusCnt_i-act")||(a(".bonusCnt_i").removeClass("bonusCnt_i-act"),c.addClass("bonusCnt_i-act"),e.hide().eq(d).show())}),b.on("focus",".jsOrderV3PhoneField",function(){b.trigger("trackUserAction",["1 Телефон_Получатель_ОБЯЗАТЕЛЬНО"])}),b.on("focus",".jsOrderV3EmailField",function(){b.trigger("trackUserAction",["2 Email_Получатель"])}),b.on("focus",".jsOrderV3NameField",function(){b.trigger("trackUserAction",["3 Имя_Получатель_ОБЯЗАТЕЛЬНО"])}),b.on("focus",".jsOrderV3BonusCardField",function(){b.trigger("trackUserAction",["4 Начислить_баллы_Получатель"])}),b.on("click",".jsOrderV3AuthLink",function(){b.trigger("trackUserAction",["5 Войти_с_паролем_Получатель"])})}(jQuery),function(a){var b=a(document.body),c=a(".orderCnt"),d=c.find("#OrderV3ErrorBlock"),e=a(".jsOrderV3PageNew"),f=a(".jsOrderV3PageDelivery"),g=a(".jsOrderValidationErrors"),h="textfield-err",i=function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},j=function(a){var b,c,d,e,f,g,h,i,j="0123456789";for(i=a.toString().replace(/\s+/g,""),b=0;b<i.length;b++)if(c=i.charAt(b),-1==j.indexOf(c))return!1;if(8==i.length)i="00000"+i;else if(13!=i.length)return!1;return d=i.substring(i.length-1),i=i.substring(0,i.length-1),e=Number(i.charAt(1))+Number(i.charAt(3))+Number(i.charAt(5))+Number(i.charAt(7))+Number(i.charAt(9))+Number(i.charAt(11)),e*=3,f=Number(i.charAt(0))+Number(i.charAt(2))+Number(i.charAt(4))+Number(i.charAt(6))+Number(i.charAt(8))+Number(i.charAt(10)),g=e+f,h=g%10,0!=h&&(h=10-h),h==d},k=function(b){var e="";d||c.prepend(a("<div />",{id:"OrderV3ErrorBlock"})),a.each(b,function(a,c){e+=c,a!=b-1&&(e+="<br/>")}),d.html(e).show()};g.length,e.find("form").on("submit",function(c){var d=[],e=a("[name=user_info\\[phone\\]]"),f=a("[name=user_info\\[email\\]]"),g=a("[name=user_info\\[first_name\\]]"),l=a("[name=user_info\\[bonus_card_number\\]]"),m=e.val().replace(/\s+/g,"");/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(m)||(d.push("Неверный формат телефона"),e.addClass(h)),0==f.val().length||i(f.val())||(d.push("Неверный формат E-mail"),f.addClass(h)),0==g.val().length&&(d.push("Поле имени не может быть пустым"),g.addClass(h)),0==l.val().length||j(l.val())||(d.push("Неверный код карты лояльности"),l.addClass(h)),0!=d.length&&(k(d),c.preventDefault(),b.trigger("trackUserAction",["6_2 Далее_ошибка_Получатель","Поле ошибки: "+d.join(", ")]))}),f.on("submit","form",function(e){var f=[];a(".jsAcceptAgreement").is(":checked")||f.push("Необходимо согласие с информацией о продавце и его офертой"),-1!=a(".orderCol_delivrLst_i-act").text().indexOf("Доставка")&&(ENTER.OrderV3.address&&ENTER.OrderV3.address.building.name||f.push("Укажите адрес доставки")),a(".orderCol_addrs_tx").each(function(b,c){0==a(c).text().replace(/\s+/,"").length&&f.push("Укажите адрес самовывоза")}),0!=f.length?(d=c.find("#OrderV3ErrorBlock"),k(f),e.preventDefault(),b.trigger("trackUserAction",["15_2 Оформить_ошибка_Доставка","Поле ошибки: "+f.join(", ")])):b.trigger("trackUserAction",["15_1 Оформить_успешно_Доставка_ОБЯЗАТЕЛЬНО"])})}(jQuery);