!function(a){a.ENTER.OrderV3={info:{},constructors:{},map:{},mapOptions:{},$map:{},kladrCityId:0}}(window),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width;if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),function(a){var b=a(document.body),c=window._gaq,d=(a(".jsRegion").data("value"),a(".jsOrderSaleAnalytics").data("value")),e=a(".jsOrderDeliveryAnalytics").data("value"),f=function(a,b,d,e){var f=d||"",g=b||"";a&&a.data&&(a.data.step&&(g=a.data.step),a.data.action&&(f=a.data.action)),"undefined"==typeof ga&&(ga=window[window.GoogleAnalyticsObject]),"object"==typeof c&&c.push(["_trackEvent","Воронка_новая_v2",g,f]),"function"==typeof ga&&ga("send","event","Воронка_новая_v2",g,f),"function"!=typeof ga,"function"==typeof ga&&"function"==typeof ga.getAll&&0==ga.getAll().length};b.on("trackUserAction.orderV3Tracking",f),d&&a.each(d,function(b,c){"object"==typeof c&&a("body").trigger("trackGoogleEvent",c)}),e&&a.each(e,function(b,c){"object"==typeof c&&a("body").trigger("trackGoogleEvent",c)})}(jQuery),function(a){function b(){}var c=a("#js-order-content");c.on("click",".orderCol_data-count",function(b){var c=a(this);b.stopPropagation(),c.hide().siblings(".orderCol_data-summ, .orderCol_data-price").hide(),c.siblings(".orderCol_data-edit").show()}),c.on("click",".bCountSection__eP, .bCountSection__eM",function(b){var c=a(this),d=c.siblings("input"),e=parseInt(d.data("stock"),10),f=parseInt(d.val(),10);c.hasClass("bCountSection__eP")&&e>f&&d.val(f+1),c.hasClass("bCountSection__eM")&&f>1&&d.val(f-1),b.preventDefault(),b.stopPropagation()}),c.on("change",".bCountSection__eNum",function(a){a.stopPropagation()}),window.ENTER.OrderV3.constructors.counter=b}(jQuery),function(a,b,c){function d(){var a=this,d="Улица";return a.streetShortToLong={"пр-кт":"Проспект","ш":"Шоссе","ул.":"Улица","ул":"Улица","пер":"Переулок","пл":"Площадь","дор":"Дорога"},a.cityName=b.observable(""),a.cityId=b.observable(0),a.streetName=b.observable(""),a.streetType=b.observable(d),a.streetTypeShort=b.observable(""),a.streetId=b.observable(0),a.buildingName=b.observable(""),a.buildingId=b.observable(0),a.apartmentName=b.observable(""),a.inputFocus=b.observable(!0),a.inputPrefix=b.computed(function(){return""==a.streetName()?"Улица:":""==a.buildingName()?"дом:":"квартира:"}),a.getParent=function(){var b=!1;return 0!=a.cityId()&&"Улица:"==a.inputPrefix()?b={type:c.kladr.type.street,parentType:"city",parentId:a.cityId()}:0!=a.streetId()&&"дом:"==a.inputPrefix()&&(b={type:c.kladr.type.building,parentType:"street",parentId:a.streetId()}),b},a.update=function(b){"string"==typeof b?""==a.streetName()?(a.streetName(b),a.streetTypeShort("")):""==a.buildingName()?a.buildingName(b):""==a.apartmentName()&&a.apartmentName(b):"object"==typeof b&&("street"==b.contentType?a.streetName(b.name).streetId(b.id).streetType(b.type).streetTypeShort(b.typeShort):"building"==b.contentType&&a.buildingName(b.name).buildingId(b.id))},a.clearCity=function(){return a.cityName("").cityId(0),a},a.clearStreet=function(){return a.streetName("").streetType(d).streetId(0),a},a.clearBuilding=function(){return a.buildingName("").buildingId(0),a},a.clearApartment=function(){return a.apartmentName(""),a},a}function e(a){""!=a.streetName()&&c.ajax({type:"POST",data:{action:"changeAddress",params:{street:a.streetName()+" "+(""==a.streetTypeShort()?a.streetType():a.streetTypeShort()),building:a.buildingName(),apartment:a.apartmentName(),kladr_id:0!=a.buildingId()?a.buildingId():0!=a.streetId()?a.streetId():0!=a.cityId()?a.cityId():""}}}).fail(function(a){var b=c.parseJSON(a.responseText);b.result}).done(function(a){})}function f(a,b){if(h.getParent()!==!1){var d=c.extend({},{limit:10,name:a.term},h.getParent());c.kladr.api(d,function(a){b(c.map(a,function(a){return{label:g(a),value:a}}))})}}function g(a){var b=a.name,d=a.typeShort,e="";return-1!=c.inArray(d,["ул","пер","пл","дор"])&&(e="."),"street"===a.contentType?b+" "+d+e:b}var h,i=c("#jsUserAddress").data("value"),j=c("#kladr-config").data("value"),k=c("#page-config").data("value").user.region;if(ENTER.OrderV3.constructors.smartAddressInit=function(){var a=c(".jsSmartAddressInput"),b=c.extend(j,{limit:1,type:c.kladr.type.city,name:k.name});a.autocomplete({source:f,minLength:1,open:function(a,b){c(".ui-autocomplete").css({position:"absolute",top:29,left:0})},select:function(b,c){return this.value="",a.val(""),h.update(c.item.value),!1},focus:function(a,b){this.value=b.item.label,a.preventDefault(),a.stopPropagation()},change:function(a,b){},messages:{noResults:"",results:function(){}}}),a.on({keypress:function(b){13==b.which&&c(this).val().length>0&&(h.update(c(this).val()),a.val(""),a.autocomplete("close"))},keydown:function(b){var d=b.keyCode||b.charCode;8===d&&0===c(this).val().length&&("дом:"==h.inputPrefix()&&(a.val(h.streetName()),h.clearBuilding().clearStreet()),"квартира:"==h.inputPrefix()&&(a.val(h.buildingName()),h.clearApartment().clearBuilding()),b.preventDefault())},blur:function(){h.update(c(this).val()),a.val(""),e(h)}}),c(".jsSmartAddressEditField").on("click",function(){var b=c(this).data("type");b&&"function"==typeof h[b]&&(a.val(h[b]()),"apartmentName"==b&&h.clearApartment(),"buildingName"==b&&h.clearBuilding().clearApartment(),"streetName"==b&&(h.clearStreet().clearBuilding().clearApartment(),""!=h.streetTypeShort()&&a.val(a.val()+" "+h.streetTypeShort())))}),k.kladrId?h.cityId(k.kladrId):j&&k.name&&c.kladr.api(b,function(a){var b=a.length>0?a[0].id:0;0==b||h.cityId(a[0].id)})},h=new d,"object"==typeof i){if(i.street){var l=i.street.match(/(.+)\s+(.+)$/);l&&(h.streetShortToLong.hasOwnProperty(l[2])?(h.streetType(h.streetShortToLong[l[2]]),h.streetTypeShort(l[2])):h.streetType(l[2]),h.streetName(l[1]))}i.building&&h.buildingName(i.building),i.apartment&&h.apartmentName(i.apartment)}c.each(c(".jsAddressRootNode"),function(a,c){b.applyBindings(h,c)}),ENTER.OrderV3.address=h,ENTER.OrderV3.constructors.smartAddressInit()}(window,ko,jQuery),function(a){var b=ENTER.OrderV3,c=a("#yandex-map-container"),d=function(){var d=c.data("options");b.map=new ymaps.Map("yandex-map-container",{center:[d.latitude,d.longitude],zoom:d.zoom,controls:["zoomControl","fullscreenControl","geolocationControl","typeSelector"]},{autoFitToViewport:"always",suppressMapOpenBlock:!0}),b.map.controls.remove("searchControl"),b.mapOptions=d,b.$map=c,b.koModels=[],b.map.events.add("boundschange",function(c){var d;c.get("newBounds")&&(d=c.get("target").getBounds(),a.each(b.koModels,function(a,b){b.latitudeMin(d[0][0]),b.latitudeMax(d[1][0]),b.longitudeMin(d[0][1]),b.longitudeMax(d[1][1])}))}),b.map.geoObjects.events.add("click",function(){$body.trigger("trackGoogleEvent",["pickup_ux","map_point","клик"])}),b.map.geoObjects.events.add("hintopen",function(){$body.trigger("trackGoogleEvent",["pickup_ux","map_point","наведение"])}),$body.on("click",".js-order-map .jsChangePoint",function(){$body.trigger("trackGoogleEvent",["pickup_ux","map_point","выбор"])}),a.each(a(".jsNewPoints"),function(c,d){var e=JSON.parse(a(this).find("script.jsMapData").html()),f=new ENTER.DeliveryPoints(e.points,b.map);b.koModels.push(f),ko.applyBindings(f,d)})};c.length&&ymaps.ready(d)}(jQuery),function(a){var b=document.getElementsByTagName("body")[0],c=a(b),d=a(".orderCnt"),e=a("#jsOrder"),f=a(".jsNewOnlineCompletePage").length>0,g="function"==typeof Spinner?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:62,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null,h=function(d,e,f,h){var i={method:d,order:e,number:f};"undefined"!=typeof h&&""!=h&&(i.action=h),a.ajax({url:"getPaymentForm",type:"POST",data:i,success:function(d){var e;""!=d.form&&(e=a(d.form),g&&g.spin(b),e.hasClass("jsPaymentFormPaypal")&&"undefined"!=typeof e.attr("action")?window.location.href=e.attr("action"):(c.append(e),e.submit()))}})},i=function(b,d,e,f){1==b&&j(d.kupivkredit),2==b&&k(d["direct-credit"]),a.ajax({type:"POST",url:"/order/update-credit",data:{number_erp:e,bank_id:f}}),1==f&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","19_1 Заявка_кредит_Оплата","Тинькофф"]),2==f&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","19_1 Заявка_кредит_Оплата","Ренесанс"]),3==f&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","19_1 Заявка_кредит_Оплата","ОТП-Банк"])},j=function(a){var b,c=function(a){},d=function(a){};$LAB.script("//www.kupivkredit.ru/widget/vkredit.js").wait(function(){b=new VkreditWidget(1,a.vars.sum,{order:a.vars.order,sig:a.vars.sig,callbackUrl:window.location.href,onClose:c,onDecision:d}),b.openWidget()})},k=function(b){var c=[];$LAB.script("//api.direct-credit.ru/JsHttpRequest.js").script({src:"//api.direct-credit.ru/dc.js",type:"text/javascript",charset:"windows-1251"}).wait(function(){a.each(b.vars.items,function(a,b){c.push({id:b.articul,name:b.name,price:b.price,type:b.type,count:b.quantity})}),DCLoans(b.vars.partnerID,"getCredit",{products:c,order:b.vars.number,codeTT:b.vars.region},function(a){},!1)})};d.on("click",".jsPaymentMethod",function(b){var e=a(this).data("value"),f=a(this).closest(".orderLn").length>0?a(this).closest(".orderLn"):d,g=f.data("order-id"),i=f.data("order-number"),j=f.data("order-action");switch(b.preventDefault(),e){case 5:h(5,g,i,j),c.trigger("trackGoogleEvent",["Воронка_новая_v2","17_1 Оплатить_онлайн_Оплата","Онлайн-оплата"]);break;case 8:h(8,g,i,j),c.trigger("trackGoogleEvent",["Воронка_новая_v2","17_1 Оплатить_онлайн_Оплата","Psb"]);break;case 13:h(13,g,i,j),c.trigger("trackGoogleEvent",["Воронка_новая_v2","17_1 Оплатить_онлайн_Оплата","PayPal"]);break;case 14:h(14,g,i,j),c.trigger("trackUserAction",["17_1 Оплатить_онлайн_Связной_клуб_баллы"])}}),d.on("click",".jsOnlinePaymentPossible",function(){a(this).find(".jsOnlinePaymentDiscount").hide(),d.find(".jsOnlinePaymentDiscountPayNow").show(),c.trigger("trackGoogleEvent",["Воронка_новая_v2","17 Оплатить_онлайн_вход_Оплата"])}),d.on("click",".jsOnlinePaymentPossibleNoMotiv",function(){var b=a(".jsOnlinePaymentBlock");b.length&&(a(this).hide(),b.show())}),d.on("click",".jsOrderCouponInitial",function(b){a(this).hide(),a(".jsOrderCouponExpanded").show(),b.preventDefault()}),d.on("click",".jsOnlinePaymentSpan",function(b){a(this).parent().siblings(".jsOnlinePaymentList").show(),c.trigger("trackUserAction",["17 Оплатить_онлайн_вход_Оплата"]),b.stopPropagation()}),d.on("click",".jsOnlinePaymentBlock",function(b){0==a(this).find(".jsOnlinePaymentList").length?a(this).siblings(".jsOnlinePaymentList").show():a(this).find(".jsOnlinePaymentList").show(),0!=a(this).find(".jsCreditList").length&&a(this).find(".jsCreditList").show(),b.stopPropagation()}),d.on("click",".jsCreditButton",function(b){a(this).siblings(".jsCreditList").show(),b.preventDefault(),b.stopPropagation(),c.trigger("trackGoogleEvent",["Воронка_новая_v2","19 Заявка_кредит_Оплата"])}),d.on("click",".jsCreditList li",function(b){var e=a(this).data("bank-provider-id"),f=a(this).data("value"),g=a(this).parent().siblings(".credit-widget").data("value"),h=a(this).closest(".orderLn").data("order-number-erp");return"undefined"==typeof h&&(h=d.data("order-number-erp")),a(b.target).hasClass("jsCreditListOnlineMotivRules")?(c.trigger("trackGoogleEvent",["Воронка_новая_v2","19_2 Условия_кредит_Оплата"]),!0):(b.preventDefault(),b.stopPropagation(),a(this).closest("ul").hasClass("jsCreditListOnlineMotiv")||a(this).parent().hide(),void i(e,g,h,f))}),c.on("click",function(){"/order/complete"==window.location.pathname&&a(".popupFl").hide()}),/order\/complete/.test(window.location.href)&&(f?(a(".jsGAOnlinePaymentNotPossible").length>0&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","16 Вход_Оплата_ОБЯЗАТЕЛЬНО","нет онлайн оплаты"]),a(".jsOnlinePaymentPossibleNoMotiv").length>0&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","16 Вход_Оплата_ОБЯЗАТЕЛЬНО","нет мотиватора"]),a(".jsOnlinePaymentBlockVisible").length>0&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","17 Оплатить_онлайн_вход_Оплата"]),a(".jsCreditBlock").length>0&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","19 Заявка_кредит_Оплата"]),c.on("click",".jsCompleteOrderShowShop",function(){c.trigger("trackGoogleEvent",["Воронка_новая_v2","16_1 Как_добраться"])})):c.trigger("trackUserAction",["16 Вход_Оплата_ОБЯЗАТЕЛЬНО"]),a(".jsOrderPaid").length>0&&c.trigger("trackGoogleEvent",["Воронка_новая_v2","18 Успешная_Оплата"]),docCookies.hasItem("enter_mnogo_ru")&&docCookies.setItem("enter_mnogo_ru","",1,"/"),docCookies.hasItem("enter_panda_pay")&&docCookies.setItem("enter_panda_pay","",1,"/")),0!=e.length&&(ENTER.utils.sendOrderToGA(e.data("value")),ENTER.utils.analytics.reviews.clean(),ENTER.utils.analytics.productPageSenders.clean(),ENTER.utils.analytics.productPageSenders2.clean()),a(function(){var b=a(".js-orderV3New-complete-subscribe").data("value");b&&b.subscribe&&b.email&&c.trigger("trackGoogleEvent",{category:"subscription",action:"subscribe_order_confirmation"})}),a(".js-payment-popup-show").on("click",function(){a(this).parent().find(".js-payment-popup").show(),a("body").append('<div class="payments-popup__overlay js-payment-popup-overlay"></div>')}),a(".js-payment-popup-closer").on("click",function(){a(this).parent().hide(),a(".js-payment-popup-overlay").remove()}),c.on("click",".js-payment-popup-overlay",function(){a(".js-payment-popup").hide(),a(this).remove()})}(jQuery),function(a){ENTER.OrderV3=ENTER.OrderV3||{};try{}catch(b){}var c=document.getElementsByTagName("body")[0],d=a(c),e=a("#js-order-content"),f=a(".js-order-ctrl__input"),g="",h="function"==typeof Spinner?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:"#666",speed:1,trail:62,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"50%",left:"50%"}):null,i=function(a,b){v("changeDelivery",{block_name:a,delivery_method_token:b})},j=function(a,b){v("changeDate",{block_name:a,date:b})},k=function(a,b,c){v("changePoint",{block_name:a,id:b,token:c})},l=function(a,b){v("changeInterval",{block_name:a,interval:b})},m=function(a,b,c,d){v("changeProductQuantity",{block_name:a,id:b,ui:c,quantity:d})},n=function(a,b,c){var d={block_name:a};d[b]=c,v("changePaymentMethod",d)},o=function(a){v("changeOrderComment",{comment:a})},p=function(b,c){var d=a("[data-block_name="+b+"]").find(".jsCertificatePinInput").val();""!=d?t(b,c,d):s(b,c)},q=function(a,b){v("deleteDiscount",{block_name:a,number:b})},r=function(b,c){var d="cuponErr",e=a("<div />",{"class":"jsPandaPayMessage"});b.attr("disabled",!0).css("opacity","0.5"),a("."+d).remove(),a.ajax({url:"http://pandapay.ru/api/promocode/check",data:{format:"jsonp",code:c},dataType:"jsonp",jsonp:"callback",success:function(a){a.error?e.addClass(d).text(a.message).insertBefore(b.parent()):a.success&&(e.addClass(d).css("color","green").text("Промокод принят").insertBefore(b.parent()),docCookies.setItem("enter_panda_pay",c,3600,"/"),b.remove())}}).always(function(){b.attr("disabled",!1).css("opacity","1")})},s=function(b,c){a.ajax({type:"POST",url:"/certificate-check",data:{code:c,pin:"0000"}}).done(function(d){742==d.error_code?a("[data-block_name="+b+"]").find(".cuponPin").show():743==d.error_code&&v("applyDiscount",{block_name:b,number:c})}).always(function(a){})},t=function(a,b,c){v("applyCertificate",{block_name:a,code:b,pin:c})},u=function(a){v("deleteCertificate",{block_name:a})},v=function(b,d){var f=!0;-1!==a.inArray(b,["changeDate","changeInterval","changeOrderComment"])&&(f=!1),a.ajax({type:"POST",data:{action:b,params:d},beforeSend:function(){f&&e.fadeOut(500),h&&h.spin(c)}}).fail(function(b){var c=a.parseJSON(b.responseText);c.result,c.result.redirect&&(window.location.href=c.result.redirect)}).done(function(b){a(".jsNewPoints").remove(),e.empty().html(b.result.page),e.find(".jsAddressRootNode").length>0&&(a.each(e.find(".jsAddressRootNode"),function(a,b){ko.applyBindings(ENTER.OrderV3.address,b)}),"function"==typeof ENTER.OrderV3.constructors.smartAddressInit&&ENTER.OrderV3.constructors.smartAddressInit()),ENTER.OrderV3.koModels=[],a.each(e.find(".jsNewPoints"),function(b,c){var d=a.parseJSON(a(this).find("script.jsMapData").html()),e=new ENTER.DeliveryPoints(d.points,ENTER.OrderV3.map);ENTER.OrderV3.koModels.push(e),ko.applyBindings(e,c)}),e.find(".jsMinOrderSumPopup").lightbox_me({closeClick:!1,closeEsc:!1,centered:!0})}).always(function(){e.stop(!0,!0).fadeIn(200),h&&h.stop(),A()})},w=function(b){var c=b.find(".js-order-map").first(),d=b.parent(),e=a.parseJSON(c.next().html()),f=ENTER.OrderV3.mapOptions,g=ENTER.OrderV3.map;e&&"function"==typeof g.getType&&(b.lightbox_me({centered:!0,closeSelector:".jsCloseFl",onClose:function(){d.append(b)}}),b.is(":visible")||b.show(),g.geoObjects.removeAll(),g.setCenter([f.latitude,f.longitude],f.zoom),c.append(ENTER.OrderV3.$map.show()),g.container.fitToViewport(),a.each(e.points,function(a,b){try{g.geoObjects.add(new ENTER.Placemark(b,!0))}catch(c){}}),1===g.geoObjects.getLength()?(g.setCenter(g.geoObjects.get(0).geometry.getCoordinates(),15),g.geoObjects.get(0).options.set("visible",!0)):g.setBounds(g.geoObjects.getBounds()))},x=function(){a(".js-order-oferta-popup").lightbox_me()},y=function(b){var c=a(b),d=a(".js-tab-oferta-content"),e=a(b).attr("data-tab");a(".js-oferta-tab").removeClass("orderOferta_tabs_i-cur"),d.removeClass("orderOferta_tabcnt-cur"),c.addClass("orderOferta_tabs_i-cur"),a("#"+e).addClass("orderOferta_tabcnt-cur")},z=function(){var b=a(this),c=b.parent().find(".js-order-ctrl__lbl");""!==b.val()?c.show():c.hide()},A=function(){var b=a(".js-order-ctrl__input");a.map(b,function(b,c){"undefined"!=typeof a(b).data("mask")&&a(b).mask(a(b).data("mask"))})};e.on("click",".jsCloseFl",function(b){b.stopPropagation(),a(this).closest(".popupFl").hide(),b.preventDefault()}),e.on("click",".jsAddressRootNode",function(){ENTER.OrderV3.address.inputFocus(!0),a(this).find(".jsSmartAddressInput").focus()}),e.on("blur",".jsSmartAddressInput",function(){ENTER.OrderV3.address.inputFocus(!1)}),e.on("click",".orderCol_date, .js-order-changePlace-link",function(b){var c=a(this).data("content");b.stopPropagation(),a(".popupFl").hide(),a(this).hasClass("js-order-changePlace-link")?(w(a(this).closest(".jsOrderRow").find(".jsNewPoints")),d.trigger("trackUserAction",["10 Место_самовывоза_Доставка_ОБЯЗАТЕЛЬНО"])):(a(c).show(),d.trigger("trackUserAction",["11 Срок_доставки_Доставка"])),b.preventDefault()}),d.on("click",".selShop_tab:not(.selShop_tab-act)",function(){var b=a(this).data("token");a(".selShop_l").hide(),a(".selShop_l[data-token="+b+"]").show(),a(".selShop_tab").removeClass("selShop_tab-act"),a(".selShop_tab[data-token="+b+"]").addClass("selShop_tab-act")}),e.on("click",".jsShowDiscountForm",function(b){b.stopPropagation(),a(this).hide().parent().next().show()}),e.on("click",".orderCol_delivrLst li",function(){var b=a(this);b.hasClass("orderCol_delivrLst_i-act")||i(b.closest(".orderRow").data("block_name"),b.data("delivery_method_token"))}),e.on("click",".jsDeliveryChange:not(.active)",function(){var b=a(this);i(b.closest(".jsOrderRow").data("block_name"),b.data("delivery_method_token"))}),e.on("click",".celedr_col",function(){var b=a(this).data("value");"number"==typeof b&&(d.trigger("trackUserAction",["11_1 Срок_Изменил_дату_Доставка"]),j(a(this).closest(".orderRow").data("block_name"),b))}),d.on("click",".jsChangePoint",function(){var b=a(this).data("blockname"),c=a(this).data("id"),e=a(this).data("token");c&&e&&(d.trigger("trackUserAction",["10_1 Ввод_данных_Самовывоза_Доставка_ОБЯЗАТЕЛЬНО"]),d.children(".selShop, .lb_overlay").remove(),k(b,c,e))}),d.on("click",".jsOrderV3Dropbox",function(){a(this).siblings().removeClass("opn").find(".jsOrderV3DropboxInner").hide(),a(this).find(".jsOrderV3DropboxInner").toggle(),a(this).hasClass("opn")?a(this).removeClass("opn"):a(this).addClass("opn")}),e.on("click",".jsShowDeliveryIntervals",function(){a(this).find(".customSel_lst").show()}),e.on("click",".customSel_lst li",function(){l(a(this).closest(".orderRow").data("block_name"),a(this).data("value"))}),e.on("click",".jsChangeProductQuantity",function(b){var c=a(this),d=c.parent().find("input").val();m(c.data("block_name"),c.data("id"),c.data("ui"),d),b.preventDefault()}),e.on("click",".jsDeleteProduct",function(b){var c=a(this);m(c.data("block_name"),c.data("id"),c.data("ui"),0),b.preventDefault()}),e.on("change",".jsCreditCardPayment",function(){var b=a(this),c=b.closest(".orderRow").data("block_name");b.is(":checked")&&d.trigger("trackUserAction",["13_1 Оплата_банковской_картой_Доставка"]),n(c,"by_credit_card",b.is(":checked"))}),e.on("change",".jsCreditPayment",function(){var b=a(this),c=b.closest(".orderRow").data("block_name");b.is(":checked")&&d.trigger("trackUserAction",["13_2 Оплата_в_кредит_Доставка"]),n(c,"by_online_credit",a(this).is(":checked"))}),e.on("blur focus",".orderComment_fld",function(){g!=a(this).val()&&(g=a(this).val(),o(a(this).val()))}),e.on("click",".jsOrderV3Comment",function(){a(".orderComment_fld").toggle()}),e.on("click",".jsApplyDiscount",function(b){var c=a(this),d=c.closest(".orderRow"),e=d.data("block_name"),f=c.parent().siblings("input").val().trim();/SN.{10}/.test(f)&&0==d.find(".jsOrderV3Discount").length?r(c,f):""!=f&&p(e,f),b.preventDefault()}),e.on("click",".jsApplyDiscount-1509",function(b){var c=a(this),d=c.data("relation"),e=c.data("value")||{};e.number=a(d.number).val().trim(),/SN.{10}/.test(e.number)&&0==$orderBlock.find(".jsOrderV3Discount").length?r(c,e.number):""!=e.number&&p(e[["block_name"]],e.number),b.preventDefault()}),e.on("click",".jsDeleteDiscount",function(b){var c=a(this),d=c.closest(".orderRow").data("block_name"),e=c.data("value");q(d,e),b.preventDefault()}),e.on("click",".jsDeleteCertificate",function(){var b=a(this).closest(".orderRow").data("block_name");u(b)}),e.on("click",".jsAcceptTerms",function(){a(".jsAcceptAgreement").is(":checked")||d.trigger("trackUserAction",["14 Согласен_оферта_Доставка_ОБЯЗАТЕЛЬНО"])}),d.on("click",".js-order-oferta-popup-btn",function(b){var c=a(this).data("value");b.preventDefault(),""!=c&&("www.enter.ru"!=window.location.host&&(c=c.replace(/^.*enter.ru/,"")),a.ajax({url:ENTER.utils.setURLParam("ajax",1,c),success:function(b){a(".orderOferta_tl:first").html(b.content||""),x()}}))}),d.on("click",".js-oferta-tab",function(){y(this)}),a(".jsMinOrderSumPopup").lightbox_me({closeClick:!1,closeEsc:!1,centered:!0}),d.on("click",".jsPaymentMethodRadio",function(){var b=a(this),c=b.closest(".orderRow").data("block_name"),e=b.val();"by_online_credit"==e&&(d.trigger("trackGoogleEvent",["Воронка_новая_v2","13_3 Способы_оплаты_Доставка","Кредит"]),d.trigger("trackGoogleEvent",["Credit","Выбор опции","Оформление заказа"])),"by_online"==e&&d.trigger("trackGoogleEvent",["Воронка_новая_v2","13_3 Способы_оплаты_Доставка","Онлайн-оплата"]),n(c,e,"true")}),d.on("change",".jsPaymentMethodSelect",function(b){var c=a(this),e=c.closest(".orderRow").data("block_name"),f=c.find(":selected").val();n(e,f,"true"),"by_credit_card"==f&&d.trigger("trackGoogleEvent",["Воронка_новая_v2","13_3 Способы_оплаты_Доставка","Картой_курьеру"]),b.preventDefault()}),/order\/delivery/.test(window.location.href)&&(d.trigger("trackUserAction",["6_1 Далее_успешно_Получатель_ОБЯЗАТЕЛЬНО"]),d.trigger("trackUserAction",["7 Вход_Доставка_ОБЯЗАТЕЛЬНО","Количество заказов: "+a(".orderRow").length])),d.on("click","a.jsChangeRegionAnalytics",function(b){var c=a(this).text(),e=a(".jsRegion").data("value"),f=a(this).attr("href");b.preventDefault(),d.trigger("trackGoogleEvent",[{eventCategory:"Воронка_"+e,eventAction:"8 Регион_Доставка",eventLabel:"Было: "+e+", Стало: "+c,hitCallback:f}])}),d.on("change",".jsDeliveryMapFilters input",function(){var b=a(this).data("type"),c=a(this).next().find("span").text();d.trigger("trackGoogleEvent",["pickup_ux","filter",b+"_"+c])}),d.on("click",".jsMapDeliveryList .jsChangePoint",function(){d.trigger("trackGoogleEvent",["pickup_ux","list_point","выбор"])}),a.each(f,z),d.on("keyup",".js-order-ctrl__input",z),d.on("click",".js-show-edit",function(){a(this).hide(),a(this).parent().find(".js-edit").show()}),d.on("click",".js-edit-quant",function(){var b=a(this),c=b.parent().find(".js-quant"),d=c.data("min"),e=b.data("delta"),f=parseInt(c.val())+parseInt(e);f>=d&&c.val(f)}),d.on("click",".js-del-popup-show",function(){var b=a(this);b.parent().find(".js-del-popup").show(),d.append("<div class='order-popup__overlay js-order-overlay'></div>")}),d.on("click",".js-del-popup-close",function(){var b=a(this);b.closest(".js-del-popup").hide(),a(".js-order-overlay").remove()}),d.on("click",".js-order-err-close",function(){a(this).closest(".order-error").hide()}),d.on("click",".js-order-overlay",function(){d.find(".js-del-popup").hide(),a(this).remove()}),d.on("focus",".js-order-deliveryAddress",function(){function b(b,d){if(c()!==!1){var e=a.extend({},{limit:10,name:b.term},c());a.kladr.api(e,function(b){d(a.map(b,function(a){return{label:"street"==f?a.name+" "+a.typeShort+".":a.name,value:a}}))})}}function c(){var b=!1;return"street"==f&&h?b={type:a.kladr.type.street,parentType:"city",parentId:h}:"building"==f&&h&&(b={type:a.kladr.type.building,parentType:"street",parentId:h}),b}function d(){a.ajax({type:"POST",data:{action:"changeAddress",params:{street:j.eq(0).val(),building:j.eq(1).val(),apartment:j.eq(2).val(),kladr_id:i.data("last-kladr-id")}}}).fail(function(b){var c=a.parseJSON(b.responseText);c.result}).done(function(a){})}var e=a(this),f=e.data("field"),g=e.data("relation"),h=e.data("parent-kladr-id"),i=a(g.container),j=i.find("input.js-order-deliveryAddress");e.autocomplete({source:b,minLength:1,open:function(a,b){},select:function(a,b){return e.val(b.item.label),j.eq(1).data("parent-kladr-id",b.item.value.id),i.data("last-kladr-id",b.item.value.id),d(),!1},focus:function(a,b){this.value=b.item.label,a.preventDefault(),a.stopPropagation()},change:function(a,b){},messages:{noResults:"",results:function(){}}}),j.eq(2).off().on("keyup",d)}),a("#auth-block").attr("data-state","register").addClass("state_register"),d.on("click",'[form="js-orderForm"]',function(b){var c=a(this),d=c.attr("form")&&a("#"+c.attr("form")),e={errors:[]};try{d.length&&(d.trigger("form.reset"),d.find("[required]").each(function(b,c){var d=a(c);d.is(":checkbox")?!d.is(":checked")&&e.errors.push({message:"",field:d.data("field")}):d.is("input")&&!d.val()&&e.errors.push({message:"",field:d.data("field")})}),e.errors.length?d.trigger("form.result",[e]):d.submit(),b.preventDefault())}catch(f){}}),delete a.mask.definitions[9],a.mask.definitions.x="[0-9]",a.mask.placeholder="_",a.mask.autoclear=!1,A(),d.on("input",".js-quant",function(){var b=a(this);b.val(b.val().replace(/[^0-9]+/g,""))})}(jQuery),function(a){var b=a(document.body),c=a(".orderCnt"),d=c.find("input"),e=[];delete a.mask.definitions[9],a.mask.definitions.x="[0-9]",a.mask.placeholder="_",a.mask.autoclear=!1,a.map(d,function(b,c){"undefined"!=typeof a(b).data("mask")&&a(b).mask(a(b).data("mask"))}),c.on("click",".bonusCnt_i",function(b){b.stopPropagation();var c=a(this),d=c.data("eq"),e=a(".bonusCnt_it");c.hasClass("bonusCnt_i-act")||(a(".bonusCnt_i").removeClass("bonusCnt_i-act"),c.addClass("bonusCnt_i-act"),e.hide().eq(d).show(),c.find(".bonusCnt_tx_code .brb-dt").hide())}),b.on("mouseenter",".jsShowBonusCardHint",function(){a(this).parent().siblings(".bonusCnt_popup").show()}),b.on("mouseleave",".jsShowBonusCardHint",function(){a(this).parent().siblings(".bonusCnt_popup").hide()}),a(".jsOrderV3BonusCardField").each(function(b,c){a(c).closest(".bonusCnt-v2").find(".bonusCnt_tx_code .brb-dt").eq(b).text(a(c).val())}),b.on("focus",".jsOrderV3PhoneField",function(){-1==a.inArray(this,e)&&(b.trigger("trackUserAction",["1 Телефон_Получатель_ОБЯЗАТЕЛЬНО"]),e.push(this))}),b.on("focus",".jsOrderV3EmailField",function(){-1==a.inArray(this,e)&&(b.trigger("trackUserAction",["2 Email_Получатель"]),e.push(this))}),b.on("focus",".jsOrderV3NameField",function(){-1==a.inArray(this,e)&&(b.trigger("trackUserAction",["3 Имя_Получатель_ОБЯЗАТЕЛЬНО"]),e.push(this))}),b.on("focus",".jsOrderV3BonusCardField",function(){
b.trigger("trackUserAction",["4 Начислить_баллы_Получатель"])}),b.on("click",".jsOrderV3AuthLink",function(){b.trigger("trackUserAction",["5 Войти_с_паролем_Получатель"])}),/orde(r|rs)\/new/.test(window.location.href)&&b.trigger("trackUserAction",["1 Вход_Получатель_ОБЯЗАТЕЛЬНО"]),a(".jsOrderV3SubscribeCheckbox").is(":checked")&&docCookies.setItem("enter_wanna_subscribe",!0,0,"/"),b.on("change",".jsOrderV3SubscribeCheckbox",function(){docCookies.setItem("enter_wanna_subscribe",a(this).is(":checked"),0,"/")}),a(".jsOrderV3PhoneField").focus()}(jQuery),function(a){var b=a(document.body),c=a(".orderCnt"),d=c.find("#OrderV3ErrorBlock"),e=a(".jsOrderV3PageNew"),f=a(".jsOrderV3PageDelivery"),g=a(".jsOrderValidationErrors"),h="textfield-err",i=!1,j=docCookies.getItem("enter_mnogo_ru"),k=function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)&&!/[а-яА-Я]/.test(a)},l=function(a){return 0==a.length||/\d{4}\s\d{4}/.test(a)},m=function(){var b=[],c=a("[name=user_info\\[phone\\]]"),d=a("[name=user_info\\[email\\]]"),e=a("[name=user_info\\[bonus_card_number\\]]"),f=a(".jsOrderV3MnogoRuCardField"),g=a(".jsOrderV3SubscribeCheckbox"),i=c.val().replace(/\s+/g,"");if(/\+7\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(i)){c.removeClass("textfield-err").siblings(".errTx").hide();try{c.data("event")&&(a.post("/event/push",{name:"pushOrderStep",data:{step:1,user:{phone:c.val()}}}),c.data("event",!1))}catch(b){}}else b.push("Неверный формат телефона"),c.addClass("textfield-err").siblings(".errTx").show();return(g.is(":checked")||d.hasClass("jsOrderV3EmailRequired"))&&0==d.val().length?(b.push("Не указан email"),d.addClass("textfield-err").siblings(".errTx").text("Не указан email").show()):0==d.val().length||k(d.val())?d.removeClass("textfield-err").siblings(".errTx").hide():(b.push("Неверный формат E-mail"),d.addClass("textfield-err").siblings(".errTx").text("Неверный формат email").show()),e.length>0&&e.mask(e.data("mask")),f.length>0&&f.mask(f.data("mask")),e.length>0&&0!=e.val().length&&!ENTER.utils.checkEan(e.val())?(b.push("Неверный код карты лояльности"),e.addClass(h).siblings(".errTx").show()):e.removeClass("textfield-err").siblings(".errTx").hide(),f.length>0&&!l(f.val())?(b.push("Неверный код карты Много.ру"),f.addClass(h).siblings(".errTx").show()):f.removeClass("textfield-err").siblings(".errTx").hide(),b};g.length,e.on("blur","input",function(){i||m()}),e.find("form").on("submit",function(c){var d=m(),e=a(".jsOrderV3MnogoRuCardField");0!=d.length?(c.preventDefault(),b.trigger("trackUserAction",["6_2 Далее_ошибка_Получатель","Поле ошибки: "+d.join(", ")])):e&&docCookies.setItem("enter_mnogo_ru",e.val(),31536e3,"/")}),e.on("mousedown keydown",".jsOrderV3SubscribeLabel, .jsOrderV3SubscribeCheckbox",function(){i=!0,e.one("mouseup keyup",function(){setTimeout(function(){i=!1,a("input",e).blur()},0)})}),e.on("change",".jsOrderV3SubscribeCheckbox",function(){a(this).is(":checked")||b.trigger("trackGoogleEvent",["Email_checkout","unsubscribe","email"])}),e.on("blur",".jsOrderV3EmailField",function(){if(!i){var c=a(this);k(c.val())?b.trigger("trackGoogleEvent",["Email_checkout","success_validation","email"]):b.trigger("trackGoogleEvent",["Email_checkout","fail_prevalidation","email"])}}),e&&null!=j&&"undefined"!=j&&(e.find(".jsOrderV3MnogoRuCardField").val(j),e.find(".jsMnogoRuSpan").text(j)),f.on("click",".jsAcceptTerms",function(b){a(b.currentTarget).parent().removeClass("accept-err")}),f.on("click",".orderCompl_btn",function(e){var f=[],g=a(".jsAcceptAgreement"),h=a(this).closest("form"),i=!1,j=a(".jsPartnerOrder");g.is(":checked")?g.parent().removeClass("accept-err"):(f.push("Необходимо согласие с информацией о продавце и его офертой"),g.parent().addClass("accept-err")),j.each(function(){-1!=a(this).find(".orderCol_delivrLst_i-act").text().indexOf("Доставка")&&(ENTER.OrderV3.address&&ENTER.OrderV3.address.buildingName()?a(".jsSmartAddressBlock").removeClass("orderCol_delivrIn-err"):(a(".jsSmartAddressBlock").addClass("orderCol_delivrIn-err"),f.push("Укажите адрес доставки"))),a(this).find(".orderCol_addrs_tx").each(function(b,c){0==a(c).text().replace(/\s+/,"").length&&(a(this).closest(".orderCol_delivrIn-empty").addClass("orderCol_delivrIn-err"),f.push("Укажите адрес самовывоза"))})}),e.preventDefault(),0!=f.length?(d=c.find("#OrderV3ErrorBlock"),b.trigger("trackUserAction",["15_2 Оформить_ошибка_Доставка","Поле ошибки: "+f.join(", ")])):(a(".orderCol_addrs_fld").length>0&&""==ENTER.OrderV3.address.buildingName()&&(i=!0),a(".orderCol_delivrIn-empty:not(.jsSmartAddressBlock)").length>0&&(i=!0),i&&b.trigger("trackUserAction",["15_3 Оформить_успешно_КЦ"]),b.trigger("trackUserAction",["15_1 Оформить_успешно_Доставка_ОБЯЗАТЕЛЬНО"]),a(this).attr("disabled",!0),setTimeout(function(){h.submit()},1e3))})}(jQuery);