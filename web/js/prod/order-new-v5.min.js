function DeliveryBox(e,o,r,l,t){console.info("Cоздание блока доставки "+o+" для "+r);var i=this;i.OrderModel=t,i.createdBox=l,i.deliveryPoint=r,i.products=[],i.fullPrice=0,i.state=o,i.deliveryPrice=Number.POSITIVE_INFINITY,i.showMessage=null,i.choosenDate=null,i.addProductGroup(e),i.OrderModel.deliveryBoxes.push(i)}DeliveryBox.prototype._getFirstPropertyName=function(e){for(var o in e)return o},DeliveryBox.prototype.addProduct=function(e){var o=this,r=null,l=null,t=null,i=[];return e.deliveries[o.state].hasOwnProperty(o.deliveryPoint)?(r=parseInt(e.deliveries[o.state][o.deliveryPoint].price,10),o.deliveryPrice=o.deliveryPrice>r?r:o.deliveryPrice,o.fullPrice+=e.total,o.products.push({name:e.name,price:e.total,quantity:e.quantity,deleteUrl:e.deleteUrl,productUrl:e.url,productImg:e.image}),void 0):(console.warn("Для товара "+e.id+" нет пункта доставки "+o.deliveryPoint+". Необходимо создать новый блок"),t=o._getFirstPropertyName(e.deliveries[o.state]),l=o.state+"_"+t,void 0!==o.createdBox[l]?o.createdBox[l].addProduct(e):(i.push(e),o.createdBox[l]=new DeliveryBox(i,o.state,t,o.createdBox,o.OrderModel)),void 0)},DeliveryBox.prototype.addProductGroup=function(e){for(var o=e.length-1;o>=0;o--)this.addProduct(e[o])},function(){console.info("Логика разбиения заказа для оформления заказа v.5");var e="/ajax/order-delivery",o={},r=null,l=null,t={},i=function i(e){for(var r={},i=[],d=[],s=null,a=null,c=0,u=e.length;u>c;c++){console.info("перебирем метод "+e[c]),d=[],i=o.deliveryStates[e[c]].products;for(var v=i.length-1;v>=0;v--)r[i[v]]?console.log("товар "+i[v]+" уже определялся к блоку"):(console.log("добавляем товар "+i[v]+" в блок для метода "+e[c]),r[i[v]]=!0,d.push(o.products[i[v]]));d.length&&(s=o.pointsByDelivery[e[c]]?l:0,a=e[c]+"_"+s,void 0!==t[a]?t[a].addProductGroup(d):t[a]=new DeliveryBox(d,e[c],s,t,n))}console.info("Созданные блоки:"),console.log(t),r.length!==o.products.length&&console.warn("не все товары были обработаны")},n={prepareData:ko.observable(!1),deliveryTypes:ko.observableArray([]),deliveryBoxes:ko.observableArray([]),chooseDeliveryTypes:function(e){var d=e.states,s=d[0];t={},n.deliveryBoxes.removeAll(),r=e.token,o.pointsByDelivery[s]?(console.log("есть точки доставки из которых нужно выбрать"),l=13):(console.log("для выбранного метода доставки нет точек доставки"),l=0),console.log("выбранный метод доставки "+r),console.log("выбранное место доставки "+l),i(d)}};ko.applyBindings(n);var d=function d(e){console.log("Данные с сервера получены"),o=e,n.deliveryTypes(e.deliveryTypes),n.prepareData(!0)};$.ajax({type:"GET",url:e,success:d})}();