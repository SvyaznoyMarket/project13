function DeliveryBox(e,o,r,l,t){console.info("Cоздание блока доставки "+o+" для "+r);var n=this;n.OrderModel=t,n.createdBox=l,n.deliveryPoint=r,n.products=[],n.fullPrice=0,n.state=o,n.deliveryPrice=Number.POSITIVE_INFINITY,n.showMessage=null,n.choosenDate=null,n.addProductGroup(e),n.OrderModel.deliveryBoxes.push(n)}DeliveryBox.prototype._getFirstPropertyName=function(e){for(var o in e)return o},DeliveryBox.prototype.addProduct=function(e){var o=this,r=null,l=null,t=null,n=[];return e.deliveries[o.state].hasOwnProperty(o.deliveryPoint)?(r=parseInt(e.deliveries[o.state][o.deliveryPoint].price,10),o.deliveryPrice=o.deliveryPrice>r?r:o.deliveryPrice,o.fullPrice+=e.sum,o.products.push({name:e.name,price:e.sum,quantity:e.quantity,deleteUrl:e.deleteUrl,productUrl:e.url,productImg:e.image}),void 0):(console.warn("Для товара "+e.id+" нет пункта доставки "+o.deliveryPoint+". Необходимо создать новый блок"),t=o._getFirstPropertyName(e.deliveries[o.state]),l=o.state+"_"+t,void 0!==o.createdBox[l]?o.createdBox[l].addProduct(e):(n.push(e),o.createdBox[l]=new DeliveryBox(n,o.state,t,o.createdBox,o.OrderModel)),void 0)},DeliveryBox.prototype.addProductGroup=function(e){for(var o=e.length-1;o>=0;o--)this.addProduct(e[o])},function(){console.info("Логика разбиения заказа для оформления заказа v.5");var e="/ajax/order-delivery",o={},r=null,l=null,t={},n=function n(e){for(var r={},n=[],s=[],d=null,a=null,c=0,u=e.length;u>c;c++)if(console.info("перебирем метод "+e[c]),s=[],o.deliveryStates.hasOwnProperty(e[c])){n=o.deliveryStates[e[c]].products;for(var v=n.length-1;v>=0;v--)r[n[v]]?console.log("товар "+n[v]+" уже определялся к блоку"):(console.log("добавляем товар "+n[v]+" в блок для метода "+e[c]),r[n[v]]=!0,s.push(o.products[n[v]]));s.length&&(d=o.pointsByDelivery[e[c]]?l:0,a=e[c]+"_"+d,void 0!==t[a]?t[a].addProductGroup(s):t[a]=new DeliveryBox(s,e[c],d,t,i))}else console.warn("для метода "+e[c]+" нет товаров");console.info("Созданные блоки:"),console.log(t),r.length!==o.products.length&&console.warn("не все товары были обработаны")},i={prepareData:ko.observable(!1),deliveryTypes:ko.observableArray([]),deliveryBoxes:ko.observableArray([]),chooseDeliveryTypes:function(e){var s=e.states,d=s[0];t={},i.deliveryBoxes.removeAll(),r=e.token,o.pointsByDelivery[d]?(console.log("есть точки доставки из которых нужно выбрать"),l=13):(console.log("для выбранного метода доставки нет точек доставки"),l=0),console.log("выбранный метод доставки "+r),console.log("выбранное место доставки "+l),n(s)}};ko.applyBindings(i);var s=function s(e){return e.success?(console.log("Данные с сервера получены"),o=e,i.deliveryTypes(e.deliveryTypes),i.prepareData(!0),void 0):(console.warn("произошла ошибка при получении данных с сервера"),console.log(e.error),!1)};$.ajax({type:"GET",url:e,success:s})}();