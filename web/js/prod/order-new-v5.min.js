(function(e,t,r,i){var n,a,o=i.utils,s=r("#page-config").data("value"),l=r("#jsOrderForm").data("value"),c=r("#metrostations").data("name"),u=r("#jsDeliveryAddress").data("value"),d=s?s.addressAutocomplete:!1,h=null,p=null,f=6,m=r("#order_address_street"),v=r("#order_address_building"),g=r("#order_address_number"),_=r("#order_address_metro"),E=r("#order_subway_id"),y=null,b=!1,T=u?u.regionName:"",x=r("#map"),w=null,R=function(){var e,t,i,n,a=12,o="";return e=r.trim(T),t="город",e&&(o&&(o+=", "),o+=t+" "+e,a=12),e=null,t=null,i=m.kladr("current"),n=r.trim(m.val()),i?(e=i.name,t=i.type):n&&(e=n,t=""),e&&(o&&(o+=", "),o+=t+" "+e,a=14),e=null,t=null,i=v.kladr("current"),n=r.trim(v.val()),i?(e=i.name,t="дом"):n&&(e=n,t="дом"),e&&(o&&(o+=", "),o+=t+" "+e,a=16),e=null,t=null,n=r.trim(g.val()),n&&(e=n,t="корпус"),e&&(o&&(o+=", "),o+=t+" "+e,a=16),{address:o,zoom:a}},S=function(){var e,t,r,i,n=R();n.address&&b&&w!==n.address&&(console.log(n.address),w=n.address,e=ymaps.geocode(n.address),e.then(function(e){t=e.geoObjects.get(0).geometry.getCoordinates(),t&&(r=t[0],i=t[1],y.points=[],y.mapWS.geoObjects.each(function(e){y.mapWS.geoObjects.remove(e)}),y.points.push({latitude:r,longitude:i}),y._showMarkers(),y.mapWS.setCenter(t,n.zoom),_.length&&M(r,i))}))},M=function(e,t){var r,i,n;E.length&&(r=ymaps.geocode([e,t],{kind:"metro"}),r.then(function(e){if(i=e.geoObjects.get(0),n=i.properties.get("name"),n=n.replace("метро ",""),_.val(n),E.val(""),o.orderValidator&&o.orderValidator._unmarkFieldError(_),void 0!==c)for(var t=c.length-1;t>=0;t--)if(n===c[t].label){E.val(c[t].val);break}},function(e){console.warn("При выполнении запроса произошла ошибка: "+e),_.val(""),E.val(""),o.orderValidator&&o.orderValidator._markFieldError(_,"Не выбрана станция метро")}))},H=function(e){return n=r("ul.error_list"),n.length?n.html("<li>"+e+"</li>"):r("#map").before(r('<ul class="error_list" />').append("<li>"+e+"</li>")),!1},C=function(){return n=r("ul.error_list"),n.length&&n.html(""),!1},k=function(e){""===r.trim(e)&&r.kladr.api({token:v.kladr("token"),key:v.kladr("key"),type:v.kladr("type"),name:e,parentType:v.kladr("parentType"),parentId:v.kladr("parentId"),limit:1},function(e){e.length&&(C(),v.kladr("current",e[0]))})};defaultValues=function(){""!=r.trim(l["order[address_street]"])&&r.kladr.api({token:h,key:p,type:r.kladr.type.street,name:l["order[address_street]"],parentType:r.kladr.type.city,parentId:a,limit:1},function(e){e.length&&(C(),m.kladr("current",e[0]),v.kladr("parentType",r.kladr.type.street),v.kladr("parentId",e[0].id),k(l["order[address_building]"]))})},fieldsHandler={city:function(){return T?(r.kladr.api({token:h,key:p,type:r.kladr.type.city,name:T,limit:1},function(e){return e.length?(a=e[0].id,fieldsHandler.street(),fieldsHandler.building(),fieldsHandler.buildingAdd(),m.kladr("parentType",r.kladr.type.city),m.kladr("parentId",a),defaultValues(),void 0):(console.log("КЛАДР не нашел город "+T),void 0)}),void 0):null},street:function(){m.kladr({token:h,key:p,type:r.kladr.type.street,verify:!0,limit:f,source:function(e){r.kladr.api({token:m.kladr("token"),key:m.kladr("key"),type:m.kladr("type"),name:e,parentType:m.kladr("parentType"),parentId:m.kladr("parentId"),limit:m.kladr("limit")},function(e){var t,i,n=[];if(e.length&&(C(),m.kladr("current",e[0]),v.kladr("parentType",r.kladr.type.street),e[0].id!==v.kladr("parentId")&&(v.kladr("parentId",e[0].id),k(v.val())),S(),1!==e.length)){for(t in e)i=e[t],i.label=i.type+" "+i.name,i.value=i.name,n.push(i);m.autocomplete({source:n,appendTo:".jsInputStreet",minLength:2,select:function(e,t){C(),m.kladr("current",t.item),v.kladr("parentType",r.kladr.type.street),t.item.id!==v.kladr("parentId")&&(v.kladr("parentId",t.item.id),k(v.val())),S()}})}})}})},building:function(){v.kladr({token:h,key:p,type:r.kladr.type.building,verify:!0,limit:f,source:function(e){r.kladr.api({token:v.kladr("token"),key:v.kladr("key"),type:v.kladr("type"),name:e,parentType:v.kladr("parentType"),parentId:v.kladr("parentId"),limit:v.kladr("limit")},function(e){var t,r,i=[];if(e.length&&(C(),v.kladr("current",e[0]),S(),1!==e.length)){for(t in e)r=e[t],r.label=r.name,i.push(r);v.autocomplete({source:i,appendTo:".jsInputBuilding",minLength:0,select:function(e,t){C(),v.kladr("current",t.item),S()}})}})}})},buildingAdd:function(){g.change(function(){S()})}},fieldsInit=function(){fieldsHandler.city()},mapCreate=function(){var e,t,n=R();!b&&x.length&&(w=n.address,x.show().width(477).height(350),b=!0,e=ymaps.geocode(n.address),e.then(function(e){t=e.geoObjects.get(0).geometry.getCoordinates(),y=new i.constructors.CreateMap("map",[{latitude:t[0],longitude:t[1]}]),y.points=[],y.mapWS.geoObjects.each(function(e){y.mapWS.geoObjects.remove(e)}),""!==r.trim(l["order[address_street]"])&&y.points.push({latitude:t[0],longitude:t[1]}),y._showMarkers(),y.mapWS.setCenter(t,n.zoom)},function(e){console.log(e),H("Не нашли ваш город на карте."),y=new i.constructors.CreateMap("map",[{latitude:55.76,longitude:37.64}])}))},d&&(u&&u.kladr&&(h=u.kladr.token?u.kladr.token:null,p=u.kladr.key?u.kladr.key:null,f=u.kladr.itemLimit?u.kladr.itemLimit:6),fieldsInit(),r("body").bind("orderdeliverychange",function(){ymaps.ready(mapCreate)}))})(this,this.document,this.jQuery,this.ENTER),function(e,t,r,i,n){var a,o=i.constructors,s=(i.utils,i.config.pageConfig),l=s.prepayment;console.info("deliveryBox.js init"),console.log(i.OrderModel),o.DeliveryBox=function(){"use strict";function t(e,o,s){if(!(this instanceof t))return new t(e,o,s);console.info("Cоздание блока доставки "+o+" для "+s),console.log(this),a=i.OrderModel;var l=this;return l.isUnique=a.orderDictionary.isUniqueDeliveryState(o),l.token=o+"_"+s,l.products=[],l.fullPrice=0,l.totalBlockSum=0,l.state=o,l.deliveryName=a.orderDictionary.getNameOfState(o),l.deliveryPrice=Number.NEGATIVE_INFINITY,l.choosenDate=n.observable(),l.choosenNameOfWeek=n.observable(),l.choosenPoint=n.observable({id:s}),l.choosenInterval=n.observable(),l.showPopupWithPoints=n.observable(!1),l.hasPointDelivery=a.orderDictionary.hasPointDelivery(o),l.isExpensiveOrder=!1,l.hasProductWithPrepayment=!1,l.allDatesForBlock=n.observableArray([]),l.pointList=[],l.changePointButtonText=a.orderDictionary.getChangeButtonText(o),l.hasPointDelivery&&!a.orderDictionary.getPointByStateAndId(l.state,s)?(console.info("есть точки доставки для выбранного метода доставки, но выбранная точка не доступна для этого метода доставки. Берем первую точку для выбранного метода доставки"),l.choosenPoint(a.orderDictionary.getFirstPointByState(l.state))):l.hasPointDelivery?(console.info("есть точки доставки для выбранного метода доставки, и выбранная точка доступна для этого метода доставки"),l.choosenPoint(a.orderDictionary.getPointByStateAndId(l.state,s))):(console.info("для выбранного метода доставки не нужна точка доставки"),a.hasHomeDelivery(!0),r("body").trigger("orderdeliverychange",[!0])),l.calendarSliderLeft=n.observable(0),l.addProductGroup(e),0===l.products.length?(console.warn("в блоке "+l.token+" не осталось товаров"),void 0):(a.deliveryBoxes.push(l),void 0)}return t.prototype._makePointList=function(){console.info("Создание списка точек доставки");var e,t,r=this,i=!0,n=null;for(e in r.products[0].deliveries[r.state]){for(t=r.products.length-1;t>=0&&(i=r.products[t].deliveries[r.state].hasOwnProperty(e),i);t--);i&&(n=a.orderDictionary.getPointByStateAndId(r.state,e),r.pointList.push(n))}console.log("Точки доставки созданы"),console.log(r.pointList)},t.prototype.addUniqueSuffix=function(e){var t;return e=e||"",t=Math.floor(1e4*Math.random()+1),e+="_"+t},t.prototype.selectPoint=function(t){var r,n=this,o=n.state+"_"+t.id,s=null,l=[];if(a.hasDeliveryBox(o)){for(r=n.products.length-1;r>=0;r--)n.products[r].id&&l.push(n.products[r].id);n._hasProductsAlreadyAdded(l)||(s=a.getDeliveryBoxByToken(o),s.addProductGroup(n.products),a.removeDeliveryBox(n.token))}else n.isUnique&&(o+=n.addUniqueSuffix()),console.info("удаляем старый блок"),console.log("старый токен "+n.token),console.log("новый токен "+o),n.token=o,n.choosenPoint(a.orderDictionary.getPointByStateAndId(n.state,t.id)),i.OrderModel.choosenPoint(t.id),console.log(a.deliveryBoxes()),a.paypalECS()&&(console.info("PayPal ECS включен. Необходимо сохранить выбранную точку доставки в cookie"),e.docCookies.setItem("chPoint_paypalECS",t.id,600));return a.showPopupWithPoints(!1),!1},t.prototype.changePoint=function(){var e,t=this;for(e=t.pointList.length-1;e>=0;e--)t.pointList[e].parentBoxToken=t.token;return a.popupWithPoints({header:"Выберите точку доставки",points:t.pointList}),a.showPopupWithPoints(!0),!1},t.prototype._getFirstPropertyName=function(e){for(var t in e)return t},t.prototype._addProduct=function(e){var r=this,n=null,o=null,s=null,c=[],u=null,d={};if(!r._hasProductsAlreadyAdded([e.id])){if(!e.deliveries[r.state].hasOwnProperty(r.choosenPoint().id))return console.warn("Для товара "+e.id+" нет пункта доставки "+r.choosenPoint().id+" Необходимо создать новый блок"),s=r._getFirstPropertyName(e.deliveries[r.state]),o=r.state+"_"+s,c.push(e),a.hasDeliveryBox(o)?(console.log("Блок для этого типа доставки в этот пункт уже существует. Добавляем продукт в блок"),u=a.getDeliveryBoxByToken(o),u.addProductGroup(e),a.removeDeliveryBox(r.token)):(console.log("Блока для этого типа доставки в этот пункт еще существует"),new t(c,r.state,s)),void 0;n=parseInt(e.deliveries[r.state][r.choosenPoint().id].price,10),r.deliveryPrice=n>r.deliveryPrice?n:r.deliveryPrice,d={id:e.id,name:e.name,price:e.sum?e.sum:e.price,quantity:e.quantity,deleteUrl:e.deleteUrl,setUrl:e.setUrl,productUrl:e.url,productImg:e.image?e.image:e.productImg,deliveries:{},isPrepayment:e.isPrepayment},r.isUnique&&e.oldQuantity-1>0&&(console.log("Переделываем deleteUrl:"),console.log(d.deleteUrl),d.deleteUrl=d.deleteUrl.replace("delete-","add-"),d.deleteUrl+="?quantity="+(e.oldQuantity-1),console.log(d.deleteUrl)),d.isPrepayment&&(r.hasProductWithPrepayment=!0),d.deliveries[r.state]=e.deliveries[r.state],r.fullPrice=i.utils.numMethods.sumDecimal(d.price,r.fullPrice),r.products.push(d),l.enabled&&(r.isExpensiveOrder=l.priceLimit<=parseInt(r.fullPrice,10)+parseInt(r.deliveryPrice,10)?!0:!1)}},t.prototype._hasProductsAlreadyAdded=function(e){var t,i=this,n=!1;if(void 0===e||!e.length)return n;for(t=i.products.length-1;t>=0;t--)-1!==r.inArray(i.products[t].id,e)&&(n=!0);return n},t.prototype.updateTotalPrice=function(){console.info("Перерасчет общей стоимости заказа");var e=this,t=a.totalSum();e.totalBlockSum=i.utils.numMethods.sumDecimal(e.fullPrice,e.deliveryPrice),t=i.utils.numMethods.sumDecimal(e.totalBlockSum,t),a.totalSum(t),console.log(a.totalSum())},t.prototype.addProductGroup=function(e){var t,r=this;for(console.info("добавляем товары в блок"),t=e.length-1;t>=0;t--)console.log(t+"ый пошел..."),console.log(e[t]),r._addProduct(e[t]);return r.products.length?(r.calculateDate(),r.updateTotalPrice(),r.hasPointDelivery&&(console.info("У товара есть точки доставки. Создаем список точек доставки"),r._makePointList()),void 0):(console.warn("в блоке "+r.token+" нет товаров"),void 0)},t.prototype._getNameDayOfWeek=function(e){var t=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"];return t[e]},t.prototype._getFullNameDayOfWeek=function(e){var t=["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"];return t[e]},t.prototype._hasDateInAllProducts=function(e){var t,r,i,n=this,a=null,o=null,s=!0;for(r=n.products.length-1;r>=0;r--){for(a=n.products[r].deliveries[n.state][n.choosenPoint().id].dates,i=0,t=a.length;t>i;i++){if(o=a[i].value,o===e){s=!0;break}s=!1}if(!s)break}return s},t.prototype.clickCalendarDay=function(t){var r=this;return t.avalible?(a.paypalECS()&&(console.info("PayPal ECS включен. Необходимо сохранить выбранную дату в cookie"),e.docCookies.setItem("chDate_paypalECS",JSON.stringify(t),600)),r.choosenNameOfWeek(r._getFullNameDayOfWeek(t.dayOfWeek)),r.choosenDate(t),void 0):!1},t.prototype.calculateDate=function(){console.info("Вычисление общей даты для продуктов в блоке");var r,i,n=this,o=a.orderDictionary.getToday(),s=null,l=null,c="",u=null,d=[],h=null;for(console.log("Сегодняшняя дата с сервера "+o),s=n.products[0].deliveries[n.state][n.choosenPoint().id].dates,i=0,r=s.length;r>i;i++)l=s[i].value,n._hasDateInAllProducts(l)&&l>=o&&(s[i].avalible=!0,s[i].humanDayOfWeek=n._getNameDayOfWeek(s[i].dayOfWeek),n.allDatesForBlock().push(s[i]));n.allDatesForBlock().length||(console.warn("нет общих дат для блока. Необходимо разделить продукты в блоке"),u=n.products.pop(),d.push(u),c=n.state+"_"+n.choosenPoint().id+"_"+n.addUniqueSuffix(),console.log("новый токен "+c),console.log(n),new t(d,n.state,n.choosenPoint().id),n.calculateDate()),a.paypalECS()&&e.docCookies.hasItem("chDate_paypalECS")?(console.info("PayPal ECS включен. Необходимо взять выбранную дату из cookie"),h=e.docCookies.getItem("chDate_paypalECS"),n.choosenDate(JSON.parse(h))):n.choosenDate(n.allDatesForBlock()[0]),n.choosenNameOfWeek(n._getFullNameDayOfWeek(n.choosenDate().dayOfWeek)),0!==n.choosenDate().intervals.length&&n.choosenInterval(n.choosenDate().intervals[0]),n.makeCalendar()},t.prototype.makeCalendar=function(){console.info("Создание календаря, округление до целых недель");var e,t,r,i=this,n=0,a={},o=null,s=null,l=864e5;for(r=0;i.allDatesForBlock().length-1>=r;r++){if(void 0===i.allDatesForBlock()[r+1]){console.info("Следущая дата последняя. заканчиваем цикл");break}a={},o=i.allDatesForBlock()[r].value+l,s=new Date(o),o!==i.allDatesForBlock()[r+1].value&&(a={value:o,avalible:!1,humanDayOfWeek:i._getNameDayOfWeek(s.getDay()),dayOfWeek:s.getDay(),day:s.getDate()},console.log("предыдущая дата была "+new Date(i.allDatesForBlock()[r].value).getDate()+" новая дата вклинилась "+s.getDate()+" следущая дата "+new Date(i.allDatesForBlock()[r+1].value).getDate()),i.allDatesForBlock.splice(r+1,0,a))}if(1!==i.allDatesForBlock()[0].dayOfWeek)for(n=0===i.allDatesForBlock()[0].dayOfWeek?6:i.allDatesForBlock()[0].dayOfWeek-1,o=i.allDatesForBlock()[0].value,e=n;e>0;e--)o-=l,s=new Date(o),a={avalible:!1,humanDayOfWeek:i._getNameDayOfWeek(s.getDay()),dayOfWeek:s.getDay(),day:s.getDate()},i.allDatesForBlock.unshift(a);if(0!==i.allDatesForBlock()[i.allDatesForBlock().length-1].dayOfWeek)for(n=7-i.allDatesForBlock()[i.allDatesForBlock().length-1].dayOfWeek,o=i.allDatesForBlock()[i.allDatesForBlock().length-1].value,t=n;t>0;t--)o+=l,s=new Date(o),a={avalible:!1,humanDayOfWeek:i._getNameDayOfWeek(s.getDay()),dayOfWeek:s.getDay(),day:s.getDate()},i.allDatesForBlock.push(a)},t.prototype.calendarLeftBtn=function(){var e=this,t=parseInt(e.calendarSliderLeft(),10);t+=380,e.calendarSliderLeft(t)},t.prototype.calendarRightBtn=function(){var e=this,t=parseInt(e.calendarSliderLeft(),10);t-=380,e.calendarSliderLeft(t)},t}()}(this,this.document,this.jQuery,this.ENTER,this.ko),function(e){console.info("orderCredit.js init...");var t=$(".bBankWrap"),r=t.find(".bSelectInput");bankWrapLabel=r.find(".bCustomLabel");var i=function i(){var r=$("#selectedBank"),i=t.find(".bCustomInput"),n=function n(){var e=$("input:checked",t).val();r.val(e)};$(i,t).eq(0).attr("checked","checked"),$(bankWrapLabel,t).eq(0).addClass("mChecked"),t.change(n),n(),e.DirectCredit.init($("#jsCreditBank").data("value"),$(".credit_pay"))};t.length&&i()}(this),function(e,t,r,i){console.info("orderDictionary.js init...");var n=i.constructors;n.OrderDictionary=function(){"use strict";function t(e){return this instanceof t?(this.orderData=e,this.serverTime=this.orderData.time,this.deliveryTypes=this.orderData.deliveryTypes,this.deliveryStates=this.orderData.deliveryStates,this.pointsByDelivery=this.orderData.pointsByDelivery,this.products=this.orderData.products,void 0):new t(e)}return t.prototype.getNameOfState=function(e){return this.hasDeliveryState(e)?this.deliveryStates[e].name:(console.warn("Не найден метод доставки "+e),!1)},t.prototype.getToday=function(){return this.serverTime},t.prototype.hasDeliveryState=function(e){return this.deliveryStates.hasOwnProperty(e)},t.prototype.isUniqueDeliveryState=function(e){var t;return this.hasDeliveryState(e)?(t=this.deliveryStates[e],t.unique):!1},t.prototype.hasPointDelivery=function(e){return this.hasDeliveryState(e)?this.pointsByDelivery.hasOwnProperty(e):!1},t.prototype.getPointByStateAndId=function(t,r){var i,n=this.getAllPointsByState(t);for(r+="",i=n.length-1;i>=0;i--)if(n[i].id===r)return e.ENTER.utils.cloneObject(n[i]);return!1},t.prototype.getFirstPointByState=function(e){var t=this.getAllPointsByState(e);return t[0]?i.utils.cloneObject(t[0]):!1},t.prototype.getAllPointsByState=function(e){if(!this.hasDeliveryState(e))return!1;var t=this.pointsByDelivery[e],r=t?t.token:!1,i=r?this.orderData[r]:!1;return i||!1},t.prototype.getChangeButtonText=function(e){var t=this.pointsByDelivery[e]?this.pointsByDelivery[e].changeName:"Сменить";return t},t.prototype.getProductFromState=function(e){return this.hasDeliveryState(e)?this.deliveryStates[e].products:(console.warn("Не найден метод доставки "+e),!1)},t.prototype.getProductById=function(e){return this.products.hasOwnProperty(e)?this.products[e]:(console.warn("Такого продукта не найдено"),!1)},t}()}(this,this.document,this.jQuery,this.ENTER),function(){if(console.info("orderSertificate init..."),!$("#paymentMethod-10").length)return console.warn("нет метода оплаты сертификатом"),!1;var e=$("#paymentMethod-10").parent(),t=e.find(".mCardNumber"),r=e.find(".mCardPin"),i=e.find(".bPayMethodAction"),n=i.attr("data-url"),a=function(){var e=!1,a="processBlock",o=function o(){return t.val().replace(/[^0-9]/g,"")},s=function s(){return r.val().replace(/[^0-9]/g,"")},l=function l(){return{code:o(),pin:s()}},c=function c(){return e&&""!==o()&&14===o().length&&""!==s()&&4===s().length?!0:!1},u=function u(){return 4!==r.val().length?(console.warn("пин код мал"),!1):t.val().length?(d("mOrange","Проверка по номеру карты"),$.post(n,l(),function(e){if(!("success"in e))return!1;if(!e.success){var t=e.error!==void 0?e.error:"ERROR";return d("mRed",t),!1}d("mGreen",e.data)}),void 0):(console.warn("номер карты не введен"),!1)},d=function d(t,r){console.info("setProcessingStatus");var n=$(".process").first(),o={typeNum:t};switch(n.hasClass("picked")||n.remove(),t){case"mOrange":o.text=r,e=!1;break;case"mRed":o.text="Произошла ошибка: "+r,e=!1;break;case"mGreen":o.text="activated"in r?"Карта "+r.code+" на сумму "+r.sum+" активирована!":"Карта "+r.code+" имеет номинал "+r.sum,e=!0}i.after(tmpl(a,o)),r.activated!==void 0&&$(".process").first().addClass("picked")};return{checkCard:u,setProcessingStatus:d,isActive:c,getCode:o,getPIN:s}}();t.bind("change",function(){a.checkCard()}),r.bind("change",function(){a.checkCard()}),$.mask.definitions.n="[0-9]",r.mask("nnnn",{completed:a.checkCard,placeholder:"*"})}(this),function(e,t,r,i){console.info("orderValidation.js init");var n=i.utils,a={},o=r("#metrostations").data("name"),s=r("#order_recipient_first_name"),l=(r("#order_recipient_last_name"),r("#order_recipient_email")),c=r("#order_recipient_phonenumbers"),u=r("#order_address_metro"),d=r("#order_subway_id"),h=r("#order_address_street"),p=r("#order_address_building"),f=r("#sclub-number"),m=(r('.jsCustomRadio[name="order[payment_method_id]"]'),r("#qiwi-phone")),v=r("#order_agreed"),g=r("#completeOrder"),_=null,E=null,y=null,b={fields:[{fieldNode:s,require:!0,customErr:"Введите имя получателя",validateOnChange:!0},{fieldNode:l,validBy:"isEmail",customErr:"Некорректно введен e-mail",validateOnChange:!0},{fieldNode:c,require:!0,customErr:"Некорректно введен телефон",validateOnChange:!0},{fieldNode:v,require:!0,customErr:"Необходимо согласие"}]},T={source:o,appendTo:"#metrostations",minLength:2,select:function(e,t){d.val(t.item.val)}};console.log(i.OrderModel),console.log("orderValidation:: vars initd"),a=new FormValidator(b),n.orderValidator=a;var x=function x(e,t){var i='<div class="popupbox width290"><div class="font18 pb18"> '+e+"</div>"+"</div>"+'<p style="text-align:center"><a href="#" class="closePopup bBigOrangeButton">OK</a></p>',n=r("<div>").addClass("popup").html(i);n.appendTo("body");var a=function(){return n.trigger("close"),n.remove(),void 0!==t&&t(),!1};n.lightbox_me({centered:!0,onClose:a}),n.find(".closePopup").bind("click",a)},w=function w(e){console.warn("Ошибка в поле");var t=r('[name="order['+e.field+']"]'),i=function i(){a._unmarkFieldError(r(this))};a._markFieldError(t,e.message),t.bind("focus",i)},R={"default":function(e){return console.log("Обработчик ошибки"),e.error&&e.error.message?(x(e.error.message,function(){t.location.href=e.redirect}),void 0):(t.location.href=e.redirect,void 0)},0:function(e){console.warn("Обработка ошибок формы");var i=null;if(e.redirect)return x(e.error.message,function(){t.location.href=e.redirect}),void 0;x(e.error.message);for(var n=e.form.error.length-1;n>=0;n--)i=e.form.error[n],console.warn(i),w(i);r.scrollTo(r(".mError").eq(0),500,{offset:-15})},743:function(e){x(e.error.message)}},S=function S(){if("undefined"!=typeof _gaq){for(var t=i.OrderModel.deliveryBoxes().length-1;t>=0;t--)_gaq.push(["_trackEvent","Order card","Completed","выбрана "+i.OrderModel.choosenDeliveryTypeId+" доставят "+i.OrderModel.deliveryBoxes()[t].state]);_gaq.push(["_trackEvent","Order complete",i.OrderModel.deliveryBoxes().length,i.OrderModel.orderDictionary.products.length]),_gaq.push(["_trackTiming","Order complete","DB response",y])}e.yaCounter10503055!==void 0&&e.yaCounter10503055.reachGoal("\\orders\\complete")},M=function M(r){return console.info("данные отправлены. получен ответ от сервера"),E=(new Date).getTime(),y=E-_,console.log(r),r.success?(S(),i.OrderModel.paypalECS()&&!g.hasClass("mConfirm")&&(console.info("PayPal ECS включен. Заказ оформлен. Необходимо удалить выбранные параметры из cookie"),e.docCookies.removeItem("chDate_paypalECS","/"),e.docCookies.removeItem("chTypeBtn_paypalECS","/"),e.docCookies.removeItem("chPoint_paypalECS","/"),e.docCookies.removeItem("chTypeId_paypalECS","/"),e.docCookies.removeItem("chStetesPriority_paypalECS","/")),t.location.href=r.redirect,void 0):(console.log("ошибка оформления заказа"),n.blockScreen.unblock(),R.hasOwnProperty(r.error.code)?(console.log("Есть обработчик"),R[r.error.code](r)):(console.log("Стандартный обработчик"),R["default"](r)),!1)},H=function H(){var t,a,o,s=null,l=[],c=[],u={},d=r("#order-form");for(n.blockScreen.block("Ваш заказ оформляется"),c=d.serializeArray(),console.info("Перебираем блоки доставки"),a=i.OrderModel.deliveryBoxes().length-1;a>=0;a--){for(u={},s=i.OrderModel.deliveryBoxes()[a],t=s.choosenPoint(),console.log("currentDeliveryBox:"),console.log(s),u={deliveryMethod_token:s.state,date:s.choosenDate().value,interval:[s.choosenInterval()?s.choosenInterval().start:"",s.choosenInterval()?s.choosenInterval().end:""],point_id:t.id,products:[]},console.log("choosePoint:"),console.log(t),"pickpoint"===s.state&&(console.log("Is PickPoint!"),u.point_id=t.number,u.point_address={street:t.street,house:t.house},u.point_name=t.point_name),o=s.products.length-1;o>=0;o--)u.products.push(s.products[o].id);console.log("tmpPart:"),console.log(u),l.push(u)}c.push({name:"order[delivery_type_id]",value:i.OrderModel.choosenDeliveryTypeId}),c.push({name:"order[part]",value:JSON.stringify(l)}),e.KM!==void 0&&c.push({name:"kiss_session",value:e.KM.i}),console.log("dataToSend:"),console.log(c),_=(new Date).getTime(),r.ajax({url:d.attr("action"),timeout:12e4,type:"POST",data:c,success:M,statusCode:{500:function(){x("Неудалось создать заказ. Попробуйте позднее.")},504:function(){x("Неудалось создать заказ. Попробуйте позднее.")}}})},C=function C(){return console.info("Завершить оформление заказа"),i.OrderModel.lifeGift()?(H(),!1):(a.validate({onInvalid:function(e){console.warn("invalid"),console.log(e),r.scrollTo(e[e.length-1].fieldNode,500,{offset:-15})},onValid:H}),!1)},k=function k(){for(var e=o.length-1;e>=0;e--)if(u.val()===o[e].label)return;u.val("")},A=function A(e,t){t?(a.setValidate(h,{require:!0,customErr:"Не введено название улицы",validateOnChange:!0}),a.setValidate(p,{require:!0,customErr:"Не введен номер дома",validateOnChange:!0}),void 0!==o&&a.setValidate(u,{fieldNode:u,customErr:"Не выбрана станция метро",require:!0,validateOnChange:!0})):(a.setValidate(h,{require:!1}),a.setValidate(p,{require:!1}),void 0!==o&&a.setValidate(u,{require:!1})),console.info("Изменен тип доставки"),console.log(a)};r.mask.definitions.n="[0-9]",f.mask("2 98nnnn nnnnnn",{placeholder:"*"}),m.mask("(nnn) nnn-nn-nn"),c.mask("(nnn) nnn-nn-nn"),e.docCookies.getItem("emails")&&(console.log("AB TEST: e-mail require"),a.setValidate(l,{require:!0}));var D=function D(e){var t,i=null;console.info("defaultValueToField");for(t in e)if(console.log("поле "+t),e[t]){if(console.log("для поля есть значение "+e[t]),i=r('input[name="'+t+'"]'),"radio"===i.attr("type")){i.filter('[value="'+e[t]+'"]').attr("checked","checked").trigger("change");continue}i.val(e[t])}};if(D(r("#jsOrderForm").data("value")),void 0!==o){u.autocomplete(T),u.bind("change",k);for(var P=o.length-1;P>=0;P--)if(parseInt(d.val(),10)===o[P].val){u.val(o[P].label);break}}r("body").bind("orderdeliverychange",A),g.bind("click",C),console.log("orderValidation.js inited")}(this,this.document,this.jQuery,this.ENTER),function(e,t,r,i,n){console.info("separate-order.js init");var a=r("#jsOrderDelivery").data("value"),o=i.utils,s=r("body"),l=function l(t){var n={},a=[],l=[],u=null,d=null,h=null,p=null,f=null,m=null,v=[],g=i.OrderModel.orderDictionary.orderData.discounts;i.OrderModel.paypalECS()&&(console.info("PayPal ECS включен. Необходимо сохранить выбранные параметры в cookie"),e.docCookies.setItem("chTypeBtn_paypalECS",i.OrderModel.deliveryTypesButton,600),e.docCookies.setItem("chPoint_paypalECS",i.OrderModel.choosenPoint(),600),e.docCookies.setItem("chTypeId_paypalECS",i.OrderModel.choosenDeliveryTypeId,600),e.docCookies.setItem("chStetesPriority_paypalECS",JSON.stringify(i.OrderModel.statesPriority),600)),i.OrderModel.deliveryBoxes.removeAll(),i.OrderModel.hasCoupons(!1),console.log("Маркируем выбранный способ доставки"),r("#"+i.OrderModel.deliveryTypesButton).attr("checked","checked").trigger("change"),i.OrderModel.totalSum(0),i.OrderModel.hasHomeDelivery(!1),s.trigger("orderdeliverychange",[!1]);for(var _=0,E=t.length;E>_;_++)if(h=t[_],m=i.OrderModel.orderDictionary.isUniqueDeliveryState(h),console.info("перебирем "+(m?"уникальный* ":"")+"метод "+h),l=[],i.OrderModel.orderDictionary.hasDeliveryState(h)){a=i.OrderModel.orderDictionary.getProductFromState(h);for(var y=a.length-1;y>=0;y--)p=a[y],n[p]?console.log("товар "+p+" уже определялся к блоку"):(console.log("добавляем товар "+p+" в блок для метода "+h),n[p]=!0,l.push(i.OrderModel.orderDictionary.getProductById(p)));if(l.length)if(u=i.OrderModel.orderDictionary.hasPointDelivery(h)?i.OrderModel.choosenPoint():0,d=h+"_"+u,i.OrderModel.hasDeliveryBox(d))f=i.OrderModel.getDeliveryBoxByToken(d),f.addProductGroup(l);else if(m)for(v=i.OrderModel.prepareProductsQuantityByUniq(l),y=v.length-1;y>=0;y--)p=[v[y]],i.constructors.DeliveryBox(p,h,u);else i.constructors.DeliveryBox(l,h,u)}else console.info("для метода "+h+" нет товаров");if(console.info("Созданные блоки:"),console.log(i.OrderModel.deliveryBoxes()),i.OrderModel.couponsBox(g),i.OrderModel.couponsBox(g),i.OrderModel.couponUrl(r(".bSaleList__eItem:visible .jsCustomRadio").eq(0).val()),r(".bSaleList__eItem:visible .jsCustomRadio").eq(0).trigger("change"),0===r(".bPayMethod:visible .jsCustomRadio:checked").length&&r(".bPayMethod:visible .jsCustomRadio").eq(0).attr("checked","checked").trigger("change"),i.OrderModel.hasCoupons()&&i.OrderModel.deliveryBoxes().length>1||1>parseFloat(i.OrderModel.totalSum())){console.warn("Нужно удалить купон");var b="Купон не может быть применен при текущем разбиении заказа и будет удален",T=function(){console.log("удаление"),i.OrderModel.deleteItem(i.OrderModel.appliedCoupon())};return r.when(c(b)).then(T),!1}n.length!==i.OrderModel.orderDictionary.orderData.products.length&&console.warn("не все товары были обработаны"),console.warn("end"),r(".bCountSection").goodsCounter({onChange:function(e){console.info("counter change"),console.log(e);var t,n=r(this).data("seturl")||"",a=n.addParameterToUrl("quantity",e);console.log(n),console.log(a);var s=function s(e){return e.success?(i.OrderModel.couponNumber(""),void 0):(i.OrderModel.couponError(e.error.message),o.blockScreen.unblock(),void 0)};o.blockScreen.block("Обновляем"),t=[{type:"GET",url:a,callback:s},{type:"GET",url:i.OrderModel.updateUrl,callback:i.OrderModel.modelUpdate}],o.packageReq(t)}})};n.bindingHandlers.popupShower={update:function(e,t){var a=t(),o=n.utils.unwrapObservable(a),s=null;o?(s=new i.constructors.CreateMap("pointPopupMap",i.OrderModel.popupWithPoints().points,r("#mapInfoBlock")),r(e).lightbox_me({centered:!0,onClose:function(){console.info("закрываем"),a(!1)}}),s._showMarkers()):(r("#pointPopupMap").empty(),r(e).trigger("close"))}},n.bindingHandlers.payBlockVisible={update:function(e){var t,n,a=r(e),o=a.data("vars"),s=o&&o.toHide?o.toHide:!1,l=i.OrderModel.choosenDeliveryTypeId,c=i.OrderModel.deliveryBoxes(),u=c.length,d=1;if(u){if(1===u?(d=0,console.log("Кол-во deliveryBoxes == 1: Показываем payBlock")):(d=1,console.log("Кол-во deliveryBoxes > 1: Скрываем payBlock")),s)for(t in s)if(s[t].length===void 0)r.inArray(l,s)>=0&&(d=1,console.log("toHide NoArr: Скрываем payBlock"));else if(l===t)for(n in s[t])n===o.typeId&&(d=1,console.log("toHide Arr: Скрываем payBlock"));d?a.hide():a.show()}}},n.bindingHandlers.paymentMethodVisible={update:function(e,t){var a=t(),o=n.utils.unwrapObservable(a),s=r(e),l=s.data("value"),c=parseInt(l["max-sum"],10),u=parseInt(l["min-sum"],10),d=l.method_id,h=l.isAvailableToPickpoint;return 6===i.OrderModel.choosenDeliveryTypeId&&!1===h||4===i.OrderModel.choosenDeliveryTypeId&&13===d&&i.OrderModel.lifeGift()===!1||!isNaN(c)&&o>c||!isNaN(u)&&u>o?(s.hide(),void 0):(s.show(),void 0)}},n.bindingHandlers.calendarSlider={update:function(e,t,i,n,a){var o=r(e),s=t(),l=o.find(".bBuyingDatesItem"),c=l.width()+parseInt(l.css("marginRight"),10)+parseInt(l.css("marginLeft"),10);return o.width(l.length*c),s>0?(s-=380,a.box.calendarSliderLeft(s),void 0):-o.width()>s?(s+=380,a.box.calendarSliderLeft(s),void 0):(o.animate({left:s}),void 0)}},n.bindingHandlers.couponsVisible={update:function(e,t){var a,o=t(),s=n.utils.unwrapObservable(o),l=r(e),c=l.find(".mSaleInput"),u=l.find(".mSaleBtn"),d=l.find(".bSaleData__eEmptyBlock");for(r(".bSaleList__eItem").removeClass("hidden"),a=s.length-1;a>=0;a--)l.find('.bSaleList__eItem[data-type="'+s[a].type+'"]').addClass("hidden"),"coupon"===s[a].type&&(console.log("Есть примененный купон"),i.OrderModel.hasCoupons(!0),i.OrderModel.appliedCoupon(s[a]));r(".bSaleList__eItem.hidden").length===r(".bSaleList__eItem").length||r(".bSaleList__eItem:hidden").length===r(".bSaleList__eItem").length?(c.attr("disabled","disabled"),u.attr("disabled","disabled").addClass("mDisabled"),d.show()):(c.removeAttr("disabled"),u.removeAttr("disabled").removeClass("mDisabled"),d.hide())}},i.OrderModel={updateUrl:r("#jsOrderDelivery").data("url"),prepareData:n.observable(!1),showPopupWithPoints:n.observable(!1),deliveryTypesButton:null,tmpStatesPriority:null,statesPriority:null,lifeGift:n.observable(!1),oneClick:n.observable(!1),paypalECS:n.observable(!1),cartSum:null,orderDictionary:null,choosenPoint:n.observable(),hasHomeDelivery:n.observable(!1),deliveryTypes:n.observableArray([]),deliveryBoxes:n.observableArray([]),popupWithPoints:n.observable({}),totalSum:n.observable(0),hasCoupons:n.observable(!1),appliedCoupon:n.observable(),couponNumber:n.observable(),couponUrl:n.observable(),couponError:n.observable(),couponsBox:n.observableArray([]),hasDeliveryBox:function(e){console.info("Существует ли блок доставки "+e);var t=null;for(t=i.OrderModel.deliveryBoxes().length-1;t>=0;t--)if(i.OrderModel.deliveryBoxes()[t].token===e)return!0;return!1},getDeliveryBoxByToken:function(e){console.info("Получить ссылку на блок по токену "+e);var t=null;for(t=i.OrderModel.deliveryBoxes().length-1;t>=0;t--)if(i.OrderModel.deliveryBoxes()[t].token===e)return i.OrderModel.deliveryBoxes()[t]
},removeDeliveryBox:function(e){console.info("Удаление блока по токену "+e);var t=null;for(t=i.OrderModel.deliveryBoxes().length-1;t>=0;t--)if(i.OrderModel.deliveryBoxes()[t].token===e)return i.OrderModel.deliveryBoxes().splice(t,1),void 0},checkCoupon:function(){console.info("проверяем купон");var e,t={number:i.OrderModel.couponNumber()},r=i.OrderModel.couponUrl(),n=function n(e){return e.success?(i.OrderModel.couponNumber(""),void 0):(i.OrderModel.couponError(e.error.message),o.blockScreen.unblock(),void 0)};return i.OrderModel.couponError(""),void 0===r?(console.warn("Не выбран тип скидки"),i.OrderModel.couponError("Не выбран тип скидки"),void 0):void 0!==t.number&&t.number.length?(o.blockScreen.block("Применяем купон"),e=[{type:"POST",url:r,data:t,callback:n},{type:"GET",url:i.OrderModel.updateUrl,callback:i.OrderModel.modelUpdate}],o.packageReq(e),!1):(console.warn("Не введен номер"),i.OrderModel.couponError("Не введен номер"),void 0)},selectPoint:function(e){console.info("point selected..."),console.log(e.parentBoxToken);var t=null;return e.parentBoxToken?(t=i.OrderModel.getDeliveryBoxByToken(e.parentBoxToken),console.log(t),t.selectPoint.apply(t,[e]),!1):(i.OrderModel.statesPriority=i.OrderModel.tmpStatesPriority,i.OrderModel.choosenPoint(e.id),i.OrderModel.showPopupWithPoints(!1),l(i.OrderModel.statesPriority),!1)},chooseDeliveryTypes:function(e,t){console.info("chooseDeliveryTypes");var n=e.states[0],a=t.target.htmlFor;return console.log(n),console.log(a),r("#"+a).attr("checked")?(console.warn("Этот пункт "+a+" уже был выбран"),!1):(i.OrderModel.deliveryTypesButton=a,console.log(i.OrderModel.deliveryTypesButton),i.OrderModel.tmpStatesPriority=e.states,console.log(i.OrderModel.tmpStatesPriority),i.OrderModel.choosenDeliveryTypeId=e.id,console.log(i.OrderModel.choosenDeliveryTypeId),i.OrderModel.orderDictionary.hasPointDelivery(n)?(console.log("Необходимо показать окно с выбором точки доставки"),i.OrderModel.popupWithPoints({header:e.name,points:i.OrderModel.orderDictionary.getAllPointsByState(n)}),i.OrderModel.showPopupWithPoints(!0),!1):(console.log("Выбор точки доставки не требуется"),i.OrderModel.statesPriority=i.OrderModel.tmpStatesPriority,i.OrderModel.choosenPoint(0),console.info("Отправляем данные на разбивку"),l(i.OrderModel.statesPriority),!1))},modelUpdate:function(e){console.info("обновление данных с сервера"),h(e),l(i.OrderModel.statesPriority)},deleteItem:function(e){console.info("удаление товара");var r=null;o.blockScreen.block("Удаляем");var n=function n(){var t=i.OrderModel.orderDictionary.products,r=0,n=0,a={};if(!e.product)return!1;for(var o in t)r+=o[o].price,n+=o[o].quantity;a={"Checkout Step 1 SKU Quantity":n,"Checkout Step 1 SKU Total":r},"undefined"!=typeof _kmq&&_kmq.push(["set",a]),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Order card","Item deleted"])},a=function a(e){if(console.info("deleteItemResponceHandler"),console.log(e),!e.success)return console.warn("не удалось удалить товар"),o.blockScreen.unblock(),!1;if(("undefined"!=typeof _gaq||"undefined"!=typeof _kmq)&&n(),e.product){var r=e.product.id,i=e.category_id;(function(e){var r=t,i=r.createElement("IMG"),n=r.body;e=e.replace(/!\[rnd\]/,Math.round(9999999*Math.random()))+"&tail256="+escape(r.referrer||"unknown"),i.style.position="absolute",i.style.width=i.style.height="0px",i.onload=i.onerror=function(){n.removeChild(i),i=n=null},i.src=e,n.insertBefore(i,n.firstChild)})("http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=del_basket&bt=55&pz=0&custom=10="+r+";11="+i+"&![rnd]")}};return console.log(e.deleteUrl),r=[{type:"GET",url:e.deleteUrl,callback:a},{type:"GET",url:i.OrderModel.updateUrl,callback:i.OrderModel.modelUpdate}],o.packageReq(r),!1},prepareProductsQuantityByUniq:function(e){var t,r,n,a=[];for(r=e.length-1;r>=0;r--)for(t=i.utils.cloneObject(e[r]),t.sum=t.price,t.quantity=1,t.oldQuantity=e[r].quantity,n=e[r].quantity-1;n>=0;n--)a.push(t);return a}},n.applyBindings(i.OrderModel);var c=function c(e){var t='<div class="popupbox width290"><div class="font18 pb18"> '+e+"</div>"+"</div>"+'<p style="text-align:center"><a href="#" class="closePopup bBigOrangeButton">OK</a></p>',i=r("<div>").addClass("popup").html(t),n=r.Deferred();i.appendTo("body");var a=function(){i.trigger("close"),i.remove(),n.resolve()};return i.lightbox_me({centered:!0,closeClick:!1,closeEsc:!1}),i.find(".closePopup").bind("click",a),n.promise()},u={"default":function(e){var t="Товар "+e.name+" недоступен для продажи.",i=r.Deferred();return r.when(c(t)).then(function(){r.ajax({type:"GET",url:e.deleteUrl}).then(i.resolve)}),i.promise()},708:function(e){var t="",n=r.Deferred();t=e.name&&e.error.message&&e.quantity?"Вы заказали товар "+e.name+" в количестве "+e.quantity+" шт. <br/ >"+e.error.message:"Товар недоступен для продажи",r.when(c(t)).then(function(){var t=[{type:"GET",url:e.setUrl,callback:n.resolve},{type:"GET",url:i.OrderModel.updateUrl,callback:i.OrderModel.modelUpdate}];return o.packageReq(t),n.promise()})}},d=function d(e){var i=null,n=[];for(i in e.products)e.products[i].error&&e.products[i].error.code&&n.push(e.products[i]);var a=function a(e,t){var i=null;return 0>e?(console.warn("return"),t(),void 0):(i=n[e].error.code,i=u.hasOwnProperty(i)?i:"default",r.when(u[i](n[e])).then(function(){var r=e-1;a(r,t)}),void 0)};0===n.length&&e.error.message?r.when(c(e.error.message)).then(function(){e.redirect&&(t.location.href=e.redirect)}):a(n.length-1,function(){console.warn("1 этап закончен"),e.redirect&&(t.location.href=e.redirect)})},h=function h(t){var r,n;return o.blockScreen.unblock(),t.success?(console.info("Данные с сервера получены"),i.OrderModel.orderDictionary=new i.constructors.OrderDictionary(t),t.paypalECS&&(console.info("paypal true"),i.OrderModel.paypalECS(!0)),t.cart&&t.cart.sum&&(console.info("Есть первоначальная сумма корзины : "+t.cart.sum),i.OrderModel.cartSum=t.cart.sum),i.OrderModel.deliveryTypes(t.deliveryTypes),i.OrderModel.lifeGift(t.lifeGift||!1),i.OrderModel.oneClick(t.oneClick||!1),i.OrderModel.prepareData(!0),i.OrderModel.paypalECS()&&e.docCookies.hasItem("chTypeBtn_paypalECS")&&e.docCookies.hasItem("chPoint_paypalECS")&&e.docCookies.hasItem("chTypeId_paypalECS")&&e.docCookies.hasItem("chStetesPriority_paypalECS")&&(console.info("PayPal ECS включен. Необходимо применить параметры из cookie"),i.OrderModel.deliveryTypesButton=e.docCookies.getItem("chTypeBtn_paypalECS"),i.OrderModel.choosenPoint(e.docCookies.getItem("chPoint_paypalECS")),i.OrderModel.choosenDeliveryTypeId=e.docCookies.getItem("chTypeId_paypalECS"),i.OrderModel.statesPriority=JSON.parse(e.docCookies.getItem("chStetesPriority_paypalECS")),l(i.OrderModel.statesPriority)),1===t.deliveryTypes.length&&(r=t.deliveryTypes[0],n=i.OrderModel.orderDictionary.getFirstPointByState(r.states[0])||r.id,console.log("Обнаружен только 1 способ доставки: "+r.name+" — выбираем его."),console.log("Выбран первый пункт* доставки:"),console.log(n),i.OrderModel.statesPriority=r.states,i.OrderModel.deliveryTypesButton="method_"+r.id,i.OrderModel.choosenDeliveryTypeId=r.id,i.OrderModel.choosenPoint(n),l(i.OrderModel.statesPriority)),void 0):(console.warn("Данные содержат ошибки"),console.log(t.error),d(t),!1)},p=function p(e){return console.log("selectPointOnBaloon"),console.log(e),console.log(r(this).data("pointid")),console.log(r(this).data("parentbox")),i.OrderModel.selectPoint({id:r(this).data("pointid"),parentBoxToken:r(this).data("parentbox")}),!1},f=function(t){console.info("analyticsStep_1");var r,i=0,n=0,a=[],o={};for(r in t.products)i+=t.products[r].price,n+=t.products[r].quantity,a.push({id:t.products[r].id,name:t.products[r].name,price:t.products[r].price,quantity:t.products[r].quantity});o={"Checkout Step 1 SKU Quantity":n,"Checkout Step 1 SKU Total":i,"Checkout Step 1 Order Type":"cart order"},"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","New order","Items",n]),"undefined"!=typeof _kmq&&_kmq.push(["record","Checkout Step 1",o]),e.APRT_DATA=e.APRT_DATA||{},e.APRT_DATA.pageType=5,e.APRT_DATA.orderInfo=e.APRT_DATA.orderInfo||{},e.APRT_DATA.orderInfo.totalPrice=i,e.APRT_DATA.basketProducts=a};console.log(i.OrderModel),h(a),f(a),s.on("click",".shopchoose",p)}(this,this.document,this.jQuery,this.ENTER,this.ko);