function DeliveryBox(e,t,r,i,n){console.info("Cоздание блока доставки "+t+" для "+r);var a=this;a.OrderModel=n,a.createdBox=i,a.deliveryPoint=r,a.products=[],a.fullPrice=0,a.state=t,a.deliveryPrice=Number.POSITIVE_INFINITY,a.showMessage=null,a.choosenDate=null,a.addProductGroup(e),a.OrderModel.deliveryBoxes.push(a)}DeliveryBox.prototype._getFirstPropertyName=function(e){for(var t in e)return t},DeliveryBox.prototype.addProduct=function(e){var t=this,r=null,i=null,n=null,a=[];return e.deliveries[t.state].hasOwnProperty(t.deliveryPoint)?(r=parseInt(e.deliveries[t.state][t.deliveryPoint].price,10),t.deliveryPrice=t.deliveryPrice>r?r:t.deliveryPrice,t.fullPrice+=e.sum,t.products.push({name:e.name,price:e.sum,quantity:e.quantity,deleteUrl:e.deleteUrl,productUrl:e.url,productImg:e.image}),void 0):(console.warn("Для товара "+e.id+" нет пункта доставки "+t.deliveryPoint+". Необходимо создать новый блок"),n=t._getFirstPropertyName(e.deliveries[t.state]),i=t.state+"_"+n,void 0!==t.createdBox[i]?t.createdBox[i].addProduct(e):(a.push(e),t.createdBox[i]=new DeliveryBox(a,t.state,n,t.createdBox,t.OrderModel)),void 0)},DeliveryBox.prototype.addProductGroup=function(e){for(var t=e.length-1;t>=0;t--)this.addProduct(e[t])},function(){console.info("Логика разбиения заказа для оформления заказа v.5");var e="/ajax/order-delivery",t={},r=null,i=null,n={},a=function a(e){for(var r={},a=[],s=[],l=null,c=null,u=0,h=e.length;h>u;u++)if(console.info("перебирем метод "+e[u]),s=[],t.deliveryStates.hasOwnProperty(e[u])){a=t.deliveryStates[e[u]].products;for(var d=a.length-1;d>=0;d--)r[a[d]]?console.log("товар "+a[d]+" уже определялся к блоку"):(console.log("добавляем товар "+a[d]+" в блок для метода "+e[u]),r[a[d]]=!0,s.push(t.products[a[d]]));s.length&&(l=t.pointsByDelivery[e[u]]?i:0,c=e[u]+"_"+l,void 0!==n[c]?n[c].addProductGroup(s):n[c]=new DeliveryBox(s,e[u],l,n,o))}else console.warn("для метода "+e[u]+" нет товаров");console.info("Созданные блоки:"),console.log(n),r.length!==t.products.length&&console.warn("не все товары были обработаны")},o={prepareData:ko.observable(!1),deliveryTypes:ko.observableArray([]),deliveryBoxes:ko.observableArray([]),chooseDeliveryTypes:function(e){var s=e.states,l=s[0];n={},o.deliveryBoxes.removeAll(),r=e.token,t.pointsByDelivery[l]?(console.log("есть точки доставки из которых нужно выбрать"),i=13):(console.log("для выбранного метода доставки нет точек доставки"),i=0),console.log("выбранный метод доставки "+r),console.log("выбранное место доставки "+i),a(s)}};ko.applyBindings(o);var s=function s(e){return e.success?(console.log("Данные с сервера получены"),t=e,o.deliveryTypes(e.deliveryTypes),o.prepareData(!0),void 0):(console.warn("произошла ошибка при получении данных с сервера"),console.log(e.error),!1)};$.ajax({type:"GET",url:e,success:s})}();