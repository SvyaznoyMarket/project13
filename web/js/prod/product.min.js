$(function(){$(".js-product-3d-html5-opener").bind("click",function(a){a.preventDefault(),$LAB.script("/maybe3dPlayer/player.min.js").wait(function(){$(".js-product-3d-html5-popup").lightbox_me({centered:!0,closeSelector:".close",onLoad:function(){var a=$(".js-product-3d-html5-popup");Maybe3D.Starter.setModelPathHTML5(a.data("url")),Maybe3D.Starter.embed(a.data("id"),"js-product-3d-html5-popup-model")},onClose:function(){$("#js-product-3d-html5-popup-model").empty()}})})}),$(".js-product-3d-swf-opener").bind("click",function(a){a.preventDefault(),$LAB.script("swfobject.min.js").wait(function(){try{$("#js-product-3d-swf-popup-model").length||$(".js-product-3d-swf-popup-container").append('<div id="js-product-3d-swf-popup-model"></div>');var a="js-product-3d-swf-popup-object",b=$(".js-product-3d-swf-popup");swfobject.embedSWF(b.data("url"),"js-product-3d-swf-popup-model","700px","500px","10.0.0","js/vendor/expressInstall.swf",{language:"auto"},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",wmode:"direct"},{id:a}),b.lightbox_me({centered:!0,closeSelector:".close",onClose:function(){swfobject.removeSWF(a)}})}catch(c){}})}),$(".js-product-3d-img-opener").bind("click",function(a){a.preventDefault(),$LAB.script("DAnimFramePlayer.min.js").wait(function(){var a=$(".js-product-3d-img-popup"),b=a.data("value"),c=a.data("host");try{$("#js-product-3d-img-container").length||new DAnimFramePlayer(a[0],c).DoLoadModel(b),a.lightbox_me({centered:!0,closeSelector:".close"})}catch(d){}})})}),function(){var a=$(".creditbox");if(a.length>0){var b=$(document.body),c=a.find(".creditbox__sum strong");window.creditBox={init:function(){{var b=$("input[name=dc_buy_on_credit]").data("model");a.find("label")}$(".jsProductCreditRadio").on("change",function(){var a=$(this).val(),b=$(".js-WidgetBuy .jsBuyButton");b.length>0&&b.attr("href",ENTER.utils.setURLParam("credit",a,b.attr("href")))}),"function"==typeof window.dc_getCreditForTheProduct&&dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:b.price,count:1,type:b.product_type},function(b){!1 in b||b.payment>0&&(c.html(printPrice(Math.ceil(b.payment))),a.show())})}},b.on("userLogged",function(a,b){if($.isArray(b.cartProducts)){var c=$("#jsProductCard").data("value").id;$.each(b.cartProducts,function(a,b){b.isCredit&&b.id==c&&$("#creditinput").attr("checked",!0).trigger("change")})}}),creditBox.init()}else{var d=$(".bProductDesc");d.length&&!d.hasClass("mNoCredit")&&d.addClass("mNoCredit")}}(),function(){$(".js-show-shops").on("click",function(){var a=$(".shopsPopup"),b=$(".shopsPopup .jsBuyButton");a.lightbox_me({centered:!0,autofocus:!0}),b.on("click",function(){a.trigger("close")})})}(),function(){var a=function(){var a=$(".js-photoslider"),b=a.find(".js-photoslider-gal"),c=a.find(".js-photoslider-btn-prev"),d=a.find(".js-photoslider-btn-next"),e=b.find(".js-photoslider-gal-i");if(!e.length)return!1;var f=e.width()+parseInt(e.css("marginLeft"),10)+parseInt(e.css("marginRight"),10),g=0;b.css({width:e.length*f,left:g});var h=function(){g>0?c.show():c.hide(),g<b.width()-a.width()?d.show():d.hide()},i=function(){return g-=f,b.animate({left:-g}),h(),!1},j=function(){return g+=f,b.animate({left:-g}),h(),!1};h(),c.bind("click",i),d.bind("click",j)};$(document).ready(function(){$(".js-photoslider").length&&a()})}(),function(){var a=function(){var a=$(".bHint_ePopup"),b=$(".bHint_eLink"),c=$(".bHint_ePopup .close"),d=function(a){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Hints",a.hintTitle,a.url])},e=function(){a.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150);var b={hintTitle:$(this).html(),url:window.location.href};return d(b),!1},f=function(){return a.fadeOut(150),!1};b.bind("click",e),c.bind("click",f)};$(document).ready(function(){$(".bHint").length&&a()})}(),function(a){a.Planner3dKupeConstructor=null,a.Planner3d_Init=function(a){},a.Planner3d_UpdatePrice=function(a){var b=$("#planner3D").data("cart-sum-url"),c={};c.product={};for(var d=function(a){return a.success?void $(".jsPrice").html(printPrice(a.sum)):!1},e=0,f=a.length;f>e;e++){var g=a[e].id;if(""!==a[e].error)return $(".jsBuyButton").addClass("mDisabled"),$("#coupeError").html("Вставки продаются только парами!").show(),!1;$(".jsBuyButton").removeClass("mDisabled"),$("#coupeError").hide(),void 0!==c.product[g+""]?c.product[g+""].quantity++:c.product[g+""]={id:g,quantity:1}}$.ajax({type:"POST",url:b,data:c,success:d})};var b=function(){if($(this).hasClass("mDisabled"))return!1;var b=a.Planner3dKupeConstructor.GetBasketContent(),c=$(this).attr("href"),d={},e=function(a){return a.success?($(".jsBuyButton").html("В корзине").addClass("mBought").attr("href","/cart"),a.product.name=$(".bMainContainer__eHeader-title").html(),a.product.price=$(".jsPrice").eq("1").html(),a.product.article=$(".bMainContainer__eHeader-article").html(),void $("body").trigger("addtocart",[a])):!1};return d.product=b,$.ajax({type:"POST",url:c,data:d,success:e}),!1},c=function(){try{var c=$("#planner3D").data("product");a.Planner3dKupeConstructor=new DKupe3dConstructor(document.getElementById("planner3D"),"/css/item/coupe_img/","/css/item/coupe_tex/","/css/item/test_coupe_icons/"),a.Planner3dKupeConstructor.Initialize("/js/KupeConstructorData.json",c.id)}catch(d){var e={event:"Kupe3dConstructor error",type:"ошибка загрузки Kupe3dConstructor",err:d};a.ENTER.utils.logError(e)}$(".jsBuyButton").off(),$(".jsBuyButton").bind("click",b)};$(document).ready(function(){$("#planner3D").length&&$LAB.script("KupeConstructorScript.min.js").script("three.min.js").wait(c)})}(this),function(){var a=function(){var a=$(".priceSale"),b=$(".jsLowPriceNotifer"),c=$(".bLowPriceNotiferPopup__eSubmitEmail"),d=$(".bLowPriceNotiferPopup__eInputEmail"),e=$(".bLowPriceNotiferPopup"),f=$(".bLowPriceNotiferPopup__eError"),g=$(".jsSubscribe"),h=function(){return e.fadeOut(300),!1},i=function(b,c){c&&(c.name&&a.show(),c.email&&d.val(c.email))},j=function(){return e.fadeIn(300),e.find(".close").bind("click",h),!1},k=function(a){return a.success?(g[0]&&g[0].checked&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","subscription","subscribe_price_alert",d.val()]),h(),e.remove(),void b.remove()):(d.addClass("red"),a.error.message&&f.show().html(a.error.message),!1)},l=function(){return g.length&&g.is(":checked")?!0:!1},m=function(){var a=c.data("url");return a+=encodeURI("?email="+d.val()+"&subscribe="+(l()?1:0)),$.get(a,k),!1};c.bind("click",m),b.bind("click",j),$("body").bind("userLogged",i)};$(document).ready(function(){$(".jsLowPriceNotifer").length&&a()})}(),function(a){var b=a(document.body),c=b.find(".jsProductCreditButton");b.hasClass("product-card-new")&&(b.on("click",".jsOpenProductImgPopup",function(){b.find(".jsProductImgPopup").lightbox_me({centered:!0,closeSelector:".closer",onLoad:function(){},onClose:function(){}})}),b.find(".jsProductPhotoThumb").on("click",function(){b.find(".jsProductPopupBigPhoto").attr("src",a(this).data("big-img"))}),b.on("click",".jsProductPopupZoom",function(){}),b.on("click",".jsProductPopupSlide",function(){}),c.length>0&&"function"==typeof window.dc_getCreditForTheProduct&&window.dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:c.data("credit").price,count:1,type:c.data("credit").product_type},function(a){"undefined"!=typeof a.payment&&a.payment>0&&(c.find(".jsProductCreditPrice").text(printPrice(Math.ceil(a.payment))),c.show())}))}(jQuery),$(document).ready(function(){!function(){var a=$(".js-photo-zoomedImg");if(a.length){var b=void 0!==a.data("zoom-disable")?a.data("zoom-disable"):!0,c={gallery:"productImgGallery",galleryActiveClass:"prod-photoslider__gal__link--active",zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:a.data("is-slot")?344:519,borderSize:1,borderColour:"#C7C7C7",disableZoom:b},d=function(){return void 0!=$(this).data("zoom-disable")&&$(this).data("zoom-disable")!=b?(b=$(this).data("zoom-disable"),b?($.removeData(a,"elevateZoom"),$(".zoomContainer").remove()):(c.disableZoom=b,a.elevateZoom(c)),!1):void 0};a.elevateZoom(c),$(".jsPhotoGalleryLink").on("click",d)}}(),$(".bCountSection").goodsCounter({onChange:function(a){var b=this.attr("data-spinner-for"),c=$("."+b),d=$("."+b+"-oneClick");newHref=c.attr("href")||"",c.attr("href",newHref.addParameterToUrl("quantity",a)),d.data("quantity",a)}}),$(".js-slider").goodsSlider({onLoad:function(a){ko.applyBindings(ENTER.UserModel,a)}}),$(".bDescSelectItem").customDropDown({changeHandler:function(a){var b=a.data("url");document.location.href=b}}),$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")});try{var a=ENTER.config.pageConfig.product?ENTER.config.pageConfig.product.id:null,b=docCookies.getItem("product_viewed")||"",c=[];a&&(c=b?ENTER.utils.arrayUnique(b.split(",")):[],c.push(a),docCookies.setItem("product_viewed",c.slice(-20).join(","),604800,"/"))}catch(d){}}),function(){var a=$("#jsProductCard").data("value")||{},b=function(b){var c=this;"undefined"!==a.article&&(_gaq.push(["_trackEvent","YM_link",a.article]),b.preventDefault(),"undefined"!==c&&setTimeout(function(){c.click()},500))};return $("#jsProductCard").length?void("undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",b)})):!1}(),function(){var a={user:-1,pro:-1},b={user:0,pro:0},c=null,d=null,e=null,f=$(".jsGetReviews"),g=$(".bReviewsTabs__eTab"),h=$(".bReviewsWrapper"),i=$(".bReviewsContent"),j=function(c,d,e){var g,h=a[d]+1,i=!1,j="/product-reviews/"+c,k=function(c){$("."+e).html($("."+e).html()+c.content),a[d]++,b[d]=c.pageCount,a[d]+1>=b[d]?f.hide():f.show()};$("body").hasClass("jewel")&&(i="jewel"),g={page:h,type:d,layout:i},$.ajax({type:"GET",data:g,url:j,success:k})};if(g.length){var k=h.attr("data-reviews-type");a[k]++,b[k]=h.attr("data-page-count"),b[k]>1&&f.show(),c=h.attr("data-product-ui"),d=h.attr("data-reviews-type"),e=h.attr("data-container"),g.click(function(){e=$(this).attr("data-container"),void 0!==e&&(d=$(this).attr("data-reviews-type"),g.removeClass("active"),$(this).addClass("active"),i.hide(),$("."+e).show(),f.hide(),"user"===d&&f.html("Показать ещё отзывы"),$("."+e).html()?a[d]+1>=b[d]?f.hide():f.show():j(c,d,e))}),f.click(function(){j(c,d,e)})}}(),function(){var a=$("body"),b=$(".jsReviewPopup"),c=b.find(".jsReviewForm"),d=$(".jsFormSubmit"),e=d.val(),f=c.find(".starsList__item"),g=c.find(".jsReviewStarsCount"),h={fill:"mFill",empty:"mEmpty"},i=$(".jsAdvantage"),j=$(".jsDisadvantage"),k=$(".jsExtract"),l=$(".jsAuthorName"),m=$(".jsAuthorEmail"),n={fields:[{fieldNode:i,require:!0,customErr:"Не указаны достоинства"},{fieldNode:j,require:!0,customErr:"Не указаны недостатки"},{fieldNode:k,require:!0,customErr:"Не указан комментарий"},{fieldNode:l,require:!0,customErr:"Не указано имя"},{fieldNode:m,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},o=new FormValidator(n),p=function(){return b.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},q=function(a){var b=$('[name="review['+a.field+']"]'),c=function(){o._unmarkFieldError($(this))};return o._markFieldError(b,a.message),b.bind("focus",c),!1},r=function(a){var b=$("ul.error_list",c);return b.length?b.html("<li>"+a+"</li>"):($(".bFormLogin__ePlaceTitle",c).after($('<ul class="error_list" />').append("<li>"+a+"</li>")),$(c).prepend($('<ul class="error_list" />').append("<li>"+a+"</li>"))),!1},s=function(a){for(var b=null,c=a.form.error.length-1;c>=0;c--)b=a.form.error[c],"global"!==b.field&&null!==b.message?q(b):"global"===b.field&&null!==b.message&&r(b.message);return!1},t=function(a){return a.error?(s(a),!1):(a.success&&(a.notice.message&&c.before(a.notice.message),c.hide()),!1)},u=function(){function a(){c.data("disabled",!1),d.removeAttr("disabled"),d.removeClass("mDisabled"),d.val(e)}return c.data("disabled")?!1:(c.data("disabled",!0),d.attr("disabled","disabled"),d.addClass("mDisabled"),d.val("Сохраняю…"),$("ul.error_list",c).length&&$("ul.error_list",c).html(""),o.validate({onInvalid:function(b){a()},onValid:function(){return $.ajax({type:"post",url:c.attr("action"),data:c.serializeArray(),dataType:"json",success:t,complete:function(){a()}}),!1}}),!1)},v=function(a){f.removeClass(h.fill).removeClass(h.empty),f.each(function(b){$(this).addClass(a>=b+1?h.fill:h.empty)})},w=function(){var a=$(this),b=a.index()+1;v(b)},x=function(){var a=g.val();v(a)},y=function(){var a=$(this),b=a.index()+1;g.val(b),v(b)},z=function(a,b){b&&(b.name&&(l.val(b.name),l.parent(".jsPlace2Col").hide()),b.email&&(m.val(b.email),m.parent(".jsPlace2Col").hide()),b.name&&b.email&&l.parents(".jsFormFieldset").hide())};a.on("click",".jsReviewSend",p),a.on("submit",".jsReviewForm",u),a.on("userLogged",z),f.hover(w,x),f.on("unhover",x),f.on("click",y),"#add-review"==location.hash&&p()}(),$(function(){$("#spk-widget-reviews").length&&("#add-review"==location.hash&&(location.href="?spkPreState=addReview"),$(".sprosikupiRating .spk-good-rating a").live("click",function(a){return $(document).stop().scrollTo($(a.currentTarget).attr("href"),800),!1}),$.getScript("//static.sprosikupi.ru/js/widget/sprosikupi.bootstrap.js"))}),$(function(){var a=$("#shoppilot-reviews-container");a.length&&(_shoppilot=window._shoppilot||[],_shoppilot.push(["_setStoreId","535a852cec8d830a890000a6"]),_shoppilot.push(["_setOnReady",function(b){new b.ProductWidget({name:"product-rating",styles:"product-reviews",product_id:a.data("productId")}).appendTo("#shoppilot-rating-container"),new b.ProductWidget({name:"product-reviews",styles:"product-reviews",product_id:a.data("productId")}).appendTo(a[0]),"#add-review"==location.hash&&new b.Surveybox({product_id:a.data("productId")}).open()}]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//ugc.shoppilot.ru/javascripts/require.js",a.setAttribute("data-main","//ugc.shoppilot.ru/javascripts/social-apps.js");var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),$("#shoppilot-rating-container").on("click","a.sp-product-inline-rating-label",function(a){return $(document).stop().scrollTo($(a.currentTarget).attr("href").replace(/^.*?#/,"#"),800),!1}))}),$(function(){var a=$("body");$(".js-product-similarProducts-link").on("click",function(b){try{a.trigger("trackGoogleEvent",{category:"RR_взаимодействие",action:"Перешел на карточку товара",label:"SEO",hitCallback:$(this).attr("href")}),b.stopPropagation()}catch(c){}})}),$(function(){var a=$(".js-product-video");if(a.length&&$(".js-product-video-container").length){var b=0,c=0,d=document.location.href,e=$(".js-product-video-iframeContainer"),f=e.html();e.empty(),a.bind("click",function(){var a=$(".js-product-video-iframeContainer");a.append(f);var e=$("iframe",a);return e.attr("src",e.attr("src")+"?autoplay=1"),$(".js-product-video-container").lightbox_me({centered:!0,onLoad:function(){b=(new Date).getTime(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Play",d])},onClose:function(){$(".js-product-video-iframeContainer").empty(),c=(new Date).getTime();var a=c-b;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Stop",d,a])}}),!1})}});