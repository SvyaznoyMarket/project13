(function(){if($(".creditbox").length){console.log("## Product has creditbox");var e=$(".creditbox"),t=e.find(".creditbox__sum strong");window.creditBox={cookieTimeout:null,toggleCookie:function(e){clearTimeout(this.cookieTimeout),this.cookieTimeout=setTimeout(function(){window.docCookies.setItem("credit_on",e?1:0,3600,"/")},200)},init:function(){var o=this,i=$("input[name=dc_buy_on_credit]").data("model"),n=$(".creditbox label");$("input[type=radio][name=price_or_credit]").change(function(e){e.preventDefault(),n.length&&(n.toggleClass("checked"),o.toggleCookie(n.hasClass("checked")))}),1===this.getState()&&$(".creditbox label").addClass("checked"),i.count=1,i.cart="/cart",dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:i.price,count:i.count,type:i.product_type},function(o){false in o||o.payment>0&&(t.html(printPrice(Math.ceil(o.payment))),e.show())})},getState:function(){return window.docCookies.hasItem("credit_on")?window.docCookies.getItem("credit_on"):0}},creditBox.init()}else{console.log("## Product does not have creditbox");var o=$(".bProductDesc");o.length&&!o.hasClass("mNoCredit")&&o.addClass("mNoCredit")}})(),function(){if($(".bDeliveryNowClick").length){var e=function e(){var e=$(this).parent(".mDeliveryNow"),t=e.find("ul.bDeliveryFreeAddress");e.toggleClass("mOpen"),e.toggleClass("mClose"),e.hasClass("mOpen")?t.slideDown():t.slideUp()};$(".bDeliveryNowClick").on("click",e)}}(),function(){var e=function(){var e=$(".bPhotoSlider"),t=e.find(".bPhotoSliderGallery"),o=e.find(".bPhotoSlider__eBtn.mPrev"),i=e.find(".bPhotoSlider__eBtn.mNext"),n=t.find(".bPhotoSliderGallery__eItem");if(!n.length)return!1;var r=n.width()+parseInt(n.css("marginLeft"),10)+parseInt(n.css("marginRight"),10),c=0;t.css({width:n.length*r,left:c});var a=function(){c>0?o.show():o.hide(),t.width()-e.width()>c?i.show():i.hide()},d=function(){return c-=r,t.animate({left:-c}),a(),!1},l=function(){return c+=r,t.animate({left:-c}),a(),!1};a(),o.bind("click",d),i.bind("click",l)};$(document).ready(function(){$(".bPhotoSlider").length&&e()})}(),function(e){var t=e.ENTER.config.pageConfig,o=e.ENTER.utils,i=function i(){var e=function e(){var e=$("#3dModelImg"),t=e.data("value"),i=e.data("host"),n=null,r=function r(){return $("#3dModelImg").lightbox_me({centered:!0,closeSelector:".close"}),!1};try{$("#3dImgContainer").length||(n=new DAnimFramePlayer(document.getElementById("3dModelImg"),i),n.DoLoadModel(t),$(".mGrad360.3dimg").bind("click",r))}catch(c){var a={event:"3dimg",type:"ошибка загрузки 3dimg для мебели",err:c};o.logError(a)}};$LAB.script("DAnimFramePlayer.min.js").wait(e)};$(document).ready(function(){t["product.img3d"]&&i()})}(this),function(){var e=function(){var e=$(".bHint_ePopup"),t=$(".bHint_eLink"),o=$(".bHint_ePopup .close"),i=function(e){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Hints",e.hintTitle,e.url])},n=function(){e.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150);var t={hintTitle:$(this).html(),url:window.location.href};return i(t),!1},r=function(){return e.fadeOut(150),!1};t.bind("click",n),o.bind("click",r)};$(document).ready(function(){$(".bHint").length&&e()})}(),function(e){e.Planner3dKupeConstructor=null,e.Planner3d_Init=function(){},e.Planner3d_UpdatePrice=function(e){var t=$("#planner3D").data("cart-sum-url"),o={};o.product={};for(var i=function(e){return e.success?($(".jsPrice").html(printPrice(e.sum)),void 0):!1},n=0,r=e.length;r>n;n++){var c=e[n].id;if(""!==e[n].error)return $(".jsBuyButton").addClass("mDisabled"),$("#coupeError").html("Вставки продаются только парами!").show(),!1;$(".jsBuyButton").removeClass("mDisabled"),$("#coupeError").hide(),void 0!==o.product[c+""]?o.product[c+""].quantity++:o.product[c+""]={id:c,quantity:1}}$.ajax({type:"POST",url:t,data:o,success:i})};var t=function(){if($(this).hasClass("mDisabled"))return!1;var t=e.Planner3dKupeConstructor.GetBasketContent(),o=$(this).attr("href"),i={},n=function(e){return e.success?($(".jsBuyButton").html("В корзине").addClass("mBought").attr("href","/cart"),e.product.name=$(".bMainContainer__eHeader-title").html(),e.product.price=$(".jsPrice").eq("1").html(),e.product.article=$(".bMainContainer__eHeader-article").html(),$("body").trigger("addtocart",[e]),void 0):!1};return i.product=t,$.ajax({type:"POST",url:o,data:i,success:n}),!1},o=function(){try{var o=$("#planner3D").data("product");e.Planner3dKupeConstructor=new DKupe3dConstructor(document.getElementById("planner3D"),"/css/item/coupe_img/","/css/item/coupe_tex/","/css/item/test_coupe_icons/"),e.Planner3dKupeConstructor.Initialize("/js/KupeConstructorData.json",o.id)}catch(i){var n={event:"Kupe3dConstructor error",type:"ошибка загрузки Kupe3dConstructor",err:i};e.ENTER.utils.logError(n)}$(".jsBuyButton").off(),$(".jsBuyButton").bind("click",t)};$(document).ready(function(){$("#planner3D").length&&$LAB.script("KupeConstructorScript.min.js").script("three.min.js").wait(o)})}(this),function(){var e=function e(){var e=$(".priceSale"),t=$(".jsLowPriceNotifer"),o=$(".bLowPriceNotiferPopup__eSubmitEmail"),i=$(".bLowPriceNotiferPopup__eInputEmail"),n=$(".bLowPriceNotiferPopup"),r=$(".bLowPriceNotiferPopup__eError"),c=$(".jsSubscribe"),a=function a(){return n.fadeOut(300),!1},d=function(t,o){o&&(o.name&&(o.isSubscribed&&c.parent("label").hide(),e.show()),o.email&&i.val(o.email))},l=function l(){return n.fadeIn(300),n.find(".close").bind("click",a),!1},s=function s(e){return e.success?(a(),n.remove(),t.remove(),void 0):(i.addClass("red"),e.error.message&&r.show().html(e.error.message),!1)},u=function u(){return c.length&&c.is(":checked")?!0:!1},m=function m(){var e=o.data("url");return e+=encodeURI("?email="+i.val()+"&subscribe="+(u()?1:0)),$.get(e,s),!1};o.bind("click",m),t.bind("click",l),$("body").bind("userLogged",d)};$(document).ready(function(){$(".jsLowPriceNotifer").length&&e()})}(),function(e){var t=e.ENTER.config.pageConfig,o=e.ENTER.utils,i=!1,n=function(e){return"function"!=typeof e?!1:(i?e():($LAB.script("swfobject.min.js").wait(e),i=!0),!0)},r=function(){var e=$("#maybe3dModelPopup").data("value"),t=function(){var t=function(t){t.stopPropagation();try{$("#maybe3dModel").length||$("#maybe3dModelPopup_inner").append('<div id="maybe3dModel"></div>'),swfobject.embedSWF(e.init.swf,e.init.container,e.init.width,e.init.height,e.init.version,e.init.install,e.flashvars,e.params,e.attributes),$("#maybe3dModelPopup").lightbox_me({centered:!0,closeSelector:".close",onClose:function(){swfobject.removeSWF(e.attributes.id)}})}catch(i){var n={event:"swfobject_error",type:"ошибка загрузки swf maybe3d",err:i};o.logError(n)}return!1};$(".mGrad360.maybe3d").bind("click",t)};n(t)},c=function c(){console.log("### LoadFitting BEGIN");var e=function e(){var e=function e(){return"undefined"==typeof ARPlugin?(console.warn("ARPlugin is not defined"),$("li.vFitting").hide(),!1):(console.log("ARPlugin is defined"),ARPlugin.init({type:"simple",js:"/js/prod/",css:"/styles/ARPlugin/",img:"/styles/ARPlugin/img/",swf:"/styles/ARPlugin/swf/",resources:t["product.resources"],meshes_path:t["product.meshes"],textures_path:t["product.textures"],marker_path:t["product.marker"]}),fittingPopupShow=function(e){e.preventDefault(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","3D-primerochnaya",t["product.name"],"click"]),ARPlugin.show(t["product.article"]+".obj",t["product.article"]+".png")},$(".vFitting").bind("click",fittingPopupShow),void 0)};$LAB.script("ARPluginOrigin.js").wait(e)};n(e)};$(document).ready(function(){t["product.maybe3d"]&&r(),t["product.vFitting"]&&c()})}(this),$(document).ready(function(){(function(){if(!$(".bZoomedImg").length)return console.warn("Нет изображения для elevateZoom"),void 0;var e=$(".bZoomedImg"),t=void 0!==e.data("zoom-disable")?e.data("zoom-disable"):!0,o={gallery:"productImgGallery",galleryActiveClass:"mActive",zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:519,borderSize:1,borderColour:"#C7C7C7",disableZoom:t},i=function(){return void 0!=$(this).data("zoom-disable")&&$(this).data("zoom-disable")!=t?(t=$(this).data("zoom-disable"),t?($.removeData(e,"elevateZoom"),$(".zoomContainer").remove()):(o.disableZoom=t,e.elevateZoom(o)),!1):void 0};e.elevateZoom(o),$(".jsPhotoGalleryLink").on("click",i)})(),$(".bCountSection").goodsCounter({onChange:function(e){var t=this.attr("data-spinner-for"),o=$("."+t),i=o.attr("href")||"";console.log("counter change"),console.log(o),o.attr("href",i.addParameterToUrl("quantity",e))}}),$(".bGoodsSlider").goodsSlider(),$(".bDescSelectItem").customDropDown({changeHandler:function(e){var t=e.data("url");document.location.href=t}}),function(){var e=function e(e){var t=e.product,o=e.regionId,i=window._rutarget||[];t&&o&&i.push({event:"buyNow",sku:t.id,qty:t.quantity,regionId:o})},t=function t(t){return console.info("payPal ajax complete"),t.success&&t.redirect?(e(t),document.location.href=t.redirect,void 0):(window.ENTER.utils.blockScreen.unblock(),void 0)},o=function o(){console.info("payPal click");var e=$(this),o=e.attr("href"),i=$(".bCountSection__eNum"),n={};return window.ENTER.utils.blockScreen.block("Загрузка"),i.length&&$.isNumeric(i.val())&&1*i.val()>1&&(n.quantity=i.val()),$.get(o,n,t),!1};$(".jsPayPalButton").bind("click",o),$(".jsLifeGiftButton").bind("click",o),$(".jsOneClickButton").bind("click",o)}(),$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")})}),function(){var e=$("#jsProductCard").data("value")||{},t={"Viewed Product SKU":e.article,"Viewed Product Product Name":e.name,"Viewed Product Product Status":e.stockState},o=function(t){console.log("reviewsYandexClick");var o=this;"undefined"!==e.article&&(_gaq.push(["_trackEvent","YM_link",e.article]),t.preventDefault(),"undefined"!==o&&setTimeout(function(){o.click()},500))};return $("#jsProductCard").length?("undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Product",t]),"undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",o)}),void 0):!1}(),function(){var e={accessorize:function(e){console.log(e);var t={"Recommended Item Clicked Accessorize Recommendation Place":"product","Recommended Item Clicked Accessorize Clicked SKU":e.article,"Recommended Item Clicked Accessorize Clicked Product Name":e.name,"Recommended Item Clicked Accessorize Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Accessorize",t])},alsoBought:function(e){console.log(e);var t={"Recommended Item Clicked Also Bought Recommendation Place":"product","Recommended Item Clicked Also Bought Clicked SKU":e.article,"Recommended Item Clicked Also Bought Clicked Product Name":e.name,"Recommended Item Clicked Also Bought Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Bought",t])},alsoViewed:function(e){console.log(e);var t={"Recommended Item Clicked Also Viewed Recommendation Place":"product","Recommended Item Clicked Also Viewed Clicked SKU":e.article,"Recommended Item Clicked Also Viewed Clicked Product Name":e.name,"Recommended Item Clicked Also Viewed Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Viewed",t])}},t=function t(){console.info("click!");var t=$(this).parents(".bGoodsSlider").data("slider"),o=t.type,i=$(this).data("product");console.log(o),i.position=$(this).index(),e.hasOwnProperty(o)&&e[o](i)};$(".bGoodsSlider").on("click",".bSliderAction__eItem",t)}(),function(){var e={user:-1,pro:-1},t={user:0,pro:0},o=null,i=null,n=null,r=$(".jsGetReviews"),c=$(".bReviewsTabs__eTab"),a=$(".bReviewsWrapper"),d=$(".bReviewsContent"),l=function(o,i,n){var c=e[i]+1,a=!1,d="/product-reviews/"+o,l={},s=function s(o){$("."+n).html($("."+n).html()+o.content),e[i]++,t[i]=o.pageCount,e[i]+1>=t[i]?r.hide():r.show()};$("body").hasClass("jewel")&&(a="jewel"),l={page:c,type:i,layout:a},$.ajax({type:"GET",data:l,url:d,success:s})};if(c.length){var s=a.attr("data-reviews-type");e[s]++,t[s]=a.attr("data-page-count"),t[s]>1&&r.show(),o=a.attr("data-product-id"),i=a.attr("data-reviews-type"),n=a.attr("data-container"),c.click(function(){n=$(this).attr("data-container"),void 0!==n&&(i=$(this).attr("data-reviews-type"),c.removeClass("active"),$(this).addClass("active"),d.hide(),$("."+n).show(),r.hide(),"user"===i&&r.html("Показать ещё отзывы"),$("."+n).html()?e[i]+1>=t[i]?r.hide():r.show():l(o,i,n))}),r.click(function(){l(o,i,n)})}}(),function(){var e=$("body"),t=$(".jsReviewPopup"),o=t.find(".jsReviewForm"),i=o.find(".starsList__item"),n=o.find(".jsReviewStarsCount"),r={fill:"mFill",empty:"mEmpty"},c=$(".jsAdvantage"),a=$(".jsDisadvantage"),d=$(".jsExtract"),l=$(".jsAuthorName"),s=$(".jsAuthorEmail"),u={fields:[{fieldNode:c,require:!0,customErr:"Не указаны достоинства"},{fieldNode:a,require:!0,customErr:"Не указаны недостатки"},{fieldNode:d,require:!0,customErr:"Не указан комментарий"},{fieldNode:l,require:!0,customErr:"Не указано имя"},{fieldNode:s,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},m=new FormValidator(u),f=function f(){return t.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},p=function p(e){var t=$('[name="review['+e.field+']"]'),o=function o(){m._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),m._markFieldError(t,e.message),t.bind("focus",o),!1},h=function h(e){var t=$("ul.error_list",o);return t.length?t.html("<li>"+e+"</li>"):($(".bFormLogin__ePlaceTitle",o).after($('<ul class="error_list" />').append("<li>"+e+"</li>")),$(o).prepend($('<ul class="error_list" />').append("<li>"+e+"</li>"))),!1},g=function g(e){var t=null;console.warn("Обработка ошибок формы");for(var o=e.form.error.length-1;o>=0;o--)t=e.form.error[o],console.warn(t),"global"!==t.field&&null!==t.message?p(t):"global"===t.field&&null!==t.message&&h(t.message);return!1},v=function v(e){return console.log("Ответ от сервера"),e.error?(console.warn("Form has error"),g(e),!1):(e.success&&(e.notice.message&&o.before(e.notice.message),o.hide()),!1)},b=function b(){var e=function e(){return $.post(o.attr("action"),o.serializeArray(),v,"json"),console.log('Сабмит формы "Отзыв о товаре"'),!1};return $("ul.error_list",o).length&&$("ul.error_list",o).html(""),m.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:e}),!1},w=function w(e){i.removeClass(r.fill).removeClass(r.empty),i.each(function(t){e>=t+1?$(this).addClass(r.fill):$(this).addClass(r.empty)})},y=function y(){var e=$(this),t=e.index()+1;w(t)},_=function _(){var e=n.val();w(e)},k=function k(){var e=$(this),t=e.index()+1;n.val(t),w(t)},C=function C(e,t){t&&(t.name&&(l.val(t.name),l.parent(".jsPlace2Col").hide()),t.email&&(s.val(t.email),s.parent(".jsPlace2Col").hide()),t.name&&t.email&&l.parents(".jsFormFieldset").hide())};e.on("click",".jsReviewSend",f),e.on("submit",".jsReviewForm",b),e.on("userLogged",C),i.hover(y,_),i.on("unhover",_),i.on("click",k)}(),function(){var e=function(){if(!$("#productVideo").length)return!1;var e=0,t=0,o=document.location.href,i=$(".mVideo"),n=$("#productVideo .productVideo_iframe").html(),r=function(){return $("#productVideo .productVideo_iframe").append(n),$(".productVideo_iframe iframe").attr("src",$(".productVideo_iframe iframe").attr("src")+"?autoplay=1"),$("#productVideo").lightbox_me({centered:!0,onLoad:function(){e=(new Date).getTime(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Play",o])},onClose:function(){$("#productVideo .productVideo_iframe").empty(),t=(new Date).getTime();var i=t-e;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Stop",o,i])}}),!1};$("#productVideo .productVideo_iframe").empty(),i.bind("click",r)};$(document).ready(function(){$(".mVideo").length&&e()})}();