$(function(){$(".js-product-3d-html5-opener").bind("click",function(a){a.preventDefault(),$LAB.script("/maybe3dPlayer/player.min.js").wait(function(){$(".js-product-3d-html5-popup").lightbox_me({centered:!0,closeSelector:".jsPopupCloser",onLoad:function(){var a=$(".js-product-3d-html5-popup");Maybe3D.Starter.setModelPathHTML5(a.data("url")),Maybe3D.Starter.embed(a.data("id"),"js-product-3d-html5-popup-model")},onClose:function(){$("#js-product-3d-html5-popup-model").empty()}})})}),$(".js-product-3d-swf-opener").bind("click",function(a){a.preventDefault(),$LAB.script("swfobject.min.js").wait(function(){try{$("#js-product-3d-swf-popup-model").length||$(".js-product-3d-swf-popup-container").append('<div id="js-product-3d-swf-popup-model"></div>');var a="js-product-3d-swf-popup-object",b=$(".js-product-3d-swf-popup");swfobject.embedSWF(b.data("url"),"js-product-3d-swf-popup-model","700px","500px","10.0.0","js/vendor/expressInstall.swf",{language:"auto"},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",wmode:"direct"},{id:a}),b.lightbox_me({centered:!0,closeSelector:".jsPopupCloser",onClose:function(){swfobject.removeSWF(a)}})}catch(c){}})}),$(".js-product-3d-img-opener").bind("click",function(a){a.preventDefault(),$LAB.script("DAnimFramePlayer.min.js").wait(function(){var a=$(".js-product-3d-img-popup"),b=a.data("value");try{$("#js-product-3d-img-container").length||new DAnimFramePlayer(a[0]).DoLoadModel(b),a.lightbox_me({centered:!0,closeSelector:".jsPopupCloser"})}catch(c){}})})}),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.4",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),$(function(){var a=$("#jsProductCard");if(a.length&&"product_card"==$("body").data("template")){var b=a.data("value")||{},c=$.deparam((location.search||"").slice(1)),d=function(a){var c=this;"undefined"!==b.article&&(_gaq.push(["_trackEvent","YM_link",b.article]),a.preventDefault(),"undefined"!==c&&setTimeout(function(){c.click()},500))};ENTER.utils.analytics.productPageSenders.add(b.ui,c.sender),ENTER.utils.analytics.productPageSenders2.add(b.ui,c.sender2),"undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",d)});try{"out of stock"===b.stockState&&$("body").trigger("trackGoogleEvent",{action:"unavailable_product",category:$.map(b.category,function(a){return a.name}).join("_"),label:b.barcode+"_"+b.article})}catch(e){}}}),function(){var a=$(".creditbox");if(a.length>0){var b=$(document.body),c=a.find(".creditbox__sum strong");if(window.creditBox={init:function(){{var b=$("input[name=dc_buy_on_credit]").data("model");a.find("label")}$(".jsProductCreditRadio").on("change",function(){var a=$(this).val(),b=$(".js-WidgetBuy .jsBuyButton");b.length>0&&(b.attr("href",ENTER.utils.setURLParam("credit",a,b.attr("href"))),b.attr("href",ENTER.utils.setURLParam("sender2","credit",b.attr("href"))))}),"function"==typeof window.DCLoans&&window.DCLoans("4427","getPayment",{products:[{price:b.price,count:1,type:b.product_type}]},function(b){var d={payment:null};d.payment=b.allProducts,d.payment&&(c.html(printPrice(Math.ceil(d.payment))),a.show())})}},ENTER.config.userInfo&&$.isArray(ENTER.config.userInfo.cart.products)){var d=$("#jsProductCard").data("value").id;$.each(ENTER.config.userInfo.cart.products,function(a,b){b.isCredit&&b.id==d&&$("#creditinput").attr("checked",!0).trigger("change")})}b.on("click",".jsProductCreditRadio",function(){b.trigger("trackGoogleEvent",["Credit","Выбор опции","Карточка товара"])}),creditBox.init()}else{var e=$(".bProductDesc");e.length&&!e.hasClass("mNoCredit")&&e.addClass("mNoCredit")}}(),function(){$(".js-show-shops").on("click",function(){var a=$(".shopsPopup"),b=$(".shopsPopup .jsBuyButton");a.lightbox_me({centered:!0,autofocus:!0}),b.on("click",function(){a.trigger("close")})})}(),function(){var a=function(){var a=$(".js-photoslider"),b=a.find(".js-photoslider-gal"),c=a.find(".js-photoslider-btn-prev"),d=a.find(".js-photoslider-btn-next"),e=b.find(".js-photoslider-gal-i");if(!e.length)return!1;var f=e.width()+parseInt(e.css("marginLeft"),10)+parseInt(e.css("marginRight"),10),g=0;b.css({width:e.length*f,left:g});var h=function(){g>0?c.show():c.hide(),g<b.width()-a.width()?d.show():d.hide()},i=function(){return g-=f,b.animate({left:-g}),h(),!1},j=function(){return g+=f,b.animate({left:-g}),h(),!1};h(),c.bind("click",i),d.bind("click",j)};$(document).ready(function(){$(".js-photoslider").length&&a()})}(),function(){var a=function(){var a=$(".bHint_ePopup"),b=$(".bHint_eLink"),c=$(".bHint_ePopup .close"),d=function(){return a.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150),!1},e=function(){return a.fadeOut(150),!1};b.bind("click",d),c.bind("click",e)};$(document).ready(function(){$(".bHint").length&&a()})}(),$(function(){function a(a){a.preventDefault(),f||(e.after($(Mustache.render($("#tpl-lowPriceNotifier-popup").html(),{price:j.price,userOfficeUrl:j.userOfficeUrl,actionChannelName:j.actionChannelName,isSubscribedToActionChannel:ENTER.config.userInfo.user.isSubscribedToActionChannel,showUserEmailNotify:ENTER.config.userInfo.user.isLogined&&!ENTER.config.userInfo.user.email,userEmail:ENTER.config.userInfo.user.email}))),f=$(".js-lowPriceNotifier-popup"),g=$(".js-lowPriceNotifier-popup-email"),h=$(".js-lowPriceNotifier-popup-error"),i=$(".js-lowPriceNotifier-popup-subscribe"),$(".js-lowPriceNotifier-popup-submit").on("click",c),f.find(".js-lowPriceNotifier-popup-close").on("click",function(a){a.preventDefault(),b()})),f.fadeIn(300)}function b(){f.fadeOut(300)}function c(a){a.preventDefault(),$.get(j.submitUrl+(-1==j.submitUrl.indexOf("?")?"?":"&")+"email="+encodeURIComponent(g.val())+"&subscribe="+(d()?1:0),function(a){return a.success?(i[0]&&i[0].checked&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","subscription","subscribe_price_alert",g.val()]),b(),f.remove(),void e.remove()):(g.addClass("red"),a.error.message&&h.show().html(a.error.message),!1)})}function d(){return i.length&&i.is(":checked")?!0:!1}var e=$(".js-lowPriceNotifier-opener");if(e.length){var f,g,h,i,j=$(".js-lowPriceNotifier").data("values");e.on("click",a)}}),+function(a){var b=a(document.body),c=b.find(".jsProductImgPopup"),d=b.find(".jsProductPopupBigPhoto"),e=a(".jsProductPopupBigPhotoHolder"),f=a(".jsPopupPhotoThumb"),g=a(".jsProductThumbList"),h=a(".jsProductThumbBtn"),i=a(".jsProductPopupZoom"),j=g.width(),k=(g.get(0)?g.get(0).scrollWidth:0,a(".jsPopupThumbList")),l=0,m=a(".jsPopupThumbBtn"),n=0,o="product-card-photo-thumbs__i--act",p="product-card-photo-thumbs__btn--disabled",q=f.length,r={centered:!0,closeSelector:".jsPopupCloser",preventScroll:!0,closeClick:!0},s=function(){var a,b,c,f;return a=new Image,a.src=d.attr("src"),b=a.width,c=a.height,f=b<e.width()&&c<e.height(),f&&i.addClass("disabled"),!f},t=function(a){var b,c,f,g=d.data("zoom");if("undefined"==typeof g){if(0>a)return;d.data("zoom",a)}else{if(0==g&&0>a)return;d.data("zoom",g+a)}if(b=new Image,b.src=d.attr("src"),f=b.width,c=b.height,a>0&&(f>e.width()||c>e.height())){d.removeClass("fixed").css({"max-height":c,"max-width":f});var h,i,j=e.offset(),k=e.height(),l=e.width(),m=d.width(),n=d.height(),o=j.left,p=j.top;h=m>l?l-m+o:0,i=n>k?k-n+p:0,d.draggable({containment:[h,i,o,p],scroll:!1})}0>a&&u()},u=function(){d.addClass("fixed"),d.css({"max-height":"100%","max-width":"100%",top:0,left:0}),d.data("zoom",0),i.removeClass("disabled"),a(".jsProductPopupZoomOut").addClass("disabled"),d.hasClass("ui-draggable")&&d.draggable("destroy")},v=function(a){f.removeClass(o).eq(a).addClass(o),d.attr("src",f.eq(a).data("big-img")).css({"max-height":"100%","max-width":"100%",top:0,left:0}),u()};b.on("click",".jsOpenProductImgPopup",function(){var b=a("."+o);c.find(".jsProductPopupBigPhoto").attr("src",b.data("big-img")),f.removeClass(o).eq(b.index()).addClass(o),c.enterLightboxMe({centered:!1,closeSelector:".jsPopupCloser",modalCSS:{top:"0",left:"0"},closeClick:!0,preventScroll:!0,onLoad:function(){s(),l=k.width(),n=k.get(0)?k.get(0).scrollWidth:0},onClose:function(){u()}}),a(window).on("resize",function(){u()})}),b.find(".jsProductPhotoThumb").on("click",function(){var c=a(this);c.siblings().removeClass("product-card-photo-thumbs__i--act"),c.addClass("product-card-photo-thumbs__i--act"),b.find(".jsProductMiddlePhoto").attr("src",c.data("middle-img"))}),b.on("click",".jsProductPopupZoom",function(){var b=a(this),c=parseInt(a(this).data("dir"),10);s()&&(i.removeClass("disabled"),b.addClass("disabled"),t(c))}),b.on("click",".jsProductPopupSlide",function(){var b=a(this).data("dir"),d=f.index(c.find("."+o)),e=c.find(".product-card-photo-thumbs__cnt--slides").length;if(v(d+b==q?0:d+b),e){var g=c.find("."+o).position().left,h=parseInt(k.css("margin-left")),i=c.find(".product-card-photo-thumbs__i").length-1;if(g>h&&!(0==h&&l>g)||d==i){var j=1==Math.sign(g)?"-=":"+=";k.is(":animated")||k.animate({"margin-left":j+l},function(){var a=parseInt(k.css("margin-left"));m.removeClass(p),l>=n+a&&m.eq(1).addClass(p),a>=0&&m.eq(0).addClass(p)})}}}),f.on("click",function(){v(f.index(a(this)))}),h.on("click",function(){var b=47*f.length;if(!g.is(":animated")){var c=a(this).data("dir")+j,d=c.split("="),e=parseInt(g.css("margin-left"))+parseInt(d[0]+d[1]);h.addClass(p),-e>=b-j?h.eq(0).removeClass(p):e>=0?h.eq(1).removeClass(p):h.removeClass(p),g.animate({"margin-left":c})}}),m.on("click",function(){k.is(":animated")||k.animate({"margin-left":a(this).data("dir")+l},function(){var a=parseInt(k.css("margin-left"));m.removeClass(p),l>=n+a&&m.eq(1).addClass(p),a>=0&&m.eq(0).addClass(p)})}),b.on("click",".jsProductMediaButton li",function(b){var c=a(b.target).next(),d=c.find("iframe"),e=d.data("src"),f=c.find(".jsProduct3DContainer"),g=c.find(".jsProduct3DJSON");e&&d.attr("src",e),0==f.length&&0==g.length?c.lightbox_me(a.extend(r,{destroyOnClose:!0,onClose:function(){d.removeAttr("src"),a(b.target).parent().append(c.clone().hide())}})):"swf"==f.data("type")?$LAB.script("swfobject.min.js").wait(function(){var d="js-product-3d-swf-popup-object";swfobject.embedSWF(f.data("url"),"js-product-3d-swf-popup-model","700px","500px","10.0.0","js/vendor/expressInstall.swf",{language:"auto"},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",wmode:"direct"},{id:d}),c.lightbox_me(a.extend(r,{onClose:function(){a(b.target).parent().append(c.clone().hide())}}))}):g.length>0&&$LAB.script("DAnimFramePlayer.min.js").wait(function(){var d=g.data("value");try{a("#js-product-3d-img-container").length||new DAnimFramePlayer(g[0]).DoLoadModel(d),c.lightbox_me(a.extend(r,{onClose:function(){a(b.target).parent().append(c.clone().hide())}}))}catch(e){}})})}(jQuery),function(a){var b,c=a(window),d=a(document.body),e=d.find(".jsProductCreditButton"),f=a(".jsReviewFormRating"),g=a(".js-topbar-fixed"),h=a(".jsProductTabs"),i=a(".js-pp-ep-fishka"),j={centered:!0,closeSelector:".jsPopupCloser",closeClick:!0};d.hasClass("product-card-new")&&(b=h.offset().top,e.length>0&&"function"==typeof window.DCLoans&&(window.DCLoans("4427","getPayment",{products:[{price:e.data("credit").price,count:1,type:e.data("credit").product_type}]},function(a){var b={payment:null};b.payment=a.allProducts,b.payment&&(e.find(".jsProductCreditPrice").text(printPrice(Math.ceil(b.payment))),e.show())}),e.on("click",function(b){var c=a(a(this).data("target"));c.length&&(c.first().trigger("click",["on"]),b.preventDefault())})),function(){function b(){var b=a(".jsReviewForm2"),c=ENTER.config.userInfo.user;c.name&&a("[name=review\\[author_name\\]]").val(c.name.slice(0,19)),c.email&&a("[name=review\\[author_email\\]]").val(c.email),b.lightbox_me(a.extend(j,{onLoad:function(){},onClose:function(){b.find(".form-ctrl__textarea--err, .form-ctrl__input--err").removeClass("form-ctrl__textarea--err form-ctrl__input--err")}}))}d.on("click",".jsReviewAdd",function(){b()}),"#add-review"==location.hash&&b()}(),d.on("click",".jsShowMoreReviews",function(){var b,c=a(this).data("ui"),d=a(this).data("total-num"),e=a(".jsReviewItem:hidden");e.length>0?(e.show(),a(".jsReviewItem").length==d&&a(".jsShowMoreReviews").hide()):(b=a(".jsReviewItem").length,a.ajax("/product-reviews/"+c,{data:{page:b/10,numOnPage:10}}).done(function(b){b.content&&(a(".jsReviewsList").append(b.content),a(".jsReviewItem").length==d&&a(".jsShowMoreReviews").hide())}))}),h.length&&c.on("scroll",function(){var a="pp-fixed";c.scrollTop()-100>b?(h.addClass(a),i.addClass("fadeIn"),g.addClass(a)):(h.removeClass(a),i.removeClass("fadeIn"),g.removeClass(a))}),d.scrollspy({target:"#jsScrollSpy",offset:120}),d.on("click",".jsProductTabs a",function(b){var c=a(this).attr("href");b.preventDefault(),window.location.hash=c,window.scrollTo(0,a(c).offset().top-105)}),d.on("click",".jsOneClickButton",function(){a(".jsProductPointsMap").trigger("close")}),d.on("click",".jsShowDeliveryMap",function(){var b=a(this).data("product-id"),c=a(this).data("product-ui"),e=a(".jsProductPointsMap");if(0!=a(".jsDeliveryPickupAvailable").length)return e.find(".jsDeliveryMapPoints").length>0?void e.lightbox_me({centered:!0,preventScroll:!0}):void(e.data("xhr")||a.ajax("/ajax/product/map/"+b+"/"+c,{dataType:"json",beforeSend:function(){e.data("xhr",!0),e.lightbox_me({centered:!0,preventScroll:!0})}}).always(function(){e.data("xhr",!1)}).done(function(b){if(b.success){var c,f,g=a(b.html),h=a.parseJSON(g.find(".jsMapData").html()),i=g.find(".js-order-map").first().attr("id");e.html(b.html),d.on("click",".jsCloseFl",function(){e.trigger("close")}),h&&(c=new ymaps.Map(i,{center:[h.latitude,h.longitude],zoom:h.zoom,controls:["zoomControl","fullscreenControl","geolocationControl","typeSelector"]},{autoFitToViewport:"always",suppressMapOpenBlock:!0}),c.controls.remove("searchControl"),c.geoObjects.removeAll(),c.container.fitToViewport(),f=new ENTER.DeliveryPoints(h.points,c),c.events.add("boundschange",function(a){var b;a.get("newBounds")&&(b=a.get("target").getBounds(),f.latitudeMin(b[0][0]),f.latitudeMax(b[1][0]),f.longitudeMin(b[0][1]),f.longitudeMax(b[1][1]))}),a.each(h.points,function(a,b){try{c.geoObjects.add(new ENTER.Placemark(b,!0,"jsOneClickButton"))}catch(d){}}),1===c.geoObjects.getLength()?(c.setCenter(c.geoObjects.get(0).geometry.getCoordinates(),15),c.geoObjects.get(0).options.set("visible",!0)):(c.setBounds(c.geoObjects.getBounds()),c.events.once("boundschange",function(a){a.get("oldZoom")<a.get("newZoom")&&c.geoObjects.each(function(a){a.options.set("visible",!0)})})),ko.applyBindings(f,e[0]),d.on("click",".jsOrderV3Dropbox",function(){a(this).siblings().removeClass("opn").find(".jsOrderV3DropboxInner").hide(),a(this).find(".jsOrderV3DropboxInner").toggle(),a(this).hasClass("opn")?a(this).removeClass("opn"):a(this).addClass("opn")}))}else;}))}),a(".js-slider-2").goodsSlider({leftArrowSelector:".goods-slider__btn--prev",rightArrowSelector:".goods-slider__btn--next",sliderWrapperSelector:".goods-slider__inn",sliderSelector:".goods-slider-list",itemSelector:".goods-slider-list__i",categoryItemSelector:".js-product-accessoires-category",onLoad:function(b){ko.applyBindings(ENTER.UserModel,b),"ProductSimilar"==a(b).data("position")&&a(".jsSimilarTab").show()}}),f.on("click",function(){var b="popup-rating__i--fill",c=a(this).index();f.removeClass(b),a(this).addClass(b).prevAll().addClass(b),a("#reviewFormRating").val(++c)}),a("#reviewForm").on("submit",function(b){var c=a(this),d="form-ctrl__textarea--err",e="form-ctrl__input--err",f="form-ctrl__textarea-lbl--err";b.preventDefault(),a.ajax({type:"post",url:a(this).attr("action"),data:a(this).serializeArray(),dataType:"json",success:function(b){if(b.error)a.each(b.form.error,function(a,b){var g=c.find('[name="review['+b.field+']"]');g.removeClass(d).removeClass(e),b.message?(g.is("textarea")&&(g.addClass(d),g.siblings("."+f).show()),g.is("input")&&g.addClass(e)):g.siblings("."+f).hide()});else if(b.success){var g=a(".jsReviewSuccessAdd");a(".jsReviewFormInner").hide(),a(".jsReviewForm2").animate({height:g.height()}),g.fadeIn()}},complete:function(a){}})}),d.on("click",".jsReviewVote",function(b){var c=a(b.target),d=c.data("vote"),e=a(this),f=e.data("user-vote"),g=e.closest(".jsReviewItem").data("review-ui"),h=e.find(".jsReviewVoteBtn"),i="active",j="voting";e.data("xhr")||a.ajax("/product-reviews/vote",{type:"post",data:{"review-ui":g,vote:f==d?0:d},beforeSend:function(){c.addClass(j),e.data("xhr",!0)},success:function(a){a.success&&(e.data("user-vote",a.vote),e.find(".jsReviewVoteBtn").removeClass(i),0!=a.vote&&h.eq(1==a.vote?0:1).addClass(i),"undefined"!=typeof a.positive&&h.eq(0).text(a.positive),"undefined"!=typeof a.negative&&h.eq(1).text(a.negative))}}).always(function(){c.removeClass(j),e.data("xhr",!1)})}),a(".jsProductPartnerOffer").on("click",function(b){b.preventDefault();var c=a(this).attr("href"),d=a(".jsProductPartnerOfferDiv");c&&(c=c.replace(/^http:\/\/.*?\//,"/"),0==d.length?a.get(ENTER.utils.setURLParam("ajax",1,c)).done(function(b){a('<div class="jsProductPartnerOfferDiv partner-offer-popup"></div>').append(a('<i class="closer jsPopupCloser">×</i>'),a('<div class="inn" />').append(a("<h1 />").text(b.title||""),a("<article />").html(b.content||""))).lightbox_me(j)}):d.lightbox_me(j))}),d.on("click",".jsImageInLightBox",function(b){b.preventDefault();var c=a(this).data("href");a('<div class="popup popup--normal"><div class="closer jsPopupCloser">×</div> </div>').append(a("<img />",{src:c})).lightbox_me({destroyOnClose:!0,closeSelector:".jsPopupCloser",centered:!0})}),d.on("click",".jsProductImgPopup .jsBuyButton",function(){a(this).closest(".jsProductImgPopup").trigger("close")}),a(".js-description-expand").on("click",function(){a(this).removeClass("collapsed js-description-expand")}),d.on("click",".jsProductCardNewLabelInfo",function(){a(".jsProductCardNewLabelPopup").toggleClass("info-popup--open")}),d.on("click",".jsSubscribeAfterReview",function(){a(".js-registerForm-subscribe").is(":checked")&&a.ajax({type:"POST",url:"/subscribe/create",data:{channel:1,email:a("#reviewFormEmail").val()},success:function(b){b.success?a(".jsReviewSuccessJustSubscribed").lightbox_me(j):(a(".jsReviewSuccessSubscribed").lightbox_me(j),910!=b.code&&a(".jsReviewSuccessSubscribed .popup-form-success__txt").text(b.error))}})}))}(jQuery),!function(){var a,b=$(".js-countdown"),c=$(".js-countdown-out"),d=b.attr("data-expires"),e=function(a){var b=a+"",c=b.slice(-1),d=1*c;return 0===d?"дней":a>4&&21>a?"дней":d>4&&a>20?"дней":d>1&&5>d?"дня":"день"},f=function(a){var b=a.days>0?"D "+e(a.days)+" HH:MM:SS":"HH:MM:SS";b=b.replace(/(D+)/,function(b,c){return c.length>1&&a.days<10?"0"+a.days:a.days}),b=b.replace(/(H+)/,function(b,c){return c.length>1&&a.hours<10?"0"+a.hours:a.hours}),b=b.replace(/(M+)/,function(b,c){return c.length>1&&a.minutes<10?"0"+a.minutes:a.minutes}),b=b.replace(/(S+)/,function(b,c){return c.length>1&&a.seconds<10?"0"+a.seconds:a.seconds}),c.html(b)};try{a=new CountDown({timestamp:1e3*d,tick:f})}catch(g){}}(),$(document).ready(function(){var a=$("#productDescriptionToggle");!function(){var a="prod-photoslider__gal__link--active",b=$(".js-photo-zoomedImg");if(b.length){var c={$imageContainer:$(".js-product-bigImg"),zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:b.data("is-slot")?344:519,borderSize:1,borderColour:"#C7C7C7"};b.data("zoom-image")&&b.elevateZoom(c),$(".jsPhotoGalleryLink").on("click",function(d){d.preventDefault();var e=$(d.currentTarget);e.hasClass(a)||($(".jsPhotoGalleryLink").removeClass(a),e.addClass(a),b.data("elevateZoom")&&b.data("elevateZoom").destroy(),e.data("zoom-image")&&(b.data("zoom-image",e.data("zoom-image")),b.one("load",function(){b.elevateZoom(c)})),b.attr("src",e.data("image")))})}}(),$(".bCountSection").goodsCounter({onChange:function(a){var b=this.attr("data-spinner-for"),c=$("."+b),d=c.attr("href")||"";c.attr("href",d.addParameterToUrl("quantity",a))}}),$(".js-slider").goodsSlider({onLoad:function(a){ko.applyBindings(ENTER.UserModel,a)}}),$(".bDescSelectItem").customDropDown({changeHandler:function(a){document.location.href=a.data("url")}}),a.length&&a.toggle(function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")});try{var b=ENTER.config.pageConfig.product?ENTER.config.pageConfig.product.id:null,c=docCookies.getItem("product_viewed")||"",d=[];b&&(d=c?ENTER.utils.arrayUnique(c.split(",")):[],d.push(b),docCookies.setItem("product_viewed",d.slice(-20).join(","),604800,"/"))}catch(e){}}),function(){var a=$(window),b=$(document.body),c=$(".js-reviews-wrapper"),d=$(".js-reviews-list"),e=$(".js-reviews-getMore"),f=0,g=c.attr("data-page-count"),h=c.attr("data-product-ui"),i=c.data("avg-score"),j=c.data("first-page-avg-score"),k=c.data("category-name");c.length&&(e.click(function(){$.ajax({type:"GET",url:ENTER.utils.generateUrl("product.reviews.get",{productUi:h}),data:{page:f+1},success:function(a){d.html(d.html()+a.content),f++,g=a.pageCount,f+1>=g?e.hide():e.show()}})}),function(){function d(){var f=a.height();a.scrollTop()+f>c.offset().top?e||(e=setTimeout(function(){a.unbind("scroll",d),b.trigger("trackGoogleEvent",{category:"Items_review",action:"All_"+i+"_Top_"+j,label:k}),ENTER.utils.analytics.reviews.add(h,i,j,k)},2e3)):e&&(clearTimeout(e),e=null)}var e;a.scroll(d),d()}())}(),function(){var a=$("body"),b=$(".jsReviewPopup"),c=b.find(".jsReviewForm"),d=$(".jsFormSubmit"),e=d.val(),f=c.find(".stars-list__item"),g=c.find(".jsReviewStarsCount"),h={fill:"star-fill",empty:"star-empty"},i=$(".jsAdvantage"),j=$(".jsDisadvantage"),k=$(".jsExtract"),l=$(".jsAuthorName"),m=$(".jsAuthorEmail"),n={fields:[{fieldNode:i,require:!0,customErr:"Не указаны достоинства"},{fieldNode:j,require:!0,customErr:"Не указаны недостатки"},{fieldNode:k,require:!0,customErr:"Не указан комментарий"},{fieldNode:l,require:!0,customErr:"Не указано имя"},{fieldNode:m,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},o=new FormValidator(n),p=function(){return b.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},q=function(a){var b=$('[name="review['+a.field+']"]'),c=function(){o._unmarkFieldError($(this))};return o._markFieldError(b,a.message),b.bind("focus",c),!1},r=function(a){var b=$("ul.error_list",c);return b.length?b.html("<li>"+a+"</li>"):($(".bFormLogin__ePlaceTitle",c).after($('<ul class="error_list" />').append("<li>"+a+"</li>")),$(c).prepend($('<ul class="error_list" />').append("<li>"+a+"</li>"))),!1},s=function(a){for(var b=null,c=a.form.error.length-1;c>=0;c--)b=a.form.error[c],"global"!==b.field&&null!==b.message?q(b):"global"===b.field&&null!==b.message&&r(b.message);return!1},t=function(a){return a.error?(s(a),!1):(a.success&&(a.notice.message&&c.before(a.notice.message),c.hide()),!1)},u=function(){function a(){c.data("disabled",!1),d.removeAttr("disabled"),d.removeClass("mDisabled"),d.val(e)}return c.data("disabled")?!1:(c.data("disabled",!0),d.attr("disabled","disabled"),d.addClass("mDisabled"),d.val("Сохраняю…"),$("ul.error_list",c).length&&$("ul.error_list",c).html(""),o.validate({onInvalid:function(b){a()},onValid:function(){return $.ajax({type:"post",url:c.attr("action"),data:c.serializeArray(),dataType:"json",success:t,complete:function(){a()}}),!1}}),!1)},v=function(a){f.removeClass(h.fill).removeClass(h.empty),f.each(function(b){$(this).addClass(a>=b+1?h.fill:h.empty)})},w=function(){var a=$(this),b=a.index()+1;v(b)},x=function(){var a=g.val();v(a)},y=function(){var a=$(this),b=a.index()+1;g.val(b),v(b)},z=function(a){a&&(a.name&&(l.val(a.name),l.parent(".jsPlace2Col").hide()),a.email&&(m.val(a.email),m.parent(".jsPlace2Col").hide()),a.name&&a.email&&l.parents(".jsFormFieldset").hide())};a.on("click",".jsReviewSend",p),a.on("submit",".jsReviewForm",u),z(ENTER.config.userInfo.user),f.hover(w,x),f.on("unhover",x),f.on("click",y),"#add-review"==location.hash&&p()}(),$(function(){$(".js-product-similarProducts-link").on("click",function(){$("body").trigger("trackGoogleEvent",{category:"RR_взаимодействие",action:"Перешел на карточку товара",label:"SEO"})})}),$(function(){var a=$(".js-product-video");if(a.length&&$(".js-product-video-container").length){var b=0,c=0,d=(document.location.href,$(".js-product-video-iframeContainer")),e=d.html();d.empty(),a.bind("click",function(){var a=$(".js-product-video-iframeContainer");a.append(e);var d=$("iframe",a);return d.attr("src",d.data("src")),$(".js-product-video-container").lightbox_me({centered:!0,closeSelector:".jsPopupCloser",onLoad:function(){b=(new Date).getTime()},onClose:function(){$(".js-product-video-iframeContainer").empty(),c=(new Date).getTime()}}),!1})}});