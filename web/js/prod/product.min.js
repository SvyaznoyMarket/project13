$(function(){$(".js-product-3d-html5-opener").bind("click",function(a){a.preventDefault(),$LAB.script("/maybe3dPlayer/player.min.js").wait(function(){$(".js-product-3d-html5-popup").lightbox_me({centered:!0,closeSelector:".close",onLoad:function(){var a=$(".js-product-3d-html5-popup");Maybe3D.Starter.setModelPathHTML5(a.data("url")),Maybe3D.Starter.embed(a.data("id"),"js-product-3d-html5-popup-model")},onClose:function(){$("#js-product-3d-html5-popup-model").empty()}})})}),$(".js-product-3d-swf-opener").bind("click",function(a){a.preventDefault(),$LAB.script("swfobject.min.js").wait(function(){try{$("#js-product-3d-swf-popup-model").length||$(".js-product-3d-swf-popup-container").append('<div id="js-product-3d-swf-popup-model"></div>');var a="js-product-3d-swf-popup-object",b=$(".js-product-3d-swf-popup");swfobject.embedSWF(b.data("url"),"js-product-3d-swf-popup-model","700px","500px","10.0.0","js/vendor/expressInstall.swf",{language:"auto"},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",wmode:"direct"},{id:a}),b.lightbox_me({centered:!0,closeSelector:".close",onClose:function(){swfobject.removeSWF(a)}})}catch(c){}})}),$(".js-product-3d-img-opener").bind("click",function(a){a.preventDefault(),$LAB.script("DAnimFramePlayer.min.js").wait(function(){var a=$(".js-product-3d-img-popup"),b=a.data("value"),c=a.data("host");try{$("#js-product-3d-img-container").length||new DAnimFramePlayer(a[0],c).DoLoadModel(b),a.lightbox_me({centered:!0,closeSelector:".close"})}catch(d){}})})}),$(function(){var a=$("#jsProductCard");if(a.length&&"product_card"==$("body").data("template")){var b=a.data("value")||{},c=$.deparam((location.search||"").slice(1)),d=function(a){var c=this;"undefined"!==b.article&&(_gaq.push(["_trackEvent","YM_link",b.article]),a.preventDefault(),"undefined"!==c&&setTimeout(function(){c.click()},500))};ENTER.utils.analytics.productPageSenders.add(b.ui,c.sender),ENTER.utils.analytics.productPageSenders2.add(b.ui,c.sender2),"undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",d)})}}),function(){var a=$(".creditbox");if(a.length>0){var b=$(document.body),c=a.find(".creditbox__sum strong");if(window.creditBox={init:function(){{var b=$("input[name=dc_buy_on_credit]").data("model");a.find("label")}$(".jsProductCreditRadio").on("change",function(){var a=$(this).val(),b=$(".js-WidgetBuy .jsBuyButton");b.length>0&&(b.attr("href",ENTER.utils.setURLParam("credit",a,b.attr("href"))),b.attr("href",ENTER.utils.setURLParam("sender2","credit",b.attr("href"))))}),"function"==typeof window.dc_getCreditForTheProduct&&dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:b.price,count:1,type:b.product_type},function(b){!1 in b||b.payment>0&&(c.html(printPrice(Math.ceil(b.payment))),a.show())})}},ENTER.config.userInfo&&$.isArray(ENTER.config.userInfo.cartProducts)){var d=$("#jsProductCard").data("value").id;$.each(ENTER.config.userInfo.cartProducts,function(a,b){b.isCredit&&b.id==d&&$("#creditinput").attr("checked",!0).trigger("change")})}b.on("click",".jsProductCreditRadio",function(){b.trigger("trackGoogleEvent",["Credit","Выбор опции","Карточка товара"])}),creditBox.init()}else{var e=$(".bProductDesc");e.length&&!e.hasClass("mNoCredit")&&e.addClass("mNoCredit")}}(),function(){$(".js-show-shops").on("click",function(){var a=$(".shopsPopup"),b=$(".shopsPopup .jsBuyButton");a.lightbox_me({centered:!0,autofocus:!0}),b.on("click",function(){a.trigger("close")})})}(),function(){var a=function(){var a=$(".js-photoslider"),b=a.find(".js-photoslider-gal"),c=a.find(".js-photoslider-btn-prev"),d=a.find(".js-photoslider-btn-next"),e=b.find(".js-photoslider-gal-i");if(!e.length)return!1;var f=e.width()+parseInt(e.css("marginLeft"),10)+parseInt(e.css("marginRight"),10),g=0;b.css({width:e.length*f,left:g});var h=function(){g>0?c.show():c.hide(),g<b.width()-a.width()?d.show():d.hide()},i=function(){return g-=f,b.animate({left:-g}),h(),!1},j=function(){return g+=f,b.animate({left:-g}),h(),!1};h(),c.bind("click",i),d.bind("click",j)};$(document).ready(function(){$(".js-photoslider").length&&a()})}(),function(){var a=function(){var a=$(".bHint_ePopup"),b=$(".bHint_eLink"),c=$(".bHint_ePopup .close"),d=function(){return a.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150),!1},e=function(){return a.fadeOut(150),!1};b.bind("click",d),c.bind("click",e)};$(document).ready(function(){$(".bHint").length&&a()})}(),$(function(){function a(a){a.preventDefault(),f||(e.after($(Mustache.render($("#tpl-lowPriceNotifier-popup").html(),{price:j.price,userOfficeUrl:j.userOfficeUrl,actionChannelName:j.actionChannelName,isSubscribedToActionChannel:ENTER.config.userInfo.user.isSubscribedToActionChannel,showUserEmailNotify:ENTER.config.userInfo.user.isLogined&&!ENTER.config.userInfo.user.email,userEmail:ENTER.config.userInfo.user.email}))),f=$(".js-lowPriceNotifier-popup"),g=$(".js-lowPriceNotifier-popup-email"),h=$(".js-lowPriceNotifier-popup-error"),i=$(".js-lowPriceNotifier-popup-subscribe"),$(".js-lowPriceNotifier-popup-submit").on("click",c),f.find(".js-lowPriceNotifier-popup-close").on("click",function(a){a.preventDefault(),b()})),f.fadeIn(300)}function b(){f.fadeOut(300)}function c(a){a.preventDefault(),$.get(j.submitUrl+(-1==j.submitUrl.indexOf("?")?"?":"&")+"email="+encodeURIComponent(g.val())+"&subscribe="+(d()?1:0),function(a){return a.success?(i[0]&&i[0].checked&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","subscription","subscribe_price_alert",g.val()]),b(),f.remove(),void e.remove()):(g.addClass("red"),a.error.message&&h.show().html(a.error.message),!1)})}function d(){return i.length&&i.is(":checked")?!0:!1}var e=$(".js-lowPriceNotifier-opener");if(e.length){var f,g,h,i,j=$(".js-lowPriceNotifier").data("values");e.on("click",a)}}),$(document).ready(function(){!function(){var a="prod-photoslider__gal__link--active",b=$(".js-photo-zoomedImg");if(b.length){var c={$imageContainer:$(".js-product-bigImg"),zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:b.data("is-slot")?344:519,borderSize:1,borderColour:"#C7C7C7"};b.data("zoom-image")&&b.elevateZoom(c),$(".jsPhotoGalleryLink").on("click",function(d){d.preventDefault();var e=$(d.currentTarget);e.hasClass(a)||($(".jsPhotoGalleryLink").removeClass(a),e.addClass(a),b.data("elevateZoom")&&b.data("elevateZoom").destroy(),e.data("zoom-image")&&(b.data("zoom-image",e.data("zoom-image")),b.one("load",function(){b.elevateZoom(c)})),b.attr("src",e.data("image")))})}}(),$(".bCountSection").goodsCounter({onChange:function(a){var b=this.attr("data-spinner-for"),c=$("."+b),d=$("."+b+"-oneClick");newHref=c.attr("href")||"",c.attr("href",newHref.addParameterToUrl("quantity",a)),d.data("quantity",a)}}),$(".js-slider").goodsSlider({onLoad:function(a){ko.applyBindings(ENTER.UserModel,a)}}),$(".bDescSelectItem").customDropDown({changeHandler:function(a){var b=a.data("url");document.location.href=b}}),$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")});try{var a=ENTER.config.pageConfig.product?ENTER.config.pageConfig.product.id:null,b=docCookies.getItem("product_viewed")||"",c=[];a&&(c=b?ENTER.utils.arrayUnique(b.split(",")):[],c.push(a),docCookies.setItem("product_viewed",c.slice(-20).join(","),604800,"/"))}catch(d){}}),function(){var a=$(window),b=$(document.body),c=$(".js-reviews-wrapper"),d=$(".js-reviews-list"),e=$(".js-reviews-getMore"),f=0,g=c.attr("data-page-count"),h=c.attr("data-product-ui"),i=c.data("avg-score"),j=c.data("first-page-avg-score"),k=c.data("category-name");c.length&&(e.click(function(){$.ajax({type:"GET",url:ENTER.utils.generateUrl("product.reviews.get",{productUi:h}),data:{page:f+1},success:function(a){d.html(d.html()+a.content),f++,g=a.pageCount,f+1>=g?e.hide():e.show()}})}),function(){function d(){var f=a.height();a.scrollTop()+f>c.offset().top?e||(e=setTimeout(function(){a.unbind("scroll",d),b.trigger("trackGoogleEvent",{category:"Items_review",action:"All_"+i+"_Top_"+j,label:k}),ENTER.utils.analytics.reviews.add(h,i,j,k)},2e3)):e&&(clearTimeout(e),e=null)}var e;a.scroll(d),d()}())}(),function(){var a=$("body"),b=$(".jsReviewPopup"),c=b.find(".jsReviewForm"),d=$(".jsFormSubmit"),e=d.val(),f=c.find(".stars-list__item"),g=c.find(".jsReviewStarsCount"),h={fill:"star-fill",empty:"star-empty"},i=$(".jsAdvantage"),j=$(".jsDisadvantage"),k=$(".jsExtract"),l=$(".jsAuthorName"),m=$(".jsAuthorEmail"),n={fields:[{fieldNode:i,require:!0,customErr:"Не указаны достоинства"},{fieldNode:j,require:!0,customErr:"Не указаны недостатки"},{fieldNode:k,require:!0,customErr:"Не указан комментарий"},{fieldNode:l,require:!0,customErr:"Не указано имя"},{fieldNode:m,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},o=new FormValidator(n),p=function(){return b.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},q=function(a){var b=$('[name="review['+a.field+']"]'),c=function(){o._unmarkFieldError($(this))};return o._markFieldError(b,a.message),b.bind("focus",c),!1},r=function(a){var b=$("ul.error_list",c);return b.length?b.html("<li>"+a+"</li>"):($(".bFormLogin__ePlaceTitle",c).after($('<ul class="error_list" />').append("<li>"+a+"</li>")),$(c).prepend($('<ul class="error_list" />').append("<li>"+a+"</li>"))),!1},s=function(a){for(var b=null,c=a.form.error.length-1;c>=0;c--)b=a.form.error[c],"global"!==b.field&&null!==b.message?q(b):"global"===b.field&&null!==b.message&&r(b.message);return!1},t=function(a){return a.error?(s(a),!1):(a.success&&(a.notice.message&&c.before(a.notice.message),c.hide()),!1)},u=function(){function a(){c.data("disabled",!1),d.removeAttr("disabled"),d.removeClass("mDisabled"),d.val(e)}return c.data("disabled")?!1:(c.data("disabled",!0),d.attr("disabled","disabled"),d.addClass("mDisabled"),d.val("Сохраняю…"),$("ul.error_list",c).length&&$("ul.error_list",c).html(""),o.validate({onInvalid:function(b){a()},onValid:function(){return $.ajax({type:"post",url:c.attr("action"),data:c.serializeArray(),dataType:"json",success:t,complete:function(){a()}}),!1}}),!1)},v=function(a){f.removeClass(h.fill).removeClass(h.empty),f.each(function(b){$(this).addClass(a>=b+1?h.fill:h.empty)})},w=function(){var a=$(this),b=a.index()+1;v(b)},x=function(){var a=g.val();v(a)},y=function(){var a=$(this),b=a.index()+1;g.val(b),v(b)},z=function(a){a&&(a.name&&(l.val(a.name),l.parent(".jsPlace2Col").hide()),a.email&&(m.val(a.email),m.parent(".jsPlace2Col").hide()),a.name&&a.email&&l.parents(".jsFormFieldset").hide())};a.on("click",".jsReviewSend",p),a.on("submit",".jsReviewForm",u),z(ENTER.config.userInfo.user),f.hover(w,x),f.on("unhover",x),f.on("click",y),"#add-review"==location.hash&&p()}(),$(function(){var a=$("body");$(".js-product-similarProducts-link").on("click",function(b){try{a.trigger("trackGoogleEvent",{category:"RR_взаимодействие",action:"Перешел на карточку товара",label:"SEO",hitCallback:$(this).attr("href")}),b.stopPropagation()}catch(c){}})}),$(function(){var a=$(".js-product-video");if(a.length&&$(".js-product-video-container").length){var b=0,c=0,d=(document.location.href,$(".js-product-video-iframeContainer")),e=d.html();d.empty(),a.bind("click",function(){var a=$(".js-product-video-iframeContainer");a.append(e);var d=$("iframe",a);return d.attr("src",d.attr("src")+"?autoplay=1"),$(".js-product-video-container").lightbox_me({centered:!0,onLoad:function(){b=(new Date).getTime()},onClose:function(){$(".js-product-video-iframeContainer").empty(),c=(new Date).getTime()}}),!1})}});