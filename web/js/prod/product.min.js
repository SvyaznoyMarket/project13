(function(){if($(".creditbox").length){console.log("## Product has creditbox");var e=$(".creditbox"),t=e.find(".creditbox__sum strong");window.creditBox={cookieTimeout:null,toggleCookie:function(e){clearTimeout(this.cookieTimeout),this.cookieTimeout=setTimeout(function(){window.docCookies.setItem("credit_on",e?1:0,3600,"/")},200)},init:function(){var o=this,n=$("input[name=dc_buy_on_credit]").data("model"),i=$(".creditbox label");$("input[type=radio][name=price_or_credit]").change(function(e){e.preventDefault(),i.length&&(i.toggleClass("checked"),o.toggleCookie(i.hasClass("checked")))}),1===this.getState()&&$(".creditbox label").addClass("checked"),n.count=1,n.cart="/cart",dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:n.price,count:n.count,type:n.product_type},function(o){false in o||o.payment>0&&(t.html(printPrice(Math.ceil(o.payment))),e.show())})},getState:function(){return window.docCookies.hasItem("credit_on")?window.docCookies.getItem("credit_on"):0}},creditBox.init()}else{console.log("## Product does not have creditbox");var o=$(".bProductDesc");o.length&&!o.hasClass("mNoCredit")&&o.addClass("mNoCredit")}})(),function(){if($(".bDeliveryNowClick").length){var e=function e(){var e=$(this).parent(".mDeliveryNow"),t=e.find("ul.bDeliveryFreeAddress");e.toggleClass("mOpen"),e.toggleClass("mClose"),e.hasClass("mOpen")?t.slideDown():t.slideUp()};$(".bDeliveryNowClick").on("click",e)}}(),function(){var e=function(){var e=$(".bPhotoSlider"),t=e.find(".bPhotoSliderGallery"),o=e.find(".bPhotoSlider__eBtn.mPrev"),n=e.find(".bPhotoSlider__eBtn.mNext"),i=t.find(".bPhotoSliderGallery__eItem");if(!i.length)return!1;var r=i.width()+parseInt(i.css("marginLeft"),10)+parseInt(i.css("marginRight"),10),c=0;t.css({width:i.length*r,left:c});var a=function(){c>0?o.show():o.hide(),t.width()-e.width()>c?n.show():n.hide()},d=function(){return c-=r,t.animate({left:-c}),a(),!1},u=function(){return c+=r,t.animate({left:-c}),a(),!1};a(),o.bind("click",d),n.bind("click",u)};$(document).ready(function(){$(".bPhotoSlider").length&&e()})}(),function(e){var t=e.ENTER.config.pageConfig,o=e.ENTER.utils,n=function n(){var e=function e(){var e=$("#3dModelImg"),t=e.data("value"),n=e.data("host"),i=null,r=function r(){return $("#3dModelImg").lightbox_me({centered:!0,closeSelector:".close"}),!1};try{$("#3dImgContainer").length||(i=new DAnimFramePlayer(document.getElementById("3dModelImg"),n),i.DoLoadModel(t),$(".mGrad360.3dimg").bind("click",r))}catch(c){var a={event:"3dimg",type:"ошибка загрузки 3dimg для мебели",err:c};o.logError(a)}};$LAB.script("DAnimFramePlayer.min.js").wait(e)};$(document).ready(function(){t["product.img3d"]&&n()})}(this),function(){var e=function(){var e=$(".bHint_ePopup"),t=$(".bHint_eLink"),o=$(".bHint_ePopup .close"),n=function(e){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Hints",e.hintTitle,e.url])},i=function(){e.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150);var t={hintTitle:$(this).html(),url:window.location.href};return n(t),!1},r=function(){return e.fadeOut(150),!1};t.bind("click",i),o.bind("click",r)};$(document).ready(function(){$(".bHint").length&&e()})}(),function(e){e.Planner3dKupeConstructor=null,e.Planner3d_Init=function(){},e.Planner3d_UpdatePrice=function(e){var t=$("#planner3D").data("cart-sum-url"),o={};o.product={};for(var n=function(e){return e.success?($(".jsPrice").html(printPrice(e.sum)),void 0):!1},i=0,r=e.length;r>i;i++){var c=e[i].id;if(""!==e[i].error)return $(".jsBuyButton").addClass("mDisabled"),$("#coupeError").html("Вставки продаются только парами!").show(),!1;$(".jsBuyButton").removeClass("mDisabled"),$("#coupeError").hide(),void 0!==o.product[c+""]?o.product[c+""].quantity++:o.product[c+""]={id:c,quantity:1}}$.ajax({type:"POST",url:t,data:o,success:n})};var t=function(){if($(this).hasClass("mDisabled"))return!1;var t=e.Planner3dKupeConstructor.GetBasketContent(),o=$(this).attr("href"),n={},i=function(e){return e.success?($(".jsBuyButton").html("В корзине").addClass("mBought").attr("href","/cart"),e.product.name=$(".bMainContainer__eHeader-title").html(),e.product.price=$(".jsPrice").eq("1").html(),e.product.article=$(".bMainContainer__eHeader-article").html(),$("body").trigger("addtocart",[e]),void 0):!1};return n.product=t,$.ajax({type:"POST",url:o,data:n,success:i}),!1},o=function(){try{var o=$("#planner3D").data("product");e.Planner3dKupeConstructor=new DKupe3dConstructor(document.getElementById("planner3D"),"/css/item/coupe_img/","/css/item/coupe_tex/","/css/item/test_coupe_icons/"),e.Planner3dKupeConstructor.Initialize("/js/KupeConstructorData.json",o.id)}catch(n){var i={event:"Kupe3dConstructor error",type:"ошибка загрузки Kupe3dConstructor",err:n};e.ENTER.utils.logError(i)}$(".jsBuyButton").off(),$(".jsBuyButton").bind("click",t)};$(document).ready(function(){$("#planner3D").length&&$LAB.script("KupeConstructorScript.min.js").script("three.min.js").wait(o)})}(this),function(){var e=function e(){var e=$(".priceSale"),t=$(".jsLowPriceNotifer"),o=$(".bLowPriceNotiferPopup__eSubmitEmail"),n=$(".bLowPriceNotiferPopup__eInputEmail"),i=$(".bLowPriceNotiferPopup"),r=$(".bLowPriceNotiferPopup__eError"),c=$(".jsSubscribe"),a=function a(){return i.fadeOut(300),!1},d=function(t,o){o&&(o.name&&(o.isSubscribed&&c.parent("label").hide(),e.show()),o.email&&n.val(o.email))},u=function u(){return i.fadeIn(300),i.find(".close").bind("click",a),!1},l=function l(e){return e.success?(a(),i.remove(),t.remove(),void 0):(n.addClass("red"),e.error.message&&r.show().html(e.error.message),!1)},s=function s(){return c.length&&c.is(":checked")?!0:!1},m=function m(){var e=o.data("url");return e+=encodeURI("?email="+n.val()+"&subscribe="+(s()?1:0)),$.get(e,l),!1};o.bind("click",m),t.bind("click",u),$("body").bind("userLogged",d)};$(document).ready(function(){$(".jsLowPriceNotifer").length&&e()})}(),function(e){var t=e.ENTER.config.pageConfig,o=e.ENTER.utils,n=!1,i=function(e){return"function"!=typeof e?!1:(n?e():($LAB.script("swfobject.min.js").wait(e),n=!0),!0)},r=function(){var e=$("#maybe3dModelPopup").data("value"),t=function(){var t=function(t){t.stopPropagation();try{$("#maybe3dModel").length||$("#maybe3dModelPopup_inner").append('<div id="maybe3dModel"></div>'),swfobject.embedSWF(e.init.swf,e.init.container,e.init.width,e.init.height,e.init.version,e.init.install,e.flashvars,e.params,e.attributes),$("#maybe3dModelPopup").lightbox_me({centered:!0,closeSelector:".close",onClose:function(){swfobject.removeSWF(e.attributes.id)}})}catch(n){var i={event:"swfobject_error",type:"ошибка загрузки swf maybe3d",err:n};o.logError(i)}return!1};$(".mGrad360.maybe3d").bind("click",t)};i(t)},c=function c(){console.log("### LoadFitting BEGIN");var e=function e(){var e=function e(){return"undefined"==typeof ARPlugin?(console.warn("ARPlugin is not defined"),$("li.vFitting").hide(),!1):(console.log("ARPlugin is defined"),ARPlugin.init({type:"simple",js:"/js/prod/",css:"/styles/ARPlugin/",img:"/styles/ARPlugin/img/",swf:"/styles/ARPlugin/swf/",resources:t["product.resources"],meshes_path:t["product.meshes"],textures_path:t["product.textures"],marker_path:t["product.marker"]}),fittingPopupShow=function(e){e.preventDefault(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","3D-primerochnaya",t["product.name"],"click"]),ARPlugin.show(t["product.article"]+".obj",t["product.article"]+".png")},$(".vFitting").bind("click",fittingPopupShow),void 0)};$LAB.script("ARPluginOrigin.js").wait(e)};i(e)};$(document).ready(function(){t["product.maybe3d"]&&r(),t["product.vFitting"]&&c()})}(this),$(document).ready(function(e){function t(){function e(e){var t=this;t.id=e.id,t.url=e.url,t.name=e.name,t.line=e.lineName,t.price=e.price,t.image=e.image,t.height=e.height,t.width=e.width,t.depth=e.depth,t.count=o.observable(e.count),t.maxCount=o.observable(1/0),t.prettyPrice=o.computed(function(){return window.printPrice(parseInt(t.price)*parseInt(t.count()))}),t.prettyItemPrice=o.computed(function(){return window.printPrice(parseInt(t.price))}),t.deliveryDate=o.observable(e.deliveryDate),t.plusClick=function(){t.maxCount()>t.count()&&99>t.count()&&(t.count(parseInt(t.count())+1),$.post("/ajax/product/delivery",{product:[{id:t.id,quantity:t.count()}]},function(e){e.success?(t.deliveryDate(e.product[0].delivery[0].date.value),console.log("Delivery: id=",t.id," quantity=",t.count()," date: ",e.product[0].delivery)):(t.count(t.count()-1),t.maxCount(t.count()))}))},t.minusClick=function(){t.count()>0&&t.count(t.count()-1)},t.countKeydown=function(e,t){t.stopPropagation();var o=0!=t.target.selectionStart-t.target.selectionEnd;if(38===t.which)return e.plusClick(),!1;if(40===t.which)return e.minusClick(),!1;if(39===t.which||37===t.which)return!0;if(t.which>=48&&57>=t.which||t.which>=96&&105>=t.which||8===t.which||46===t.which){if(!o){if(2>(""+e.count()).length&&(8==t.which||46==t.which))return!1;if((""+e.count()).length>1&&8!=t.which&&46!=t.which)return!1}return!0}return!1},t.countKeyUp=function(){return""===t.count()&&t.count(1),!1}}function t(){var t=this;t.products=o.observableArray([]),t.isBaseKit=o.computed(function(){var e=!0;return o.utils.arrayForEach(t.products(),function(t){i[t.id].count!=t.count()&&(e=!1)}),e}),t.totalPrice=o.computed(function(){var e=0;return o.utils.arrayForEach(t.products(),function(t){e+=parseInt(t.count())*parseInt(t.price)}),window.printPrice(e)}),t.totalCount=o.computed(function(){var e=0;return o.utils.arrayForEach(t.products(),function(t){e+=parseInt(t.count())}),e}),t.buyLink=o.computed(function(){var e="/cart/set-products?",n=0;return o.utils.arrayForEach(t.products(),function(t){t.count()>0&&(e+="product["+n+"][id]="+t.id+"&product["+n+"][quantity]="+t.count()+"&",n+=1)}),e}),t.dataUpsale=function(e){var t="/ajax/upsale/"+e;return o.toJSON({url:t,fromUpsale:!1})},t.addProduct=function(o){t.products.push(new e(o))},t.populateWithObj=function(o){t.products($.map(o,function(t){return new e(t)})),t.products.sort(function(e,t){return e.line==t.line?0:e.line<t.line?-1:1})},t.resetToBaseKit=function(){t.populateWithObj(i)},t.populateWithObj(i)}var o=window.ko;o.applyBindings(new t)}if(0!==$(".packageSet").length){var o=$(".jsChangePackageSet"),n=$(".jsPackageSetPopup"),i=$(".mPackageSetEdit").data("value"),r=e.config.debug?"/js/vendor/knockout.js":"/js/prod/knockout.min.js",c=function c(e){e.preventDefault(),$(".bCountSection").goodsCounter("destroy"),n.lightbox_me({autofocus:!0})};o.on("click",c),$("body").on("addtocart",function(){n.trigger("close.lme")}),window.ko?t():$.getScript(r,t)}}(window.ENTER)),$(document).ready(function(){(function(){if(!$(".bZoomedImg").length)return console.warn("Нет изображения для elevateZoom"),void 0;var e=$(".bZoomedImg"),t=void 0!==e.data("zoom-disable")?e.data("zoom-disable"):!0,o={gallery:"productImgGallery",galleryActiveClass:"mActive",zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:519,borderSize:1,borderColour:"#C7C7C7",disableZoom:t},n=function(){return void 0!=$(this).data("zoom-disable")&&$(this).data("zoom-disable")!=t?(t=$(this).data("zoom-disable"),t?($.removeData(e,"elevateZoom"),$(".zoomContainer").remove()):(o.disableZoom=t,e.elevateZoom(o)),!1):void 0};e.elevateZoom(o),$(".jsPhotoGalleryLink").on("click",n)})(),$(".bCountSection").goodsCounter({onChange:function(e){var t=this.attr("data-spinner-for"),o=$("."+t),n=o.attr("href")||"";console.log("counter change"),console.log(o),o.attr("href",n.addParameterToUrl("quantity",e))}}),$(".bGoodsSlider").goodsSlider(),$(".bDescSelectItem").customDropDown({changeHandler:function(e){var t=e.data("url");document.location.href=t}}),function(){var e=function e(e){return console.info("payPal ajax complete"),e.success&&e.redirect?(document.location.href=e.redirect,void 0):(window.ENTER.utils.blockScreen.unblock(),void 0)},t=function t(){console.info("payPal click");var t=$(this),o=t.attr("href"),n=$(".bCountSection__eNum"),i={};return window.ENTER.utils.blockScreen.block("Загрузка"),n.length&&$.isNumeric(n.val())&&1*n.val()>1&&(i.quantity=n.val()),$.get(o,i,e),!1};$(".jsPayPalButton").bind("click",t),$(".jsLifeGiftButton").bind("click",t),$(".jsOneClickButton").bind("click",t)}(),$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(e){e.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")})}),function(){var e=$("#jsProductCard").data("value")||{},t={"Viewed Product SKU":e.article,"Viewed Product Product Name":e.name,"Viewed Product Product Status":e.stockState},o=function(t){console.log("reviewsYandexClick");var o=this;"undefined"!==e.article&&(_gaq.push(["_trackEvent","YM_link",e.article]),t.preventDefault(),"undefined"!==o&&setTimeout(function(){o.click()},500))};return $("#jsProductCard").length?("undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Product",t]),"undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",o)}),void 0):!1}(),function(){var e={accessorize:function(e){console.log(e);var t={"Recommended Item Clicked Accessorize Recommendation Place":"product","Recommended Item Clicked Accessorize Clicked SKU":e.article,"Recommended Item Clicked Accessorize Clicked Product Name":e.name,"Recommended Item Clicked Accessorize Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Accessorize",t])},alsoBought:function(e){console.log(e);var t={"Recommended Item Clicked Also Bought Recommendation Place":"product","Recommended Item Clicked Also Bought Clicked SKU":e.article,"Recommended Item Clicked Also Bought Clicked Product Name":e.name,"Recommended Item Clicked Also Bought Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Bought",t])},alsoViewed:function(e){console.log(e);var t={"Recommended Item Clicked Also Viewed Recommendation Place":"product","Recommended Item Clicked Also Viewed Clicked SKU":e.article,"Recommended Item Clicked Also Viewed Clicked Product Name":e.name,"Recommended Item Clicked Also Viewed Product Position":e.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Viewed",t])}},t=function t(){console.info("click!");var t=$(this).parents(".bGoodsSlider").data("slider"),o=t.type,n=$(this).data("product");console.log(o),n.position=$(this).index(),e.hasOwnProperty(o)&&e[o](n)};$(".bGoodsSlider").on("click",".bSliderAction__eItem",t)}(),function(){var e={user:-1,pro:-1},t={user:0,pro:0},o=null,n=null,i=null,r=$(".jsGetReviews"),c=$(".bReviewsTabs__eTab"),a=$(".bReviewsWrapper"),d=$(".bReviewsContent"),u=function(o,n,i){var c=e[n]+1,a=!1,d="/product-reviews/"+o,u={},l=function l(o){$("."+i).html($("."+i).html()+o.content),e[n]++,t[n]=o.pageCount,e[n]+1>=t[n]?r.hide():r.show()};$("body").hasClass("jewel")&&(a="jewel"),u={page:c,type:n,layout:a},$.ajax({type:"GET",data:u,url:d,success:l})};if(c.length){var l=a.attr("data-reviews-type");e[l]++,t[l]=a.attr("data-page-count"),t[l]>1&&r.show(),o=a.attr("data-product-id"),n=a.attr("data-reviews-type"),i=a.attr("data-container"),c.click(function(){i=$(this).attr("data-container"),void 0!==i&&(n=$(this).attr("data-reviews-type"),c.removeClass("active"),$(this).addClass("active"),d.hide(),$("."+i).show(),r.hide(),"user"===n&&r.html("Показать ещё отзывы"),$("."+i).html()?e[n]+1>=t[n]?r.hide():r.show():u(o,n,i))}),r.click(function(){u(o,n,i)})}}(),function(){var e=$("body"),t=$(".jsReviewPopup"),o=t.find(".jsReviewForm"),n=o.find(".starsList__item"),i=o.find(".jsReviewStarsCount"),r={fill:"mFill",empty:"mEmpty"},c=$(".jsAdvantage"),a=$(".jsDisadvantage"),d=$(".jsExtract"),u=$(".jsAuthorName"),l=$(".jsAuthorEmail"),s={fields:[{fieldNode:c,require:!0,customErr:"Не указаны достоинства"},{fieldNode:a,require:!0,customErr:"Не указаны недостатки"},{fieldNode:d,require:!0,customErr:"Не указан комментарий"},{fieldNode:u,require:!0,customErr:"Не указано имя"},{fieldNode:l,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},m=new FormValidator(s),p=function p(){return t.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},f=function f(e){var t=$('[name="review['+e.field+']"]'),o=function o(){m._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),m._markFieldError(t,e.message),t.bind("focus",o),!1},h=function h(e){var t=$("ul.error_list",o);return t.length?t.html("<li>"+e+"</li>"):($(".bFormLogin__ePlaceTitle",o).after($('<ul class="error_list" />').append("<li>"+e+"</li>")),$(o).prepend($('<ul class="error_list" />').append("<li>"+e+"</li>"))),!1},g=function g(e){var t=null;console.warn("Обработка ошибок формы");for(var o=e.form.error.length-1;o>=0;o--)t=e.form.error[o],console.warn(t),"global"!==t.field&&null!==t.message?f(t):"global"===t.field&&null!==t.message&&h(t.message);return!1},v=function v(e){return console.log("Ответ от сервера"),e.error?(console.warn("Form has error"),g(e),!1):(e.success&&(e.notice.message&&o.before(e.notice.message),o.hide()),!1)},w=function w(){var e=function e(){return $.post(o.attr("action"),o.serializeArray(),v,"json"),console.log('Сабмит формы "Отзыв о товаре"'),!1};return $("ul.error_list",o).length&&$("ul.error_list",o).html(""),m.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:e}),!1},b=function b(e){n.removeClass(r.fill).removeClass(r.empty),n.each(function(t){e>=t+1?$(this).addClass(r.fill):$(this).addClass(r.empty)})},y=function y(){var e=$(this),t=e.index()+1;b(t)},k=function k(){var e=i.val();b(e)},C=function C(){var e=$(this),t=e.index()+1;i.val(t),b(t)},P=function P(e,t){t&&(t.name&&(u.val(t.name),u.parent(".jsPlace2Col").hide()),t.email&&(l.val(t.email),l.parent(".jsPlace2Col").hide()),t.name&&t.email&&u.parents(".jsFormFieldset").hide())};e.on("click",".jsReviewSend",p),e.on("submit",".jsReviewForm",w),e.on("userLogged",P),n.hover(y,k),n.on("unhover",k),n.on("click",C)}(),function(){var e=function(){if(!$("#productVideo").length)return!1;var e=0,t=0,o=document.location.href,n=$(".mVideo"),i=$("#productVideo .productVideo_iframe").html(),r=function(){return $("#productVideo .productVideo_iframe").append(i),$(".productVideo_iframe iframe").attr("src",$(".productVideo_iframe iframe").attr("src")+"?autoplay=1"),$("#productVideo").lightbox_me({centered:!0,onLoad:function(){e=(new Date).getTime(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Play",o])},onClose:function(){$("#productVideo .productVideo_iframe").empty(),t=(new Date).getTime();var n=t-e;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Stop",o,n])}}),!1};$("#productVideo .productVideo_iframe").empty(),n.bind("click",r)};$(document).ready(function(){$(".mVideo").length&&e()})}();