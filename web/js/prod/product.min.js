$(function(){$(".js-product-3d-html5-opener").bind("click",function(a){a.preventDefault(),$LAB.script("/maybe3dPlayer/player.min.js").wait(function(){$(".js-product-3d-html5-popup").lightbox_me({centered:!0,closeSelector:".close",onLoad:function(){var a=$(".js-product-3d-html5-popup");Maybe3D.Starter.setModelPathHTML5(a.data("url")),Maybe3D.Starter.embed(a.data("id"),"js-product-3d-html5-popup-model")},onClose:function(){$("#js-product-3d-html5-popup-model").empty()}})})}),$(".js-product-3d-swf-opener").bind("click",function(a){a.preventDefault(),$LAB.script("swfobject.min.js").wait(function(){try{$("#js-product-3d-swf-popup-model").length||$(".js-product-3d-swf-popup-container").append('<div id="js-product-3d-swf-popup-model"></div>');var a="js-product-3d-swf-popup-object",b=$(".js-product-3d-swf-popup");swfobject.embedSWF(b.data("url"),"js-product-3d-swf-popup-model","700px","500px","10.0.0","js/vendor/expressInstall.swf",{language:"auto"},{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",wmode:"direct"},{id:a}),b.lightbox_me({centered:!0,closeSelector:".close",onClose:function(){swfobject.removeSWF(a)}})}catch(c){}})}),$(".js-product-3d-img-opener").bind("click",function(a){a.preventDefault(),$LAB.script("DAnimFramePlayer.min.js").wait(function(){var a=$(".js-product-3d-img-popup"),b=a.data("value"),c=a.data("host");try{$("#js-product-3d-img-container").length||new DAnimFramePlayer(a[0],c).DoLoadModel(b),a.lightbox_me({centered:!0,closeSelector:".close"})}catch(d){}})})}),function(){if($(".creditbox").length){var a=$(".creditbox"),b=a.find(".creditbox__sum strong");window.creditBox={cookieTimeout:null,toggleCookie:function(a){clearTimeout(this.cookieTimeout),this.cookieTimeout=setTimeout(function(){window.docCookies.setItem("credit_on",a?1:0,3600,"/")},200)},init:function(){var c=this,d=$("input[name=dc_buy_on_credit]").data("model"),e=$(".creditbox label");$("input[type=radio][name=price_or_credit]").change(function(a){a.preventDefault(),e.length&&(e.toggleClass("checked"),c.toggleCookie(e.hasClass("checked")))}),1===this.getState()&&$(".creditbox label").addClass("checked"),d.count=1,d.cart="/cart",dc_getCreditForTheProduct(4427,window.docCookies.getItem("enter_auth"),"getPayment",{price:d.price,count:d.count,type:d.product_type},function(c){!1 in c||c.payment>0&&(b.html(printPrice(Math.ceil(c.payment))),a.show())})},getState:function(){return window.docCookies.hasItem("credit_on")?window.docCookies.getItem("credit_on"):0}},creditBox.init()}else{var c=$(".bProductDesc");c.length&&!c.hasClass("mNoCredit")&&c.addClass("mNoCredit")}}(),function(){$(".js-show-shops").on("click",function(){var a=$(".shopsPopup"),b=$(".shopsPopup .jsBuyButton");a.lightbox_me({centered:!0,autofocus:!0}),b.on("click",function(){a.trigger("close")})})}(),function(){var a=function(){var a=$(".js-photoslider"),b=a.find(".js-photoslider-gal"),c=a.find(".js-photoslider-btn-prev"),d=a.find(".js-photoslider-btn-next"),e=b.find(".js-photoslider-gal-i");if(!e.length)return!1;var f=e.width()+parseInt(e.css("marginLeft"),10)+parseInt(e.css("marginRight"),10),g=0;b.css({width:e.length*f,left:g});var h=function(){g>0?c.show():c.hide(),g<b.width()-a.width()?d.show():d.hide()},i=function(){return g-=f,b.animate({left:-g}),h(),!1},j=function(){return g+=f,b.animate({left:-g}),h(),!1};h(),c.bind("click",i),d.bind("click",j)};$(document).ready(function(){$(".js-photoslider").length&&a()})}(),function(){var a=function(){var a=$(".bHint_ePopup"),b=$(".bHint_eLink"),c=$(".bHint_ePopup .close"),d=function(a){"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Hints",a.hintTitle,a.url])},e=function(){a.hide(),$(this).parent().find(".bHint_ePopup").fadeIn(150);var b={hintTitle:$(this).html(),url:window.location.href};return d(b),!1},f=function(){return a.fadeOut(150),!1};b.bind("click",e),c.bind("click",f)};$(document).ready(function(){$(".bHint").length&&a()})}(),function(a){a.Planner3dKupeConstructor=null,a.Planner3d_Init=function(){},a.Planner3d_UpdatePrice=function(a){var b=$("#planner3D").data("cart-sum-url"),c={};c.product={};for(var d=function(a){return a.success?void $(".jsPrice").html(printPrice(a.sum)):!1},e=0,f=a.length;f>e;e++){var g=a[e].id;if(""!==a[e].error)return $(".jsBuyButton").addClass("mDisabled"),$("#coupeError").html("Вставки продаются только парами!").show(),!1;$(".jsBuyButton").removeClass("mDisabled"),$("#coupeError").hide(),void 0!==c.product[g+""]?c.product[g+""].quantity++:c.product[g+""]={id:g,quantity:1}}$.ajax({type:"POST",url:b,data:c,success:d})};var b=function(){if($(this).hasClass("mDisabled"))return!1;var b=a.Planner3dKupeConstructor.GetBasketContent(),c=$(this).attr("href"),d={},e=function(a){return a.success?($(".jsBuyButton").html("В корзине").addClass("mBought").attr("href","/cart"),a.product.name=$(".bMainContainer__eHeader-title").html(),a.product.price=$(".jsPrice").eq("1").html(),a.product.article=$(".bMainContainer__eHeader-article").html(),void $("body").trigger("addtocart",[a])):!1};return d.product=b,$.ajax({type:"POST",url:c,data:d,success:e}),!1},c=function(){try{var c=$("#planner3D").data("product");a.Planner3dKupeConstructor=new DKupe3dConstructor(document.getElementById("planner3D"),"/css/item/coupe_img/","/css/item/coupe_tex/","/css/item/test_coupe_icons/"),a.Planner3dKupeConstructor.Initialize("/js/KupeConstructorData.json",c.id)}catch(d){var e={event:"Kupe3dConstructor error",type:"ошибка загрузки Kupe3dConstructor",err:d};a.ENTER.utils.logError(e)}$(".jsBuyButton").off(),$(".jsBuyButton").bind("click",b)};$(document).ready(function(){$("#planner3D").length&&$LAB.script("KupeConstructorScript.min.js").script("three.min.js").wait(c)})}(this),function(){var a=function(){var a=$(".priceSale"),b=$(".jsLowPriceNotifer"),c=$(".bLowPriceNotiferPopup__eSubmitEmail"),d=$(".bLowPriceNotiferPopup__eInputEmail"),e=$(".bLowPriceNotiferPopup"),f=$(".bLowPriceNotiferPopup__eError"),g=$(".jsSubscribe"),h=function(){return e.fadeOut(300),!1},i=function(b,c){c&&(c.name&&a.show(),c.email&&d.val(c.email))},j=function(){return e.fadeIn(300),e.find(".close").bind("click",h),!1},k=function(a){return a.success?(g[0]&&g[0].checked&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","subscription","subscribe_price_alert",d.val()]),h(),e.remove(),void b.remove()):(d.addClass("red"),a.error.message&&f.show().html(a.error.message),!1)},l=function(){return g.length&&g.is(":checked")?!0:!1},m=function(){var a=c.data("url");return a+=encodeURI("?email="+d.val()+"&subscribe="+(l()?1:0)),$.get(a,k),!1};c.bind("click",m),b.bind("click",j),$("body").bind("userLogged",i)};$(document).ready(function(){$(".jsLowPriceNotifer").length&&a()})}(),$(document).ready(function(){function a(){function a(a){var b=this;b.id=a.id,b.url=a.url,b.name=a.name,b.line=a.lineName,b.price=a.price,b.image=a.image,b.height=a.height,b.width=a.width,b.depth=a.depth,b.count=c.observable(a.count),b.maxCount=c.observable(1/0),b.prettyPrice=c.computed(function(){return window.printPrice(parseInt(b.price)*parseInt(b.count()))}),b.prettyItemPrice=c.computed(function(){return window.printPrice(parseInt(b.price))}),b.deliveryDate=c.observable(a.deliveryDate),b.plusClick=function(){b.maxCount()>b.count()&&b.count()<99&&(b.count(parseInt(b.count())+1),$.post("/ajax/product/delivery",{product:[{id:b.id,quantity:b.count()}]},function(a){a.success?b.deliveryDate(a.product[0].delivery[0].date.value):(b.count(b.count()-1),b.maxCount(b.count()))}))},b.minusClick=function(){b.count()>0&&b.count(b.count()-1)},b.countKeydown=function(a,b){b.stopPropagation();var c=b.target.selectionStart-b.target.selectionEnd!=0;if(38===b.which)return a.plusClick(),!1;if(40===b.which)return a.minusClick(),!1;if(39===b.which||37===b.which)return!0;if(b.which>=48&&b.which<=57||b.which>=96&&b.which<=105||8===b.which||46===b.which){if(!c){if(a.count().toString().length<2&&(8==b.which||46==b.which))return!1;if(a.count().toString().length>1&&8!=b.which&&46!=b.which)return!1}return!0}return!1},b.countKeyUp=function(){return""===b.count()&&b.count(1),!1}}function b(){var b=this;b.products=c.observableArray([]),b.isBaseKit=c.computed(function(){var a=!0;return c.utils.arrayForEach(b.products(),function(b){g[b.id].count!=b.count()&&(a=!1)}),a}),b.totalPrice=c.computed(function(){var a=0;return c.utils.arrayForEach(b.products(),function(b){a+=parseInt(b.count())*parseInt(b.price)}),window.printPrice(a)}),b.totalCount=c.computed(function(){var a=0;return c.utils.arrayForEach(b.products(),function(b){a+=parseInt(b.count())}),a}),b.buyLink=c.computed(function(){var a="/cart/set-products?",d=0;return c.utils.arrayForEach(b.products(),function(b){b.count()>0&&(a+="product["+d+"][id]="+b.id+"&product["+d+"][quantity]="+b.count()+"&",d+=1)}),a+=$.param({sender:f})}),b.dataUpsale=function(a){var b="/ajax/upsale/"+a;return c.toJSON({url:b,fromUpsale:!1})},b.addProduct=function(c){b.products.push(new a(c))},b.populateWithObj=function(c){b.products($.map(c,function(b){return new a(b)})),b.products.sort(function(a,b){return a.line==b.line?0:a.line<b.line?-1:1})},b.resetToBaseKit=function(){b.populateWithObj(g)},b.populateWithObj(g)}var c=window.ko;c.cleanNode(document.querySelector(".jsPackageSetPopup")),c.applyBindings(new b,document.querySelector(".jsPackageSetPopup"))}if(0!==$(".packageSet").length){var b=$("#jsProductCard").data("value"),c=$(".jsChangePackageSet"),d=$(".jsPackageSetPopup"),e=$(".js-packageSetEdit").data("value"),f=e.sender,g=e.products,h=function(a){a.preventDefault(),$(".bCountSection").goodsCounter("destroy"),d.lightbox_me({autofocus:!0}),"undefined"!=typeof _gaq&&"undefined"!=typeof b&&_gaq.push(["_trackEvent","addedCollection","collection",b.article])};c.on("click",h),$("body").on("addtocart",function(){d.trigger("close.lme")}),a()}}(window.ENTER)),$(document).ready(function(){!function(){if($(".bZoomedImg").length){var a=$(".bZoomedImg"),b=void 0!==a.data("zoom-disable")?a.data("zoom-disable"):!0,c={gallery:"productImgGallery",galleryActiveClass:"mActive",zoomWindowOffety:0,zoomWindowOffetx:19,zoomWindowWidth:519,borderSize:1,borderColour:"#C7C7C7",disableZoom:b},d=function(){return void 0!=$(this).data("zoom-disable")&&$(this).data("zoom-disable")!=b?(b=$(this).data("zoom-disable"),b?($.removeData(a,"elevateZoom"),$(".zoomContainer").remove()):(c.disableZoom=b,a.elevateZoom(c)),!1):void 0};a.elevateZoom(c),$(".jsPhotoGalleryLink").on("click",d)}}(),$(".bCountSection").goodsCounter({onChange:function(a){var b=this.attr("data-spinner-for"),c=$("."+b),d=$("."+b+"-oneClick");newHref=c.attr("href")||"",c.attr("href",newHref.addParameterToUrl("quantity",a)),d.data("quantity",a)}}),$(".js-slider").goodsSlider({onLoad:function(a){ko.applyBindings(ENTER.UserModel,a)}}),$(".bDescSelectItem").customDropDown({changeHandler:function(a){var b=a.data("url");document.location.href=b}}),function(){var a=function(a){return a.success&&a.redirect?void(document.location.href=a.redirect):void window.ENTER.utils.blockScreen.unblock()},b=function(){var b=$(this),c=b.attr("href"),d=$(".bCountSection__eNum"),e={};return window.ENTER.utils.blockScreen.block("Загрузка"),d.length&&$.isNumeric(d.val())&&1*d.val()>1&&(e.quantity=d.val()),$.get(c,e,a),!1};$(".jsPayPalButton").bind("click",b),$(".jsLifeGiftButton").bind("click",b),$(".jsOneClickButton").bind("click",b)}(),$("#productDescriptionToggle").length&&$("#productDescriptionToggle").toggle(function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").show(),$(this).html("Скрыть все характеристики")},function(a){a.preventDefault(),$(this).parent().parent().find(".descriptionlist:not(.short)").hide(),$(this).html("Показать все характеристики")});try{var a=ENTER.config.pageConfig.product?ENTER.config.pageConfig.product.id:null,b=docCookies.getItem("product_viewed")||"",c=[];a&&(c=b?ENTER.utils.arrayUnique(b.split(",")):[],c.push(a),docCookies.setItem("product_viewed",c.slice(-20).join(","),604800,"/"))}catch(d){}}),function(){var a=$("#jsProductCard").data("value")||{},b={"Viewed Product SKU":a.article,"Viewed Product Product Name":a.name,"Viewed Product Product Status":a.stockState},c=function(b){var c=this;"undefined"!==a.article&&(_gaq.push(["_trackEvent","YM_link",a.article]),b.preventDefault(),"undefined"!==c&&setTimeout(function(){c.click()},500))};return $("#jsProductCard").length?("undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Product",b]),void("undefined"!=typeof _gaq&&$("a.reviewLink.yandex").each(function(){$(this).one("click",c)}))):!1}(),function(){var a={accessorize:function(a){var b={"Recommended Item Clicked Accessorize Recommendation Place":"product","Recommended Item Clicked Accessorize Clicked SKU":a.article,"Recommended Item Clicked Accessorize Clicked Product Name":a.name,"Recommended Item Clicked Accessorize Product Position":a.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Accessorize",b])},alsoBought:function(a){var b={"Recommended Item Clicked Also Bought Recommendation Place":"product","Recommended Item Clicked Also Bought Clicked SKU":a.article,"Recommended Item Clicked Also Bought Clicked Product Name":a.name,"Recommended Item Clicked Also Bought Product Position":a.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Bought",b])},alsoViewed:function(a){var b={"Recommended Item Clicked Also Viewed Recommendation Place":"product","Recommended Item Clicked Also Viewed Clicked SKU":a.article,"Recommended Item Clicked Also Viewed Clicked Product Name":a.name,"Recommended Item Clicked Also Viewed Product Position":a.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Also Viewed",b])}},b=function(){var b=$(this).parents(".js-slider").data("slider"),c=b.type,d=$(this).data("product");d.position=$(this).index(),a.hasOwnProperty(c)&&a[c](d)};$(".js-slider").on("click",".bSliderAction__eItem",b)}(),function(){var a={user:-1,pro:-1},b={user:0,pro:0},c=null,d=null,e=null,f=$(".jsGetReviews"),g=$(".bReviewsTabs__eTab"),h=$(".bReviewsWrapper"),i=$(".bReviewsContent"),j=function(c,d,e){var g,h=a[d]+1,i=!1,j="/product-reviews/"+c,k=function(c){$("."+e).html($("."+e).html()+c.content),a[d]++,b[d]=c.pageCount,a[d]+1>=b[d]?f.hide():f.show()};$("body").hasClass("jewel")&&(i="jewel"),g={page:h,type:d,layout:i},$.ajax({type:"GET",data:g,url:j,success:k})};if(g.length){var k=h.attr("data-reviews-type");a[k]++,b[k]=h.attr("data-page-count"),b[k]>1&&f.show(),c=h.attr("data-product-ui"),d=h.attr("data-reviews-type"),e=h.attr("data-container"),g.click(function(){e=$(this).attr("data-container"),void 0!==e&&(d=$(this).attr("data-reviews-type"),g.removeClass("active"),$(this).addClass("active"),i.hide(),$("."+e).show(),f.hide(),"user"===d&&f.html("Показать ещё отзывы"),$("."+e).html()?a[d]+1>=b[d]?f.hide():f.show():j(c,d,e))}),f.click(function(){j(c,d,e)})}}(),function(){var a=$("body"),b=$(".jsReviewPopup"),c=b.find(".jsReviewForm"),d=$(".jsFormSubmit"),e=d.val(),f=c.find(".starsList__item"),g=c.find(".jsReviewStarsCount"),h={fill:"mFill",empty:"mEmpty"},i=$(".jsAdvantage"),j=$(".jsDisadvantage"),k=$(".jsExtract"),l=$(".jsAuthorName"),m=$(".jsAuthorEmail"),n={fields:[{fieldNode:i,require:!0,customErr:"Не указаны достоинства"},{fieldNode:j,require:!0,customErr:"Не указаны недостатки"},{fieldNode:k,require:!0,customErr:"Не указан комментарий"},{fieldNode:l,require:!0,customErr:"Не указано имя"},{fieldNode:m,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]},o=new FormValidator(n),p=function(){return b.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){}}),!1},q=function(a){var b=$('[name="review['+a.field+']"]'),c=function(){o._unmarkFieldError($(this))};return o._markFieldError(b,a.message),b.bind("focus",c),!1},r=function(a){var b=$("ul.error_list",c);return b.length?b.html("<li>"+a+"</li>"):($(".bFormLogin__ePlaceTitle",c).after($('<ul class="error_list" />').append("<li>"+a+"</li>")),$(c).prepend($('<ul class="error_list" />').append("<li>"+a+"</li>"))),!1},s=function(a){for(var b=null,c=a.form.error.length-1;c>=0;c--)b=a.form.error[c],"global"!==b.field&&null!==b.message?q(b):"global"===b.field&&null!==b.message&&r(b.message);return!1},t=function(a){return a.error?(s(a),!1):(a.success&&(a.notice.message&&c.before(a.notice.message),c.hide()),!1)},u=function(){function a(){c.data("disabled",!1),d.removeAttr("disabled"),d.removeClass("mDisabled"),d.val(e)}return c.data("disabled")?!1:(c.data("disabled",!0),d.attr("disabled","disabled"),d.addClass("mDisabled"),d.val("Сохраняю…"),$("ul.error_list",c).length&&$("ul.error_list",c).html(""),o.validate({onInvalid:function(b){a()},onValid:function(){return $.ajax({type:"post",url:c.attr("action"),data:c.serializeArray(),dataType:"json",success:t,complete:function(){a()}}),!1}}),!1)},v=function(a){f.removeClass(h.fill).removeClass(h.empty),f.each(function(b){$(this).addClass(a>=b+1?h.fill:h.empty)})},w=function(){var a=$(this),b=a.index()+1;v(b)},x=function(){var a=g.val();v(a)},y=function(){var a=$(this),b=a.index()+1;g.val(b),v(b)},z=function(a,b){b&&(b.name&&(l.val(b.name),l.parent(".jsPlace2Col").hide()),b.email&&(m.val(b.email),m.parent(".jsPlace2Col").hide()),b.name&&b.email&&l.parents(".jsFormFieldset").hide())};a.on("click",".jsReviewSend",p),a.on("submit",".jsReviewForm",u),a.on("userLogged",z),f.hover(w,x),f.on("unhover",x),f.on("click",y),"#add-review"==location.hash&&p()}(),$(function(){$("#spk-widget-reviews").length&&("#add-review"==location.hash&&(location.href="?spkPreState=addReview"),$(".sprosikupiRating .spk-good-rating a").live("click",function(a){return $(document).stop().scrollTo($(a.currentTarget).attr("href"),800),!1}),$.getScript("//static.sprosikupi.ru/js/widget/sprosikupi.bootstrap.js"))}),$(function(){var a=$("#shoppilot-reviews-container");a.length&&(_shoppilot=window._shoppilot||[],_shoppilot.push(["_setStoreId","535a852cec8d830a890000a6"]),_shoppilot.push(["_setOnReady",function(b){new b.ProductWidget({name:"product-rating",styles:"product-reviews",product_id:a.data("productId")}).appendTo("#shoppilot-rating-container"),new b.ProductWidget({name:"product-reviews",styles:"product-reviews",product_id:a.data("productId")}).appendTo(a[0]),"#add-review"==location.hash&&new b.Surveybox({product_id:a.data("productId")}).open()}]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//ugc.shoppilot.ru/javascripts/require.js",a.setAttribute("data-main","//ugc.shoppilot.ru/javascripts/social-apps.js");var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),$("#shoppilot-rating-container").on("click","a.sp-product-inline-rating-label",function(a){return $(document).stop().scrollTo($(a.currentTarget).attr("href").replace(/^.*?#/,"#"),800),!1}))}),$(function(){var a=$("body");$(".js-product-similarProducts-link").on("click",function(b){try{a.trigger("trackGoogleEvent",{category:"RR_взаимодействие",action:"Перешел на карточку товара",label:"SEO",hitCallback:$(this).attr("href")}),b.stopPropagation()}catch(c){}})}),$(function(){var a=$(".js-product-video");if(a.length&&$(".js-product-video-container").length){var b=0,c=0,d=document.location.href,e=$(".js-product-video-iframeContainer"),f=e.html();e.empty(),a.bind("click",function(){var a=$(".js-product-video-iframeContainer");a.append(f);var e=$("iframe",a);return e.attr("src",e.attr("src")+"?autoplay=1"),$(".js-product-video-container").lightbox_me({centered:!0,onLoad:function(){b=(new Date).getTime(),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Play",d])},onClose:function(){$(".js-product-video-iframeContainer").empty(),c=(new Date).getTime();var a=c-b;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Video","Stop",d,a])}}),!1})}});