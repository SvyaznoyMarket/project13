
;(function(w){w.ENTER.OrderV3={info:{},constructors:{},map:{},mapOptions:{},$map:{},kladrCityId:0};}(window));
(function($){$.kladr={};$.kladr.url='http://kladr.enter.ru/api.php';$.kladr.type={region:'region',district:'district',city:'city',street:'street',building:'building'};$.kladr.api=function(query,callback){var params={};if(query.token)params.token=query.token;if(query.key)params.key=query.key;if(query.type)params.contentType=query.type;if(query.name)params.query=query.name;if(query.parentType&&query.parentId){params[query.parentType+'Id']=query.parentId;}
if(query.withParents)params.withParent=1;params.limit=query.limit?query.limit:2000;var completed=false;$.getJSON($.kladr.url+"?callback=?",params,function(data){if(completed)return;completed=true;callback&&callback(data.result);});setTimeout(function(){if(completed)return;completed=true;console.error('Request error');callback&&callback([]);},5000);};$.kladr.check=function(query,callback){query.withParents=false;query.limit=1;$.kladr.api(query,function(objs){if(objs&&objs.length){callback&&callback(objs[0]);}else{callback&&callback(false);}});};})(jQuery);(function($,undefined){$.fn.kladr=function(param1,param2){var result=undefined;this.each(function(){var res=kladr($(this),param1,param2);if(result==undefined)result=res;});return result;function kladr(input,param1,param2){var ac=null;var spinner=null;var options=null;var defaultOptions={token:null,key:null,type:null,parentType:null,parentId:null,limit:10,withParents:false,verify:false,showSpinner:true,arrowSelect:true,current:null,open:null,close:null,send:null,received:null,select:null,check:null,source:function(query,callback){var params={token:options.token,key:options.token,type:options.type,name:query,parentType:options.parentType,parentId:options.parentId,withParents:options.withParents,limit:options.limit};$.kladr.api(params,callback);},labelFormat:function(obj,query){var label='';var name=obj.name.toLowerCase();query=query.toLowerCase();var start=name.indexOf(query);start=start>0?start:0;if(obj.typeShort){label+=obj.typeShort+'. ';}
if(query.length<obj.name.length){label+=obj.name.substr(0,start);label+='<strong>'+obj.name.substr(start,query.length)+'</strong>';label+=obj.name.substr(start+query.length,obj.name.length-query.length-start);}else{label+='<strong>'+obj.name+'</strong>';}
return label;},valueFormat:function(obj,query){return obj.name;}};var keys={up:38,down:40,esc:27,enter:13};var spinnerInterval=null;return init(param1,param2,function(){var isActive=false;create();position();input.keyup(open);input.keydown(keyselect);input.change(function(){if(!isActive)change();});input.blur(function(){if(!isActive)close();});ac.on('click','li, a',mouseselect);ac.on('mouseenter','li',function(){var $this=$(this);ac.find('li.active').removeClass('active');$this.addClass('active');var obj=$this.find('a').data('kladr-object');trigger('preselect',obj);isActive=true;});ac.on('mouseleave','li',function(){$(this).removeClass('active');isActive=false;});$(window).resize(position);});function init(param1,param2,callback){options=input.data('kladr-options');if(param2!==undefined){options[param1]=param2;input.data('kladr-options',options);return input;}
if($.type(param1)==='string'){if(!options)return null;return options[param1];}
if(options){return input;}
options=defaultOptions;if($.type(param1)==='object'){for(var i in param1){options[i]=param1[i];}}
input.data('kladr-options',options);callback&&callback();return input;};function create(){var container=$(document.getElementById('kladr_autocomplete'));var inputName=input.attr('name');if(!container.length){container=$('<div id="kladr_autocomplete"></div>').appendTo('body');}
input.attr('autocomplete','off');ac=$('<ul class="kladr_autocomplete_'+inputName+'" style="display: none;"></ul>');ac.appendTo(container);spinner=$('<div class="spinner kladr_autocomplete_'+inputName+'_spinner" class="spinner" style="display: none;"></div>');spinner.appendTo(container);};function render(objs,query){ac.empty();for(var i in objs){var obj=objs[i];var value=options.valueFormat(obj,query);var label=options.labelFormat(obj,query);var a=$('<a data-val="'+value+'">'+label+'</a>');a.data('kladr-object',obj);var li=$('<li></li>').append(a);li.appendTo(ac);}};function position(){var inputOffset=input.offset();var inputWidth=input.outerWidth();var inputHeight=input.outerHeight();ac.css({top:inputOffset.top+inputHeight+'px',left:inputOffset.left});var differ=ac.outerWidth()-ac.width();ac.width(inputWidth-differ);var spinnerWidth=spinner.width();var spinnerHeight=spinner.height();spinner.css({top:inputOffset.top+(inputHeight-spinnerHeight)/2-1,left:inputOffset.left+inputWidth-spinnerWidth-2,});};function open(event){if((event.which>8)&&(event.which<46))return;if(!validate())return;var query=key(input.val());if(!$.trim(query)){close();return;}
spinnerShow();trigger('send');options.source(query,function(objs){spinnerHide();trigger('received');if(!input.is(':focus')){close();return;}
if(!$.trim(input.val())||!objs.length){close();return;}
render(objs,query);position();ac.slideDown(50);trigger('open');});};function close(){select();ac.hide();trigger('close');};function validate(){switch(options.type){case $.kladr.type.region:case $.kladr.type.district:case $.kladr.type.city:if(options.parentType&&!options.parentId)
{console.error('parentType is defined and parentId in not');return false;}
break;case $.kladr.type.street:if(options.parentType!=$.kladr.type.city){console.error('For street parentType must equal "city"');return false;}
if(!options.parentId){console.error('For street parentId must defined');return false;}
break;case $.kladr.type.building:if(options.parentType!=$.kladr.type.street){console.error('For building parentType must equal "street"');return false;}
if(!options.parentId){console.error('For building parentId must defined');return false;}
break;default:console.error('type must defined and equal "region", "district", "city", "street" or "building"');return false;}
if(options.limit<1){console.error('limit must greater than 0');return false;}
return true;};function select(){var a=ac.find('.active a');if(!a.length)return;input.val(a.attr('data-val'));options.current=a.data('kladr-object');input.data('kladr-options',options);trigger('select',options.current);};function keyselect(event){var active=ac.find('li.active');switch(event.which){case keys.up:if(active.length){active.removeClass('active');active=active.prev();}else{active=ac.find('li').last();}
active.addClass('active');var obj=active.find('a').data('kladr-object');trigger('preselect',obj);if(options.arrowSelect)select();break;case keys.down:if(active.length){active.removeClass('active');active=active.next();}else{active=ac.find('li').first();}
active.addClass('active');var obj=active.find('a').data('kladr-object');trigger('preselect',obj);if(options.arrowSelect)select();break;case keys.esc:active.removeClass('active');close();break;case keys.enter:if(!options.arrowSelect)select();active.removeClass('active');close();return false;}};function mouseselect(){close();input.focus();return false;};function change(){if(!options.verify)return;if(!validate())return;var query=key(input.val());if(!$.trim(query))return;spinnerShow();trigger('send');options.source(query,function(objs){spinnerHide();trigger('received');var obj=null;for(var i=0;i<objs.length;i++){var queryLowerCase=query.toLowerCase();var nameLowerCase=objs[i].name.toLowerCase();if(queryLowerCase==nameLowerCase){obj=objs[i];break;}}
if(obj)input.val(options.valueFormat(obj,query));options.current=obj;input.data('kladr-options',options);trigger('check',options.current);});};function key(val){var en="1234567890qazwsxedcrfvtgbyhnujmik,ol.p;[']- "+"QAZWSXEDCRFVTGBYHNUJMIK<OL>P:{\"} ";var ru="1234567890йфяцычувскамепинртгоьшлбщдюзжхэъ- "+"ЙФЯЦЫЧУВСКАМЕПИНРТГОЬШЛБЩДЮЗЖХЭЪ ";var strNew='';var ch;var index;for(var i=0;i<val.length;i++){ch=val[i];index=en.indexOf(ch);if(index>-1){strNew+=ru[index];continue;}
strNew+=ch;}
return strNew;};function trigger(event,obj){if(!event)return;input.trigger('kladr_'+event,obj);if(options[event])options[event].call(input.get(0),obj);};function spinnerStart(){if(spinnerInterval)return;var top=-0.2;spinnerInterval=setInterval(function(){if(!spinner.is(':visible')){clearInterval(spinnerInterval);spinnerInterval=null;return;}
spinner.css('background-position','0% '+top+'%');top+=5.555556;if(top>95)top=-0.2;},30);};function spinnerShow(){if(options.showSpinner){spinner.show();spinnerStart();}};function spinnerHide(){spinner.hide();};};};})(jQuery);
(function(root,factory){if(typeof exports=='object')module.exports=factory()
else if(typeof define=='function'&&define.amd)define(factory)
else root.Spinner=factory()}
(this,function(){"use strict";var prefixes=['webkit','Moz','ms','O'],animations={},useCssAnimations
function createEl(tag,prop){var el=document.createElement(tag||'div'),n
for(n in prop)el[n]=prop[n]
return el}
function ins(parent){for(var i=1,n=arguments.length;i<n;i++)
parent.appendChild(arguments[i])
return parent}
var sheet=(function(){var el=createEl('style',{type:'text/css'})
ins(document.getElementsByTagName('head')[0],el)
return el.sheet||el.styleSheet}())
function addAnimation(alpha,trail,i,lines){var name=['opacity',trail,~~(alpha*100),i,lines].join('-'),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf('Animation')).toLowerCase(),pre=prefix&&'-'+prefix+'-'||''
if(!animations[name]){sheet.insertRule('@'+pre+'keyframes '+name+'{'+'0%{opacity:'+z+'}'+
start+'%{opacity:'+alpha+'}'+
(start+0.01)+'%{opacity:1}'+
(start+trail)%100+'%{opacity:'+alpha+'}'+'100%{opacity:'+z+'}'+'}',sheet.cssRules.length)
animations[name]=1}
return name}
function vendor(el,prop){var s=el.style,pp,i
prop=prop.charAt(0).toUpperCase()+prop.slice(1)
for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop
if(s[pp]!==undefined)return pp}
if(s[prop]!==undefined)return prop}
function css(el,prop){for(var n in prop)
el.style[vendor(el,n)||n]=prop[n]
return el}
function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i]
for(var n in def)
if(obj[n]===undefined)obj[n]=def[n]}
return obj}
function pos(el){var o={x:el.offsetLeft,y:el.offsetTop}
while((el=el.offsetParent))
o.x+=el.offsetLeft,o.y+=el.offsetTop
return o}
function getColor(color,idx){return typeof color=='string'?color:color[idx%color.length]}
var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:'#000',direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:'spinner',top:'50%',left:'50%',position:'absolute'}
function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}
Spinner.defaults={}
merge(Spinner.prototype,{spin:function(target){this.stop()
var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width
css(el,{left:o.left,top:o.top})
if(target){target.insertBefore(el,target.firstChild||null)}
el.setAttribute('role','progressbar')
self.lines(el,self.opts)
if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity)
self.opacity(el,j*o.direction+start,alpha,o)}
self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}
return self},stop:function(){var el=this.el
if(el){clearTimeout(this.timeout)
if(el.parentNode)el.parentNode.removeChild(el)
this.el=undefined}
return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg
function fill(color,shadow){return css(createEl(),{position:'absolute',width:(o.length+o.width)+'px',height:o.width+'px',background:color,boxShadow:shadow,transformOrigin:'left',transform:'rotate('+~~(360/o.lines*i+o.rotate)+'deg) translate('+o.radius+'px'+',0)',borderRadius:(o.corners*o.width>>1)+'px'})}
for(;i<o.lines;i++){seg=css(createEl(),{position:'absolute',top:1+~(o.width/2)+'px',transform:o.hwaccel?'translate3d(0,0,0)':'',opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+' '+1/o.speed+'s linear infinite'})
if(o.shadow)ins(seg,css(fill('#000','0 0 4px '+'#000'),{top:2+'px'}))
ins(el,ins(seg,fill(getColor(o.color,i),'0 0 1px rgba(0,0,0,.1)')))}
return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}})
function initVML(){function vml(tag,attr){return createEl('<'+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}
sheet.addRule('.spin-vml','behavior:url(#default#VML)')
Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r
function grp(){return css(vml('group',{coordsize:s+' '+s,coordorigin:-r+' '+-r}),{width:s,height:s})}
var margin=-(o.width+o.length)*2+'px',g=css(grp(),{position:'absolute',top:margin,left:margin}),i
function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+'deg',left:~~dx}),ins(css(vml('roundrect',{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml('fill',{color:getColor(o.color,i),opacity:o.opacity}),vml('stroke',{opacity:0}))))}
if(o.shadow)
for(i=1;i<=o.lines;i++)
seg(i,-2,'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)')
for(i=1;i<=o.lines;i++)seg(i)
return ins(el,g)}
Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild
o=o.shadow&&o.lines||0
if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild
if(c)c.opacity=val}}}
var probe=css(createEl('group'),{behavior:'url(#default#VML)'})
if(!vendor(probe,'transform')&&probe.adj)initVML()
else useCssAnimations=vendor(probe,'animation')
return Spinner}));
;(function($){var $orderContent=$('#js-order-content');$orderContent.on('click','.orderCol_data-count',function(e){var $this=$(this);e.stopPropagation();$this.hide().siblings('.orderCol_data-summ, .orderCol_data-price').hide();$this.siblings('.orderCol_data-edit').show();});$orderContent.on('click','.bCountSection__eP, .bCountSection__eM',function(e){var $this=$(this),$input=$this.siblings('input'),stock=parseInt($input.data('stock'),10),quantity=parseInt($input.val(),10);if($this.hasClass('bCountSection__eP')){if(stock>quantity)$input.val(quantity+1);}
if($this.hasClass('bCountSection__eM')){if(quantity>1)$input.val(quantity-1);}
e.preventDefault();e.stopPropagation();});$orderContent.on('change','.bCountSection__eNum',function(e){e.stopPropagation();});function _counter(){}
window.ENTER.OrderV3.constructors.counter=_counter;}(jQuery));
;(function($){function inputAddress(){var config=$('#kladr-config').data('value'),$addressBlock=$('.orderCol_addrs'),$input=$addressBlock.find('input'),$inputPrefix=$addressBlock.find('#addressInputPrefix'),typeNames={street:'Улица',building:'дом',apartment:'квартира'},spinner=typeof Spinner=='function'?new Spinner({lines:7,length:3,width:3,radius:2,corners:1,rotate:0,direction:1,color:'#666',speed:1,trail:60,shadow:false,hwaccel:true,className:'spinner',zIndex:2e9,top:'50%',left:'50%'}):null,address,init,autocompleteRequest,spinnerBlock;if($input.length===0)return;spinnerBlock=$('<div />',{'class':'kladr_spinner'}).css({'position':'absolute',top:0,right:0,height:'30px',width:'30px'});$addressBlock.prepend(spinnerBlock);function Address(c){this.city=c;this.street={};this.building={};this.apartment={};this.getParent=function(){console.log('getParent()');if(this.street.id&&!this.building.name)return{parentType:this.street.contentType,parentId:this.street.id,type:$.kladr.type.building};if(this.city.id&&!this.street.name)return{parentType:this.city.contentType,parentId:this.city.id};else return false;};this.getLastType=function(){console.log('getLastType()',this);if(typeof this.street.name==='undefined')return'street';else if(typeof this.building.name==='undefined')return'building';else if(typeof this.apartment.name==='undefined')return'apartment';else return false;};this.getNextType=function(){console.log('getNextType()',this);console.log('typeof this.street.name',typeof this.street.name);if(typeof this.building.name!=='undefined')return'apartment';else if(typeof this.street.name!=='undefined')return'building';else if(typeof this.street.name==='undefined')return'street';else return false;};this.update=function(item){if(typeof item.contentType==='undefined'){if(item.type===false){console.error('False type in address update',item);return;}
item.contentType=item.type;}
console.log('update(), contentType',item.contentType);this[item.contentType]=item;$input.autocomplete('close').val('');addAddressItem(item);updatePrefix($('input:focus').eq(0));if(item.contentType=='apartment')$input.hide();console.log('Address update: address, item',this,item);ENTER.OrderV3.address=this;};this.clear=function(til,elem){var $elem=$('.jsAddressItem[data-type='+til+']');switch(til){case'apartment':this.apartment={};break;case'building':this.apartment={};this.building={};break;case'street':this.apartment={};this.building={};this.street={};break;}
$elem.nextAll('.jsAddressItem').remove();if(elem)$(elem).closest('.orderCol_addrs').find('input').val($elem.find('.jsAddressItemName').eq(0).text()).show().focus();$elem.remove();console.log('Address cleared til %s',til,this);};this.clearLast=function(elem){var lastType=$('.jsAddressItem:last').data('type');console.log('lastType',lastType);if(lastType)this.clear(lastType,elem);};return this;}
function saveAddressRequest(){$.ajax({type:'POST',data:{'action':'changeAddress','params':{street:address.street.type+' '+address.street.name,building:address.building.name,apartment:address.apartment.name}}}).fail(function(jqXHR){var response=$.parseJSON(jqXHR.responseText);if(response.result){console.error(response.result);}}).done(function(data){console.log("Query: %s",data.result.OrderDeliveryRequest);console.log("Model:",data.result.OrderDeliveryModel);console.log('Address saved');})}
function updatePrefix(elem){var type=address.getLastType(),$prefixHolder=$(elem).siblings('#addressInputPrefix');$prefixHolder.text(typeNames[type]+(type=='apartment'?' (необязательно)':'')+":");}
function addAddressItem(item){var typeName,holder=$('<li />',{"class":"orderCol_addrs_fld_i jsAddressItem","data-item":JSON.stringify(item),"data-type":item.contentType});typeName=typeof item.id!=='undefined'?item.type:typeNames[item.contentType];holder.append($('<span />').addClass('orderCol_addrs_fld_n jsAddressItemType').text(typeName)).append($('<span />').addClass('orderCol_addrs_fld_val jsAddressItemName').text(item.name));holder.insertBefore($input.parent());}
function formatStreetName(elem){var name=elem.name,typeShort=elem.typeShort,dot='';if($.inArray(typeShort,['ул','пер','пл','дор'])!=-1)dot='.';if(elem.contentType==='street'){return name+' '+typeShort+dot;}else{return name;}}
function fillAddressBlock(address){$.each(['street','building','apartment'],function(i,val){if(typeof address[val].type!=='undefined'||typeof address[val].contentType!=='undefined')addAddressItem(address[val]);});}
$addressBlock.on('click','.jsAddressItem',function(e){e.stopPropagation();var type=$(this).data('type');address.clear(type,this);});$addressBlock.on('click',function(e){if(address.getLastType()!==false){$(this).find('input').eq(0).show().focus();}
e.preventDefault();});autocompleteRequest=function autoCompleRequestF(request,response){if(address.getParent()!==false){var query=$.extend(config,{limit:10,type:$.kladr.type.street,name:request.term},address.getParent());if(spinner)spinner.spin($('.kladr_spinner')[0]);console.log('[КЛАДР] запрос: ',query);$.kladr.api(query,function(data){console.log('[КЛАДР] ответ',data);if(spinner)spinner.stop();response($.map(data,function(elem){return{label:formatStreetName(elem),value:elem}}))});}};$input.autocomplete({source:autocompleteRequest,minLength:1,select:function(event,ui){this.value='';address.update(ui.item.value);return false;},focus:function(event,ui){this.value=ui.item.label;event.preventDefault();event.stopPropagation();},change:function(event,ui){},messages:{noResults:'',results:function(){}}});$input.on({focus:function(){updatePrefix(this)},blur:function(){$inputPrefix.text('');saveAddressRequest()}});$input.on('keypress',function(e){console.log(address.getNextType());if(e.which==13){console.log('Enter pressed, address: ',address);if($(this).val().length>0)address.update({type:address.getNextType(),name:$(this).val()})}});$input.on('keydown',function(e){var key=e.keyCode||e.charCode;if(key===8&&$(this).val().length===0){address.clearLast(this);e.preventDefault();}});$input.data('ui-autocomplete')._renderMenu=function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});};$input.data('ui-autocomplete')._renderItem=function(ul,item){return $("<li>").attr("data-value",JSON.stringify(item.value)).append($("<a>").text(item.label)).appendTo(ul);};init=function initF(){if(typeof ENTER.OrderV3.address==='object'){address=ENTER.OrderV3.address;fillAddressBlock(address);$input.hide();}else{console.log('spinner',spinner);if(spinner)spinner.spin($('.kladr_spinner')[0]);address=new Address({});console.log('Определение адреса КЛАДР, запрос',$.extend(config,{limit:1,type:$.kladr.type.city,name:$('#region-name').data('value')}));$.kladr.api($.extend(config,{'limit':1,type:$.kladr.type.city,name:$('#region-name').data('value')}),function(data){console.log('KLADR data',data);var id=data.length>0?data[0].id:0;if(id==0)console.error('КЛАДР не определил город, конфигурация запроса: ',$.extend(config,{limit:1,type:$.kladr.type.city,name:$('#region-name').data('value')}));else address.city=data[0];if(spinner)spinner.stop()})}};init();}
ENTER.OrderV3.constructors.smartAddress=inputAddress;inputAddress();}(jQuery));
(function($){var E=ENTER.OrderV3,$mapContainer=$('#yandex-map-container');var init=function(){var options=$mapContainer.data('options');E.map=new ymaps.Map("yandex-map-container",{center:[options.latitude,options.longitude],zoom:options.zoom},{autoFitToViewport:'always'});E.mapOptions=options;E.$map=$mapContainer;};ymaps.ready(init);})(jQuery);
;(function($){var $orderContent=$('.orderCnt');$orderContent.on('click','.jsPaymentMethod',function(){var id=$(this).data('value'),$order=$(this).closest('.orderLn');switch(id){case 5:$order.find('.jsPaymentFormPSB').trigger('submit');break;case 8:$order.find('.jsPaymentFormPSBInvoice').trigger('submit');break;case 13:window.location.href=$order.find('.jsPaymentFormPaypal').attr('action');break;}});$orderContent.on('click','.jsOnlinePaymentSpan',function(){$(this).parent().siblings('.jsOnlinePaymentList').show();});}(jQuery));
;(function($){ENTER.OrderV3=ENTER.OrderV3||{};console.log('Model',$('#initialOrderModel').data('value'));var body=document.getElementsByTagName('body')[0],$orderContent=$('#js-order-content'),spinner=typeof Spinner=='function'?new Spinner({lines:11,length:5,width:8,radius:23,corners:1,rotate:0,direction:1,color:'#666',speed:1,trail:62,shadow:false,hwaccel:true,className:'spinner',zIndex:2e9,top:'50%',left:'50%'}):null,changeDelivery=function changeDeliveryF(block_name,delivery_method_token){sendChanges('changeDelivery',{'block_name':block_name,'delivery_method_token':delivery_method_token});},changeDate=function changeDateF(block_name,timestamp){sendChanges('changeDate',{'block_name':block_name,'date':timestamp})},changePoint=function changePointF(block_name,id,token){sendChanges('changePoint',{'block_name':block_name,'id':id,'token':token})},changeInterval=function changeIntervalF(block_name,interval){sendChanges('changeInterval',{'block_name':block_name,'interval':interval})},changeProductQuantity=function changeProductQuantityF(block_name,id,quantity){sendChanges('changeProductQuantity',{'block_name':block_name,'id':id,'quantity':quantity})},changePaymentMethod=function changePaymentMethodF(block_name,method,isActive){var params={'block_name':block_name};params[method]=isActive;sendChanges('changePaymentMethod',params)},changeOrderComment=function changeOrderCommentF(comment){sendChanges('changeOrderComment',{'comment':comment})},applyDiscount=function applyDiscountF(block_name,number){sendChanges('applyDiscount',{'block_name':block_name,'number':number})},deleteDiscount=function deleteDiscountF(block_name,number){sendChanges('deleteDiscount',{'block_name':block_name,'number':number})},checkCertificate=function checkCertificateF(number){},sendChanges=function sendChangesF(action,params){console.info('Sending action "%s" with params:',action,params);$.ajax({type:'POST',data:{'action':action,'params':params},beforeSend:function(){$orderContent.fadeOut(500);if(spinner)spinner.spin(body)}}).fail(function(jqXHR){var response=$.parseJSON(jqXHR.responseText);if(response.result){console.error(response.result);}
if(response.result.redirect){window.location.href=response.result.redirect;}}).done(function(data){console.log("Query: %s",data.result.OrderDeliveryRequest);console.log("Model:",data.result.OrderDeliveryModel);$orderContent.empty().html($(data.result.page).find('#js-order-content').html());ENTER.OrderV3.constructors.smartAddress();}).always(function(){$orderContent.stop(true,true).fadeIn(200);if(spinner)spinner.stop();});},log=function logF(data){$.ajax({"type":'POST',"data":data,"url":'/order/log'})},showMap=function(elem,token){var $currentMap=elem.find('.js-order-map').first(),mapData=$currentMap.data('value'),mapOptions=ENTER.OrderV3.mapOptions,map=ENTER.OrderV3.map;if(!token){token=Object.keys(mapData.points)[0]}
if(mapData){if(!elem.is(':visible'))elem.show();map.geoObjects.removeAll();map.setCenter([mapOptions.latitude,mapOptions.longitude],mapOptions.zoom);$currentMap.append(ENTER.OrderV3.$map.show());map.container.fitToViewport();for(var i=0;i<mapData.points[token].length;i++){var point=mapData.points[token][i];if(!point.latitude||!point.longitude)continue;var placemark=new ymaps.Placemark([point.latitude,point.longitude],{balloonContentHeader:point.name,balloonContentBody:'Адрес: '+point.address+'',hintContent:point.name},{iconLayout:'default#image',iconImageHref:point.marker.iconImageHref,iconImageSize:point.marker.iconImageSize,iconImageOffset:point.marker.iconImageOffset});map.geoObjects.add(placemark);}
if(map.geoObjects.getLength()===1){map.setCenter(map.geoObjects.get(0).geometry.getCoordinates(),15);}else{map.setBounds(map.geoObjects.getBounds());}}else{console.error('No map data for token = "%s", elemId = "%s"',token,elemId,$currentMap);}};$orderContent.on('click','.jsCloseFl',function(e){e.stopPropagation();$(this).closest('.popupFl').hide();e.preventDefault();});$orderContent.on('click','.orderCol_date, .js-order-changePlace-link',function(e){var elemId=$(this).data('content');e.stopPropagation();$('.popupFl').hide();$(elemId).show();if($(this).hasClass('js-order-changePlace-link')){var token=$(elemId).find('.selShop_l:first').data('token');$(elemId).find('.selShop_l').hide().first().show();$(elemId).find('.selShop_tab').removeClass('selShop_tab-act').first().addClass('selShop_tab-act');showMap($(this).closest('.orderCol'),token);}else{log({'action':'view-date'});}
e.preventDefault();});$orderContent.on('click','.selShop_tab:not(.selShop_tab-act)',function(){var token=$(this).data('token'),id=$(this).closest('.popupFl').attr('id');$('.selShop_l').hide();$('.selShop_l[data-token='+token+']').show();$('.selShop_tab').removeClass('selShop_tab-act');$('.selShop_tab[data-token='+token+']').addClass('selShop_tab-act');showMap('#'+id,token);});$orderContent.on('click','.jsShowDiscountForm',function(e){e.stopPropagation();$(this).hide().parent().next().show();});$orderContent.on('click','.orderCol_delivrLst li',function(){var $elem=$(this);if(!$elem.hasClass('orderCol_delivrLst_i-act')){if($elem.data('delivery_group_id')==1){showMap($elem.parent().siblings('.selShop').first());}else{changeDelivery($(this).closest('.orderRow').data('block_name'),$(this).data('delivery_method_token'));}}});$orderContent.on('click','.celedr_col',function(){var timestamp=$(this).data('value');if(typeof timestamp=='number'){changeDate($(this).closest('.orderRow').data('block_name'),timestamp)}});$orderContent.on('click','.shopLst_i',function(){var id=$(this).data('id'),token=$(this).data('token');if(id&&token){changePoint($(this).closest('.orderRow').data('block_name'),id,token)}});$orderContent.on('click','.customSel_def',function(){$(this).next('.customSel_lst').show();});$orderContent.on('click','.customSel_lst li',function(){changeInterval($(this).closest('.orderRow').data('block_name'),$(this).data('value'));});$orderContent.on('click','.jsChangeProductQuantity',function(e){var $this=$(this),quantity=$this.parent().find('input').val();changeProductQuantity($this.data('block_name'),$this.data('id'),quantity);e.preventDefault();});$orderContent.on('click','.jsDeleteProduct',function(e){var $this=$(this);changeProductQuantity($this.data('block_name'),$this.data('id'),0);e.preventDefault();});$orderContent.on('change','.jsCreditCardPayment',function(){var $this=$(this),block_name=$this.closest('.orderRow').data('block_name');changePaymentMethod(block_name,'by_credit_card',$this.is(':checked'))});$orderContent.on('change','.jsCreditPayment',function(){var $this=$(this),block_name=$this.closest('.orderRow').data('block_name');changePaymentMethod(block_name,'by_online_credit',$(this).is(':checked'))});$orderContent.on('blur','.orderComment_fld',function(){changeOrderComment($(this).val());});$orderContent.on('click','.orderComment_t',function(){$('.orderComment_fld').show();});$orderContent.on('click','.jsApplyDiscount',function(e){var $this=$(this),block_name=$this.closest('.orderRow').data('block_name'),number=$this.siblings('input').val();if(number!='')applyDiscount(block_name,number);e.preventDefault();});$orderContent.on('click','.jsDeleteDiscount',function(e){var $this=$(this),block_name=$this.closest('.orderRow').data('block_name'),number=$this.data('value');deleteDiscount(block_name,number);e.preventDefault();});$orderContent.on('click','.jsWanna',function(e){var span='<span style="margin: 5px 0 17px 10px; display: inline-block; color: #878787;">Спасибо за участие в опросе.</span>';$(span).insertAfter($(this));$(this).hide();window.docCookies.setItem('enter_order_v3_wanna',1,0,'/order');log({'action':'wanna'});})})(jQuery);
(function($){var $orderContent=$('.orderCnt'),$inputs=$orderContent.find('input');$.mask.definitions['x']='[0-9]';$.mask.placeholder=" ";$.map($inputs,function(elem,i){if(typeof $(elem).data('mask')!=='undefined')$(elem).mask($(elem).data('mask'));});$orderContent.on('click','.bonusCnt_i',function(e){e.stopPropagation();var $elem=$(this),eq=$elem.data('eq'),$cardsDescriptions=$('.bonusCnt_it');if($elem.hasClass('bonusCnt_i-act'))return;$('.bonusCnt_i').removeClass('bonusCnt_i-act');$elem.addClass('bonusCnt_i-act');$cardsDescriptions.hide().eq(eq).show();});})(jQuery);
;(function($){var $orderContent=$('.orderCnt'),$errorBlock=$orderContent.find('#OrderV3ErrorBlock'),$pageNew=$('.jsOrderV3PageNew'),$pageDelivery=$('.jsOrderV3PageDelivery'),$validationErrors=$('.jsOrderValidationErrors'),errorClass='textfield-err',validateEmail=function validateEmailF(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);},showError=function showErrorF(errArr){var text='';if(!$errorBlock)$orderContent.prepend($('<div />',{id:'OrderV3ErrorBlock'}));$.each(errArr,function(i,val){text+=val;if(i!=errArr-1)text+='<br/>';});$errorBlock.html(text).show()};if($validationErrors.length){console.warn('Validation errors',$validationErrors);}
$pageNew.find('form').on('submit',function(e){var error=[],$phoneInput=$('[name=user_info\\[phone\\]]'),$emailInput=$('[name=user_info\\[email\\]]'),$nameInput=$('[name=user_info\\[first_name\\]]'),phone=$phoneInput.val().replace(/\s+/g,'');if(!/8\d{10}/.test(phone)){error.push('Неверный формат телефона');$phoneInput.addClass(errorClass);}
if($emailInput.val().length!=0&&!validateEmail($emailInput.val())){error.push('Неверный формат E-mail');$emailInput.addClass(errorClass);}
if($nameInput.val().length==0){error.push('Поле имени не может быть пустым');$nameInput.addClass(errorClass);}
if(error.length!=0){showError(error);e.preventDefault();}});$pageDelivery.on('submit','form',function(e){var error=[];if(!$('.jsAcceptAgreement').is(':checked')){error.push('Необходимо согласие с информацией о продавце и его офертой');}
if($('.orderCol_delivrLst_i-act').text().indexOf('Доставка')!=-1){if(!ENTER.OrderV3.address||!ENTER.OrderV3.address.building.name)error.push('Укажите адрес доставки');}
$('.orderCol_addrs_tx').each(function(i,val){if($(val).text().replace(/\s+/,'').length==0)error.push('Укажите адрес самовывоза');});if(error.length!=0){$errorBlock=$orderContent.find('#OrderV3ErrorBlock');showError(error);e.preventDefault()}});}(jQuery));
//@ sourceMappingURL=order-v3.js.map