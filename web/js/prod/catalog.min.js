(function(e){console.info("Catalog init: catalog.js");var n=(e.config.pageConfig,e.utils),o=n.extendApp("ENTER.catalog");o.enableHistoryAPI="object"==typeof Mustache&&History.enabled,o.listingWrap=$(".bListing"),o.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+o.enableHistoryAPI)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),o=n.extendApp("ENTER.catalog"),t=$(".bFilter"),i=t.find(".bBtnPick__eLink"),l=t.find(".bFilterToggle"),r=t.find(".bFilterCont"),a=t.find(".bRangeSlider"),c=t.find(".bFilterParams__eItem"),s=t.find(".bFilterValuesItem"),d=$(".bSortingLine");o.filter={lastRes:null,getViewType:function(){var e=d.find(".mViewer .mSortItem");return e.filter(".mActive").data("type")},applyTemplate:{list:function(e){console.info("applyTemplate list"),o.listingWrap.empty(),o.listingWrap.html(e)},selectedFilter:function(e){var n=t.find(".bFilterFoot");n.empty(),n.html(e)},sorting:function(e){var n=d.find(".bSortingList.mSorting");n.empty(),n.html(e)},pagination:function(e){var n=$(".bSortingList.mPager");n.empty(),n.html(e)}},render:{list:function(e){console.info("render list"),console.log(o.filter.getViewType()!==void 0?o.filter.getViewType():"default");var n,t=o.filter.getViewType()!==void 0?o.filter.getViewType():"default",i={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},l=i[t].html(),r=i[t].data("partial");return n=Mustache.render(l,e,r),console.log("end of render list"),n},selectedFilter:function(e){console.info("render selectedFilter");var n,t=$("#tplSelectedFilter"),i=t.html(),l=t.data("partial");return n=Mustache.render(i,e,l),e.hasOwnProperty("values")&&(console.info("run update filter!"),o.filter.updateFilter(e.values)),console.log("end of render selectedFilter"),n},sorting:function(e){console.info("render sorting");var n,o=$("#tplSorting"),t=o.html(),i=o.data("partial");return n=Mustache.render(t,e,i),console.log("end of render sorting"),n},pagination:function(e){console.info("render pagination");var n,o=$("#tplPagination"),t=o.html(),i=o.data("partial");return n=Mustache.render(t,e,i),console.log("end of render paginaton"),n}},renderCatalogPage:function(e){console.info("renderCatalogPage");var n,t,i=e?e:o.filter.lastRes;o.filter.resetForm();for(n in i)o.filter.render.hasOwnProperty(n)&&o.filter.applyTemplate.hasOwnProperty(n)&&(t=o.filter.render[n](i[n]),o.filter.applyTemplate[n](t));o.infScroll.checkInfinity(),o.filter.lastRes=i},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},n=function n(){var n=$(this),o=n.find(".bFilterSlider"),t=o.data("config"),i=n.find(".mFromRange"),l=n.find(".mToRange"),r=t.min,a=t.max;1*i.val()===r?e.unchangedSliders.push(i.attr("name")):e.changedSliders.push(i.attr("name")),1*l.val()===a?e.unchangedSliders.push(l.attr("name")):e.changedSliders.push(l.attr("name"))};return a.each(n),e},getFilterUrl:function(){for(var e,n=t.serializeArray(),i=t.attr("action"),l=o.filter.getSlidersInputState(),r=n.length-1;r>=0;r--)-1!==l.unchangedSliders.indexOf(n[r].name)&&(console.log("slider input "+n[r].name+" unchanged"),n.splice(r,1));return e=$.param(n),0!==e.length&&(i+="?"+e),i},changeFilterHandler:function(e,n){return console.info("change filter"),console.log(e),console.log(n),"object"==typeof e&&e.isTrigger&&!n?(console.warn("it's trigger event!"),void 0):(console.info("need update from server..."),t.trigger("submit"),o.filter.sendFilter(!0),void 0)},sendFilter:function(e){console.info("sendFilter"),console.log(e);var n=o.filter.getFilterUrl();return n!==document.location.pathname+document.location.search&&(console.info("goto url "+n),o.history.gotoUrl(n)),e.isTrigger?(console.warn("it's trigger"),i.animate({boxShadow:"1px 1px 20px #ffa901"},300,"swing",function(){i.animate({boxShadow:"1px 1px 3px #C7C7C7"},300,"swing")})):"object"==typeof e&&(console.warn("it's true event"),$.scrollTo(t.find(".bFilterFoot"),500)),!1},resetForm:function(){console.info("resetForm");var e=function e(e,n){var o=$(n),i=o.attr("id"),l=t.find('label[for="'+i+'"]');console.info(i),console.info(l),o.removeAttr("checked"),l.removeClass("mChecked")},n=function n(e,n){$(n).removeAttr("checked").trigger("change")},o=function o(){var e=$(this),n=e.find(".bFilterSlider"),o=n.data("config"),t=e.find(".mFromRange"),i=e.find(".mToRange"),l=o.min,r=o.max;t.val(l).trigger("change"),i.val(r).trigger("change")};t.find(":input:radio:checked").each(e),t.find(":input:checkbox:checked").each(n),a.each(o)},updateFilter:function(e){console.info("update filter");var n,o,i,l;console.info(e);var r={text:function(e,n){e.val(n).trigger("change")},radio:function(e,n){var o=e.filter('[value="'+n+'"]'),i=o.attr("id"),l=t.find('label[for="'+i+'"]');o.attr("checked","checked"),l.addClass("mChecked")},checkbox:function(e,n){e.filter('[value="'+n+'"]').attr("checked","checked").trigger("change")}};for(l in e){if(!e.hasOwnProperty(l))return;n=t.find('input[name="'+l+'"]'),o=e[l],i=n.attr("type"),console.log(n),console.log(o),console.log(i),r.hasOwnProperty(i)&&r[i](n,o)}}};var f=function f(){var e=$(this),n=e.find(".bFilterSlider"),o=n.data("config"),i=e.find(".mFromRange"),l=e.find(".mToRange"),r=o.min,a=o.max,c=o.step;n.slider({range:!0,step:c,min:r,max:a,values:[i.val(),l.val()],slide:function(e,n){i.val(n.values[0]),l.val(n.values[1])},change:function(e){console.log("change slider"),e.originalEvent&&t.trigger("change",[!0])}});var s=function s(){var e="0"+$(this).val();e=parseFloat(e),console.info("inputUpdates"),console.log(e),e=e>a?a:r>e?r:e,$(this).val(e),n.slider({values:[i.val(),l.val()]})};l.on("change",s),i.on("change",s)},g=function g(){var e=$(this),n=e.attr("href");return o.history.gotoUrl(n),!1},u=function u(){var e="mOpen",n="mClose",o=l.hasClass(e);return o?(l.removeClass(e).addClass(n),r.slideUp(400)):(l.removeClass(n).addClass(e),r.slideDown(400)),!1},h=function h(){var e=$(this),n=e.attr("href"),t="mActive",i=e.parent(),l=i.hasClass(t);return l?!1:(o.history.gotoUrl(n),!1)},p=function p(){var e=$(this),n="mActive",o=e.hasClass(n),i=e.data("ref");return o?!1:(c.removeClass(n),e.addClass(n),s.fadeOut(300),s.promise().done(function(){$("#"+i).fadeIn(300)}),$.scrollTo(t,500),!1)},m=function m(){var e=$(this),n=e.attr("href"),t="mActive",i=e.parent(),l=d.find(".mViewer .mSortItem"),r=i.hasClass(t);return r?!1:(l.removeClass(t),i.addClass(t),o.filter.lastRes?o.history.updateUrl(n):o.history.gotoUrl(n),!1)},v=function v(){var e=$(this),n=e.attr("href"),t="mActive",i=e.parent(),l=d.find(".mSorting .mSortItem"),r=i.hasClass(t);return r?!1:(l.removeClass(t),i.addClass(t),o.history.gotoUrl(n),!1)};l.on("click",u),c.on("click",p),t.on("change",o.filter.changeFilterHandler),t.on("submit",o.filter.sendFilter),d.on("click",".jsSorting",v),d.on("click",".jsChangeView",m),d.on("click",".jsPagination",h),$("body").on("click",".jsHistoryLink",g),a.each(f)}(window.ENTER),function(e){var n=(e.config.pageConfig,e.utils),o=n.extendApp("ENTER.catalog");console.info("New catalog history module"),o.history={_defaultCallback:o.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(e,n,t){console.info("gotoUrl");var i={title:document.title,url:e,data:{_onlychange:t?!0:!1}};return o.enableHistoryAPI?(o.history._customCallback=n?n:null,console.info("link handler. push state new url: "+i.url),History.pushState(i,i.title,i.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,n){var t=n?n:null;o.history.gotoUrl(e,t,!0)},getDataFromServer:function(e,n){console.info("getDataFromServer "+e),o.loader.loading();var t=function t(){o.loader.complete()},i=function i(e){console.info("resHandler"),"object"==typeof e?n(e):(console.warn("res isn't object"),console.log(typeof e)),o.loader.complete()};$.ajax({type:"GET",url:e,success:i,statusCode:{500:t,503:t},error:t})}};var t=function t(){var e=History.getState(),n=e.url,t=e.data.data,i="function"==typeof o.history._customCallback?o.history._customCallback:o.history._defaultCallback;console.info("statechange"),console.log(e),t._onlychange?(console.info("only update url "+n),i()):(n=n.addParameterToUrl("ajax","true"),o.history.getDataFromServer(n,i)),o.history._customCallback=null};History.Adapter.bind(window,"statechange",t)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var n=(e.config.pageConfig,e.utils),o=n.extendApp("ENTER.catalog"),t=$(".bSortingLine");o.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity"),"1"===window.docCookies.getItem("infScroll")&&o.infScroll.enable()},checkScroll:function(){console.info("checkscroll");var e=$(window),n=$(document);!o.infScroll.loading&&e.scrollTop()+800>n.height()-e.height()&&(console.warn("checkscroll true. load"),o.infScroll.nowPage+=1,o.infScroll.load())},load:function(){console.info("load page");var e=o.filter.getFilterUrl(),n=function n(e){var n;n=o.filter.render.list(e.list),o.infScroll.loading=!1,o.listingWrap.append(n)};o.liveScroll=!0,o.infScroll.loading=!0,e=e.addParameterToUrl("page",o.infScroll.nowPage),e=e.addParameterToUrl("ajax","true"),o.history.getDataFromServer(e,n)},enable:function(){console.info("enable...");var e="mActive",n=t.find(".mInfinity"),i=t.find(".mPaging"),l=t.find(".bSortingList__eItem.mPage"),r=o.filter.getFilterUrl();i.show(),l.hide(),n.addClass(e),o.infScroll.nowPage=1,o.infScroll.loading=!1,window.docCookies.setItem("infScroll",1,2419200,"/"),$(window).on("scroll",o.infScroll.checkScroll),o.history.gotoUrl(r),console.log("infinity scroll enable")},disable:function(){console.info("disable...");var e=o.filter.getFilterUrl();o.liveScroll=!1,e=e.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,0,"/"),$(window).off("scroll",o.infScroll.checkScroll),o.history.getDataFromServer(e,o.filter.renderCatalogPage),console.log("infinity scroll disable")}};var i=function i(){var e="mActive",n=t.find(".mInfinity"),i=n.hasClass(e);return i?!1:(o.infScroll.enable(),!1)},l=function l(){var e="mActive",n=t.find(".mInfinity"),i=n.hasClass(e);return i&&o.infScroll.disable(),!1};o.infScroll.checkInfinity(),t.on("click",".jsPaginationEnable",l),t.on("click",".jsInfinityEnable",i)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var n=(e.config.pageConfig,e.utils),o=n.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+o.enableHistoryAPI),o.loader={_loader:null,loading:function(){o.loader._loader||(o.loader._loader=$("<li>").addClass("mLoader"),o.liveScroll?o.listingWrap.append(o.loader._loader):(o.listingWrap.empty(),o.listingWrap.append(o.loader._loader)))},complete:function(){o.loader._loader&&(o.loader._loader.remove(),o.loader._loader=null)}}}(window.ENTER);