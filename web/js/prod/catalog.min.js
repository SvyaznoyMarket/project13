!function(a){console.info("Catalog init: catalog.js");var b=a.utils,c=b.extendApp("ENTER.catalog"),d=$("#bCatalog").data("lastpage");c.enableHistoryAPI="object"==typeof Mustache&&History.enabled,c.listingWrap=$(".bListing"),c.liveScroll=!1,c.lastPage=null,d&&(c.lastPage=d),console.info("Mustache is "+typeof Mustache+" (Catalog main config)"),console.info("enableHistoryAPI "+c.enableHistoryAPI)}(window.ENTER),function(a){console.info("New catalog init: filter.js");var b,c=$("body"),d=(a.config.pageConfig,a.utils),e=d.extendApp("ENTER.catalog"),f=$(".bFilter"),g=(f.find(".bBtnPick__eLink"),f.find(".bFilterToggle")),h=f.find(".bFilterCont"),i=f.find(".bRangeSlider"),j=f.find(".bFilterParams__eItem"),k=f.find(".bFilterValuesItem"),l=$(".bSortingLine");e.filter={lastRes:null,getViewType:function(){var a=l.find(".mViewer .mSortItem");return a.filter(".mActive").data("type")},applyTemplate:{list:function(a){console.info("applyTemplate list"),e.listingWrap.empty(),e.listingWrap.html(a)},selectedFilter:function(a){var b=f.find(".bFilterFoot");b.empty(),b.html(a)},sorting:function(a){var b=l.find(".bSortingList.mSorting");b.empty(),b.html(a)},pagination:function(a){var b=$(".bSortingList.mPager");b.empty(),b.html(a)},page:function(a){var b=$(".bTitlePage");b.empty(),b.html(a)},countProducts:function(a){var b=$(".bBtnPick__eLink",".bFilter"),c=a?parseInt(a):-1;c>=0&&b.length&&b.text("Подобрать ("+a+")")}},render:{list:function(a){console.info("render list"),console.log("undefined"!=typeof e.filter.getViewType()?e.filter.getViewType():"default");var b,c="undefined"!=typeof e.filter.getViewType()?e.filter.getViewType():"default",d={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},f=d[c].html(),g=d[c].data("partial");return b=Mustache.render(f,a,g),console.log("end of render list"),b},selectedFilter:function(a){if(console.info("render selectedFilter"),!a)return void console.warn("nothing to render");var b,c=$("#tplSelectedFilter"),d=c.html(),f=c.data("partial");return b=Mustache.render(d,a,f),a.hasOwnProperty("values")&&(console.info("run update filter!"),e.filter.updateFilter(a.values)),console.log("end of render selectedFilter"),b},sorting:function(a){console.info("render sorting");var b,c=$("script.tplSorting:first"),d=c.html(),e=c.data("partial");return b=Mustache.render(d,a,e),console.log("end of render sorting"),b},pagination:function(a){console.info("render pagination");var b,c=$("script.tplPagination:first"),d=c.html(),e=c.data("partial");return b=Mustache.render(d,a,e),console.log("end of render paginaton"),b},page:function(a){var b=a.title;return b},countProducts:function(a){return console.info("render countProducts"),a}},renderCatalogPage:function(a){console.info("renderCatalogPage");var b,d,f=a?a:e.filter.lastRes,g=a.pagination?a.pagination.lastPage:!1;e.filter.resetForm();for(b in f)e.filter.render.hasOwnProperty(b)&&(d=e.filter.render[b](f[b])),e.filter.applyTemplate.hasOwnProperty(b)&&e.filter.applyTemplate[b](d);e.infScroll.checkInfinity(),g&&(e.lastPage=g),e.filter.lastRes=f,c.trigger("markcartbutton")},getSlidersInputState:function(){console.info("getSlidersInputState");var a={changedSliders:[],unchangedSliders:[]},b=function(){var b=$(this),c=b.find(".bFilterSlider"),d=c.data("config"),e=b.find(".mFromRange"),f=b.find(".mToRange"),g=d.min,h=d.max;1*e.val()===g?a.unchangedSliders.push(e.attr("name")):a.changedSliders.push(e.attr("name")),1*f.val()===h?a.unchangedSliders.push(f.attr("name")):a.changedSliders.push(f.attr("name"))};return i.each(b),a},getFilterUrl:function(){console.info("getFilterUrl");for(var a,b=f.serializeArray(),c=f.attr("action")||"",d=e.filter.getSlidersInputState(),g=l.find(".mSortItem.mActive").find(".jsSorting"),h=g.data("sort"),i=e.filter.getUrlParams(),j=!1,k=b.length-1;k>=0;k--)-1!==d.unchangedSliders.indexOf(b[k].name)&&(console.log("slider input "+b[k].name+" unchanged"),b.splice(k,1));return i&&i.category&&($.each(b,function(){"category"==this.name&&(j=!0)}),j||b.unshift({name:"category",value:i.category})),a=$.param(b),0!==a.length&&(c+=-1===c.indexOf("?")?"?"+a:"&"+a),console.log(c),c=c.addParameterToUrl("sort",h)},getUrlParams:function(){var a,b,c={},d=window.location.search.substring(1).split("&");for(b=0;b<d.length;b++)a=d[b].split("="),c[a[0]]="undefined"==typeof a[1]?"":a[1];return c},changeFilterHandler:function(a,c){console.info("change filter"),console.log(a),console.log(c);var d=function(){f.trigger("submit")};return"object"==typeof a&&a.isTrigger&&!c?void console.warn("it's trigger event!"):e.enableHistoryAPI?(console.info("need update from server..."),clearTimeout(b),void(b=setTimeout(d,300))):void console.warn("history api off")},sendFilter:function(a){console.info("sendFilter"),console.log(a);var b=e.filter.getFilterUrl();return b!==document.location.pathname+document.location.search&&(console.info("goto url "+b),e.history.gotoUrl(b)),a.isTrigger?console.warn("it's trigger"):"object"==typeof a&&e.enableHistoryAPI&&(console.warn("it's true event and HistoryAPI enable"),$.scrollTo(f.find(".bFilterFoot"),500)),!1},resetForm:function(){console.info("resetForm");var a=function(a,b){var c=$(b),d=c.attr("id"),e=f.find('label[for="'+d+'"]');console.info(d),console.info(e),c.removeAttr("checked"),e.removeClass("mChecked")},b=function(a,b){$(b).removeAttr("checked").trigger("change")},c=function(){var a=$(this),b=a.find(".bFilterSlider"),c=b.data("config"),d=a.find(".mFromRange"),e=a.find(".mToRange"),f=c.min,g=c.max;d.val(f).trigger("change"),e.val(g).trigger("change")};f.find(":input:radio:checked").each(a),f.find(":input:checkbox:checked").each(b),i.each(c)},updateFilter:function(a){console.info("update filter");var b,c,d,e;console.info(a);var g={text:function(a,b){a.val(b).trigger("change")},radio:function(a,b){var c=a.filter('[value="'+b+'"]'),d=c.attr("id"),e=f.find('label[for="'+d+'"]');c.attr("checked","checked"),e.addClass("mChecked")},checkbox:function(a,b){a.filter('[value="'+b+'"]').attr("checked","checked").trigger("change")}};for(e in a){if(!a.hasOwnProperty(e))return;b=f.find('input[name="'+e+'"]'),c=a[e],d=b.attr("type"),console.log(b),console.log(c),console.log(d),g.hasOwnProperty(d)&&g[d](b,c)}},openFilter:function(){o(!0)}};var m=function(){var a=$(this),b=a.find(".bFilterSlider"),c=b.data("config"),d=a.find(".mFromRange"),e=a.find(".mToRange"),g=c.min,h=c.max,i=c.step;b.slider({range:!0,step:i,min:g,max:h,values:[d.val(),e.val()],slide:function(a,b){d.val(b.values[0]),e.val(b.values[1])},change:function(a){console.log("change slider"),a.originalEvent&&f.trigger("change",[!0])}});var j=function(){var a="0"+$(this).val();a=parseFloat(a),console.info("inputUpdates"),console.log(a),a=a>h?h:g>a?g:a,$(this).val(a),b.slider({values:[d.val(),e.val()]})};e.on("change",j),d.on("change",j)},n=function(){var a=$(this),b=a.attr("href");return e.history.gotoUrl(b),!1},o=function(a){var b="mOpen",c="mClose",d=g.hasClass(b);return d&&"boolean"!=typeof a?(g.removeClass(b).addClass(c),h.slideUp(400)):(g.removeClass(c).addClass(b),h.slideDown(400)),!1},p=function(){var a=$(this),b=a.attr("href"),c="mActive",d=a.parent(),g=d.hasClass(c);return g?!1:(e.history.gotoUrl(b),f.length&&$.scrollTo(f,500),!1)},q=function(){var a=$(this),b="mActive",c=a.hasClass(b),d=a.data("ref");return c?!1:(j.removeClass(b),a.addClass(b),k.fadeOut(300),k.promise().done(function(){$("#"+d).fadeIn(300)}),$.scrollTo(f,500),!1)},r=function(){var a=$(this),b=a.attr("href"),c="mActive",d=a.parent(),f=l.find(".mViewer .mSortItem"),g=d.hasClass(c);return g?!1:(f.removeClass(c),d.addClass(c),e.filter.lastRes?e.history.updateUrl(b):e.history.gotoUrl(b),!1)},s=function(){var a=$(this),b=a.attr("href"),c="mActive",d=a.parent(),f=l.find(".mSorting .mSortItem"),g=d.hasClass(c);return g?!1:(f.removeClass(c),d.addClass(c),e.history.gotoUrl(b),!1)};g.on("click",o),j.on("click",q),f.on("change",e.filter.changeFilterHandler),f.on("submit",e.filter.sendFilter),l.on("click",".jsSorting",s),l.on("click",".jsChangeView",r),l.on("click",".jsPagination",p),c.on("click",".jsHistoryLink",n),i.each(m)}(window.ENTER),function(a){var b=a.utils,c=b.extendApp("ENTER.catalog");console.info("New catalog history module"),c.history={_defaultCallback:c.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(a,b,d){console.info("gotoUrl");var e={title:document.title,url:a,data:{_onlychange:d?!0:!1}};return c.enableHistoryAPI?(c.history._customCallback=b?b:null,console.info("link handler. push state new url: "+e.url),void History.pushState(e,e.title,e.url)):void(document.location.href=a)},updateUrl:function(a,b){var d=b?b:null;c.history.gotoUrl(a,d,!0)},getDataFromServer:function(a,b){console.info("getDataFromServer "+a),c.loader&&c.loader.loading(),console.log("getDataFromServer::loading");var d=function(){c.loader&&c.loader.complete()},e=function(a){console.info("resHandler"),"object"==typeof a?b(a):(console.warn("res isn't object"),console.log(typeof a)),c.loader&&c.loader.complete()};$.ajax({type:"GET",url:a,success:e,statusCode:{500:d,503:d},error:d})}};var d=function(){var a=History.getState(),b=a.url,d=a.data.data,e="function"==typeof c.history._customCallback?c.history._customCallback:c.history._defaultCallback;console.info("statechange"),console.log(a),d._onlychange?(console.info("only update url "+b),e()):(b=b.addParameterToUrl("ajax","true"),c.history.getDataFromServer(b,e)),c.history._customCallback=null};History.Adapter.bind(window,"statechange",d)}(window.ENTER),function(a){console.info("Catalog init: catalog_infinityScroll.js");var b=a.utils,c=b.extendApp("ENTER.catalog"),d=$(".bSortingLine");c.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity "+window.docCookies.getItem("infScroll")),"1"===window.docCookies.getItem("infScroll")&&(console.warn("inf cookie == 1"),c.infScroll.enable())},checkScroll:function(){console.info("checkscroll");var a=$(window),b=$(document);!c.infScroll.loading&&a.scrollTop()+800>b.height()-a.height()&&(c.lastPage-c.infScroll.nowPage>0||null===c.lastPage)&&(console.warn("checkscroll true. load"),c.infScroll.nowPage+=1,c.infScroll.load())},load:function(){console.info("load page");var a=c.filter.getFilterUrl(),b=function(a){var b;b=c.filter.render.list(a.list),c.infScroll.loading=!1,c.listingWrap.append(b)};c.liveScroll=!0,c.infScroll.loading=!0,a=a.addParameterToUrl("page",c.infScroll.nowPage),a=a.addParameterToUrl("ajax","true"),c.history.getDataFromServer(a,b)},enable:function(){console.info("enable...");var a="mActive",b=d.find(".mInfinity"),e=d.find(".mPaging"),f=d.find(".bSortingList__eItem.mPage"),g=c.filter.getFilterUrl(),h=document.location.search.match("page=");e.show(),f.hide(),b.addClass(a),c.infScroll.nowPage=1,c.infScroll.loading=!1,window.docCookies.setItem("infScroll",1,2419200,"/"),c.infScroll.checkScroll(),$(window).on("scroll",c.infScroll.checkScroll),console.info(h),c.enableHistoryAPI&&h&&c.history.gotoUrl(g),console.log("infinity scroll enable")},disable:function(){console.info("disable infinity...");var a=c.filter.getFilterUrl();c.liveScroll=!1,a=a.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,2419200,"/"),$(window).off("scroll",c.infScroll.checkScroll),c.history.getDataFromServer(a,c.filter.renderCatalogPage),console.log("infinity scroll disable "+window.docCookies.getItem("infScroll"))}};var e=function(){var a="mActive",b=d.find(".mInfinity"),e=b.hasClass(a);return e?!1:(c.infScroll.enable(),!1)},f=function(){console.info("paginationBtnHandler");var a="mActive",b=d.find(".mInfinity"),e=b.hasClass(a);return e&&c.infScroll.disable(),!1};c.infScroll.checkInfinity(),d.on("click",".jsPaginationEnable",f),d.on("click",".jsInfinityEnable",e)}(window.ENTER),function(a){console.info("New catalog init: loader.js");var b=(a.config.pageConfig,a.utils),c=b.extendApp("ENTER.catalog"),d=$(".bBtnPick__eLink",".bFilter");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+c.enableHistoryAPI),c.loader={_loader:null,loading:function(){c.loader._loader||(c.loader._loader=$("<li>").addClass("mLoader"),d.addClass("mButLoader").text("Подобрать"),c.liveScroll?c.listingWrap.append(c.loader._loader):(c.listingWrap.empty(),c.listingWrap.append(c.loader._loader)))},complete:function(){c.loader._loader&&(c.loader._loader.remove(),c.loader._loader=null),d.removeClass("mButLoader")}}}(window.ENTER),function(){var a=$(".jsChangePackageSet"),b=$(".jsPackageSetPopup"),c=function(){b.lightbox_me({autofocus:!0})};a.on("click",c)}(window.ENTER),$(document).ready(function(){function a(a,b){var c=window[window.GoogleAnalyticsObject],d=window._gaq,e=window.location.href;c&&c("send","event",a,e,b),d&&d.push(["_trackEvent",a,e,b])}var b=$(".jsDataSmartChoice"),c=$(".specialPriceItem"),d=b.attr("data-smartchoice");$.getJSON("/ajax/product-smartchoice",{"products[]":b.data("smartchoice")},function(a){a.success&&($.each(a.result,function(a,b){$slider=$.parseHTML(b.content),$($slider).hide(),$(".specialBorderBox").append($slider),$(".smartChoiceSliderToggle-"+a).show()}),$(".bGoodsSlider").goodsSlider(),console.info("smartchoice ajax: ",a.result))}),$(".jsSmartChoiceSliderToggle a").click(function(a){a.preventDefault();var b=$(a.target),c=b.closest("div").data("smartchoice"),d=b.closest("a"),e=$(".specialPriceItemFoot_link");d.hasClass("mActive")?(e.removeClass("mActive"),$(".smartChoiceId-"+c).parent().hide(),$(".specialBorderBox").removeClass("specialBorderBox_render")):(e.removeClass("mActive"),d.addClass("mActive"),$(".bGoodsSlider").hide(),$(".specialBorderBox").addClass("specialBorderBox_render"),$(".smartChoiceId-"+c).parent().show())}),"undefined"!=typeof d&&d!==!1?c.addClass("specialPriceItem_minHeight"):c.removeClass("specialPriceItem_minHeight"),c.on("click",".specialPriceItemCont_imgLink, .specialPriceItemCont_name",function(){var b=$(this).data("article");a("SmartChoice_click",b)}),b.on("click",".productImg, .productName a",function(b){var c=$(b.target).closest(".bSlider__eItem").data("product").article;a("SmartChoice_similar_click",c)})});