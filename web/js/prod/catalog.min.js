(function(e){console.info("Catalog init: catalog.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");t.enableHistoryAPI="object"==typeof Mustache&&History.enabled,t.listingWrap=$(".bListing"),t.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+t.enableHistoryAPI)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),o=$(".bFilter"),l=o.find(".bFilterToggle"),i=o.find(".bFilterCont"),a=o.find(".bRangeSlider"),r=o.find(".bFilterParams__eItem"),c=o.find(".bFilterValuesItem"),s=$(".bSortingLine");t.filter={lastRes:null,getViewType:function(){var e=s.find(".mViewer .mSortItem");return e.filter(".mActive").data("type")},applyTemplate:{list:function(e){console.info("applyTemplate list"),t.listingWrap.empty(),t.listingWrap.html(e)},selectedFilter:function(e){var n=o.find(".bFilterFoot");n.empty(),n.html(e)},sorting:function(e){var n=s.find(".bSortingList.mSorting");n.empty(),n.html(e)},pagination:function(e){var n=$(".bSortingList.mPager");n.empty(),n.html(e)}},render:{list:function(e){console.info("render list"),console.log(t.filter.getViewType()!==void 0?t.filter.getViewType():"default");var n,o=t.filter.getViewType()!==void 0?t.filter.getViewType():"default",l={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},i=l[o].html(),a=l[o].data("partial");return n=Mustache.render(i,e,a),console.log("end of render list"),n},selectedFilter:function(e){console.info("render selectedFilter");var n,t=$("#tplSelectedFilter"),o=t.html(),l=t.data("partial");return n=Mustache.render(o,e,l),console.log("end of render selectedFilter"),n},sorting:function(e){console.info("render sorting");var n,t=$("#tplSorting"),o=t.html(),l=t.data("partial");return n=Mustache.render(o,e,l),console.log("end of render sorting"),n},pagination:function(e){console.info("render pagination");var n,t=$("#tplPagination"),o=t.html(),l=t.data("partial");return n=Mustache.render(o,e,l),console.log("end of render paginaton"),n}},renderCatalogPage:function(e){console.info("renderCatalogPage");var n,o,l=e?e:t.filter.lastRes;for(n in l)t.filter.render.hasOwnProperty(n)&&t.filter.applyTemplate.hasOwnProperty(n)&&(o=t.filter.render[n](l[n]),t.filter.applyTemplate[n](o));t.infScroll.checkInfinity(),t.filter.lastRes=l},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},n=function n(){var n=$(this),t=n.find(".bFilterSlider"),o=t.data("config"),l=n.find(".mFromRange"),i=n.find(".mToRange"),a=o.min,r=o.max;1*l.val()===a?e.unchangedSliders.push(l.attr("name")):e.changedSliders.push(l.attr("name")),1*i.val()===r?e.unchangedSliders.push(i.attr("name")):e.changedSliders.push(i.attr("name"))};return a.each(n),e},getFilterUrl:function(){for(var e,n=o.serializeArray(),l=o.attr("action"),i=t.filter.getSlidersInputState(),a=n.length-1;a>=0;a--)-1!==i.unchangedSliders.indexOf(n[a].name)&&(console.log("slider input "+n[a].name+" unchanged"),n.splice(a,1));return e=$.param(n),0!==e.length&&(l+="?"+e),l},changeFilterHandler:function(){console.info("change filter")},sendFilter:function(){var e=t.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),t.history.gotoUrl(e)),!1},resetForm:function(){console.info("resetForm");var e=function e(e,n){var t=$(n),l=t.attr("id"),i=o.find('label[for="'+l+'"]');console.info(l),console.info(i),t.removeAttr("checked"),i.removeClass("mChecked")},n=function n(e,n){$(n).removeAttr("checked").trigger("change")},t=function t(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),o=e.find(".mFromRange"),l=e.find(".mToRange"),i=t.min,a=t.max;o.val(i).trigger("change"),l.val(a).trigger("change")};o.find(":input:radio:checked").each(e),o.find(":input:checkbox:checked").each(n),a.each(t)},updateFilter:function(){console.info("update filter")}};var d=function d(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),l=e.find(".mFromRange"),i=e.find(".mToRange"),a=t.min,r=t.max,c=t.step;n.slider({range:!0,step:c,min:a,max:r,values:[l.val(),i.val()],slide:function(e,n){l.val(n.values[0]),i.val(n.values[1])},change:function(){console.log("change slider"),o.trigger("change")}});var s=function s(){var e="0"+$(this).val();e=parseInt(e,10),e=e>r?r:a>e?a:e,$(this).val(e),n.slider({values:[l.val(),i.val()]})};i.on("change",s),l.on("change",s)},f=function f(){var e=$(this),n=e.attr("href");return t.history.gotoUrl(n),!1},g=function g(){var e="mOpen",n="mClose",t=l.hasClass(e);return t?(l.removeClass(e).addClass(n),i.slideUp(400)):(l.removeClass(n).addClass(e),i.slideDown(400)),!1},u=function u(){var e=$(this),n=e.attr("href"),o="mActive",l=e.parent(),i=l.hasClass(o);return i?!1:(t.history.gotoUrl(n),!1)},h=function h(){var e=$(this),n="mActive",t=e.hasClass(n),o=e.data("ref");return t?!1:(r.removeClass(n),e.addClass(n),c.fadeOut(300),c.promise().done(function(){$("#"+o).fadeIn(300)}),!1)},m=function m(){var e=$(this),n=e.attr("href"),o="mActive",l=e.parent(),i=s.find(".mViewer .mSortItem"),a=l.hasClass(o);return a?!1:(i.removeClass(o),l.addClass(o),t.filter.lastRes?t.history.updateUrl(n):t.history.gotoUrl(n),!1)},p=function p(){var e=$(this),n=e.attr("href"),o="mActive",l=e.parent(),i=s.find(".mSorting .mSortItem"),a=l.hasClass(o);return a?!1:(i.removeClass(o),l.addClass(o),t.history.gotoUrl(n),!1)};l.on("click",g),r.on("click",h),o.on("change",t.filter.changeFilterHandler),o.on("submit",t.filter.sendFilter),s.on("click",".jsSorting",p),s.on("click",".jsChangeView",m),s.on("click",".jsPagination",u),$("body").on("click",".jsHistoryLink",f),a.each(d)}(window.ENTER),function(e){var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");console.info("New catalog history module"),t.history={_defaultCallback:t.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(e,n,o){console.info("gotoUrl");var l={title:document.title,url:e,data:{_onlychange:o?!0:!1}};return t.enableHistoryAPI?(t.history._customCallback=n?n:null,console.info("link handler. push state new url: "+l.url),History.pushState(l,l.title,l.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,n){var o=n?n:null;t.history.gotoUrl(e,o,!0)},getDataFromServer:function(e,n){console.info("getDataFromServer "+e),t.loader.loading();var o=function o(){t.loader.complete()},l=function l(e){console.info("resHandler"),"object"==typeof e?n(e):(console.warn("res isn't object"),console.log(typeof e)),t.loader.complete()};$.ajax({type:"GET",url:e,success:l,statusCode:{500:o,503:o}})}};var o=function o(){var e=History.getState(),n=e.url,o=e.data.data,l="function"==typeof t.history._customCallback?t.history._customCallback:t.history._defaultCallback;console.info("statechange"),console.log(e),o._onlychange?(console.info("only update url "+n),l()):(n=n.addParameterToUrl("ajax","true"),t.history.getDataFromServer(n,l)),t.history._customCallback=null};History.Adapter.bind(window,"statechange",o)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),o=$(".bSortingLine");t.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity"),"1"===window.docCookies.getItem("infScroll")&&t.infScroll.enable()},checkScroll:function(){console.info("checkscroll");var e=$(window),n=$(document);!t.infScroll.loading&&e.scrollTop()+800>n.height()-e.height()&&(console.warn("checkscroll true. load"),t.infScroll.nowPage+=1,t.infScroll.load())},load:function(){console.info("load page");var e=t.filter.getFilterUrl(),n=function n(e){var n;n=t.filter.render.list(e.list),t.infScroll.loading=!1,t.listingWrap.append(n)};t.liveScroll=!0,t.infScroll.loading=!0,e=e.addParameterToUrl("page",t.infScroll.nowPage),e=e.addParameterToUrl("ajax","true"),t.history.getDataFromServer(e,n)},enable:function(){console.info("enable...");var e="mActive",n=o.find(".mInfinity"),l=o.find(".mPaging"),i=o.find(".bSortingList__eItem.mPage"),a=t.filter.getFilterUrl();l.show(),i.hide(),n.addClass(e),t.infScroll.nowPage=1,window.docCookies.setItem("infScroll",1,2419200,"/"),$(window).on("scroll",t.infScroll.checkScroll),t.history.gotoUrl(a),console.log("infinity scroll enable")},disable:function(){console.info("disable...");var e=t.filter.getFilterUrl();t.liveScroll=!1,e=e.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,0,"/"),$(window).off("scroll",t.infScroll.checkScroll),t.history.getDataFromServer(e,t.filter.renderCatalogPage),console.log("infinity scroll disable")}};var l=function l(){var e="mActive",n=o.find(".mInfinity"),l=n.hasClass(e);return l?!1:(t.infScroll.enable(),!1)},i=function i(){var e="mActive",n=o.find(".mInfinity"),l=n.hasClass(e);return l&&t.infScroll.disable(),!1};t.infScroll.checkInfinity(),o.on("click",".jsPaginationEnable",i),o.on("click",".jsInfinityEnable",l)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+t.enableHistoryAPI),t.loader={_loader:null,loading:function(){t.loader._loader||(t.loader._loader=$("<li>").addClass("mLoader"),t.liveScroll?t.listingWrap.append(t.loader._loader):(t.listingWrap.empty(),t.listingWrap.append(t.loader._loader)))},complete:function(){t.loader._loader&&(t.loader._loader.remove(),t.loader._loader=null)}}}(window.ENTER);