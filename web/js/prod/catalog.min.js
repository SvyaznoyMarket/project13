(function(e){var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");console.info("New catalog history module"),t.history={gotoUrl:function(e,n){var o={title:document.title,url:e};return t.history._callback=n,t.enableHistoryAPI?(console.info("link handler. push state new url: "+o.url),History.pushState(o,o.title,o.url),void 0):(document.location.href=e,void 0)}};var o=function o(){n.blockScreen.unblock()},a=function a(e){console.info("resHandler"),"object"==typeof e&&"function"==typeof t.history._callback?t.history._callback(e):(console.warn("res isn't object or catalog.history._callback isn't function"),console.log(typeof e),console.log(typeof t.history._callback)),n.blockScreen.unblock()},i=function i(){var e=History.getState(),t=e.url;console.info("statechange"),n.blockScreen.block("Загрузка товаров"),t=t.addParameterToUrl("ajax","true"),console.log(t),console.log(e),$.ajax({type:"GET",url:t,success:a,statusCode:{500:o,503:o}})};History.Adapter.bind(window,"statechange",i)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),o=$(".bFilter"),a=o.find(".bFilterToggle"),i=o.find(".bFilterCont"),l=o.find(".bRangeSlider"),r=o.find(".bFilterParams__eItem"),s=o.find(".bFilterValuesItem"),c=$(".bSortingLine"),d=c.find(".mSorting .mSortItem");c.find(".mViewer .mSortItem"),c.find(".mViewer .mPager"),t.enableHistoryAPI="object"==typeof Mustache&&History.enabled,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+t.enableHistoryAPI),t.filter={renderTmpl:function(e){console.info("callback: renderTmpl");var n,t=$("#listing_compact_tmpl"),o=t.html(),a=t.data("partial"),i=$(".bListing");n=Mustache.render(o,e,a),i.empty(),i.html(n)},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},n=function n(){var n=$(this),t=n.find(".bFilterSlider"),o=t.data("config"),a=n.find(".mFromRange"),i=n.find(".mToRange"),l=o.min,r=o.max;1*a.val()===l?e.unchangedSliders.push(a.attr("name")):e.changedSliders.push(a.attr("name")),1*i.val()===r?e.unchangedSliders.push(i.attr("name")):e.changedSliders.push(i.attr("name"))};return l.each(n),e},getFilterUrl:function(){for(var e,n=o.serializeArray(),a=o.attr("action"),i=t.filter.getSlidersInputState(),l=n.length-1;l>=0;l--)-1!==i.unchangedSliders.indexOf(n[l].name)&&(console.log("slider input "+n[l].name+" unchanged"),n.splice(l,1));return e=$.param(n),0!==e.length&&(a+="?"+e),a},changeFilterHandler:function(){console.info("change filter")},sendFilter:function(){var e=t.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),t.history.gotoUrl(e,t.filter.renderTmpl)),!1},updateFilter:function(){console.info("update filter")}};var f=function f(){var e="mOpen",n="mClose",t=a.hasClass(e);return t?(a.removeClass(e).addClass(n),i.slideUp(400)):(a.removeClass(n).addClass(e),i.slideDown(400)),!1},u=function u(){var e=$(this),n="mActive",t=e.hasClass(n),o=e.data("ref");return t?!1:(r.removeClass(n),e.addClass(n),s.fadeOut(300),s.promise().done(function(){$("#"+o).fadeIn(300)}),!1)},g=function g(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),a=e.find(".mFromRange"),i=e.find(".mToRange"),l=t.min,r=t.max,s=t.step;n.slider({range:!0,step:s,min:l,max:r,values:[a.val(),i.val()],slide:function(e,n){a.val(n.values[0]),i.val(n.values[1])},change:function(){console.log("change slider"),o.trigger("change")}});var c=function c(){var e="0"+$(this).val();e=parseInt(e,10),e=e>r?r:l>e?l:e,$(this).val(e),n.slider({values:[a.val(),i.val()]})};i.on("change",c),a.on("change",c)},h=function h(){var e=$(this),n=e.attr("href"),o=e.parent();return d.removeClass("mActive"),o.addClass("mActive"),t.history.gotoUrl(n,t.filter.renderTmpl),!1};a.on("click",f),r.on("click",u),o.on("change",t.filter.changeFilterHandler),o.on("submit",t.filter.sendFilter),d.on("click",".bSortingList__eLink",h),l.each(g)}(window.ENTER);