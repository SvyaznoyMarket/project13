(function(e){console.info("Catalog init: catalog.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");r.enableHistoryAPI="object"==typeof Mustache&&History.enabled,r.listingWrap=$(".bListing"),r.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var t,r=(e.config.pageConfig,e.utils),i=r.extendApp("ENTER.catalog"),n=$(".bFilter"),o=n.find(".bBtnPick__eLink"),a=n.find(".bFilterToggle"),s=n.find(".bFilterCont"),l=n.find(".bRangeSlider"),c=n.find(".bFilterParams__eItem"),u=n.find(".bFilterValuesItem"),h=$(".bSortingLine");i.filter={lastRes:null,getViewType:function(){var e=h.find(".mViewer .mSortItem");return e.filter(".mActive").data("type")},applyTemplate:{list:function(e){console.info("applyTemplate list"),i.listingWrap.empty(),i.listingWrap.html(e)},selectedFilter:function(e){var t=n.find(".bFilterFoot");t.empty(),t.html(e)},sorting:function(e){var t=h.find(".bSortingList.mSorting");t.empty(),t.html(e)},pagination:function(e){var t=$(".bSortingList.mPager");t.empty(),t.html(e)},page:function(e){var t=$(".bTitlePage");t.empty(),t.html(e)}},render:{list:function(e){console.info("render list"),console.log(i.filter.getViewType()!==void 0?i.filter.getViewType():"default");var t,r=i.filter.getViewType()!==void 0?i.filter.getViewType():"default",n={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},o=n[r].html(),a=n[r].data("partial");return t=Mustache.render(o,e,a),console.log("end of render list"),t},selectedFilter:function(e){if(console.info("render selectedFilter"),!e)return console.warn("nothing to render"),void 0;var t,r=$("#tplSelectedFilter"),n=r.html(),o=r.data("partial");return t=Mustache.render(n,e,o),e.hasOwnProperty("values")&&(console.info("run update filter!"),i.filter.updateFilter(e.values)),console.log("end of render selectedFilter"),t},sorting:function(e){console.info("render sorting");var t,r=$("#tplSorting"),i=r.html(),n=r.data("partial");return t=Mustache.render(i,e,n),console.log("end of render sorting"),t},pagination:function(e){console.info("render pagination");var t,r=$("#tplPagination"),i=r.html(),n=r.data("partial");return t=Mustache.render(i,e,n),console.log("end of render paginaton"),t},page:function(e){var t=e.title;return t}},renderCatalogPage:function(e){console.info("renderCatalogPage");var t,r,n=e?e:i.filter.lastRes;i.filter.resetForm();for(t in n)i.filter.render.hasOwnProperty(t)&&(r=i.filter.render[t](n[t])),i.filter.applyTemplate.hasOwnProperty(t)&&i.filter.applyTemplate[t](r);i.infScroll.checkInfinity(),i.filter.lastRes=n},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},t=function t(){var t=$(this),r=t.find(".bFilterSlider"),i=r.data("config"),n=t.find(".mFromRange"),o=t.find(".mToRange"),a=i.min,s=i.max;1*n.val()===a?e.unchangedSliders.push(n.attr("name")):e.changedSliders.push(n.attr("name")),1*o.val()===s?e.unchangedSliders.push(o.attr("name")):e.changedSliders.push(o.attr("name"))};return l.each(t),e},getFilterUrl:function(){console.info("getFilterUrl");for(var e,t=n.serializeArray(),r=n.attr("action")||"",o=i.filter.getSlidersInputState(),a=h.find(".mSortItem.mActive").find(".jsSorting"),s=a.data("sort"),l=i.filter.getUrlParams(),c=!1,u=t.length-1;u>=0;u--)-1!==o.unchangedSliders.indexOf(t[u].name)&&(console.log("slider input "+t[u].name+" unchanged"),t.splice(u,1));return l&&l.category&&($.each(t,function(){"category"==this.name&&(c=!0)}),c||t.unshift({name:"category",value:l.category})),e=$.param(t),0!==e.length&&(r+=-1===r.indexOf("?")?"?"+e:"&"+e),console.log(r),r=r.addParameterToUrl("sort",s)},getUrlParams:function(){for(var e,t={},r=window.location.search.substring(1).split("&"),i=0;r.length>i;i++)e=r[i].split("="),t[e[0]]=e[1]===void 0?"":e[1];return t},changeFilterHandler:function(e,r){console.info("change filter"),console.log(e),console.log(r);var o=function o(){n.trigger("submit")};return"object"==typeof e&&e.isTrigger&&!r?(console.warn("it's trigger event!"),void 0):i.enableHistoryAPI?(console.info("need update from server..."),clearTimeout(t),t=setTimeout(o,300),void 0):(console.warn("history api off"),void 0)},sendFilter:function(e){console.info("sendFilter"),console.log(e);var t=i.filter.getFilterUrl();return t!==document.location.pathname+document.location.search&&(console.info("goto url "+t),i.history.gotoUrl(t)),e.isTrigger?(console.warn("it's trigger"),o.animate({boxShadow:"1px 1px 20px #ffa901"},300,"swing",function(){o.animate({boxShadow:"1px 1px 3px #C7C7C7"},300,"swing")})):"object"==typeof e&&i.enableHistoryAPI&&(console.warn("it's true event and HistoryAPI enable"),$.scrollTo(n.find(".bFilterFoot"),500)),!1},resetForm:function(){console.info("resetForm");var e=function e(e,t){var r=$(t),i=r.attr("id"),o=n.find('label[for="'+i+'"]');console.info(i),console.info(o),r.removeAttr("checked"),o.removeClass("mChecked")},t=function t(e,t){$(t).removeAttr("checked").trigger("change")},r=function r(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),i=e.find(".mFromRange"),n=e.find(".mToRange"),o=r.min,a=r.max;i.val(o).trigger("change"),n.val(a).trigger("change")};n.find(":input:radio:checked").each(e),n.find(":input:checkbox:checked").each(t),l.each(r)},updateFilter:function(e){console.info("update filter");var t,r,i,o;console.info(e);var a={text:function(e,t){e.val(t).trigger("change")},radio:function(e,t){var r=e.filter('[value="'+t+'"]'),i=r.attr("id"),o=n.find('label[for="'+i+'"]');r.attr("checked","checked"),o.addClass("mChecked")},checkbox:function(e,t){e.filter('[value="'+t+'"]').attr("checked","checked").trigger("change")}};for(o in e){if(!e.hasOwnProperty(o))return;t=n.find('input[name="'+o+'"]'),r=e[o],i=t.attr("type"),console.log(t),console.log(r),console.log(i),a.hasOwnProperty(i)&&a[i](t,r)}}};var d=function d(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),i=e.find(".mFromRange"),o=e.find(".mToRange"),a=r.min,s=r.max,l=r.step;t.slider({range:!0,step:l,min:a,max:s,values:[i.val(),o.val()],slide:function(e,t){i.val(t.values[0]),o.val(t.values[1])},change:function(e){console.log("change slider"),e.originalEvent&&n.trigger("change",[!0])}});var c=function c(){var e="0"+$(this).val();e=parseFloat(e),console.info("inputUpdates"),console.log(e),e=e>s?s:a>e?a:e,$(this).val(e),t.slider({values:[i.val(),o.val()]})};o.on("change",c),i.on("change",c)},p=function p(){var e=$(this),t=e.attr("href");return i.history.gotoUrl(t),!1},f=function f(){var e="mOpen",t="mClose",r=a.hasClass(e);return r?(a.removeClass(e).addClass(t),s.slideUp(400)):(a.removeClass(t).addClass(e),s.slideDown(400)),!1},m=function m(){var e=$(this),t=e.attr("href"),r="mActive",n=e.parent(),o=n.hasClass(r);return o?!1:(i.history.gotoUrl(t),!1)},v=function v(){var e=$(this),t="mActive",r=e.hasClass(t),i=e.data("ref");return r?!1:(c.removeClass(t),e.addClass(t),u.fadeOut(300),u.promise().done(function(){$("#"+i).fadeIn(300)}),$.scrollTo(n,500),!1)},g=function g(){var e=$(this),t=e.attr("href"),r="mActive",n=e.parent(),o=h.find(".mViewer .mSortItem"),a=n.hasClass(r);return a?!1:(o.removeClass(r),n.addClass(r),i.filter.lastRes?i.history.updateUrl(t):i.history.gotoUrl(t),!1)},_=function _(){var e=$(this),t=e.attr("href"),r="mActive",n=e.parent(),o=h.find(".mSorting .mSortItem"),a=n.hasClass(r);return a?!1:(o.removeClass(r),n.addClass(r),i.history.gotoUrl(t),!1)};a.on("click",f),c.on("click",v),n.on("change",i.filter.changeFilterHandler),n.on("submit",i.filter.sendFilter),h.on("click",".jsSorting",_),h.on("click",".jsChangeView",g),h.on("click",".jsPagination",m),$("body").on("click",".jsHistoryLink",p),l.each(d)}(window.ENTER),function(e){var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("New catalog history module"),r.history={_defaultCallback:r.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(e,t,i){console.info("gotoUrl");var n={title:document.title,url:e,data:{_onlychange:i?!0:!1}};return r.enableHistoryAPI?(r.history._customCallback=t?t:null,console.info("link handler. push state new url: "+n.url),History.pushState(n,n.title,n.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,t){var i=t?t:null;r.history.gotoUrl(e,i,!0)},getDataFromServer:function(e,t){console.info("getDataFromServer "+e),r.loader&&r.loader.loading(),console.log("getDataFromServer::loading");var i=function i(){r.loader&&r.loader.complete()},n=function n(e){console.info("resHandler"),"object"==typeof e?t(e):(console.warn("res isn't object"),console.log(typeof e)),r.loader&&r.loader.complete()};$.ajax({type:"GET",url:e,success:n,statusCode:{500:i,503:i},error:i})}};var i=function i(){var e=History.getState(),t=e.url,i=e.data.data,n="function"==typeof r.history._customCallback?r.history._customCallback:r.history._defaultCallback;console.info("statechange"),console.log(e),i._onlychange?(console.info("only update url "+t),n()):(t=t.addParameterToUrl("ajax","true"),r.history.getDataFromServer(t,n)),r.history._customCallback=null};History.Adapter.bind(window,"statechange",i)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bSortingLine");r.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity "+window.docCookies.getItem("infScroll")),"1"===window.docCookies.getItem("infScroll")&&(console.warn("inf cookie == 1"),r.infScroll.enable())},checkScroll:function(){console.info("checkscroll");var e=$(window),t=$(document);!r.infScroll.loading&&e.scrollTop()+800>t.height()-e.height()&&(console.warn("checkscroll true. load"),r.infScroll.nowPage+=1,r.infScroll.load())},load:function(){console.info("load page");var e=r.filter.getFilterUrl(),t=function t(e){var t;t=r.filter.render.list(e.list),r.infScroll.loading=!1,r.listingWrap.append(t)};r.liveScroll=!0,r.infScroll.loading=!0,e=e.addParameterToUrl("page",r.infScroll.nowPage),e=e.addParameterToUrl("ajax","true"),r.history.getDataFromServer(e,t)},enable:function(){console.info("enable...");var e="mActive",t=i.find(".mInfinity"),n=i.find(".mPaging"),o=i.find(".bSortingList__eItem.mPage"),a=r.filter.getFilterUrl(),s=document.location.search.match("page=");n.show(),o.hide(),t.addClass(e),r.infScroll.nowPage=1,r.infScroll.loading=!1,window.docCookies.setItem("infScroll",1,2419200,"/"),r.infScroll.checkScroll(),$(window).on("scroll",r.infScroll.checkScroll),console.info(s),r.enableHistoryAPI&&s&&r.history.gotoUrl(a),console.log("infinity scroll enable")},disable:function(){console.info("disable infinity...");var e=r.filter.getFilterUrl();r.liveScroll=!1,e=e.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,2419200,"/"),$(window).off("scroll",r.infScroll.checkScroll),r.history.getDataFromServer(e,r.filter.renderCatalogPage),console.log("infinity scroll disable "+window.docCookies.getItem("infScroll"))}};var n=function n(){var e="mActive",t=i.find(".mInfinity"),n=t.hasClass(e);return n?!1:(r.infScroll.enable(),!1)},o=function o(){console.info("paginationBtnHandler");var e="mActive",t=i.find(".mInfinity"),n=t.hasClass(e);return n&&r.infScroll.disable(),!1};r.infScroll.checkInfinity(),i.on("click",".jsPaginationEnable",o),i.on("click",".jsInfinityEnable",n)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI),r.loader={_loader:null,loading:function(){r.loader._loader||(r.loader._loader=$("<li>").addClass("mLoader"),r.liveScroll?r.listingWrap.append(r.loader._loader):(r.listingWrap.empty(),r.listingWrap.append(r.loader._loader)))},complete:function(){r.loader._loader&&(r.loader._loader.remove(),r.loader._loader=null)}}}(window.ENTER);