(function(e){console.info("New catalog history module");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");r.history={gotoUrl:function(e){var t={title:"Enter - это выход!",url:e};return History.enabled?(console.info("link handler. push state new url: "+t.url),History.pushState(t,t.title,t.url),void 0):(document.location.href=e,void 0)}};var i=function i(){var e=$(this).attr("href");return r.history.gotoUrl(e),!1},n=function n(){console.info("resHandler")},a=function a(){var e=History.getState(),t=e.url;console.info("statechange"),t=t.addParameterToUrl("ajax","true"),console.log(t),console.log(e),$.ajax({type:"GET",url:t,success:n})};History.Adapter.bind(window,"statechange",a),$("body").on("click",".jsHistoryLink",i)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bFilter"),n=i.find(".bFilterToggle"),a=i.find(".bFilterCont"),o=i.find(".bFilterParams__eItem"),s=i.find(".bFilterValuesItem");console.log("Mustache is "+typeof Mustache),r.filter={getSlidersInputState:function(){console.info("getSlidersInputState");var e=$(".bRangeSlider"),t={changedSliders:[],unchangedSliders:[]},r=function r(){var e=$(this),r=e.find(".bFilterSlider"),i=r.data("config"),n=e.find(".mFromRange"),a=e.find(".mToRange"),o=i.min,s=i.max;1*n.val()===o?t.unchangedSliders.push(n.attr("name")):t.changedSliders.push(n.attr("name")),1*a.val()===s?t.unchangedSliders.push(a.attr("name")):t.changedSliders.push(a.attr("name"))};return e.each(r),t},getFilterUrl:function(){for(var e,t=i.serializeArray(),n=i.attr("action"),a=r.filter.getSlidersInputState(),o=t.length-1;o>=0;o--)-1!==a.unchangedSliders.indexOf(t[o].name)&&(console.log("slider input "+t[o].name+" unchanged"),t.splice(o,1));return e=$.param(t),0!==e.length&&(n+="?"+e),console.log(n),n},sendFilter:function(){var e=r.filter.getFilterUrl();return e.length&&r.history.gotoUrl(e),!1},updateFilter:function(){console.info("update filter")}};var l=function l(){var e="mOpen",t="mClose",r=n.hasClass(e);return r?(n.removeClass(e).addClass(t),a.slideUp(400)):(n.removeClass(t).addClass(e),a.slideDown(400)),!1},c=function c(){var e=$(this),t="mActive",r=e.hasClass(t),i=e.data("ref");return r?!1:(o.removeClass(t),e.addClass(t),s.fadeOut(300),s.promise().done(function(){$("#"+i).fadeIn(300)}),!1)},u=function u(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),i=e.find(".mFromRange"),n=e.find(".mToRange"),a=r.min,o=r.max,s=r.step;t.slider({range:!0,step:s,min:a,max:o,values:[i.val(),n.val()],slide:function(e,t){i.val(t.values[0]),n.val(t.values[1])},change:function(){console.log("change slider")}});var l=function l(){var e="0"+$(this).val();e=parseInt(e,10),e=e>o?o:a>e?a:e,$(this).val(e),t.slider({values:[i.val(),n.val()]})};n.on("change",l),i.on("change",l)};n.on("click",l),o.on("click",c),i.on("submit",r.filter.sendFilter),$(".bRangeSlider").each(u)}(window.ENTER);