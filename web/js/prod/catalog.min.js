(function(e){console.info("New catalog history module");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");t.history={gotoUrl:function(e){var n={title:"Enter - это выход!",url:e};return History.enabled?(console.info("link handler. push state new url: "+n.url),History.pushState(n,n.title,n.url),void 0):(document.location.href=e,void 0)}};var a=function a(){var e=$(this).attr("href");return t.history.gotoUrl(e),!1},i=function i(){console.info("resHandler")},l=function l(){var e=History.getState(),n=e.url;console.info("statechange"),n=n.addParameterToUrl("ajax","true"),console.log(n),console.log(e),$.ajax({type:"GET",url:n,success:i})};History.Adapter.bind(window,"statechange",l),$("body").on("click",".jsHistoryLink",a)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),a=$(".bFilter"),i=a.find(".bFilterToggle"),l=a.find(".bFilterCont"),r=a.find(".bFilterParams__eItem"),o=a.find(".bFilterValuesItem");console.log("Mustache is "+typeof Mustache);var s={firstName:"Егор",lastName:"!"},d="<h1>{{firstName}} {{lastName}}</h1><p>Ты снова не передаешь action к форме. Из-за этого я не могу формировать правильный url</p>",c=Mustache.to_html(d,s),u=$("<div>").addClass("popup").html(c);u.appendTo("body"),u.lightbox_me({centered:!0}),t.filter={getSlidersInputState:function(){console.info("getSlidersInputState");var e=$(".bRangeSlider"),n={changedSliders:[],unchangedSliders:[]},t=function t(){var e=$(this),t=e.find(".bFilterSlider"),a=t.data("config"),i=e.find(".mFromRange"),l=e.find(".mToRange"),r=a.min,o=a.max;1*i.val()===r?n.unchangedSliders.push(i.attr("name")):n.changedSliders.push(i.attr("name")),1*l.val()===o?n.unchangedSliders.push(l.attr("name")):n.changedSliders.push(l.attr("name"))};return e.each(t),n},getFilterUrl:function(){for(var e,n=a.serializeArray(),i=a.attr("action"),l=t.filter.getSlidersInputState(),r=n.length-1;r>=0;r--)-1!==l.unchangedSliders.indexOf(n[r].name)&&(console.log("slider input "+n[r].name+" unchanged"),n.splice(r,1));return e=$.param(n),0!==e.length&&(i+="?"+e),console.log(i),i},sendFilter:function(){var e=t.filter.getFilterUrl();return e.length&&t.history.gotoUrl(e),!1},updateFilter:function(){console.info("update filter")}};var f=function f(){var e="mOpen",n="mClose",t=i.hasClass(e);return t?(i.removeClass(e).addClass(n),l.slideUp(400)):(i.removeClass(n).addClass(e),l.slideDown(400)),!1},g=function g(){var e=$(this),n="mActive",t=e.hasClass(n),a=e.data("ref");return t?!1:(r.removeClass(n),e.addClass(n),o.fadeOut(300),o.promise().done(function(){$("#"+a).fadeIn(300)}),!1)},h=function h(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),a=e.find(".mFromRange"),i=e.find(".mToRange"),l=t.min,r=t.max,o=t.step;n.slider({range:!0,step:o,min:l,max:r,values:[a.val(),i.val()],slide:function(e,n){a.val(n.values[0]),i.val(n.values[1])},change:function(){console.log("change slider")}});var s=function s(){var e="0"+$(this).val();e=parseInt(e,10),e=e>r?r:l>e?l:e,$(this).val(e),n.slider({values:[a.val(),i.val()]})};i.on("change",s),a.on("change",s)};i.on("click",f),r.on("click",g),a.on("submit",t.filter.sendFilter),$(".bRangeSlider").each(h)}(window.ENTER);