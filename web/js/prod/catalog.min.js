(function(e){console.info("Catalog init: catalog.js");var o=(e.config.pageConfig,e.utils),n=o.extendApp("ENTER.catalog"),t=$("#bCatalog").data("count");n.enableHistoryAPI="object"==typeof Mustache&&History.enabled,n.listingWrap=$(".bListing"),n.liveScroll=!1,n.pagesCount=null,n.productsCount=null,t!==void 0&&(t.pages!==void 0&&(n.pagesCount=bCatalog.pages),t.products!==void 0&&(n.productsCount=bCatalog.products)),console.info("Mustache is "+typeof Mustache+" (Catalog main config)"),console.info("enableHistoryAPI "+n.enableHistoryAPI)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var o,n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),i=$(".bFilter"),l=i.find(".bBtnPick__eLink"),r=i.find(".bFilterToggle"),a=i.find(".bFilterCont"),c=i.find(".bRangeSlider"),s=i.find(".bFilterParams__eItem"),d=i.find(".bFilterValuesItem"),f=$(".bSortingLine");t.filter={lastRes:null,getViewType:function(){var e=f.find(".mViewer .mSortItem");return e.filter(".mActive").data("type")},applyTemplate:{list:function(e){console.info("applyTemplate list"),t.listingWrap.empty(),t.listingWrap.html(e)},selectedFilter:function(e){var o=i.find(".bFilterFoot");o.empty(),o.html(e)},sorting:function(e){var o=f.find(".bSortingList.mSorting");o.empty(),o.html(e)},pagination:function(e){var o=$(".bSortingList.mPager");o.empty(),o.html(e)},page:function(e){var o=$(".bTitlePage");o.empty(),o.html(e)}},render:{list:function(e){console.info("render list"),console.log(t.filter.getViewType()!==void 0?t.filter.getViewType():"default");var o,n=t.filter.getViewType()!==void 0?t.filter.getViewType():"default",i={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},l=i[n].html(),r=i[n].data("partial");return o=Mustache.render(l,e,r),console.log("end of render list"),o},selectedFilter:function(e){if(console.info("render selectedFilter"),!e)return console.warn("nothing to render"),void 0;var o,n=$("#tplSelectedFilter"),i=n.html(),l=n.data("partial");return o=Mustache.render(i,e,l),e.hasOwnProperty("values")&&(console.info("run update filter!"),t.filter.updateFilter(e.values)),console.log("end of render selectedFilter"),o},sorting:function(e){console.info("render sorting");var o,n=$("#tplSorting"),t=n.html(),i=n.data("partial");return o=Mustache.render(t,e,i),console.log("end of render sorting"),o},pagination:function(e){console.info("render pagination");var o,n=$("#tplPagination"),t=n.html(),i=n.data("partial");return o=Mustache.render(t,e,i),console.log("end of render paginaton"),o},page:function(e){var o=e.title;return o}},renderCatalogPage:function(e){console.info("renderCatalogPage");var o,n,i=e?e:t.filter.lastRes,l=e.allCount;t.filter.resetForm();for(o in i)t.filter.render.hasOwnProperty(o)&&(n=t.filter.render[o](i[o])),t.filter.applyTemplate.hasOwnProperty(o)&&t.filter.applyTemplate[o](n);t.infScroll.checkInfinity(),l&&(t.pagesCount=l.pages,t.productsCount=l.products),t.filter.lastRes=i},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},o=function o(){var o=$(this),n=o.find(".bFilterSlider"),t=n.data("config"),i=o.find(".mFromRange"),l=o.find(".mToRange"),r=t.min,a=t.max;1*i.val()===r?e.unchangedSliders.push(i.attr("name")):e.changedSliders.push(i.attr("name")),1*l.val()===a?e.unchangedSliders.push(l.attr("name")):e.changedSliders.push(l.attr("name"))};return c.each(o),e},getFilterUrl:function(){console.info("getFilterUrl");for(var e,o=i.serializeArray(),n=i.attr("action")||"",l=t.filter.getSlidersInputState(),r=f.find(".mSortItem.mActive").find(".jsSorting"),a=r.data("sort"),c=t.filter.getUrlParams(),s=!1,d=o.length-1;d>=0;d--)-1!==l.unchangedSliders.indexOf(o[d].name)&&(console.log("slider input "+o[d].name+" unchanged"),o.splice(d,1));return c&&c.category&&($.each(o,function(){"category"==this.name&&(s=!0)}),s||o.unshift({name:"category",value:c.category})),e=$.param(o),0!==e.length&&(n+=-1===n.indexOf("?")?"?"+e:"&"+e),console.log(n),n=n.addParameterToUrl("sort",a)},getUrlParams:function(){var e,o,n={},t=window.location.search.substring(1).split("&");for(o=0;t.length>o;o++)e=t[o].split("="),n[e[0]]=e[1]===void 0?"":e[1];return n},changeFilterHandler:function(e,n){console.info("change filter"),console.log(e),console.log(n);var l=function l(){i.trigger("submit")};return"object"==typeof e&&e.isTrigger&&!n?(console.warn("it's trigger event!"),void 0):t.enableHistoryAPI?(console.info("need update from server..."),clearTimeout(o),o=setTimeout(l,300),void 0):(console.warn("history api off"),void 0)},sendFilter:function(e){console.info("sendFilter"),console.log(e);var o=t.filter.getFilterUrl();return o!==document.location.pathname+document.location.search&&(console.info("goto url "+o),t.history.gotoUrl(o)),e.isTrigger?(console.warn("it's trigger"),l.animate({boxShadow:"1px 1px 20px #ffa901"},300,"swing",function(){l.animate({boxShadow:"1px 1px 3px #C7C7C7"},300,"swing")})):"object"==typeof e&&t.enableHistoryAPI&&(console.warn("it's true event and HistoryAPI enable"),$.scrollTo(i.find(".bFilterFoot"),500)),!1},resetForm:function(){console.info("resetForm");var e=function e(e,o){var n=$(o),t=n.attr("id"),l=i.find('label[for="'+t+'"]');console.info(t),console.info(l),n.removeAttr("checked"),l.removeClass("mChecked")},o=function o(e,o){$(o).removeAttr("checked").trigger("change")},n=function n(){var e=$(this),o=e.find(".bFilterSlider"),n=o.data("config"),t=e.find(".mFromRange"),i=e.find(".mToRange"),l=n.min,r=n.max;t.val(l).trigger("change"),i.val(r).trigger("change")};i.find(":input:radio:checked").each(e),i.find(":input:checkbox:checked").each(o),c.each(n)},updateFilter:function(e){console.info("update filter");var o,n,t,l;console.info(e);var r={text:function(e,o){e.val(o).trigger("change")},radio:function(e,o){var n=e.filter('[value="'+o+'"]'),t=n.attr("id"),l=i.find('label[for="'+t+'"]');n.attr("checked","checked"),l.addClass("mChecked")},checkbox:function(e,o){e.filter('[value="'+o+'"]').attr("checked","checked").trigger("change")}};for(l in e){if(!e.hasOwnProperty(l))return;o=i.find('input[name="'+l+'"]'),n=e[l],t=o.attr("type"),console.log(o),console.log(n),console.log(t),r.hasOwnProperty(t)&&r[t](o,n)}},openFilter:function(){p(!0)}};var g=function g(){var e=$(this),o=e.find(".bFilterSlider"),n=o.data("config"),t=e.find(".mFromRange"),l=e.find(".mToRange"),r=n.min,a=n.max,c=n.step;o.slider({range:!0,step:c,min:r,max:a,values:[t.val(),l.val()],slide:function(e,o){t.val(o.values[0]),l.val(o.values[1])},change:function(e){console.log("change slider"),e.originalEvent&&i.trigger("change",[!0])}});var s=function s(){var e="0"+$(this).val();e=parseFloat(e),console.info("inputUpdates"),console.log(e),e=e>a?a:r>e?r:e,$(this).val(e),o.slider({values:[t.val(),l.val()]})};l.on("change",s),t.on("change",s)},u=function u(){var e=$(this),o=e.attr("href");return t.history.gotoUrl(o),!1},p=function p(e){var o="mOpen",n="mClose",t=r.hasClass(o);return t&&"boolean"!=typeof e?(r.removeClass(o).addClass(n),a.slideUp(400)):(r.removeClass(n).addClass(o),a.slideDown(400)),!1},h=function h(){var e=$(this),o=e.attr("href"),n="mActive",l=e.parent(),r=l.hasClass(n);return r?!1:(t.history.gotoUrl(o),$.scrollTo(i,500),!1)},m=function m(){var e=$(this),o="mActive",n=e.hasClass(o),t=e.data("ref");return n?!1:(s.removeClass(o),e.addClass(o),d.fadeOut(300),d.promise().done(function(){$("#"+t).fadeIn(300)}),$.scrollTo(i,500),!1)},v=function v(){var e=$(this),o=e.attr("href"),n="mActive",i=e.parent(),l=f.find(".mViewer .mSortItem"),r=i.hasClass(n);return r?!1:(l.removeClass(n),i.addClass(n),t.filter.lastRes?t.history.updateUrl(o):t.history.gotoUrl(o),!1)},y=function y(){var e=$(this),o=e.attr("href"),n="mActive",i=e.parent(),l=f.find(".mSorting .mSortItem"),r=i.hasClass(n);return r?!1:(l.removeClass(n),i.addClass(n),t.history.gotoUrl(o),!1)};r.on("click",p),s.on("click",m),i.on("change",t.filter.changeFilterHandler),i.on("submit",t.filter.sendFilter),f.on("click",".jsSorting",y),f.on("click",".jsChangeView",v),f.on("click",".jsPagination",h),$("body").on("click",".jsHistoryLink",u),c.each(g)}(window.ENTER),function(e){var o=(e.config.pageConfig,e.utils),n=o.extendApp("ENTER.catalog");console.info("New catalog history module"),n.history={_defaultCallback:n.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(e,o,t){console.info("gotoUrl");var i={title:document.title,url:e,data:{_onlychange:t?!0:!1}};return n.enableHistoryAPI?(n.history._customCallback=o?o:null,console.info("link handler. push state new url: "+i.url),History.pushState(i,i.title,i.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,o){var t=o?o:null;n.history.gotoUrl(e,t,!0)},getDataFromServer:function(e,o){console.info("getDataFromServer "+e),n.loader&&n.loader.loading(),console.log("getDataFromServer::loading");var t=function t(){n.loader&&n.loader.complete()},i=function i(e){console.info("resHandler"),"object"==typeof e?o(e):(console.warn("res isn't object"),console.log(typeof e)),n.loader&&n.loader.complete()};$.ajax({type:"GET",url:e,success:i,statusCode:{500:t,503:t},error:t})}};var t=function t(){var e=History.getState(),o=e.url,t=e.data.data,i="function"==typeof n.history._customCallback?n.history._customCallback:n.history._defaultCallback;console.info("statechange"),console.log(e),t._onlychange?(console.info("only update url "+o),i()):(o=o.addParameterToUrl("ajax","true"),n.history.getDataFromServer(o,i)),n.history._customCallback=null};History.Adapter.bind(window,"statechange",t)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var o=(e.config.pageConfig,e.utils),n=o.extendApp("ENTER.catalog"),t=$(".bSortingLine");n.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity "+window.docCookies.getItem("infScroll")),"1"===window.docCookies.getItem("infScroll")&&(console.warn("inf cookie == 1"),n.infScroll.enable())},checkScroll:function(){console.info("checkscroll");var e=$(window),o=$(document);!n.infScroll.loading&&e.scrollTop()+800>o.height()-e.height()&&null!==n.pagesCount&&n.pagesCount>n.infScroll.nowPage&&(console.warn("checkscroll true. load"),n.infScroll.nowPage+=1,n.infScroll.load())},load:function(){console.info("load page");var e=n.filter.getFilterUrl(),o=function o(e){var o;o=n.filter.render.list(e.list),n.infScroll.loading=!1,n.listingWrap.append(o)};n.liveScroll=!0,n.infScroll.loading=!0,e=e.addParameterToUrl("page",n.infScroll.nowPage),e=e.addParameterToUrl("ajax","true"),n.history.getDataFromServer(e,o)},enable:function(){console.info("enable...");var e="mActive",o=t.find(".mInfinity"),i=t.find(".mPaging"),l=t.find(".bSortingList__eItem.mPage"),r=n.filter.getFilterUrl(),a=document.location.search.match("page=");i.show(),l.hide(),o.addClass(e),n.infScroll.nowPage=1,n.infScroll.loading=!1,window.docCookies.setItem("infScroll",1,2419200,"/"),n.infScroll.checkScroll(),$(window).on("scroll",n.infScroll.checkScroll),console.info(a),n.enableHistoryAPI&&a&&n.history.gotoUrl(r),console.log("infinity scroll enable")},disable:function(){console.info("disable infinity...");var e=n.filter.getFilterUrl();n.liveScroll=!1,e=e.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,2419200,"/"),$(window).off("scroll",n.infScroll.checkScroll),n.history.getDataFromServer(e,n.filter.renderCatalogPage),console.log("infinity scroll disable "+window.docCookies.getItem("infScroll"))}};var i=function i(){var e="mActive",o=t.find(".mInfinity"),i=o.hasClass(e);return i?!1:(n.infScroll.enable(),!1)},l=function l(){console.info("paginationBtnHandler");var e="mActive",o=t.find(".mInfinity"),i=o.hasClass(e);return i&&n.infScroll.disable(),!1};n.infScroll.checkInfinity(),t.on("click",".jsPaginationEnable",l),t.on("click",".jsInfinityEnable",i)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var o=(e.config.pageConfig,e.utils),n=o.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+n.enableHistoryAPI),n.loader={_loader:null,loading:function(){n.loader._loader||(n.loader._loader=$("<li>").addClass("mLoader"),n.liveScroll?n.listingWrap.append(n.loader._loader):(n.listingWrap.empty(),n.listingWrap.append(n.loader._loader)))},complete:function(){n.loader._loader&&(n.loader._loader.remove(),n.loader._loader=null)}}}(window.ENTER);