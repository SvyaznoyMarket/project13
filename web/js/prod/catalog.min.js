(function(e){console.info("Catalog init: catalog.js");var t=(e.config.pageConfig,e.utils),n=t.extendApp("ENTER.catalog");n.enableHistoryAPI="object"==typeof Mustache&&History.enabled,n.listingWrap=$(".bListing"),n.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+n.enableHistoryAPI)})(window.ENTER),function(e){var t=(e.config.pageConfig,e.utils),n=t.extendApp("ENTER.catalog");console.info("New catalog history module"),n.history={_customCallback:null,gotoUrl:function(e,t,o){console.info("gotoUrl");var i={title:document.title,url:e,data:{_onlychange:o?!0:!1}};return n.enableHistoryAPI?(n.history._customCallback=t?t:null,console.info("link handler. push state new url: "+i.url),History.pushState(i,i.title,i.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,t){var o=t?t:null;n.history.gotoUrl(e,o,!0)}};var o=function o(e,t){console.info("getDataFromServer "+e),n.loader.loading();var o=function o(){n.loader.complete()},i=function i(e){console.info("resHandler"),"object"==typeof e?t(e):(console.warn("res isn't object"),console.log(typeof e)),n.loader.complete()};$.ajax({type:"GET",url:e,success:i,statusCode:{500:o,503:o}})},i=function i(){var e=History.getState(),t=e.url,i=e.data.data,l="function"==typeof n.history._customCallback?n.history._customCallback:n.history._defaultCallback;console.info("statechange"),console.log(e),i._onlychange?(console.info("only update url "+t),l()):(t=t.addParameterToUrl("ajax","true"),o(t,l)),n.history._customCallback=null};History.Adapter.bind(window,"statechange",i)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var t=(e.config.pageConfig,e.utils),n=t.extendApp("ENTER.catalog"),o=$(".bSortingLine");n.infScroll={load:function(){},enable:function(){window.docCookies.setItem("infScroll",1,2419200,"/"),console.info("infinity scroll enable")},disable:function(){window.docCookies.setItem("infScroll",0,0,"/")}};var i=function i(){return n.infScroll.enable(),!1};"1"===window.docCookies.getItem("infScroll")&&n.infScroll.enable(),o.on("click",".jsInfinity",i)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var t=(e.config.pageConfig,e.utils),n=t.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+n.enableHistoryAPI),n.loader={_loader:null,loading:function(){n.loader._loader||(n.loader._loader=$("<li>").addClass("mLoader"),n.liveScroll?n.listingWrap.append(n.loader._loader):(n.listingWrap.empty(),n.listingWrap.append(n.loader._loader)))},complete:function(){n.loader._loader&&(n.loader._loader.remove(),n.loader._loader=null)}}}(window.ENTER),function(e){console.info("New catalog init: filter.js");var t=(e.config.pageConfig,e.utils),n=t.extendApp("ENTER.catalog"),o=$(".bFilter"),i=o.find(".bFilterToggle"),l=o.find(".bFilterCont"),a=o.find(".bRangeSlider"),r=o.find(".bFilterParams__eItem"),s=o.find(".bFilterValuesItem"),c=$(".bSortingLine"),d=c.find(".mSorting .mSortItem"),f=c.find(".mViewer .mSortItem");c.find(".mViewer .mPager"),n.filter={lastRes:null,getViewType:function(){return f.filter(".mActive").data("type")},render:{list:function(e){console.info("render list"),console.log(n.filter.getViewType()!==void 0?n.filter.getViewType():"default");var t,o=n.filter.getViewType()!==void 0?n.filter.getViewType():"default",i={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},l=i[o].html(),a=i[o].data("partial");t=Mustache.render(l,e,a),n.listingWrap.empty(),n.listingWrap.html(t),console.log("end of render list")},selectedFilter:function(e){console.info("render selectedFilter");var t,n=$("#tplSelectedFilter"),i=n.html(),l=o.find(".bFilterFoot"),a=n.data("partial");t=Mustache.render(i,e,a),l.empty(),l.html(t),console.log("end of render selectedFilter")},sorting:function(e){console.info("render sorting");var t,n=$("#tplSorting"),o=n.html(),i=c.find(".bSortingList.mSorting"),l=n.data("partial");t=Mustache.render(o,e,l),i.empty(),i.html(t),console.log("end of render sorting")},pagination:function(e){console.info("render pagination");var t,n=$("#tplPagination"),o=n.html(),i=$(".bSortingLine.mPagerBottom"),l=n.data("partial");t=Mustache.render(o,e,l),i.empty(),i.html(t),console.log("end of render paginaton")}},renderCatalogPage:function(e){console.info("renderCatalogPage");var t,o=e?e:n.filter.lastRes;for(t in o)n.filter.render.hasOwnProperty(t)&&n.filter.render[t](o[t]);n.filter.lastRes=o},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},t=function t(){var t=$(this),n=t.find(".bFilterSlider"),o=n.data("config"),i=t.find(".mFromRange"),l=t.find(".mToRange"),a=o.min,r=o.max;1*i.val()===a?e.unchangedSliders.push(i.attr("name")):e.changedSliders.push(i.attr("name")),1*l.val()===r?e.unchangedSliders.push(l.attr("name")):e.changedSliders.push(l.attr("name"))};return a.each(t),e},getFilterUrl:function(){for(var e,t=o.serializeArray(),i=o.attr("action"),l=n.filter.getSlidersInputState(),a=t.length-1;a>=0;a--)-1!==l.unchangedSliders.indexOf(t[a].name)&&(console.log("slider input "+t[a].name+" unchanged"),t.splice(a,1));return e=$.param(t),0!==e.length&&(i+="?"+e),i},changeFilterHandler:function(){console.info("change filter")},sendFilter:function(){var e=n.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),n.history.gotoUrl(e)),!1},updateFilter:function(){console.info("update filter")}},n.history._defaultCallback=n.filter.renderCatalogPage;var g=function g(){var e=$(this),t=e.find(".bFilterSlider"),n=t.data("config"),i=e.find(".mFromRange"),l=e.find(".mToRange"),a=n.min,r=n.max,s=n.step;t.slider({range:!0,step:s,min:a,max:r,values:[i.val(),l.val()],slide:function(e,t){i.val(t.values[0]),l.val(t.values[1])},change:function(){console.log("change slider"),o.trigger("change")}});var c=function c(){var e="0"+$(this).val();e=parseInt(e,10),e=e>r?r:a>e?a:e,$(this).val(e),t.slider({values:[i.val(),l.val()]})};l.on("change",c),i.on("change",c)},u=function u(){var e=$(this),t=e.attr("href");return n.history.gotoUrl(t),!1},p=function p(){var e="mOpen",t="mClose",n=i.hasClass(e);return n?(i.removeClass(e).addClass(t),l.slideUp(400)):(i.removeClass(t).addClass(e),l.slideDown(400)),!1},m=function m(){var e=$(this),t=e.attr("href"),o="mActive",i=e.parent(),l=i.hasClass(o);return l?!1:(n.history.gotoUrl(t),!1)},h=function h(){var e=$(this),t="mActive",n=e.hasClass(t),o=e.data("ref");return n?!1:(r.removeClass(t),e.addClass(t),s.fadeOut(300),s.promise().done(function(){$("#"+o).fadeIn(300)}),!1)},v=function v(){var e=$(this),t=e.attr("href"),o="mActive",i=e.parent(),l=i.hasClass(o);return l?!1:(f.removeClass(o),i.addClass(o),n.filter.lastRes?n.history.updateUrl(t):n.history.gotoUrl(t),!1)},y=function y(){var e=$(this),t=e.attr("href"),o="mActive",i=e.parent(),l=i.hasClass(o);return l?!1:(d.removeClass(o),i.addClass(o),n.history.gotoUrl(t),!1)};i.on("click",p),r.on("click",h),o.on("change",n.filter.changeFilterHandler),o.on("submit",n.filter.sendFilter),d.on("click",".bSortingList__eLink",y),f.on("click",".bSortingList__eLink",v),c.on("click",".jsPagination",m),$("body").on("click",".jsHistoryLink",u),a.each(g)}(window.ENTER);