(function(e){console.info("New catalog history module");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");t.history={gotoUrl:function(e,n){var a={title:"Enter - это выход!",url:e};return t.history._callback=n,t.enableHistoryAPI?(console.info("link handler. push state new url: "+a.url),History.pushState(a,a.title,a.url),void 0):(document.location.href=e,void 0)}};var a=function a(){var e=$(this).attr("href");return t.history.gotoUrl(e),!1},o=function o(){n.blockScreen.unblock()},l=function l(e){console.info("resHandler"),"object"==typeof e&&"function"==typeof t.history._callback?t.history._callback(e):(console.warn("res isn't object or catalog.history._callback isn't function"),console.log(typeof e),console.log(typeof t.history._callback)),n.blockScreen.unblock()},i=function i(){var e=History.getState(),t=e.url;console.info("statechange"),n.blockScreen.block("Загрузка товаров"),t=t.addParameterToUrl("ajax","true"),console.log(t),console.log(e),$.ajax({type:"GET",url:t,success:l,statusCode:{500:o,503:o}})};History.Adapter.bind(window,"statechange",i),$("body").on("click",".jsHistoryLink",a)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),a=$(".bFilter"),o=a.find(".bFilterToggle"),l=a.find(".bFilterCont"),i=a.find(".bFilterParams__eItem"),r=a.find(".bFilterValuesItem");console.log("Mustache is "+typeof Mustache),t.enableHistoryAPI="object"==typeof Mustache&&History.enabled,t.filter={renderTmpl:function(e){console.info("callback: renderTmpl");var n,t=$("#listing_compact_tmpl"),a=t.html(),o=t.data("partial"),l=$(".bListing");n=Mustache.render(a,e,o),l.empty(),l.html(n)},getSlidersInputState:function(){console.info("getSlidersInputState");var e=$(".bRangeSlider"),n={changedSliders:[],unchangedSliders:[]},t=function t(){var e=$(this),t=e.find(".bFilterSlider"),a=t.data("config"),o=e.find(".mFromRange"),l=e.find(".mToRange"),i=a.min,r=a.max;1*o.val()===i?n.unchangedSliders.push(o.attr("name")):n.changedSliders.push(o.attr("name")),1*l.val()===r?n.unchangedSliders.push(l.attr("name")):n.changedSliders.push(l.attr("name"))};return e.each(t),n},getFilterUrl:function(){for(var e,n=a.serializeArray(),o=a.attr("action"),l=t.filter.getSlidersInputState(),i=n.length-1;i>=0;i--)-1!==l.unchangedSliders.indexOf(n[i].name)&&(console.log("slider input "+n[i].name+" unchanged"),n.splice(i,1));return e=$.param(n),0!==e.length&&(o+="?"+e),o},sendFilter:function(){var e=t.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),t.history.gotoUrl(e,t.filter.renderTmpl)),!1},updateFilter:function(){console.info("update filter")}};var s=function s(){var e="mOpen",n="mClose",t=o.hasClass(e);return t?(o.removeClass(e).addClass(n),l.slideUp(400)):(o.removeClass(n).addClass(e),l.slideDown(400)),!1},c=function c(){var e=$(this),n="mActive",t=e.hasClass(n),a=e.data("ref");return t?!1:(i.removeClass(n),e.addClass(n),r.fadeOut(300),r.promise().done(function(){$("#"+a).fadeIn(300)}),!1)},d=function d(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),a=e.find(".mFromRange"),o=e.find(".mToRange"),l=t.min,i=t.max,r=t.step;n.slider({range:!0,step:r,min:l,max:i,values:[a.val(),o.val()],slide:function(e,n){a.val(n.values[0]),o.val(n.values[1])},change:function(){console.log("change slider")}});var s=function s(){var e="0"+$(this).val();e=parseInt(e,10),e=e>i?i:l>e?l:e,$(this).val(e),n.slider({values:[a.val(),o.val()]})};o.on("change",s),a.on("change",s)};o.on("click",s),i.on("click",c),a.on("submit",t.filter.sendFilter),$(".bRangeSlider").each(d)}(window.ENTER);