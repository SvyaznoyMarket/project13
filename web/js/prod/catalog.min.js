(function(e){console.info("New catalog history module");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");r.history={gotoUrl:function(e,t){var i={title:"Enter - это выход!",url:e};return r.history._callback=t,r.enableHistoryAPI?(console.info("link handler. push state new url: "+i.url),History.pushState(i,i.title,i.url),void 0):(document.location.href=e,void 0)}};var i=function i(){var e=$(this).attr("href");return r.history.gotoUrl(e),!1},n=function n(){t.blockScreen.unblock()},a=function a(e){console.info("resHandler"),"object"==typeof e&&"function"==typeof r.history._callback?r.history._callback(e):(console.warn("res isn't object or catalog.history._callback isn't function"),console.log(typeof e),console.log(typeof r.history._callback)),t.blockScreen.unblock()},o=function o(){var e=History.getState(),r=e.url;console.info("statechange"),t.blockScreen.block("Загрузка товаров"),r=r.addParameterToUrl("ajax","true"),console.log(r),console.log(e),$.ajax({type:"GET",url:r,success:a,statusCode:{500:n,503:n}})};History.Adapter.bind(window,"statechange",o),$("body").on("click",".jsHistoryLink",i)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bFilter"),n=i.find(".bFilterToggle"),a=i.find(".bFilterCont"),o=i.find(".bFilterParams__eItem"),s=i.find(".bFilterValuesItem");console.log("Mustache is "+typeof Mustache),r.enableHistoryAPI="object"==typeof Mustache&&History.enabled,r.filter={renderTmpl:function(e){console.info("callback: renderTmpl");var t,r=$("#listing_compact_tmpl"),i=r.html(),n=r.data("partial"),a=$(".bListing");t=Mustache.render(i,e,n),a.empty(),a.html(t)},getSlidersInputState:function(){console.info("getSlidersInputState");var e=$(".bRangeSlider"),t={changedSliders:[],unchangedSliders:[]},r=function r(){var e=$(this),r=e.find(".bFilterSlider"),i=r.data("config"),n=e.find(".mFromRange"),a=e.find(".mToRange"),o=i.min,s=i.max;1*n.val()===o?t.unchangedSliders.push(n.attr("name")):t.changedSliders.push(n.attr("name")),1*a.val()===s?t.unchangedSliders.push(a.attr("name")):t.changedSliders.push(a.attr("name"))};return e.each(r),t},getFilterUrl:function(){for(var e,t=i.serializeArray(),n=i.attr("action"),a=r.filter.getSlidersInputState(),o=t.length-1;o>=0;o--)-1!==a.unchangedSliders.indexOf(t[o].name)&&(console.log("slider input "+t[o].name+" unchanged"),t.splice(o,1));return e=$.param(t),0!==e.length&&(n+="?"+e),n},sendFilter:function(){var e=r.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),r.history.gotoUrl(e,r.filter.renderTmpl)),!1},updateFilter:function(){console.info("update filter")}};var l=function l(){var e="mOpen",t="mClose",r=n.hasClass(e);return r?(n.removeClass(e).addClass(t),a.slideUp(400)):(n.removeClass(t).addClass(e),a.slideDown(400)),!1},c=function c(){var e=$(this),t="mActive",r=e.hasClass(t),i=e.data("ref");return r?!1:(o.removeClass(t),e.addClass(t),s.fadeOut(300),s.promise().done(function(){$("#"+i).fadeIn(300)}),!1)},u=function u(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),i=e.find(".mFromRange"),n=e.find(".mToRange"),a=r.min,o=r.max,s=r.step;t.slider({range:!0,step:s,min:a,max:o,values:[i.val(),n.val()],slide:function(e,t){i.val(t.values[0]),n.val(t.values[1])},change:function(){console.log("change slider")}});var l=function l(){var e="0"+$(this).val();e=parseInt(e,10),e=e>o?o:a>e?a:e,$(this).val(e),t.slider({values:[i.val(),n.val()]})};n.on("change",l),i.on("change",l)};n.on("click",l),o.on("click",c),i.on("submit",r.filter.sendFilter),$(".bRangeSlider").each(u)}(window.ENTER);