(function(e){console.info("New catalog history module");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog");t.history={gotoUrl:function(e,n){var o={title:"Enter - это выход!",url:e};return t.history._callback=n,History.enabled?(console.info("link handler. push state new url: "+o.url),History.pushState(o,o.title,o.url),void 0):(document.location.href=e,void 0)}};var o=function o(){var e=$(this).attr("href");return t.history.gotoUrl(e),!1},a=function a(e){console.info("resHandler"),"object"==typeof e&&"function"==typeof t.history._callback?t.history._callback(e):(console.warn("res isn't object or catalog.history._callback isn't function"),console.log(typeof e),console.log(typeof t.history._callback))},l=function l(){var e=History.getState(),n=e.url;console.info("statechange"),n=n.addParameterToUrl("ajax","true"),console.log(n),console.log(e),$.ajax({type:"GET",url:n,success:a})};History.Adapter.bind(window,"statechange",l),$("body").on("click",".jsHistoryLink",o)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var n=(e.config.pageConfig,e.utils),t=n.extendApp("ENTER.catalog"),o=$(".bFilter"),a=o.find(".bFilterToggle"),l=o.find(".bFilterCont"),i=o.find(".bFilterParams__eItem"),r=o.find(".bFilterValuesItem");console.log("Mustache is "+typeof Mustache),t.filter={renderTmpl:function(e){console.info("callback: renderTmpl");var n=$("#listing_compact_tmpl"),t=n.html(),o=n.data("partial"),a=$(".bListing"),l="";console.log(a),console.log(o),l=Mustache.to_html(t,e,o),a.html(l),console.log("end of render")},getSlidersInputState:function(){console.info("getSlidersInputState");var e=$(".bRangeSlider"),n={changedSliders:[],unchangedSliders:[]},t=function t(){var e=$(this),t=e.find(".bFilterSlider"),o=t.data("config"),a=e.find(".mFromRange"),l=e.find(".mToRange"),i=o.min,r=o.max;1*a.val()===i?n.unchangedSliders.push(a.attr("name")):n.changedSliders.push(a.attr("name")),1*l.val()===r?n.unchangedSliders.push(l.attr("name")):n.changedSliders.push(l.attr("name"))};return e.each(t),n},getFilterUrl:function(){for(var e,n=o.serializeArray(),a=o.attr("action"),l=t.filter.getSlidersInputState(),i=n.length-1;i>=0;i--)-1!==l.unchangedSliders.indexOf(n[i].name)&&(console.log("slider input "+n[i].name+" unchanged"),n.splice(i,1));return e=$.param(n),0!==e.length&&(a+="?"+e),a},sendFilter:function(){var e=t.filter.getFilterUrl();return console.log(document.location),e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),console.log("now url "+document.location.pathname),t.history.gotoUrl(e,t.filter.renderTmpl)),!1},updateFilter:function(){console.info("update filter")}};var s=function s(){var e="mOpen",n="mClose",t=a.hasClass(e);return t?(a.removeClass(e).addClass(n),l.slideUp(400)):(a.removeClass(n).addClass(e),l.slideDown(400)),!1},c=function c(){var e=$(this),n="mActive",t=e.hasClass(n),o=e.data("ref");return t?!1:(i.removeClass(n),e.addClass(n),r.fadeOut(300),r.promise().done(function(){$("#"+o).fadeIn(300)}),!1)},d=function d(){var e=$(this),n=e.find(".bFilterSlider"),t=n.data("config"),o=e.find(".mFromRange"),a=e.find(".mToRange"),l=t.min,i=t.max,r=t.step;n.slider({range:!0,step:r,min:l,max:i,values:[o.val(),a.val()],slide:function(e,n){o.val(n.values[0]),a.val(n.values[1])},change:function(){console.log("change slider")}});var s=function s(){var e="0"+$(this).val();e=parseInt(e,10),e=e>i?i:l>e?l:e,$(this).val(e),n.slider({values:[o.val(),a.val()]})};a.on("change",s),o.on("change",s)};a.on("click",s),i.on("click",c),o.on("submit",t.filter.sendFilter),$(".bRangeSlider").each(d)}(window.ENTER);