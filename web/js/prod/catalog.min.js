(function(e){console.info("Catalog init: catalog.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");r.enableHistoryAPI="object"==typeof Mustache&&History.enabled,r.listingWrap=$(".bListing"),r.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI)})(window.ENTER),function(e){console.info("New catalog init: filter.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bFilter"),n=i.find(".bFilterToggle"),a=i.find(".bFilterCont"),o=i.find(".bRangeSlider"),s=i.find(".bFilterParams__eItem"),l=i.find(".bFilterValuesItem"),c=$(".bSortingLine");r.filter={lastRes:null,getViewType:function(){var e=c.find(".mViewer .mSortItem");return e.filter(".mActive").data("type")},applyTemplate:{list:function(e){console.info("applyTemplate list"),r.listingWrap.empty(),r.listingWrap.html(e)},selectedFilter:function(e){var t=i.find(".bFilterFoot");t.empty(),t.html(e)},sorting:function(e){var t=c.find(".bSortingList.mSorting");t.empty(),t.html(e)},pagination:function(e){var t=$(".bSortingList.mPager");t.empty(),t.html(e)}},render:{list:function(e){console.info("render list"),console.log(r.filter.getViewType()!==void 0?r.filter.getViewType():"default");var t,i=r.filter.getViewType()!==void 0?r.filter.getViewType():"default",n={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},a=n[i].html(),o=n[i].data("partial");return t=Mustache.render(a,e,o),console.log("end of render list"),t},selectedFilter:function(e){console.info("render selectedFilter");var t,i=$("#tplSelectedFilter"),n=i.html(),a=i.data("partial");return t=Mustache.render(n,e,a),e.hasOwnProperty("values")&&(console.info("run update filter!"),r.filter.updateFilter(e.values)),console.log("end of render selectedFilter"),t},sorting:function(e){console.info("render sorting");var t,r=$("#tplSorting"),i=r.html(),n=r.data("partial");return t=Mustache.render(i,e,n),console.log("end of render sorting"),t},pagination:function(e){console.info("render pagination");var t,r=$("#tplPagination"),i=r.html(),n=r.data("partial");return t=Mustache.render(i,e,n),console.log("end of render paginaton"),t}},renderCatalogPage:function(e){console.info("renderCatalogPage");var t,i,n=e?e:r.filter.lastRes;r.filter.resetForm();for(t in n)r.filter.render.hasOwnProperty(t)&&r.filter.applyTemplate.hasOwnProperty(t)&&(i=r.filter.render[t](n[t]),r.filter.applyTemplate[t](i));r.infScroll.checkInfinity(),r.filter.lastRes=n},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},t=function t(){var t=$(this),r=t.find(".bFilterSlider"),i=r.data("config"),n=t.find(".mFromRange"),a=t.find(".mToRange"),o=i.min,s=i.max;1*n.val()===o?e.unchangedSliders.push(n.attr("name")):e.changedSliders.push(n.attr("name")),1*a.val()===s?e.unchangedSliders.push(a.attr("name")):e.changedSliders.push(a.attr("name"))};return o.each(t),e},getFilterUrl:function(){for(var e,t=i.serializeArray(),n=i.attr("action"),a=r.filter.getSlidersInputState(),o=t.length-1;o>=0;o--)-1!==a.unchangedSliders.indexOf(t[o].name)&&(console.log("slider input "+t[o].name+" unchanged"),t.splice(o,1));return e=$.param(t),0!==e.length&&(n+="?"+e),n},changeFilterHandler:function(){console.info("change filter")},sendFilter:function(){var e=r.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),r.history.gotoUrl(e)),!1},resetForm:function(){console.info("resetForm");var e=function e(e,t){var r=$(t),n=r.attr("id"),a=i.find('label[for="'+n+'"]');console.info(n),console.info(a),r.removeAttr("checked"),a.removeClass("mChecked")},t=function t(e,t){$(t).removeAttr("checked").trigger("change")},r=function r(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),i=e.find(".mFromRange"),n=e.find(".mToRange"),a=r.min,o=r.max;i.val(a).trigger("change"),n.val(o).trigger("change")};i.find(":input:radio:checked").each(e),i.find(":input:checkbox:checked").each(t),o.each(r)},updateFilter:function(e){console.info("update filter");var t,r,n,a;console.info(e);var o={text:function(e,t){e.val(t).trigger("change")},radio:function(e,t){var r=e.filter('[value="'+t+'"]'),n=r.attr("id"),a=i.find('label[for="'+n+'"]');r.attr("checked","checked"),a.addClass("mChecked")},checkbox:function(e,t){e.filter('[value="'+t+'"]').attr("checked","checked").trigger("change")}};for(a in e){if(!e.hasOwnProperty(a))return;t=i.find('input[name="'+a+'"]'),r=e[a],n=t.attr("type"),console.log(t),console.log(r),console.log(n),o.hasOwnProperty(n)&&o[n](t,r)}}};var u=function u(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),n=e.find(".mFromRange"),a=e.find(".mToRange"),o=r.min,s=r.max,l=r.step;t.slider({range:!0,step:l,min:o,max:s,values:[n.val(),a.val()],slide:function(e,t){n.val(t.values[0]),a.val(t.values[1])},change:function(){console.log("change slider"),i.trigger("change")}});var c=function c(){var e="0"+$(this).val();e=parseFloat(e),console.info("inputUpdates"),console.log(e),e=e>s?s:o>e?o:e,$(this).val(e),t.slider({values:[n.val(),a.val()]})};a.on("change",c),n.on("change",c)},h=function h(){var e=$(this),t=e.attr("href");return r.history.gotoUrl(t),!1},d=function d(){var e="mOpen",t="mClose",r=n.hasClass(e);return r?(n.removeClass(e).addClass(t),a.slideUp(400)):(n.removeClass(t).addClass(e),a.slideDown(400)),!1},p=function p(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=n.hasClass(i);return a?!1:(r.history.gotoUrl(t),!1)},f=function f(){var e=$(this),t="mActive",r=e.hasClass(t),i=e.data("ref");return r?!1:(s.removeClass(t),e.addClass(t),l.fadeOut(300),l.promise().done(function(){$("#"+i).fadeIn(300)}),!1)},m=function m(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=c.find(".mViewer .mSortItem"),o=n.hasClass(i);return o?!1:(a.removeClass(i),n.addClass(i),r.filter.lastRes?r.history.updateUrl(t):r.history.gotoUrl(t),!1)},v=function v(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=c.find(".mSorting .mSortItem"),o=n.hasClass(i);return o?!1:(a.removeClass(i),n.addClass(i),r.history.gotoUrl(t),!1)};n.on("click",d),s.on("click",f),i.on("change",r.filter.changeFilterHandler),i.on("submit",r.filter.sendFilter),c.on("click",".jsSorting",v),c.on("click",".jsChangeView",m),c.on("click",".jsPagination",p),$("body").on("click",".jsHistoryLink",h),o.each(u)}(window.ENTER),function(e){var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("New catalog history module"),r.history={_defaultCallback:r.filter.renderCatalogPage,_customCallback:null,gotoUrl:function(e,t,i){console.info("gotoUrl");var n={title:document.title,url:e,data:{_onlychange:i?!0:!1}};return r.enableHistoryAPI?(r.history._customCallback=t?t:null,console.info("link handler. push state new url: "+n.url),History.pushState(n,n.title,n.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,t){var i=t?t:null;r.history.gotoUrl(e,i,!0)},getDataFromServer:function(e,t){console.info("getDataFromServer "+e),r.loader.loading();var i=function i(){r.loader.complete()},n=function n(e){console.info("resHandler"),"object"==typeof e?t(e):(console.warn("res isn't object"),console.log(typeof e)),r.loader.complete()};$.ajax({type:"GET",url:e,success:n,statusCode:{500:i,503:i},error:i})}};var i=function i(){var e=History.getState(),t=e.url,i=e.data.data,n="function"==typeof r.history._customCallback?r.history._customCallback:r.history._defaultCallback;console.info("statechange"),console.log(e),i._onlychange?(console.info("only update url "+t),n()):(t=t.addParameterToUrl("ajax","true"),r.history.getDataFromServer(t,n)),r.history._customCallback=null};History.Adapter.bind(window,"statechange",i)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bSortingLine");r.infScroll={loading:!1,nowPage:1,checkInfinity:function(){console.info("checkInfinity"),"1"===window.docCookies.getItem("infScroll")&&r.infScroll.enable()},checkScroll:function(){console.info("checkscroll");var e=$(window),t=$(document);!r.infScroll.loading&&e.scrollTop()+800>t.height()-e.height()&&(console.warn("checkscroll true. load"),r.infScroll.nowPage+=1,r.infScroll.load())},load:function(){console.info("load page");var e=r.filter.getFilterUrl(),t=function t(e){var t;t=r.filter.render.list(e.list),r.infScroll.loading=!1,r.listingWrap.append(t)};r.liveScroll=!0,r.infScroll.loading=!0,e=e.addParameterToUrl("page",r.infScroll.nowPage),e=e.addParameterToUrl("ajax","true"),r.history.getDataFromServer(e,t)},enable:function(){console.info("enable...");var e="mActive",t=i.find(".mInfinity"),n=i.find(".mPaging"),a=i.find(".bSortingList__eItem.mPage"),o=r.filter.getFilterUrl();n.show(),a.hide(),t.addClass(e),r.infScroll.nowPage=1,r.infScroll.loading=!1,window.docCookies.setItem("infScroll",1,2419200,"/"),$(window).on("scroll",r.infScroll.checkScroll),r.history.gotoUrl(o),console.log("infinity scroll enable")},disable:function(){console.info("disable...");var e=r.filter.getFilterUrl();r.liveScroll=!1,e=e.addParameterToUrl("ajax","true"),window.docCookies.setItem("infScroll",0,0,"/"),$(window).off("scroll",r.infScroll.checkScroll),r.history.getDataFromServer(e,r.filter.renderCatalogPage),console.log("infinity scroll disable")}};var n=function n(){var e="mActive",t=i.find(".mInfinity"),n=t.hasClass(e);return n?!1:(r.infScroll.enable(),!1)},a=function a(){var e="mActive",t=i.find(".mInfinity"),n=t.hasClass(e);return n&&r.infScroll.disable(),!1};r.infScroll.checkInfinity(),i.on("click",".jsPaginationEnable",a),i.on("click",".jsInfinityEnable",n)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI),r.loader={_loader:null,loading:function(){r.loader._loader||(r.loader._loader=$("<li>").addClass("mLoader"),r.liveScroll?r.listingWrap.append(r.loader._loader):(r.listingWrap.empty(),r.listingWrap.append(r.loader._loader)))},complete:function(){r.loader._loader&&(r.loader._loader.remove(),r.loader._loader=null)}}}(window.ENTER);