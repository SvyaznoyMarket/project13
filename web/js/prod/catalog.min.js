(function(e){console.info("Catalog init: catalog.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");r.enableHistoryAPI="object"==typeof Mustache&&History.enabled,r.listingWrap=$(".bListing"),r.liveScroll=!1,console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI)})(window.ENTER),function(e){var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("New catalog history module"),r.history={_customCallback:null,gotoUrl:function(e,t,i){console.info("gotoUrl");var n={title:document.title,url:e,data:{_onlychange:i?!0:!1}};return r.enableHistoryAPI?(r.history._customCallback=t?t:null,console.info("link handler. push state new url: "+n.url),History.pushState(n,n.title,n.url),void 0):(document.location.href=e,void 0)},updateUrl:function(e,t){var i=t?t:null;r.history.gotoUrl(e,i,!0)}};var i=function i(e,t){console.info("getDataFromServer "+e),r.loader.loading();var i=function i(){r.loader.complete()},n=function n(e){console.info("resHandler"),"object"==typeof e?t(e):(console.warn("res isn't object"),console.log(typeof e)),r.loader.complete()};$.ajax({type:"GET",url:e,success:n,statusCode:{500:i,503:i}})},n=function n(){var e=History.getState(),t=e.url,n=e.data.data,a="function"==typeof r.history._customCallback?r.history._customCallback:r.history._defaultCallback;console.info("statechange"),console.log(e),n._onlychange?(console.info("only update url "+t),a()):(t=t.addParameterToUrl("ajax","true"),i(t,a)),r.history._customCallback=null};History.Adapter.bind(window,"statechange",n)}(window.ENTER),function(e){console.info("Catalog init: catalog_infinityScroll.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bSortingLine");r.infScroll={load:function(){},enable:function(){window.docCookies.setItem("infScroll",1,2419200,"/"),console.info("infinity scroll enable")},disable:function(){window.docCookies.setItem("infScroll",0,0,"/")}};var n=function n(){return r.infScroll.enable(),!1};"1"===window.docCookies.getItem("infScroll")&&r.infScroll.enable(),i.on("click",".jsInfinity",n)}(window.ENTER),function(e){console.info("New catalog init: loader.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog");console.info("Mustache is "+typeof Mustache),console.info("enableHistoryAPI "+r.enableHistoryAPI),r.loader={_loader:null,loading:function(){r.loader._loader||(r.loader._loader=$("<li>").addClass("mLoader"),r.liveScroll?r.listingWrap.append(r.loader._loader):(r.listingWrap.empty(),r.listingWrap.append(r.loader._loader)))},complete:function(){r.loader._loader&&(r.loader._loader.remove(),r.loader._loader=null)}}}(window.ENTER),function(e){console.info("New catalog init: filter.js");var t=(e.config.pageConfig,e.utils),r=t.extendApp("ENTER.catalog"),i=$(".bFilter"),n=i.find(".bFilterToggle"),a=i.find(".bFilterCont"),o=i.find(".bRangeSlider"),s=i.find(".bFilterParams__eItem"),l=i.find(".bFilterValuesItem"),c=$(".bSortingLine"),u=c.find(".mSorting .mSortItem"),h=c.find(".mViewer .mSortItem");c.find(".mViewer .mPager"),r.filter={lastRes:null,getViewType:function(){return h.filter(".mActive").data("type")},render:{products:function(e){console.info("render products"),console.log(r.filter.getViewType()!==void 0?r.filter.getViewType():"default");var t,i=r.filter.getViewType()!==void 0?r.filter.getViewType():"default",n={compact:$("#listing_compact_tmpl"),expanded:$("#listing_compact_tmpl"),"default":$("#listing_compact_tmpl")},a=n[i].html(),o=n[i].data("partial");t=Mustache.render(a,e,o),r.listingWrap.empty(),r.listingWrap.html(t),console.log("end of render products")},filters:function(e){console.info("render filter"),console.log(e);var t,r=$("#tplSelectedFilter"),n=r.html(),a=i.find(".bFilterFoot"),o=r.data("partial");t=Mustache.render(n,e,o),a.empty(),a.html(t),console.log("end of render filter")},pages:function(e){console.info("render pages");var t,r=$("#tplPagination"),i=r.html(),n=$(".bSortingLine.mPagerBottom"),a=r.data("partial");t=Mustache.render(i,e,a),n.empty(),n.html(t),console.log("end of render paginaton")}},renderCatalogPage:function(e){console.info("renderCatalogPage");var t,i=e?e:r.filter.lastRes;for(t in i)r.filter.render.hasOwnProperty(t)&&r.filter.render[t](i);r.filter.lastRes=i},getSlidersInputState:function(){console.info("getSlidersInputState");var e={changedSliders:[],unchangedSliders:[]},t=function t(){var t=$(this),r=t.find(".bFilterSlider"),i=r.data("config"),n=t.find(".mFromRange"),a=t.find(".mToRange"),o=i.min,s=i.max;1*n.val()===o?e.unchangedSliders.push(n.attr("name")):e.changedSliders.push(n.attr("name")),1*a.val()===s?e.unchangedSliders.push(a.attr("name")):e.changedSliders.push(a.attr("name"))};return o.each(t),e},getFilterUrl:function(){for(var e,t=i.serializeArray(),n=i.attr("action"),a=r.filter.getSlidersInputState(),o=t.length-1;o>=0;o--)-1!==a.unchangedSliders.indexOf(t[o].name)&&(console.log("slider input "+t[o].name+" unchanged"),t.splice(o,1));return e=$.param(t),0!==e.length&&(n+="?"+e),n},changeFilterHandler:function(){console.info("change filter")},sendFilter:function(){var e=r.filter.getFilterUrl();return e!==document.location.pathname+document.location.search&&(console.info("goto url "+e),r.history.gotoUrl(e)),!1},updateFilter:function(){console.info("update filter")}},r.history._defaultCallback=r.filter.renderCatalogPage;var d=function d(){var e=$(this),t=e.find(".bFilterSlider"),r=t.data("config"),n=e.find(".mFromRange"),a=e.find(".mToRange"),o=r.min,s=r.max,l=r.step;t.slider({range:!0,step:l,min:o,max:s,values:[n.val(),a.val()],slide:function(e,t){n.val(t.values[0]),a.val(t.values[1])},change:function(){console.log("change slider"),i.trigger("change")}});var c=function c(){var e="0"+$(this).val();e=parseInt(e,10),e=e>s?s:o>e?o:e,$(this).val(e),t.slider({values:[n.val(),a.val()]})};a.on("change",c),n.on("change",c)},p=function p(){var e=$(this),t=e.attr("href");return r.history.gotoUrl(t),!1},f=function f(){var e="mOpen",t="mClose",r=n.hasClass(e);return r?(n.removeClass(e).addClass(t),a.slideUp(400)):(n.removeClass(t).addClass(e),a.slideDown(400)),!1},m=function m(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=n.hasClass(i);return a?!1:(r.history.gotoUrl(t),!1)},v=function v(){var e=$(this),t="mActive",r=e.hasClass(t),i=e.data("ref");return r?!1:(s.removeClass(t),e.addClass(t),l.fadeOut(300),l.promise().done(function(){$("#"+i).fadeIn(300)}),!1)},g=function g(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=n.hasClass(i);return a?!1:(h.removeClass(i),n.addClass(i),r.filter.lastRes?r.history.updateUrl(t):r.history.gotoUrl(t),!1)},_=function _(){var e=$(this),t=e.attr("href"),i="mActive",n=e.parent(),a=n.hasClass(i);return a?!1:(u.removeClass(i),n.addClass(i),r.history.gotoUrl(t),!1)};n.on("click",f),s.on("click",v),i.on("change",r.filter.changeFilterHandler),i.on("submit",r.filter.sendFilter),u.on("click",".bSortingList__eLink",_),h.on("click",".bSortingList__eLink",g),c.on("click",".jsPagination",m),$("body").on("click",".jsHistoryLink",p),o.each(d)}(window.ENTER);