var DAnimFramePlayer=function(e,t){function n(e){for(var t=0;_.length>t;t++)if(_[t]==e)return;_[_.length]=e}function o(e){return a(e)?C+e:e}function a(e){return 7>e.length||"http://"!=e.substring(0,7)}function i(){if(_.length&&-1==F){for(var e=0,t=0;_.length>t;t++)(!A&&_[t].complete||A&&"complete"==_[t].readyState)&&e++;1*e/_.length,X&&X.doDraw(e*X.width/_.length),e>=_.length&&l()}}function l(){X&&X.Uninitialize(),F=0,T.animation&&T.animation.length&&(O.draggable=!1,O.style.position="absolute",O.style.cursor="pointer",O.ontouchstart=r,O.onclick=r,O.style.left=L-90+"px",O.style.top=S-90+"px",O.style.display="block",E.src=o(T.animation[0].img)),T.view360&&T.view360.length&&(z.style.position="absolute",z.style.left="10px",z.style.top=S-50+"px",z.style.display="block",z.style.cursor="pointer",z.onmousedown=c,A&&(z.onmouseup=w),H.style.position="absolute",H.style.left=L-140+"px",H.style.top=S-50+"px",H.style.display="block",H.style.cursor="pointer",H.onmousedown=v,A&&(H.onmouseup=w))}function r(){0==F&&T.animation&&T.animation.length&&(G&&(clearInterval(G),G=null),O.style.display="none",T.view360&&T.view360.length&&(z.style.display="none",H.style.display="none"),F=1,P=T.view360&&0!=T.view360.length&&0!=Math.floor(.5+p(V)/(6.2831852/T.view360.length))%T.view360.length?-1:0,s())}function s(){if(-1==P){var e=Math.floor(.5+p(V)/(6.2831852/T.view360.length));.5*T.view360.length>e?e--:e++,0==e%T.view360.length?(E.src=o(T.animation[0].img),P=0):(V=e*(6.2831852/T.view360.length),f()),setTimeout(s,30)}else P++,T.animation.length>P?(E.src=o(T.animation[P].img),setTimeout(s,T.animation[P].interval)):(F=0,E.src=o(T.animation[0].img),O.style.display="block",T.view360&&T.view360.length&&(z.style.display="block",H.style.display="block"),V=0)}function u(){if(T){if(L=T.width,S=T.height,E=document.createElement("img"),E.width=T.width,E.height=T.height,T.splash&&(E.src=o(T.splash)),A?E.ondragStart=d:E.addEventListener("dragStart",d,!1),E.draggable=!1,B.appendChild(E),T.view360)for(var e=0;T.view360.length>e;e++)n(o(T.view360[e]));if(T.animation)for(var e=0;T.animation.length>e;e++)n(o(T.animation[e].img));if(_.length>0){X=new DAnimProgressBar(A),X.Initialize(B,L,S);for(var e=0;_.length>e;e++){var t=_[e];_[e]=new Image,A?_[e].onreadystatechange=i:_[e].onload=i,_[e].src=t}}}}function d(e){e.preventDefault(),e.stopPropagation()}function h(){return!1}function c(){2!=(A?window.event.button:event.button)&&(G&&(clearInterval(G),G=null),A?z.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",w,!0)),g(),G=setInterval(g,30))}function v(){2!=(A?window.event.button:event.button)&&(G&&(clearInterval(G),G=null),A?H.setCapture():(document.addEventListener("mouseup",w,!0),event.preventDefault(),event.stopPropagation()),m(),G=setInterval(m,30))}function p(e){for(;0>e||e>=6.2831854;)e>0?e-=6.2831852:e+=6.2831852;return e}function f(){if(T.view360&&T.view360.length){var e=Math.floor(.5+p(V)/(6.2831852/T.view360.length));E.src=o(T.view360[e%T.view360.length])}}function g(){V-=.2,f()}function m(){V+=.2,f()}function w(){null!=G&&(clearInterval(G),G=null),A?H.releaseCapture():document.removeEventListener("mouseup",w,!0)}function y(e){if(0==F){var t=(A?window.event.offsetX:e.clientX)-B.offsetLeft;2==(A?window.event.button:e.button)&&(A?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),T.view360&&T.view360.length&&(A?(B.onmouseup=M,B.onmousemove=b,B.setCapture()):(document.addEventListener("mouseup",M,!0),document.addEventListener("mousemove",b,!0)),k=t-L/2,x=V))}}function b(e){var t=(A?window.event.offsetX:e.clientX)-B.offsetLeft,n=t-L/2;V=x+.02*(n-k),f(),A||e.stopPropagation()}function M(e){2==(A?window.event.button:e.button)&&(A?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),A?(B.releaseCapture(),B.onmouseup=null,B.onmousemove=null):(document.removeEventListener("mouseup",M,!0),document.removeEventListener("mousemove",b,!0)))}function I(e){0==F&&1==e.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),k=e.touches[0].pageX-L/2,x=p(V))}function D(e){if(0==F&&1==e.touches.length){e.preventDefault();var t=e.touches[0].pageX-L/2;V=x+.05*(t-k),f()}}var C,P,x,T=null,E=null,L=300,S=300,F=-1,V=0,k=0,A=0,X=null,B=document.createElement("DIV");B.setAttribute("id","3dImgContainer"),B.style.position="relative",e.appendChild(B);var O=document.createElement("DIV");O.style.display="none",O.innerHTML='<img draggable="false" src="'+t+'/images/icon_play.png" width=80 height=80 border=0>',B.appendChild(O);var z=document.createElement("DIV");z.style.display="none",z.innerHTML='<img draggable="false" src="'+t+'/images/rotate_l.png" width=51 height=47 border=0>',B.appendChild(z);var H=document.createElement("DIV");H.style.display="none",H.innerHTML='<img draggable="false" src="'+t+'/images/rotate_r.png" width=55 height=47 border=0>',B.appendChild(H);var _=[],q=function(e){if(navigator.userAgent.indexOf("MSIE")>0){var t=navigator.userAgent.match(/MSIE ([\d\.]+)/);t&&9>parseFloat(t[1])&&(A=1)}A?(B.onselectstart=h,B.onmousedown=y):(B.onselectstart=h,B.addEventListener("mousedown",y,!1),B.addEventListener("touchstart",I,!1),B.addEventListener("touchmove",D,!1)),B.oncontextmenu=h,T=e,C="",u()},G=null;return{DoLoadModel:q}},DAnimProgressBar=function(e){function t(e,t,n,o,a,i){e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+o-i,n),e.arc(t+o-i,n+i,i,-Math.PI/2,Math.PI/2,!1),e.lineTo(t+i,n+a),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1),e.closePath(),e.fill()}function n(e,n,o,a,i,l){e.save(),e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=5,e.shadowColor="#666",e.fillStyle="rgba(189,189,189,1)",t(e,n,o,a,i,l),e.shadowColor="rgba(0,0,0,0)";var r=e.createLinearGradient(0,o+i,0,0);r.addColorStop(0,"rgba(255,255,255, 0.1)"),r.addColorStop(.4,"rgba(255,255,255, 0.7)"),r.addColorStop(1,"rgba(255,255,255,0.4)"),e.fillStyle=r,t(e,n,o,a,i,l),e.fillStyle="white",e.restore()}function o(e,t,n,o,a,i,l){var r=0;e.beginPath(),i>o?(r=i-Math.sqrt(Math.pow(i,2)-Math.pow(i-o,2)),e.moveTo(t+o,n+r),e.lineTo(t+o,n+a-r),e.arc(t+i,n+i,i,Math.PI-Math.acos((i-o)/i),Math.PI+Math.acos((i-o)/i),!1)):o+i>l?(r=i-Math.sqrt(Math.pow(i,2)-Math.pow(i-(l-o),2)),e.moveTo(t+i,n),e.lineTo(t+o,n),e.arc(t+l-i,n+i,i,-Math.PI/2,-Math.acos((i-(l-o))/i),!1),e.lineTo(t+o,n+a-r),e.arc(t+l-i,n+i,i,Math.acos((i-(l-o))/i),Math.PI/2,!1),e.lineTo(t+i,n+a),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1)):(e.moveTo(t+i,n),e.lineTo(t+o,n),e.lineTo(t+o,n+a),e.lineTo(t+i,n+a),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1)),e.closePath(),e.fill(),l-1>o&&(e.save(),e.shadowOffsetX=1,e.shadowBlur=1,e.shadowColor="#666",o+i>l&&(r+=1),e.fillRect(t+o,n+r,1,s-2*r),e.restore())}function a(e,t,n,o,a,i,l){e.save(),e.fillStyle="white";var r=Math.floor(100*(o/l))+"%",s=e.measureText(r).width,u=t+o-s-i/2;i+s>=o&&(u=t+i/2),e.fillText(r,u,n+22),e.restore()}var i=null,l=null,r=300,s=34,u=20,d=20,h=s/2,c=e,v=function(){i.style.display="none"},p=function(e,t,n){if(i=document.createElement(c?"DIV":"canvas"),c||(i.width=500,i.height=150),i.style.position="absolute",i.style.left=Math.floor((t-r)/2)+"px",i.style.top=Math.floor((n-s)/2)+"px",e.appendChild(i),c&&(i.style.width=r+"px",i.style.height=s/2+"px",i.style.overflow="hidden",i.style.borderColor="#000000",i.style.borderWidth="1px",i.style.borderStyle="solid",i.style.backgroundColor="#FFFFFF",i.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+s/2+'px;"></DIV>'),!c){if(!i||!i.getContext)return;if(l=i.getContext("2d"),!l)return;l.font="16px Verdana";var o=l.createLinearGradient(0,d+s,0,0);o.addColorStop(0,"#4DA4F3"),o.addColorStop(.4,"#ADD9FF"),o.addColorStop(1,"#9ED1FF"),l.fillStyle=o}f(0)},f=function(e){if(c){var t=i.children(0);t&&(t.style.width=e+"px")}else l.clearRect(u-5,d-5,r+15,s+15),n(l,u,d,r,s,h),o(l,u,d,e,s,h,r),a(l,u,d,e,s,h,r)};return{width:r,height:s,Initialize:p,Uninitialize:v,doDraw:f}};