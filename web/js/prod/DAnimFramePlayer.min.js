var DAnimFramePlayer=function(a,e){function t(a){for(var e=0;R.length>e;e++)if(R[e]==a)return;R[R.length]=a}function n(a){return r(a)?P+a:a}function r(a){return 7>a.length||"http://"!=a.substring(0,7)}function o(){if(R.length&&-1==E){for(var a=0,e=0;R.length>e;e++)(!S&&R[e].complete||S&&"complete"==R[e].readyState)&&a++;1*a/R.length,F&&F.doDraw(a*F.width/R.length),a>=R.length&&i()}}function i(){F&&F.Uninitialize(),E=0,C.animation&&C.animation.length&&(V.draggable=!1,V.style.position="absolute",V.style.cursor="pointer",V.ontouchstart=s,V.onclick=s,V.style.left=$-90+"px",V.style.top=D-90+"px",V.style.display="block",T.src=n(C.animation[0].img)),C.view360&&C.view360.length&&(B.style.position="absolute",B.style.left="10px",B.style.top=D-50+"px",B.style.display="block",B.style.cursor="pointer",B.onmousedown=c,S&&(B.onmouseup=g),X.style.position="absolute",X.style.left=$-140+"px",X.style.top=D-50+"px",X.style.display="block",X.style.cursor="pointer",X.onmousedown=u,S&&(X.onmouseup=g))}function s(){0==E&&C.animation&&C.animation.length&&(O&&(clearInterval(O),O=null),V.style.display="none",C.view360&&C.view360.length&&(B.style.display="none",X.style.display="none"),E=1,I=C.view360&&0!=C.view360.length&&0!=Math.floor(.5+h(j)/(6.2831852/C.view360.length))%C.view360.length?-1:0,l())}function l(){if(-1==I){var a=Math.floor(.5+h(j)/(6.2831852/C.view360.length));.5*C.view360.length>a?a--:a++,0==a%C.view360.length?(T.src=n(C.animation[0].img),I=0):(j=a*(6.2831852/C.view360.length),v()),setTimeout(l,30)}else I++,C.animation.length>I?(T.src=n(C.animation[I].img),setTimeout(l,C.animation[I].interval)):(E=0,T.src=n(C.animation[0].img),V.style.display="block",C.view360&&C.view360.length&&(B.style.display="block",X.style.display="block"),j=0)}function d(){if(C){if($=C.width,D=C.height,T=document.createElement("img"),T.width=C.width,T.height=C.height,C.splash&&(T.src=n(C.splash)),S?T.ondragStart=p:T.addEventListener("dragStart",p,!1),T.draggable=!1,A.appendChild(T),C.view360)for(var a=0;C.view360.length>a;a++)t(n(C.view360[a]));if(C.animation)for(var a=0;C.animation.length>a;a++)t(n(C.animation[a].img));if(R.length>0){F=new DAnimProgressBar(S),F.Initialize(A,$,D);for(var a=0;R.length>a;a++){var e=R[a];R[a]=new Image,S?R[a].onreadystatechange=o:R[a].onload=o,R[a].src=e}}}}function p(a){a.preventDefault(),a.stopPropagation()}function _(){return!1}function c(){2!=(S?window.event.button:event.button)&&(O&&(clearInterval(O),O=null),S?B.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",g,!0)),f(),O=setInterval(f,30))}function u(){2!=(S?window.event.button:event.button)&&(O&&(clearInterval(O),O=null),S?X.setCapture():(document.addEventListener("mouseup",g,!0),event.preventDefault(),event.stopPropagation()),m(),O=setInterval(m,30))}function h(a){for(;0>a||a>=6.2831854;)a>0?a-=6.2831852:a+=6.2831852;return a}function v(){if(C.view360&&C.view360.length){var a=Math.floor(.5+h(j)/(6.2831852/C.view360.length));T.src=n(C.view360[a%C.view360.length])}}function f(){j-=.2,v()}function m(){j+=.2,v()}function g(){null!=O&&(clearInterval(O),O=null),S?X.releaseCapture():document.removeEventListener("mouseup",g,!0)}function w(a){if(0==E){var e=(S?window.event.offsetX:a.clientX)-A.offsetLeft;2==(S?window.event.button:a.button)&&(S?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),C.view360&&C.view360.length&&(S?(A.onmouseup=b,A.onmousemove=y,A.setCapture()):(document.addEventListener("mouseup",b,!0),document.addEventListener("mousemove",y,!0)),L=e-$/2,k=j))}}function y(a){var e=(S?window.event.offsetX:a.clientX)-A.offsetLeft,t=e-$/2;j=k+.02*(t-L),v(),S||a.stopPropagation()}function b(a){2==(S?window.event.button:a.button)&&(S?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),S?(A.releaseCapture(),A.onmouseup=null,A.onmousemove=null):(document.removeEventListener("mouseup",b,!0),document.removeEventListener("mousemove",y,!0)))}function x(a){0==E&&1==a.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),L=a.touches[0].pageX-$/2,k=h(j))}function M(a){if(0==E&&1==a.touches.length){a.preventDefault();var e=a.touches[0].pageX-$/2;j=k+.05*(e-L),v()}}var P,I,k,C=null,T=null,$=300,D=300,E=-1,j=0,L=0,S=0,F=null,A=document.createElement("DIV");A.setAttribute("id","3dImgContainer"),A.style.position="relative",a.appendChild(A);var V=document.createElement("DIV");V.style.display="none",V.innerHTML='<img draggable="false" src="'+e+'/images/icon_play.png" width=80 height=80 border=0>',A.appendChild(V);var B=document.createElement("DIV");B.style.display="none",B.innerHTML='<img draggable="false" src="'+e+'/images/rotate_l.png" width=51 height=47 border=0>',A.appendChild(B);var X=document.createElement("DIV");X.style.display="none",X.innerHTML='<img draggable="false" src="'+e+'/images/rotate_r.png" width=55 height=47 border=0>',A.appendChild(X);var R=[],z=function(a){if(navigator.userAgent.indexOf("MSIE")>0){var e=navigator.userAgent.match(/MSIE ([\d\.]+)/);e&&9>parseFloat(e[1])&&(S=1)}S?(A.onselectstart=_,A.onmousedown=w):(A.onselectstart=_,A.addEventListener("mousedown",w,!1),A.addEventListener("touchstart",x,!1),A.addEventListener("touchmove",M,!1)),A.oncontextmenu=_,C=a,P="",d()},O=null;return{DoLoadModel:z}},DAnimProgressBar=function(a){function e(a,e,t,n,r,o){a.beginPath(),a.moveTo(e+o,t),a.lineTo(e+n-o,t),a.arc(e+n-o,t+o,o,-Math.PI/2,Math.PI/2,!1),a.lineTo(e+o,t+r),a.arc(e+o,t+o,o,Math.PI/2,3*Math.PI/2,!1),a.closePath(),a.fill()}function t(a,t,n,r,o,i){a.save(),a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=5,a.shadowColor="#666",a.fillStyle="rgba(189,189,189,1)",e(a,t,n,r,o,i),a.shadowColor="rgba(0,0,0,0)";var s=a.createLinearGradient(0,n+o,0,0);s.addColorStop(0,"rgba(255,255,255, 0.1)"),s.addColorStop(.4,"rgba(255,255,255, 0.7)"),s.addColorStop(1,"rgba(255,255,255,0.4)"),a.fillStyle=s,e(a,t,n,r,o,i),a.fillStyle="white",a.restore()}function n(a,e,t,n,r,o,i){var s=0;a.beginPath(),o>n?(s=o-Math.sqrt(Math.pow(o,2)-Math.pow(o-n,2)),a.moveTo(e+n,t+s),a.lineTo(e+n,t+r-s),a.arc(e+o,t+o,o,Math.PI-Math.acos((o-n)/o),Math.PI+Math.acos((o-n)/o),!1)):n+o>i?(s=o-Math.sqrt(Math.pow(o,2)-Math.pow(o-(i-n),2)),a.moveTo(e+o,t),a.lineTo(e+n,t),a.arc(e+i-o,t+o,o,-Math.PI/2,-Math.acos((o-(i-n))/o),!1),a.lineTo(e+n,t+r-s),a.arc(e+i-o,t+o,o,Math.acos((o-(i-n))/o),Math.PI/2,!1),a.lineTo(e+o,t+r),a.arc(e+o,t+o,o,Math.PI/2,3*Math.PI/2,!1)):(a.moveTo(e+o,t),a.lineTo(e+n,t),a.lineTo(e+n,t+r),a.lineTo(e+o,t+r),a.arc(e+o,t+o,o,Math.PI/2,3*Math.PI/2,!1)),a.closePath(),a.fill(),i-1>n&&(a.save(),a.shadowOffsetX=1,a.shadowBlur=1,a.shadowColor="#666",n+o>i&&(s+=1),a.fillRect(e+n,t+s,1,l-2*s),a.restore())}function r(a,e,t,n,r,o,i){a.save(),a.fillStyle="white";var s=Math.floor(100*(n/i))+"%",l=a.measureText(s).width,d=e+n-l-o/2;o+l>=n&&(d=e+o/2),a.fillText(s,d,t+22),a.restore()}var o=null,i=null,s=300,l=34,d=20,p=20,_=l/2,c=a,u=function(){o.style.display="none"},h=function(a,e,t){if(o=document.createElement(c?"DIV":"canvas"),c||(o.width=500,o.height=150),o.style.position="absolute",o.style.left=Math.floor((e-s)/2)+"px",o.style.top=Math.floor((t-l)/2)+"px",a.appendChild(o),c&&(o.style.width=s+"px",o.style.height=l/2+"px",o.style.overflow="hidden",o.style.borderColor="#000000",o.style.borderWidth="1px",o.style.borderStyle="solid",o.style.backgroundColor="#FFFFFF",o.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+l/2+'px;"></DIV>'),!c){if(!o||!o.getContext)return;if(i=o.getContext("2d"),!i)return;i.font="16px Verdana";var n=i.createLinearGradient(0,p+l,0,0);n.addColorStop(0,"#4DA4F3"),n.addColorStop(.4,"#ADD9FF"),n.addColorStop(1,"#9ED1FF"),i.fillStyle=n}v(0)},v=function(a){if(c){var e=o.children(0);e&&(e.style.width=a+"px")}else i.clearRect(d-5,p-5,s+15,l+15),t(i,d,p,s,l,_),n(i,d,p,a,l,_,s),r(i,d,p,a,l,_,s)};return{width:s,height:l,Initialize:h,Uninitialize:u,doDraw:v}};