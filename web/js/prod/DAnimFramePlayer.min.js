var DAnimFramePlayer=function(a,e){function t(a){for(var e=0;V.length>e;e++)if(V[e]==a)return;V[V.length]=a}function r(a){return n(a)?k+a:a}function n(a){return 7>a.length||"http://"!=a.substring(0,7)}function s(){if(V.length&&-1==E){for(var a=0,e=0;V.length>e;e++)(!L&&V[e].complete||L&&"complete"==V[e].readyState)&&a++;1*a/V.length,A&&A.doDraw(a*A.width/V.length),a>=V.length&&i()}}function i(){A&&A.Uninitialize(),E=0,M.animation&&M.animation.length&&(z.draggable=!1,z.style.position="absolute",z.style.cursor="pointer",z.ontouchstart=o,z.onclick=o,z.style.left=T-90+"px",z.style.top=C-90+"px",z.style.display="block",I.src=r(M.animation[0].img)),M.view360&&M.view360.length&&(R.style.position="absolute",R.style.left="10px",R.style.top=C-50+"px",R.style.display="block",R.style.cursor="pointer",R.onmousedown=c,L&&(R.onmouseup=g),B.style.position="absolute",B.style.left=T-140+"px",B.style.top=C-50+"px",B.style.display="block",B.style.cursor="pointer",B.onmousedown=u,L&&(B.onmouseup=g))}function o(){0==E&&M.animation&&M.animation.length&&(O&&(clearInterval(O),O=null),z.style.display="none",M.view360&&M.view360.length&&(R.style.display="none",B.style.display="none"),E=1,$=M.view360&&0!=M.view360.length&&0!=Math.floor(.5+h(D)/(6.2831852/M.view360.length))%M.view360.length?-1:0,d())}function d(){if(-1==$){var a=Math.floor(.5+h(D)/(6.2831852/M.view360.length));.5*M.view360.length>a?a--:a++,0==a%M.view360.length?(I.src=r(M.animation[0].img),$=0):(D=a*(6.2831852/M.view360.length),f()),setTimeout(d,30)}else $++,M.animation.length>$?(I.src=r(M.animation[$].img),setTimeout(d,M.animation[$].interval)):(E=0,I.src=r(M.animation[0].img),z.style.display="block",M.view360&&M.view360.length&&(R.style.display="block",B.style.display="block"),D=0)}function l(){if(M){if(T=M.width,C=M.height,I=document.createElement("img"),I.width=M.width,I.height=M.height,M.splash&&(I.src=r(M.splash)),L?I.ondragStart=p:I.addEventListener("dragStart",p,!1),I.draggable=!1,F.appendChild(I),M.view360)for(var a=0;M.view360.length>a;a++)t(r(M.view360[a]));if(M.animation)for(var a=0;M.animation.length>a;a++)t(r(M.animation[a].img));if(V.length>0){A=new DAnimProgressBar(L),A.Initialize(F,T,C);for(var a=0;V.length>a;a++){var e=V[a];V[a]=new Image,L?V[a].onreadystatechange=s:V[a].onload=s,V[a].src=e}}}}function p(a){a.preventDefault(),a.stopPropagation()}function _(){return!1}function c(){2!=(L?window.event.button:event.button)&&(O&&(clearInterval(O),O=null),L?R.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",g,!0)),v(),O=setInterval(v,30))}function u(){2!=(L?window.event.button:event.button)&&(O&&(clearInterval(O),O=null),L?B.setCapture():(document.addEventListener("mouseup",g,!0),event.preventDefault(),event.stopPropagation()),m(),O=setInterval(m,30))}function h(a){for(;0>a||a>=6.2831854;)a>0?a-=6.2831852:a+=6.2831852;return a}function f(){if(M.view360&&M.view360.length){var a=Math.floor(.5+h(D)/(6.2831852/M.view360.length));I.src=r(M.view360[a%M.view360.length])}}function v(){D-=.2,f()}function m(){D+=.2,f()}function g(){null!=O&&(clearInterval(O),O=null),L?B.releaseCapture():document.removeEventListener("mouseup",g,!0)}function w(a){if(0==E){var e=(L?window.event.offsetX:a.clientX)-F.offsetLeft;2==(L?window.event.button:a.button)&&(L?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),M.view360&&M.view360.length&&(L?(F.onmouseup=b,F.onmousemove=y,F.setCapture()):(document.addEventListener("mouseup",b,!0),document.addEventListener("mousemove",y,!0)),S=e-T/2,j=D))}}function y(a){var e=(L?window.event.offsetX:a.clientX)-F.offsetLeft,t=e-T/2;D=j+.02*(t-S),f(),L||a.stopPropagation()}function b(a){2==(L?window.event.button:a.button)&&(L?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),L?(F.releaseCapture(),F.onmouseup=null,F.onmousemove=null):(document.removeEventListener("mouseup",b,!0),document.removeEventListener("mousemove",y,!0)))}function x(a){0==E&&1==a.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),S=a.touches[0].pageX-T/2,j=h(D))}function P(a){if(0==E&&1==a.touches.length){a.preventDefault();var e=a.touches[0].pageX-T/2;D=j+.05*(e-S),f()}}var k,$,j,M=null,I=null,T=300,C=300,E=-1,D=0,S=0,L=0,A=null,F=document.createElement("DIV");F.setAttribute("id","3dImgContainer"),F.style.position="relative",a.appendChild(F);var z=document.createElement("DIV");z.style.display="none",z.innerHTML='<img draggable="false" src="'+e+'/images/icon_play.png" width=80 height=80 border=0>',F.appendChild(z);var R=document.createElement("DIV");R.style.display="none",R.innerHTML='<img draggable="false" src="'+e+'/images/rotate_l.png" width=51 height=47 border=0>',F.appendChild(R);var B=document.createElement("DIV");B.style.display="none",B.innerHTML='<img draggable="false" src="'+e+'/images/rotate_r.png" width=55 height=47 border=0>',F.appendChild(B);var V=[],X=function(a){if(navigator.userAgent.indexOf("MSIE")>0){var e=navigator.userAgent.match(/MSIE ([\d\.]+)/);e&&9>parseFloat(e[1])&&(L=1)}L?(F.onselectstart=_,F.onmousedown=w):(F.onselectstart=_,F.addEventListener("mousedown",w,!1),F.addEventListener("touchstart",x,!1),F.addEventListener("touchmove",P,!1)),F.oncontextmenu=_,M=a,k="",l()},O=null;return{DoLoadModel:X}},DAnimProgressBar=function(a){function e(a,e,t,r,n,s){a.beginPath(),a.moveTo(e+s,t),a.lineTo(e+r-s,t),a.arc(e+r-s,t+s,s,-Math.PI/2,Math.PI/2,!1),a.lineTo(e+s,t+n),a.arc(e+s,t+s,s,Math.PI/2,3*Math.PI/2,!1),a.closePath(),a.fill()}function t(a,t,r,n,s,i){a.save(),a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=5,a.shadowColor="#666",a.fillStyle="rgba(189,189,189,1)",e(a,t,r,n,s,i),a.shadowColor="rgba(0,0,0,0)";var o=a.createLinearGradient(0,r+s,0,0);o.addColorStop(0,"rgba(255,255,255, 0.1)"),o.addColorStop(.4,"rgba(255,255,255, 0.7)"),o.addColorStop(1,"rgba(255,255,255,0.4)"),a.fillStyle=o,e(a,t,r,n,s,i),a.fillStyle="white",a.restore()}function r(a,e,t,r,n,s,i){var o=0;a.beginPath(),s>r?(o=s-Math.sqrt(Math.pow(s,2)-Math.pow(s-r,2)),a.moveTo(e+r,t+o),a.lineTo(e+r,t+n-o),a.arc(e+s,t+s,s,Math.PI-Math.acos((s-r)/s),Math.PI+Math.acos((s-r)/s),!1)):r+s>i?(o=s-Math.sqrt(Math.pow(s,2)-Math.pow(s-(i-r),2)),a.moveTo(e+s,t),a.lineTo(e+r,t),a.arc(e+i-s,t+s,s,-Math.PI/2,-Math.acos((s-(i-r))/s),!1),a.lineTo(e+r,t+n-o),a.arc(e+i-s,t+s,s,Math.acos((s-(i-r))/s),Math.PI/2,!1),a.lineTo(e+s,t+n),a.arc(e+s,t+s,s,Math.PI/2,3*Math.PI/2,!1)):(a.moveTo(e+s,t),a.lineTo(e+r,t),a.lineTo(e+r,t+n),a.lineTo(e+s,t+n),a.arc(e+s,t+s,s,Math.PI/2,3*Math.PI/2,!1)),a.closePath(),a.fill(),i-1>r&&(a.save(),a.shadowOffsetX=1,a.shadowBlur=1,a.shadowColor="#666",r+s>i&&(o+=1),a.fillRect(e+r,t+o,1,d-2*o),a.restore())}function n(a,e,t,r,n,s,i){a.save(),a.fillStyle="white";var o=Math.floor(100*(r/i))+"%",d=a.measureText(o).width,l=e+r-d-s/2;s+d>=r&&(l=e+s/2),a.fillText(o,l,t+22),a.restore()}var s=null,i=null,o=300,d=34,l=20,p=20,_=d/2,c=a,u=function(){s.style.display="none"},h=function(a,e,t){if(s=document.createElement(c?"DIV":"canvas"),c||(s.width=500,s.height=150),s.style.position="absolute",s.style.left=Math.floor((e-o)/2)+"px",s.style.top=Math.floor((t-d)/2)+"px",a.appendChild(s),c&&(s.style.width=o+"px",s.style.height=d/2+"px",s.style.overflow="hidden",s.style.borderColor="#000000",s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.backgroundColor="#FFFFFF",s.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+d/2+'px;"></DIV>'),!c){if(!s||!s.getContext)return;if(i=s.getContext("2d"),!i)return;i.font="16px Verdana";var r=i.createLinearGradient(0,p+d,0,0);r.addColorStop(0,"#4DA4F3"),r.addColorStop(.4,"#ADD9FF"),r.addColorStop(1,"#9ED1FF"),i.fillStyle=r}f(0)},f=function(a){if(c){var e=s.children(0);e&&(e.style.width=a+"px")}else i.clearRect(l-5,p-5,o+15,d+15),t(i,l,p,o,d,_),r(i,l,p,a,d,_,o),n(i,l,p,a,d,_,o)};return{width:o,height:d,Initialize:h,Uninitialize:u,doDraw:f}};