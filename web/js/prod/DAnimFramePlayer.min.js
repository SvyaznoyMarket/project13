var DAnimFramePlayer=function(e,t){function n(e){for(var t=0;R.length>t;t++)if(R[t]==e)return;R[R.length]=e}function a(e){return o(e)?P+e:e}function o(e){return 7>e.length||"http://"!=e.substring(0,7)}function i(){if(R.length&&-1==L){for(var e=0,t=0;R.length>t;t++)(!j&&R[t].complete||j&&"complete"==R[t].readyState)&&e++;1*e/R.length,$&&$.doDraw(e*$.width/R.length),e>=R.length&&r()}}function r(){$&&$.Uninitialize(),L=0,D.animation&&D.animation.length&&(V.draggable=!1,V.style.position="absolute",V.style.cursor="pointer",V.ontouchstart=l,V.onclick=l,V.style.left=E-90+"px",V.style.top=S-90+"px",V.style.display="block",T.src=a(D.animation[0].img)),D.view360&&D.view360.length&&(B.style.position="absolute",B.style.left="10px",B.style.top=S-50+"px",B.style.display="block",B.style.cursor="pointer",B.onmousedown=p,j&&(B.onmouseup=w),X.style.position="absolute",X.style.left=E-140+"px",X.style.top=S-50+"px",X.style.display="block",X.style.cursor="pointer",X.onmousedown=v,j&&(X.onmouseup=w))}function l(){0==L&&D.animation&&D.animation.length&&(z&&(clearInterval(z),z=null),V.style.display="none",D.view360&&D.view360.length&&(B.style.display="none",X.style.display="none"),L=1,I=D.view360&&0!=D.view360.length&&0!=Math.floor(.5+h(k)/(6.2831852/D.view360.length))%D.view360.length?-1:0,s())}function s(){if(-1==I){var e=Math.floor(.5+h(k)/(6.2831852/D.view360.length));.5*D.view360.length>e?e--:e++,0==e%D.view360.length?(T.src=a(D.animation[0].img),I=0):(k=e*(6.2831852/D.view360.length),f()),setTimeout(s,30)}else I++,D.animation.length>I?(T.src=a(D.animation[I].img),setTimeout(s,D.animation[I].interval)):(L=0,T.src=a(D.animation[0].img),V.style.display="block",D.view360&&D.view360.length&&(B.style.display="block",X.style.display="block"),k=0)}function d(){if(D){if(E=D.width,S=D.height,T=document.createElement("img"),T.width=D.width,T.height=D.height,D.splash&&(T.src=a(D.splash)),j?T.ondragStart=c:T.addEventListener("dragStart",c,!1),T.draggable=!1,A.appendChild(T),D.view360)for(var e=0;D.view360.length>e;e++)n(a(D.view360[e]));if(D.animation)for(var e=0;D.animation.length>e;e++)n(a(D.animation[e].img));if(R.length>0){$=new DAnimProgressBar(j),$.Initialize(A,E,S);for(var e=0;R.length>e;e++){var t=R[e];R[e]=new Image,j?R[e].onreadystatechange=i:R[e].onload=i,R[e].src=t}}}}function c(e){e.preventDefault(),e.stopPropagation()}function u(){return!1}function p(){2!=(j?window.event.button:event.button)&&(z&&(clearInterval(z),z=null),j?B.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",w,!0)),m(),z=setInterval(m,30))}function v(){2!=(j?window.event.button:event.button)&&(z&&(clearInterval(z),z=null),j?X.setCapture():(document.addEventListener("mouseup",w,!0),event.preventDefault(),event.stopPropagation()),g(),z=setInterval(g,30))}function h(e){for(;0>e||e>=6.2831854;)e>0?e-=6.2831852:e+=6.2831852;return e}function f(){if(D.view360&&D.view360.length){var e=Math.floor(.5+h(k)/(6.2831852/D.view360.length));T.src=a(D.view360[e%D.view360.length])}}function m(){k-=.2,f()}function g(){k+=.2,f()}function w(){null!=z&&(clearInterval(z),z=null),j?X.releaseCapture():document.removeEventListener("mouseup",w,!0)}function y(e){if(0==L){var t=(j?window.event.offsetX:e.clientX)-A.offsetLeft;2==(j?window.event.button:e.button)&&(j?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),D.view360&&D.view360.length&&(j?(A.onmouseup=b,A.onmousemove=_,A.setCapture()):(document.addEventListener("mouseup",b,!0),document.addEventListener("mousemove",_,!0)),F=t-E/2,C=k))}}function _(e){var t=(j?window.event.offsetX:e.clientX)-A.offsetLeft,n=t-E/2;k=C+.02*(n-F),f(),j||e.stopPropagation()}function b(e){2==(j?window.event.button:e.button)&&(j?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),j?(A.releaseCapture(),A.onmouseup=null,A.onmousemove=null):(document.removeEventListener("mouseup",b,!0),document.removeEventListener("mousemove",_,!0)))}function x(e){0==L&&1==e.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):e.preventDefault(),F=e.touches[0].pageX-E/2,C=h(k))}function M(e){if(0==L&&1==e.touches.length){e.preventDefault();var t=e.touches[0].pageX-E/2;k=C+.05*(t-F),f()}}var P,I,C,D=null,T=null,E=300,S=300,L=-1,k=0,F=0,j=0,$=null,A=document.createElement("DIV");A.setAttribute("id","3dImgContainer"),A.style.position="relative",e.appendChild(A);var V=document.createElement("DIV");V.style.display="none",V.innerHTML='<img draggable="false" src="'+t+'/images/icon_play.png" width=80 height=80 border=0>',A.appendChild(V);var B=document.createElement("DIV");B.style.display="none",B.innerHTML='<img draggable="false" src="'+t+'/images/rotate_l.png" width=51 height=47 border=0>',A.appendChild(B);var X=document.createElement("DIV");X.style.display="none",X.innerHTML='<img draggable="false" src="'+t+'/images/rotate_r.png" width=55 height=47 border=0>',A.appendChild(X);var R=[],O=function(e){if(navigator.userAgent.indexOf("MSIE")>0){var t=navigator.userAgent.match(/MSIE ([\d\.]+)/);t&&9>parseFloat(t[1])&&(j=1)}j?(A.onselectstart=u,A.onmousedown=y):(A.onselectstart=u,A.addEventListener("mousedown",y,!1),A.addEventListener("touchstart",x,!1),A.addEventListener("touchmove",M,!1)),A.oncontextmenu=u,D=e,P="",d()},z=null;return{DoLoadModel:O}},DAnimProgressBar=function(e){function t(e,t,n,a,o,i){e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+a-i,n),e.arc(t+a-i,n+i,i,-Math.PI/2,Math.PI/2,!1),e.lineTo(t+i,n+o),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1),e.closePath(),e.fill()}function n(e,n,a,o,i,r){e.save(),e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=5,e.shadowColor="#666",e.fillStyle="rgba(189,189,189,1)",t(e,n,a,o,i,r),e.shadowColor="rgba(0,0,0,0)";var l=e.createLinearGradient(0,a+i,0,0);l.addColorStop(0,"rgba(255,255,255, 0.1)"),l.addColorStop(.4,"rgba(255,255,255, 0.7)"),l.addColorStop(1,"rgba(255,255,255,0.4)"),e.fillStyle=l,t(e,n,a,o,i,r),e.fillStyle="white",e.restore()}function a(e,t,n,a,o,i,r){var l=0;e.beginPath(),i>a?(l=i-Math.sqrt(Math.pow(i,2)-Math.pow(i-a,2)),e.moveTo(t+a,n+l),e.lineTo(t+a,n+o-l),e.arc(t+i,n+i,i,Math.PI-Math.acos((i-a)/i),Math.PI+Math.acos((i-a)/i),!1)):a+i>r?(l=i-Math.sqrt(Math.pow(i,2)-Math.pow(i-(r-a),2)),e.moveTo(t+i,n),e.lineTo(t+a,n),e.arc(t+r-i,n+i,i,-Math.PI/2,-Math.acos((i-(r-a))/i),!1),e.lineTo(t+a,n+o-l),e.arc(t+r-i,n+i,i,Math.acos((i-(r-a))/i),Math.PI/2,!1),e.lineTo(t+i,n+o),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1)):(e.moveTo(t+i,n),e.lineTo(t+a,n),e.lineTo(t+a,n+o),e.lineTo(t+i,n+o),e.arc(t+i,n+i,i,Math.PI/2,3*Math.PI/2,!1)),e.closePath(),e.fill(),r-1>a&&(e.save(),e.shadowOffsetX=1,e.shadowBlur=1,e.shadowColor="#666",a+i>r&&(l+=1),e.fillRect(t+a,n+l,1,s-2*l),e.restore())}function o(e,t,n,a,o,i,r){e.save(),e.fillStyle="white";var l=Math.floor(100*(a/r))+"%",s=e.measureText(l).width,d=t+a-s-i/2;i+s>=a&&(d=t+i/2),e.fillText(l,d,n+22),e.restore()}var i=null,r=null,l=300,s=34,d=20,c=20,u=s/2,p=e,v=function(){i.style.display="none"},h=function(e,t,n){if(i=document.createElement(p?"DIV":"canvas"),p||(i.width=500,i.height=150),i.style.position="absolute",i.style.left=Math.floor((t-l)/2)+"px",i.style.top=Math.floor((n-s)/2)+"px",e.appendChild(i),p&&(i.style.width=l+"px",i.style.height=s/2+"px",i.style.overflow="hidden",i.style.borderColor="#000000",i.style.borderWidth="1px",i.style.borderStyle="solid",i.style.backgroundColor="#FFFFFF",i.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+s/2+'px;"></DIV>'),!p){if(!i||!i.getContext)return;if(r=i.getContext("2d"),!r)return;r.font="16px Verdana";var a=r.createLinearGradient(0,c+s,0,0);a.addColorStop(0,"#4DA4F3"),a.addColorStop(.4,"#ADD9FF"),a.addColorStop(1,"#9ED1FF"),r.fillStyle=a}f(0)},f=function(e){if(p){var t=i.children(0);t&&(t.style.width=e+"px")}else r.clearRect(d-5,c-5,l+15,s+15),n(r,d,c,l,s,u),a(r,d,c,e,s,u,l),o(r,d,c,e,s,u,l)};return{width:l,height:s,Initialize:h,Uninitialize:v,doDraw:f}};