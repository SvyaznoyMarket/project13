var DAnimFramePlayer=function(a,e){function n(a){for(var e=0;X.length>e;e++)if(X[e]==a)return;X[X.length]=a}function r(a){return t(a)?M+a:a}function t(a){return 7>a.length||"http://"!=a.substring(0,7)}function o(){if(X.length&&-1==j){for(var a=0,e=0;X.length>e;e++)(!S&&X[e].complete||S&&"complete"==X[e].readyState)&&a++;1*a/X.length,F&&F.doDraw(a*F.width/X.length),a>=X.length&&d()}}function d(){F&&F.Uninitialize(),j=0,T.animation&&T.animation.length&&(A.draggable=!1,A.style.position="absolute",A.style.cursor="pointer",A.ontouchstart=i,A.onclick=i,A.style.left=C-90+"px",A.style.top=D-90+"px",A.style.display="block",$.src=r(T.animation[0].img)),T.view360&&T.view360.length&&(B.style.position="absolute",B.style.left="10px",B.style.top=D-50+"px",B.style.display="block",B.style.cursor="pointer",B.onmousedown=c,S&&(B.onmouseup=g),V.style.position="absolute",V.style.left=C-140+"px",V.style.top=D-50+"px",V.style.display="block",V.style.cursor="pointer",V.onmousedown=u,S&&(V.onmouseup=g))}function i(){0==j&&T.animation&&T.animation.length&&(R&&(clearInterval(R),R=null),A.style.display="none",T.view360&&T.view360.length&&(B.style.display="none",V.style.display="none"),j=1,P=T.view360&&0!=T.view360.length&&0!=Math.floor(.5+h(E)/(6.2831852/T.view360.length))%T.view360.length?-1:0,s())}function s(){if(-1==P){var a=Math.floor(.5+h(E)/(6.2831852/T.view360.length));.5*T.view360.length>a?a--:a++,0==a%T.view360.length?($.src=r(T.animation[0].img),P=0):(E=a*(6.2831852/T.view360.length),f()),setTimeout(s,30)}else P++,T.animation.length>P?($.src=r(T.animation[P].img),setTimeout(s,T.animation[P].interval)):(j=0,$.src=r(T.animation[0].img),A.style.display="block",T.view360&&T.view360.length&&(B.style.display="block",V.style.display="block"),E=0)}function l(){if(T){if(C=T.width,D=T.height,$=document.createElement("img"),$.width=T.width,$.height=T.height,T.splash&&($.src=r(T.splash)),S?$.ondragStart=_:$.addEventListener("dragStart",_,!1),$.draggable=!1,z.appendChild($),T.view360)for(var a=0;T.view360.length>a;a++)n(r(T.view360[a]));if(T.animation)for(var a=0;T.animation.length>a;a++)n(r(T.animation[a].img));if(X.length>0){F=new DAnimProgressBar(S),F.Initialize(z,C,D);for(var a=0;X.length>a;a++){var e=X[a];X[a]=new Image,S?X[a].onreadystatechange=o:X[a].onload=o,X[a].src=e}}}}function _(a){a.preventDefault(),a.stopPropagation()}function p(){return!1}function c(){2!=(S?window.event.button:event.button)&&(R&&(clearInterval(R),R=null),S?B.setCapture():(event.preventDefault(),event.stopPropagation(),document.addEventListener("mouseup",g,!0)),v(),R=setInterval(v,30))}function u(){2!=(S?window.event.button:event.button)&&(R&&(clearInterval(R),R=null),S?V.setCapture():(document.addEventListener("mouseup",g,!0),event.preventDefault(),event.stopPropagation()),m(),R=setInterval(m,30))}function h(a){for(;0>a||a>=6.2831854;)a>0?a-=6.2831852:a+=6.2831852;return a}function f(){if(T.view360&&T.view360.length){var a=Math.floor(.5+h(E)/(6.2831852/T.view360.length));$.src=r(T.view360[a%T.view360.length])}}function v(){E-=.2,f()}function m(){E+=.2,f()}function g(){null!=R&&(clearInterval(R),R=null),S?V.releaseCapture():document.removeEventListener("mouseup",g,!0)}function w(a){if(0==j){var e=(S?window.event.offsetX:a.clientX)-z.offsetLeft;2==(S?window.event.button:a.button)&&(S?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),T.view360&&T.view360.length&&(S?(z.onmouseup=b,z.onmousemove=y,z.setCapture()):(document.addEventListener("mouseup",b,!0),document.addEventListener("mousemove",y,!0)),L=e-C/2,I=E))}}function y(a){var e=(S?window.event.offsetX:a.clientX)-z.offsetLeft,n=e-C/2;E=I+.02*(n-L),f(),S||a.stopPropagation()}function b(a){2==(S?window.event.button:a.button)&&(S?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),S?(z.releaseCapture(),z.onmouseup=null,z.onmousemove=null):(document.removeEventListener("mouseup",b,!0),document.removeEventListener("mousemove",y,!0)))}function x(a){0==j&&1==a.touches.length&&(bOldDraw?(window.event.returnValue=!1,window.event.cancelBubble=!0):a.preventDefault(),L=a.touches[0].pageX-C/2,I=h(E))}function k(a){if(0==j&&1==a.touches.length){a.preventDefault();var e=a.touches[0].pageX-C/2;E=I+.05*(e-L),f()}}var M,P,I,T=null,$=null,C=300,D=300,j=-1,E=0,L=0,S=0,F=null,z=document.createElement("DIV");z.setAttribute("id","3dImgContainer"),z.style.position="relative",a.appendChild(z);var A=document.createElement("DIV");A.style.display="none",A.innerHTML='<img draggable="false" src="'+e+'/images/icon_play.png" width=80 height=80 border=0>',z.appendChild(A);var B=document.createElement("DIV");B.style.display="none",B.innerHTML='<img draggable="false" src="'+e+'/images/rotate_l.png" width=51 height=47 border=0>',z.appendChild(B);var V=document.createElement("DIV");V.style.display="none",V.innerHTML='<img draggable="false" src="'+e+'/images/rotate_r.png" width=55 height=47 border=0>',z.appendChild(V);var X=[],O=function(a){if(navigator.userAgent.indexOf("MSIE")>0){var e=navigator.userAgent.match(/MSIE ([\d\.]+)/);e&&9>parseFloat(e[1])&&(S=1)}S?(z.onselectstart=p,z.onmousedown=w):(z.onselectstart=p,z.addEventListener("mousedown",w,!1),z.addEventListener("touchstart",x,!1),z.addEventListener("touchmove",k,!1)),z.oncontextmenu=p,T=a,M="",l()},R=null;return{DoLoadModel:O}},DAnimProgressBar=function(a){function e(a,e,n,r,t,o){a.beginPath(),a.moveTo(e+o,n),a.lineTo(e+r-o,n),a.arc(e+r-o,n+o,o,-Math.PI/2,Math.PI/2,!1),a.lineTo(e+o,n+t),a.arc(e+o,n+o,o,Math.PI/2,3*Math.PI/2,!1),a.closePath(),a.fill()}function n(a,n,r,t,o,d){a.save(),a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=5,a.shadowColor="#666",a.fillStyle="rgba(189,189,189,1)",e(a,n,r,t,o,d),a.shadowColor="rgba(0,0,0,0)";var i=a.createLinearGradient(0,r+o,0,0);i.addColorStop(0,"rgba(255,255,255, 0.1)"),i.addColorStop(.4,"rgba(255,255,255, 0.7)"),i.addColorStop(1,"rgba(255,255,255,0.4)"),a.fillStyle=i,e(a,n,r,t,o,d),a.fillStyle="white",a.restore()}function r(a,e,n,r,t,o,d){var i=0;a.beginPath(),o>r?(i=o-Math.sqrt(Math.pow(o,2)-Math.pow(o-r,2)),a.moveTo(e+r,n+i),a.lineTo(e+r,n+t-i),a.arc(e+o,n+o,o,Math.PI-Math.acos((o-r)/o),Math.PI+Math.acos((o-r)/o),!1)):r+o>d?(i=o-Math.sqrt(Math.pow(o,2)-Math.pow(o-(d-r),2)),a.moveTo(e+o,n),a.lineTo(e+r,n),a.arc(e+d-o,n+o,o,-Math.PI/2,-Math.acos((o-(d-r))/o),!1),a.lineTo(e+r,n+t-i),a.arc(e+d-o,n+o,o,Math.acos((o-(d-r))/o),Math.PI/2,!1),a.lineTo(e+o,n+t),a.arc(e+o,n+o,o,Math.PI/2,3*Math.PI/2,!1)):(a.moveTo(e+o,n),a.lineTo(e+r,n),a.lineTo(e+r,n+t),a.lineTo(e+o,n+t),a.arc(e+o,n+o,o,Math.PI/2,3*Math.PI/2,!1)),a.closePath(),a.fill(),d-1>r&&(a.save(),a.shadowOffsetX=1,a.shadowBlur=1,a.shadowColor="#666",r+o>d&&(i+=1),a.fillRect(e+r,n+i,1,s-2*i),a.restore())}function t(a,e,n,r,t,o,d){a.save(),a.fillStyle="white";var i=Math.floor(100*(r/d))+"%",s=a.measureText(i).width,l=e+r-s-o/2;o+s>=r&&(l=e+o/2),a.fillText(i,l,n+22),a.restore()}var o=null,d=null,i=300,s=34,l=20,_=20,p=s/2,c=a,u=function(){o.style.display="none"},h=function(a,e,n){if(o=document.createElement(c?"DIV":"canvas"),c||(o.width=500,o.height=150),o.style.position="absolute",o.style.left=Math.floor((e-i)/2)+"px",o.style.top=Math.floor((n-s)/2)+"px",a.appendChild(o),c&&(o.style.width=i+"px",o.style.height=s/2+"px",o.style.overflow="hidden",o.style.borderColor="#000000",o.style.borderWidth="1px",o.style.borderStyle="solid",o.style.backgroundColor="#FFFFFF",o.innerHTML='<DIV style="background-color:#ADD9FF;width:0px;height:'+s/2+'px;"></DIV>'),!c){if(!o||!o.getContext)return;if(d=o.getContext("2d"),!d)return;d.font="16px Verdana";var r=d.createLinearGradient(0,_+s,0,0);r.addColorStop(0,"#4DA4F3"),r.addColorStop(.4,"#ADD9FF"),r.addColorStop(1,"#9ED1FF"),d.fillStyle=r}f(0)},f=function(a){if(c){var e=o.children(0);e&&(e.style.width=a+"px")}else d.clearRect(l-5,_-5,i+15,s+15),n(d,l,_,i,s,p),r(d,l,_,a,s,p,i),t(d,l,_,a,s,p,i)};return{width:i,height:s,Initialize:h,Uninitialize:u,doDraw:f}};