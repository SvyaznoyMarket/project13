(function(){var e=$(".jsUserEditEnterprizeForm"),n=$(".jsEnterprizeAuthLink"),r=$("body"),o=$(".jsMobilePhone"),i=$(".jsCardNumber"),t={fields:[{fieldNode:$(".jsFirstName"),require:!0,customErr:"Не указано имя"},{fieldNode:$(".jsLastName"),require:!0,customErr:"Не указана фамилия"},{fieldNode:o,require:!0,validBy:"isPhone",customErr:"Не указан номер телефона"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"}]},l=new FormValidator(t),s=function s(e,r){r&&r.name&&n.length&&$.each(n,function(){$(this).removeClass("jsEnterprizeAuthLink")})},a=function a(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},u=function u(n,r){var r=r?r:"error",o="error"===r?"red":"notice"===r?"green":null,i=$("ul."+o);if(o)return i.length?i.html("<li>"+n+"</li>"):e.prepend($('<ul class="'+o+'" />').append("<li>"+n+"</li>")),!1},d=function d(e){var n=$('[name="user['+e.field+']"]'),r=function r(){l._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),l._markFieldError(n,e.message),n.bind("focus",r),!1},m=function m(e){var n,r=null;for(console.warn("Обработка ошибок формы"),n=e.form.error.length-1;n>=0;n--)r=e.form.error[n],r.message&&(console.warn(r),"global"===r.field?u(r.message):d(r));return!1},c=function c(e){e.preventDefault();var n=$(this).serializeArray(),r=$(this).attr("action"),o=function o(e){return e.error?(console.warn("Form has error"),m(e)):e.notice.message&&u(e.notice.message,"notice"),!1};return l.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:function(){$.post(r,n,o,"json")}}),a(),!1},f=function f(){$.mask.definitions.n="[0-9]",o.length&&o.mask("8nnnnnnnnnn"),i.length&&i.mask("2 98nnnn nnnnnn",{placeholder:"*"})};f(),r.on("userLogged",s),r.on("submit",".jsUserEditEnterprizeForm",c)})();