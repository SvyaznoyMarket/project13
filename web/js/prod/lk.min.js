(function(){var e=$(".jsUserEditEnterprizeForm"),t=$(".jsEnterprizeAuthLink"),r=$("body"),i=$(".jsMobilePhone"),n={fields:[{fieldNode:$(".jsFirstName"),require:!0,customErr:"Не указано имя"},{fieldNode:$(".jsLastName"),require:!0,customErr:"Не указана фамилия"},{fieldNode:i,require:!0,validBy:"isPhone",customErr:"Не указан номер телефона"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"}]},a=new FormValidator(n),o=function o(e,r){r&&r.name&&t.length&&$.each(t,function(){$(this).removeClass("jsEnterprizeAuthLink")})},s=function s(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},l=function l(t,r){var r=r?r:"error",i="error"===r?"red":"notice"===r?"green":null,n=$("ul."+i);if(i)return n.length?n.html("<li>"+t+"</li>"):e.prepend($('<ul class="'+i+'" />').append("<li>"+t+"</li>")),!1},c=function c(e){var t=$('[name="user['+e.field+']"]'),r=function r(){a._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),a._markFieldError(t,e.message),t.bind("focus",r),!1},u=function u(e){var t,r=null;for(console.warn("Обработка ошибок формы"),t=e.form.error.length-1;t>=0;t--)r=e.form.error[t],r.message&&(console.warn(r),"global"===r.field?l(r.message):c(r));return!1},h=function h(e){e.preventDefault();var t=$(this).serializeArray(),r=$(this).attr("action"),i=function i(e){return e.error?(console.warn("Form has error"),u(e)):e.notice.message&&l(e.notice.message,"notice"),!1};return a.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:function(){$.post(r,t,i,"json")}}),s(),!1},d=function d(){i.length&&($.mask.definitions.n="[0-9]",i.mask("8nnnnnnnnnn"))};d(),r.on("userLogged",o),r.on("submit",".jsUserEditEnterprizeForm",h)})();