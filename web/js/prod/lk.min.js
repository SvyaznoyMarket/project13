(function(){var e=$(".jsUserEditEnterprizeForm"),r=$(".jsEnterprizeAuthLink"),n=$("body"),i=$(".jsMobilePhone"),o=$(".jsCardNumber"),t={fields:[{fieldNode:$(".jsFirstName"),require:!0,customErr:"Не указано имя"},{fieldNode:$(".jsLastName"),require:!0,customErr:"Не указана фамилия"},{fieldNode:i,require:!0,validBy:"isPhone",customErr:"Не указан номер телефона"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},l=new FormValidator(t),s=function s(e,n){n&&n.name&&r.length&&$.each(r,function(){$(this).removeClass("jsEnterprizeAuthLink")})},a=function a(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},u=function u(r,n){var n=n?n:"error",i="error"===n?"red":"notice"===n?"green":null,o=$("ul."+i);if(i)return o.length?o.html("<li>"+r+"</li>"):e.prepend($('<ul class="'+i+'" />').append("<li>"+r+"</li>")),!1},d=function d(e){var r=$('[name="user['+e.field+']"]'),n=function n(){l._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),l._markFieldError(r,e.message),r.bind("focus",n),!1},c=function c(e){var r,n=null;for(console.warn("Обработка ошибок формы"),r=e.form.error.length-1;r>=0;r--)n=e.form.error[r],n.message&&(console.warn(n),"global"===n.field?u(n.message):d(n));return!1},m=function m(e){e.preventDefault();var r=$(this).serializeArray(),n=$(this).attr("action"),i=function i(e){return e.error?(console.warn("Form has error"),c(e)):e.notice.message&&u(e.notice.message,"notice"),!1};return l.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:function(){$.post(n,r,i,"json")}}),a(),!1},f=function f(){$.mask.definitions.n="[0-9]",i.length&&i.mask("8nnnnnnnnnn"),o.length&&o.mask("2 98nnnn nnnnnn",{placeholder:"*"})};f(),n.on("userLogged",s),n.on("submit",".jsUserEditEnterprizeForm",m)})();