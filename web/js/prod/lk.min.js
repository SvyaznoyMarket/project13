(function(){var e=$(".jsUserEditEnterprizeForm"),t=$(".jsEnterprizeAuthLink"),r=$("body"),i=$(".jsMobilePhone"),n=$(".jsCardNumber"),a={fields:[{fieldNode:$(".jsFirstName"),require:!0,customErr:"Не указано имя"},{fieldNode:$(".jsLastName"),require:!0,customErr:"Не указана фамилия"},{fieldNode:i,require:!0,validBy:"isPhone",customErr:"Не указан номер телефона"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},o=new FormValidator(a),s=function s(e,r){r&&r.name&&t.length&&$.each(t,function(){$(this).removeClass("jsEnterprizeAuthLink")})},l=function l(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},c=function c(t,r){var r=r?r:"error",i="error"===r?"red":"notice"===r?"green":null,n=$("ul."+i);if(i)return n.length?n.html("<li>"+t+"</li>"):e.prepend($('<ul class="'+i+'" />').append("<li>"+t+"</li>")),!1},u=function u(e){var t=$('[name="user['+e.field+']"]'),r=function r(){o._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),o._markFieldError(t,e.message),t.bind("focus",r),!1},h=function h(e){var t,r=null;for(console.warn("Обработка ошибок формы"),t=e.form.error.length-1;t>=0;t--)r=e.form.error[t],r.message&&(console.warn(r),"global"===r.field?c(r.message):u(r));return!1},d=function d(e){e.preventDefault();var t=$(this).serializeArray(),r=$(this).attr("action"),i=function i(e){return e.error?(console.warn("Form has error"),h(e)):e.notice.message&&c(e.notice.message,"notice"),!1};return o.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:function(){$.post(r,t,i,"json")}}),l(),!1},f=function f(){$.mask.definitions.n="[0-9]",i.length&&i.mask("8nnnnnnnnnn"),n.length&&n.mask("2 98nnnn nnnnnn",{placeholder:"*"})};f(),r.on("userLogged",s),r.on("submit",".jsUserEditEnterprizeForm",d)})();