!function(ENTER){var form=$(".jsEnterprizeForm"),body=$("body"),mobilePhoneField=$(".jsMobile"),authBlock=$("#enterprize-auth-block"),validationConfig={fields:[{fieldNode:$(".jsName"),require:!0,customErr:"Не указано имя"},{fieldNode:mobilePhoneField,require:!0,validBy:"isPhone",customErr:"Не указан мобильный телефон"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},validator=new FormValidator(validationConfig),signinValidationConfig={fields:[{fieldNode:$(".jsSigninUsername",authBlock),require:!0,customErr:"Не указан логин"},{fieldNode:$(".jsSigninPassword",authBlock),require:!0,customErr:"Не указан пароль"}]},signinValidator=new FormValidator(signinValidationConfig),forgotPwdValidationConfig={fields:[{fieldNode:$(".jsForgotPwdLogin",authBlock),require:!0,customErr:"Не указан email или мобильный телефон",validateOnChange:!0}]},forgotValidator=new FormValidator(forgotPwdValidationConfig),clearMsg=function(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},showMsg=function(a,b){var b=b?b:"error",c="error"===b?"red":"notice"===b?"green":null,d=$("ul."+c);if(c)return d.length?d.html("<li>"+a+"</li>"):form.prepend($('<ul class="'+c+'" />').append("<li>"+a+"</li>")),!1},formErrorHandler=function(a){var b=$('[name="user['+a.field+']"]'),c=function(){validator._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),validator._markFieldError(b,a.message),b.bind("focus",c),!1},serverErrorHandler=function(a){var b,c=null;for(console.warn("Обработка ошибок формы"),b=a.form.error.length-1;b>=0;b--)c=a.form.error[b],c.message&&(console.warn(c),"global"===c.field?showMsg(c.message):formErrorHandler(c));return!1},formSubmit=function(a){a.preventDefault();var b=$(this).serializeArray(),c=$(this).attr("action"),d=function(a){return a.error?(a.needAuth&&openAuth(),console.warn("Form has error"),serverErrorHandler(a)):void 0!==a.data.link?window.location.href=a.data.link:a.notice.message&&showMsg(a.notice.message,"notice"),!1};return $.post(c,b,d,"json"),clearMsg(),!1},openAuth=function(){ENTER.utils.signinValidationConfig=signinValidationConfig,ENTER.utils.signinValidator=signinValidator,ENTER.utils.forgotPwdValidationConfig=forgotPwdValidationConfig,ENTER.utils.forgotValidator=forgotValidator;var removeErrors=function(){var validators=["signin","forgot"],validator,config,self,i,j;for(j in validators)if(validator=eval("ENTER.utils."+validators[j]+"Validator"),config=eval("ENTER.utils."+validators[j]+"ValidationConfig"),config&&config.fields&&validator)for(i in config.fields)self=config.fields[i].fieldNode,self&&validator._unmarkFieldError(self)};return authBlock.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){authBlock.find("input:first").focus()},onClose:removeErrors}),!1};$.mask.definitions.n="[0-9]",mobilePhoneField.length&&mobilePhoneField.mask("8nnnnnnnnnn"),body.on("submit",".jsEnterprizeForm",formSubmit),body.on("click",".jsEnterprizeAuthLink",openAuth),$(".bGoodsSlider").length&&$(".bGoodsSlider").goodsSlider()}(window.ENTER);