(function(){var e=$(".jsEnterprizeForm"),r=$(".jsEnterprizeAuthLink"),n=$("body"),i=$(".jsMobile"),o={fields:[{fieldNode:$(".jsName"),require:!0,customErr:"Не указано имя"},{fieldNode:i,require:!0,validBy:"isPhone",customErr:"Не указан мобильный телефон"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},t=new FormValidator(o),l=function l(e,n){n&&n.name&&r.length&&$.each(r,function(){$(this).removeClass("jsEnterprizeAuthLink")})},s=function s(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},u=function u(r,n){var n=n?n:"error",i="error"===n?"red":"notice"===n?"green":null,o=$("ul."+i);if(i)return o.length?o.html("<li>"+r+"</li>"):e.prepend($('<ul class="'+i+'" />').append("<li>"+r+"</li>")),!1},a=function a(e){var r=$('[name="user['+e.field+']"]'),n=function n(){t._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),t._markFieldError(r,e.message),r.bind("focus",n),!1},c=function c(e){var r,n=null;for(console.warn("Обработка ошибок формы"),r=e.form.error.length-1;r>=0;r--)n=e.form.error[r],n.message&&(console.warn(n),"global"===n.field?u(n.message):a(n));return!1},d=function d(e){e.preventDefault();var r=$(this).serializeArray(),n=$(this).attr("action"),i=function i(e){if(e.error){if(e.needAuth)return $("#auth-block").lightbox_me({centered:!0,autofocus:!0,onLoad:function(){$("#auth-block").find("input:first").focus()}}),!1;console.warn("Form has error"),c(e)}else void 0!==e.data.link?window.location.href=e.data.link:e.notice.message&&u(e.notice.message,"notice");return!1};return $.post(n,r,i,"json"),s(),!1};$.mask.definitions.n="[0-9]",i.length&&i.mask("8nnnnnnnnnn"),n.on("userLogged",l),n.on("submit",".jsEnterprizeForm",d)})();