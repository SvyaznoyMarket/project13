(function(){var e=$(".jsEnterprizeForm"),r=$("body"),n=$(".jsMobile"),o={fields:[{fieldNode:$(".jsName"),require:!0,customErr:"Не указано имя"},{fieldNode:n,require:!0,validBy:"isPhone",customErr:"Не указан мобильный телефон"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},i=new FormValidator(o),t=function t(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},l=function l(r,n){var n=n?n:"error",o="error"===n?"red":"notice"===n?"green":null,i=$("ul."+o);if(o)return i.length?i.html("<li>"+r+"</li>"):e.prepend($('<ul class="'+o+'" />').append("<li>"+r+"</li>")),!1},s=function s(e){var r=$('[name="user['+e.field+']"]'),n=function n(){i._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),i._markFieldError(r,e.message),r.bind("focus",n),!1},u=function u(e){var r,n=null;for(console.warn("Обработка ошибок формы"),r=e.form.error.length-1;r>=0;r--)n=e.form.error[r],n.message&&(console.warn(n),"global"===n.field?l(n.message):s(n));return!1},a=function a(e){e.preventDefault();var r=$(this).serializeArray(),n=$(this).attr("action"),o=function o(e){if(e.error){if(e.needAuth)return $("#auth-block").lightbox_me({centered:!0,autofocus:!0,onLoad:function(){$("#auth-block").find("input:first").focus()}}),!1;console.warn("Form has error"),u(e)}else{if(e.link)return window.location.href=e.link,!1;e.notice.message&&l(e.notice.message,"notice")}return!1};return $.post(n,r,o,"json"),t(),!1};$.mask.definitions.n="[0-9]",n.length&&n.mask("8nnnnnnnnnn"),r.on("submit",".jsEnterprizeForm",a)})();