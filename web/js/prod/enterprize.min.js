(function(){var e=$(".jsEnterprizeForm"),t=$("body"),r=$(".jsMobile"),i={fields:[{fieldNode:$(".jsName"),require:!0,customErr:"Не указано имя"},{fieldNode:r,require:!0,validBy:"isPhone",customErr:"Не указан мобильный телефон"},{fieldNode:$(".jsEmail"),require:!0,validBy:"isEmail",customErr:"Не указан email"},{fieldNode:$(".jsAgree"),require:!0,customErr:"Необходимо согласие"},{fieldNode:$(".jsSubscribe"),require:!0,customErr:"Необходимо согласие"}]},n=new FormValidator(i),a=function a(){$("ul.red").length&&$("ul.red").html(""),$("ul.green").length&&$("ul.green").html("")},o=function o(t,r){var r=r?r:"error",i="error"===r?"red":"notice"===r?"green":null,n=$("ul."+i);if(i)return n.length?n.html("<li>"+t+"</li>"):e.prepend($('<ul class="'+i+'" />').append("<li>"+t+"</li>")),!1},s=function s(e){var t=$('[name="user['+e.field+']"]'),r=function r(){n._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),n._markFieldError(t,e.message),t.bind("focus",r),!1},l=function l(e){var t,r=null;for(console.warn("Обработка ошибок формы"),t=e.form.error.length-1;t>=0;t--)r=e.form.error[t],r.message&&(console.warn(r),"global"===r.field?o(r.message):s(r));return!1},c=function c(e){e.preventDefault();var t=$(this).serializeArray(),r=$(this).attr("action"),i=function i(e){if(e.error){if(e.needAuth)return $("#auth-block").lightbox_me({centered:!0,autofocus:!0,onLoad:function(){$("#auth-block").find("input:first").focus()}}),!1;console.warn("Form has error"),l(e)}else void 0!==e.data.link?window.location.href=e.data.link:e.notice.message&&o(e.notice.message,"notice");return!1};return $.post(r,t,i,"json"),a(),!1};$.mask.definitions.n="[0-9]",r.length&&r.mask("8nnnnnnnnnn"),t.on("submit",".jsEnterprizeForm",c)})();