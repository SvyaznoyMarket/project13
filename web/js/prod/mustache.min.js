(function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define(n):e.Mustache=n}})(this,function(e){function t(e,t){return b.call(e,t)}function n(e){return!t(m,e)}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return M[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e||{},this.parent=t,this._cache={}}function s(){this.clearCache()}function l(t,n,r,a){for(var i,o,s,u="",c=0,d=t.length;d>c;++c)switch(i=t[c],o=i[1],i[0]){case"#":if(s=r.lookup(o),"object"==typeof s)if(D(s))for(var f=0,p=s.length;p>f;++f)u+=l(i[4],n,r.push(s[f]),a);else s&&(u+=l(i[4],n,r.push(s),a));else if("function"==typeof s){var h=null==a?null:a.slice(i[3],i[5]);s=s.call(r.view,h,function(e){return n.render(e,r)}),null!=s&&(u+=s)}else s&&(u+=l(i[4],n,r,a));break;case"^":s=r.lookup(o),(!s||D(s)&&0===s.length)&&(u+=l(i[4],n,r,a));break;case">":s=n.getPartial(o),"function"==typeof s&&(u+=s(r));break;case"&":s=r.lookup(o),null!=s&&(u+=s);break;case"name":s=r.lookup(o),null!=s&&(u+=e.escape(s));break;case"text":u+=o}return u}function u(e){for(var t,n=[],r=n,a=[],i=0,o=e.length;o>i;++i)switch(t=e[i],t[0]){case"#":case"^":a.push(t),r.push(t),r=t[4]=[];break;case"/":var s=a.pop();s[5]=t[2],r=a.length>0?a[a.length-1][4]:n;break;default:r.push(t)}return n}function c(e){for(var t,n,r=[],a=0,i=e.length;i>a;++a)t=e[a],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function d(e){return[RegExp(r(e[0])+"\\s*"),RegExp("\\s*"+r(e[1]))]}function f(t,a){function o(){if(S&&!_)for(;x.length;)delete P[x.pop()];else x=[];S=!1,_=!1}if(t=t||"",a=a||e.tags,"string"==typeof a&&(a=a.split(h)),2!==a.length)throw Error("Invalid tags: "+a.join(", "));for(var s,l,f,m,b,w=d(a),D=new i(t),M=[],P=[],x=[],S=!1,_=!1;!D.eos();){if(s=D.pos,f=D.scanUntil(w[0]))for(var C=0,T=f.length;T>C;++C)m=f.charAt(C),n(m)?x.push(P.length):_=!0,P.push(["text",m,s,s+1]),s+=1,"\n"==m&&o();if(!D.scan(w[0]))break;if(S=!0,l=D.scan(y)||"name",D.scan(p),"="===l?(f=D.scanUntil(v),D.scan(v),D.scanUntil(w[1])):"{"===l?(f=D.scanUntil(RegExp("\\s*"+r("}"+a[1]))),D.scan(g),D.scanUntil(w[1]),l="&"):f=D.scanUntil(w[1]),!D.scan(w[1]))throw Error("Unclosed tag at "+D.pos);if(b=[l,f,s,D.pos],P.push(b),"#"===l||"^"===l)M.push(b);else if("/"===l){if(0===M.length)throw Error('Unopened section "'+f+'" at '+s);var A=M.pop();if(A[1]!==f)throw Error('Unclosed section "'+A[1]+'" at '+s)}else if("name"===l||"{"===l||"&"===l)_=!0;else if("="===l){if(a=f.split(h),2!==a.length)throw Error("Invalid tags at "+s+": "+a.join(", "));w=d(a)}}var A=M.pop();if(A)throw Error('Unclosed section "'+A[1]+'" at '+D.pos);return P=c(P),u(P)}var p=/\s*/,h=/\s+/,m=/\S/,v=/\s*=/,g=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,b=RegExp.prototype.test,w=Object.prototype.toString,D=Array.isArray||function(e){return"[object Array]"===w.call(e)},M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var r=e.split("."),a=0;t&&r.length>a;)t=t[r[a++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var a=e.parse(t,n);r=this._cache[t]=this.compileTokens(a,t)}return r},s.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},s.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},s.prototype.compileTokens=function(e,t){var n=this;return function(r,a){if(a)if("function"==typeof a)n._loadPartial=a;else for(var i in a)n.compilePartial(i,a[i]);return l(e,n,o.make(r),t)}},s.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=i,e.Context=o,e.Writer=s,e.parse=f,e.escape=a;var P=new s;e.clearCache=function(){return P.clearCache()},e.compile=function(e,t){return P.compile(e,t)},e.compilePartial=function(e,t,n){return P.compilePartial(e,t,n)},e.compileTokens=function(e,t){return P.compileTokens(e,t)},e.render=function(e,t,n){return P.render(e,t,n)},e.to_html=function(t,n,r,a){var i=e.render(t,n,r);return"function"!=typeof a?i:(a(i),void 0)}});