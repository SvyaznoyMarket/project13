(function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define(n):e.Mustache=n}})(this,function(e){function t(e,t){return y.call(e,t)}function n(e){return!t(d,e)}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return x[e]})}function s(e){this.string=e,this.tail=e,this.pos=0}function a(e,t){this.view=e||{},this.parent=t,this._cache={}}function o(){this.clearCache()}function l(t,n,r,i){for(var s,a,o,u="",c=0,h=t.length;h>c;++c)switch(s=t[c],a=s[1],s[0]){case"#":if(o=r.lookup(a),"object"==typeof o)if(S(o))for(var f=0,p=o.length;p>f;++f)u+=l(s[4],n,r.push(o[f]),i);else o&&(u+=l(s[4],n,r.push(o),i));else if("function"==typeof o){var m=null==i?null:i.slice(s[3],s[5]);o=o.call(r.view,m,function(e){return n.render(e,r)}),null!=o&&(u+=o)}else o&&(u+=l(s[4],n,r,i));break;case"^":o=r.lookup(a),(!o||S(o)&&0===o.length)&&(u+=l(s[4],n,r,i));break;case">":o=n.getPartial(a),"function"==typeof o&&(u+=o(r));break;case"&":o=r.lookup(a),null!=o&&(u+=o);break;case"name":o=r.lookup(a),null!=o&&(u+=e.escape(o));break;case"text":u+=a}return u}function u(e){for(var t,n=[],r=n,i=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var o=i.pop();o[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function c(e){for(var t,n,r=[],i=0,s=e.length;s>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function h(e){return[RegExp(r(e[0])+"\\s*"),RegExp("\\s*"+r(e[1]))]}function f(t,i){function a(){if(R&&!A)for(;C.length;)delete _[C.pop()];else C=[];R=!1,A=!1}if(t=t||"",i=i||e.tags,"string"==typeof i&&(i=i.split(m)),2!==i.length)throw Error("Invalid tags: "+i.join(", "));for(var o,l,f,d,y,w=h(i),S=new s(t),x=[],_=[],C=[],R=!1,A=!1;!S.eos();){if(o=S.pos,f=S.scanUntil(w[0]))for(var E=0,q=f.length;q>E;++E)d=f.charAt(E),n(d)?C.push(_.length):A=!0,_.push(["text",d,o,o+1]),o+=1,"\n"==d&&a();if(!S.scan(w[0]))break;if(R=!0,l=S.scan(b)||"name",S.scan(p),"="===l?(f=S.scanUntil(g),S.scan(g),S.scanUntil(w[1])):"{"===l?(f=S.scanUntil(RegExp("\\s*"+r("}"+i[1]))),S.scan(v),S.scanUntil(w[1]),l="&"):f=S.scanUntil(w[1]),!S.scan(w[1]))throw Error("Unclosed tag at "+S.pos);if(y=[l,f,o,S.pos],_.push(y),"#"===l||"^"===l)x.push(y);else if("/"===l){if(0===x.length)throw Error('Unopened section "'+f+'" at '+o);var k=x.pop();if(k[1]!==f)throw Error('Unclosed section "'+k[1]+'" at '+o)}else if("name"===l||"{"===l||"&"===l)A=!0;else if("="===l){if(i=f.split(m),2!==i.length)throw Error("Invalid tags at "+o+": "+i.join(", "));w=h(i)}}var k=x.pop();if(k)throw Error('Unclosed section "'+k[1]+'" at '+S.pos);return _=c(_),u(_)}var p=/\s*/,m=/\s+/,d=/\S/,g=/\s*=/,v=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/,y=RegExp.prototype.test,w=Object.prototype.toString,S=Array.isArray||function(e){return"[object Array]"===w.call(e)},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};s.prototype.eos=function(){return""===this.tail},s.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},s.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},a.make=function(e){return e instanceof a?e:new a(e)},a.prototype.push=function(e){return new a(e,this)},a.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var r=e.split("."),i=0;t&&r.length>i;)t=t[r[i++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},o.prototype.clearCache=function(){this._cache={},this._partialCache={}},o.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},o.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},o.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},o.prototype.compileTokens=function(e,t){var n=this;return function(r,i){if(i)if("function"==typeof i)n._loadPartial=i;else for(var s in i)n.compilePartial(s,i[s]);return l(e,n,a.make(r),t)}},o.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=s,e.Context=a,e.Writer=o,e.parse=f,e.escape=i;var _=new o;e.clearCache=function(){return _.clearCache()},e.compile=function(e,t){return _.compile(e,t)},e.compilePartial=function(e,t,n){return _.compilePartial(e,t,n)},e.compileTokens=function(e,t){return _.compileTokens(e,t)},e.render=function(e,t,n){return _.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);return"function"!=typeof i?s:(i(s),void 0)}});