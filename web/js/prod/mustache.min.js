(function(e,t){if("object"==typeof exports&&exports)t(exports);else{var r={};t(r),"function"==typeof define&&define.amd?define(r):e.Mustache=r}})(this,function(e){function t(e,t){return b.call(e,t)}function r(e){return!t(m,e)}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return D[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e||{},this.parent=t,this._cache={}}function s(){this.clearCache()}function l(t,r,n,a){for(var i,o,s,u="",c=0,d=t.length;d>c;++c)switch(i=t[c],o=i[1],i[0]){case"#":if(s=n.lookup(o),"object"==typeof s)if(S(s))for(var p=0,h=s.length;h>p;++p)u+=l(i[4],r,n.push(s[p]),a);else s&&(u+=l(i[4],r,n.push(s),a));else if("function"==typeof s){var f=null==a?null:a.slice(i[3],i[5]);s=s.call(n.view,f,function(e){return r.render(e,n)}),null!=s&&(u+=s)}else s&&(u+=l(i[4],r,n,a));break;case"^":s=n.lookup(o),(!s||S(s)&&0===s.length)&&(u+=l(i[4],r,n,a));break;case">":s=r.getPartial(o),"function"==typeof s&&(u+=s(n));break;case"&":s=n.lookup(o),null!=s&&(u+=s);break;case"name":s=n.lookup(o),null!=s&&(u+=e.escape(s));break;case"text":u+=o}return u}function u(e){for(var t,r=[],n=r,a=[],i=0,o=e.length;o>i;++i)switch(t=e[i],t[0]){case"#":case"^":a.push(t),n.push(t),n=t[4]=[];break;case"/":var s=a.pop();s[5]=t[2],n=a.length>0?a[a.length-1][4]:r;break;default:n.push(t)}return r}function c(e){for(var t,r,n=[],a=0,i=e.length;i>a;++a)t=e[a],t&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(r=t,n.push(t)));return n}function d(e){return[RegExp(n(e[0])+"\\s*"),RegExp("\\s*"+n(e[1]))]}function p(t,a){function o(){if(P&&!C)for(;x.length;)delete M[x.pop()];else x=[];P=!1,C=!1}if(t=t||"",a=a||e.tags,"string"==typeof a&&(a=a.split(f)),2!==a.length)throw Error("Invalid tags: "+a.join(", "));for(var s,l,p,m,b,w=d(a),S=new i(t),D=[],M=[],x=[],P=!1,C=!1;!S.eos();){if(s=S.pos,p=S.scanUntil(w[0]))for(var T=0,I=p.length;I>T;++T)m=p.charAt(T),r(m)?x.push(M.length):C=!0,M.push(["text",m,s,s+1]),s+=1,"\n"==m&&o();if(!S.scan(w[0]))break;if(P=!0,l=S.scan(y)||"name",S.scan(h),"="===l?(p=S.scanUntil(g),S.scan(g),S.scanUntil(w[1])):"{"===l?(p=S.scanUntil(RegExp("\\s*"+n("}"+a[1]))),S.scan(v),S.scanUntil(w[1]),l="&"):p=S.scanUntil(w[1]),!S.scan(w[1]))throw Error("Unclosed tag at "+S.pos);if(b=[l,p,s,S.pos],M.push(b),"#"===l||"^"===l)D.push(b);else if("/"===l){if(0===D.length)throw Error('Unopened section "'+p+'" at '+s);var _=D.pop();if(_[1]!==p)throw Error('Unclosed section "'+_[1]+'" at '+s)}else if("name"===l||"{"===l||"&"===l)C=!0;else if("="===l){if(a=p.split(f),2!==a.length)throw Error("Invalid tags at "+s+": "+a.join(", "));w=d(a)}}var _=D.pop();if(_)throw Error('Unclosed section "'+_[1]+'" at '+S.pos);return M=c(M),u(M)}var h=/\s*/,f=/\s+/,m=/\S/,g=/\s*=/,v=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,b=RegExp.prototype.test,w=Object.prototype.toString,S=Array.isArray||function(e){return"[object Array]"===w.call(e)},D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r),this.pos+=r}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var r=this;r;){if(e.indexOf(".")>0){t=r.view;for(var n=e.split("."),a=0;t&&n.length>a;)t=t[n[a++]]}else t=r.view[e];if(null!=t)break;r=r.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(t,r){var n=this._cache[t];if(!n){var a=e.parse(t,r);n=this._cache[t]=this.compileTokens(a,t)}return n},s.prototype.compilePartial=function(e,t,r){var n=this.compile(t,r);return this._partialCache[e]=n,n},s.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},s.prototype.compileTokens=function(e,t){var r=this;return function(n,a){if(a)if("function"==typeof a)r._loadPartial=a;else for(var i in a)r.compilePartial(i,a[i]);return l(e,r,o.make(n),t)}},s.prototype.render=function(e,t,r){return this.compile(e)(t,r)},e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=i,e.Context=o,e.Writer=s,e.parse=p,e.escape=a;var M=new s;e.clearCache=function(){return M.clearCache()},e.compile=function(e,t){return M.compile(e,t)},e.compilePartial=function(e,t,r){return M.compilePartial(e,t,r)},e.compileTokens=function(e,t){return M.compileTokens(e,t)},e.render=function(e,t,r){return M.render(e,t,r)},e.to_html=function(t,r,n,a){var i=e.render(t,r,n);return"function"!=typeof a?i:(a(i),void 0)}});