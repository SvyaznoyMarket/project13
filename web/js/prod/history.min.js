!function(a,b){var c=a.History=a.History||{},d=a.jQuery;if("undefined"!=typeof c.Adapter)throw new Error("History.js Adapter has already been loaded...");c.Adapter={bind:function(a,b,c){d(a).bind(b,c)},trigger:function(a,b){d(a).trigger(b)},onDomLoad:function(a){d(a)}},"undefined"!=typeof c.init&&c.init()}(window),function(a,b){"use strict";var c=a.console||b,d=a.document,e=a.navigator,f=a.amplify||!1,g=a.setTimeout,h=a.clearTimeout,i=a.setInterval,j=a.clearInterval,k=a.JSON,l=a.History=a.History||{},m=a.history;if(k.stringify=k.stringify||k.encode,k.parse=k.parse||k.decode,"undefined"!=typeof l.init)throw new Error("History.js Core has already been loaded...");l.init=function(){return"undefined"==typeof l.Adapter?!1:("undefined"!=typeof l.initCore&&l.initCore(),"undefined"!=typeof l.initHtml4&&l.initHtml4(),!0)},l.initCore=function(){if("undefined"!=typeof l.initCore.initialized)return!1;if(l.initCore.initialized=!0,l.options=l.options||{},l.options.hashChangeInterval=l.options.hashChangeInterval||100,l.options.safariPollInterval=l.options.safariPollInterval||500,l.options.doubleCheckInterval=l.options.doubleCheckInterval||500,l.options.storeInterval=l.options.storeInterval||1e3,l.options.busyDelay=l.options.busyDelay||250,l.options.debug=l.options.debug||!1,l.options.initialTitle=l.options.initialTitle||d.title,l.intervalList=[],l.clearAllIntervals=function(){var a,b=l.intervalList;if("undefined"!=typeof b&&null!==b){for(a=0;a<b.length;a++)j(b[a]);l.intervalList=null}},l.Adapter.bind(a,"beforeunload",l.clearAllIntervals),l.Adapter.bind(a,"unload",l.clearAllIntervals),l.debug=function(){l.options.debug&&l.log.apply(l,arguments)},l.log=function(){var a,b,e,f=!("undefined"==typeof c||"undefined"==typeof c.log||"undefined"==typeof c.log.apply),g=d.getElementById("log");if(f){var h=Array.prototype.slice.call(arguments);a=h.shift(),"undefined"!=typeof c.debug?c.debug.apply(c,[a,h]):c.log.apply(c,[a,h])}else a="\n"+arguments[0]+"\n";for(b=1,e=arguments.length;e>b;++b){var i=arguments[b];if("object"==typeof i&&"undefined"!=typeof k)try{i=k.stringify(i)}catch(j){}a+="\n"+i+"\n"}return g?(g.value+=a+"\n-----\n",g.scrollTop=g.scrollHeight-g.clientHeight):f||alert(a),!0},l.getInternetExplorerMajorVersion=function(){var a=l.getInternetExplorerMajorVersion.cached="undefined"!=typeof l.getInternetExplorerMajorVersion.cached?l.getInternetExplorerMajorVersion.cached:function(){for(var a=3,b=d.createElement("div"),c=b.getElementsByTagName("i");(b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0];);return a>4?a:!1}();return a},l.isInternetExplorer=function(){var a=l.isInternetExplorer.cached="undefined"!=typeof l.isInternetExplorer.cached?l.isInternetExplorer.cached:Boolean(l.getInternetExplorerMajorVersion());return a},l.emulated={pushState:!Boolean(a.history&&a.history.pushState&&a.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(e.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(e.userAgent))),hashChange:Boolean(!("onhashchange"in a||"onhashchange"in d)||l.isInternetExplorer()&&l.getInternetExplorerMajorVersion()<8)},l.enabled=!l.emulated.pushState,l.bugs={setHash:Boolean(!l.emulated.pushState&&"Apple Computer, Inc."===e.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),safariPoll:Boolean(!l.emulated.pushState&&"Apple Computer, Inc."===e.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),ieDoubleCheck:Boolean(l.isInternetExplorer()&&l.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(l.isInternetExplorer()&&l.getInternetExplorerMajorVersion()<7)},l.isEmptyObject=function(a){for(var b in a)return!1;return!0},l.cloneObject=function(a){var b,c;return a?(b=k.stringify(a),c=k.parse(b)):c={},c},l.getRootUrl=function(){var a=d.location.protocol+"//"+(d.location.hostname||d.location.host);return d.location.port&&(a+=":"+d.location.port),a+="/"},l.getBaseHref=function(){var a=d.getElementsByTagName("base"),b=null,c="";return 1===a.length&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c},l.getBaseUrl=function(){var a=l.getBaseHref()||l.getBasePageUrl()||l.getRootUrl();return a},l.getPageUrl=function(){var a=l.getState(!1,!1),b=(a||{}).url||d.location.href,c=b.replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\./.test(a)?a:a+"/"});return c},l.getBasePageUrl=function(){var a=d.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/";return a},l.getFullUrl=function(a,b){var c=a,d=a.substring(0,1);return b="undefined"==typeof b?!0:b,/[a-z]+\:\/\//.test(a)||(c="/"===d?l.getRootUrl()+a.replace(/^\/+/,""):"#"===d?l.getPageUrl().replace(/#.*/,"")+a:"?"===d?l.getPageUrl().replace(/[\?#].*/,"")+a:b?l.getBaseUrl()+a.replace(/^(\.\/)+/,""):l.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),c.replace(/\#$/,"")},l.getShortUrl=function(a){var b=a,c=l.getBaseUrl(),d=l.getRootUrl();return l.emulated.pushState&&(b=b.replace(c,"")),b=b.replace(d,"/"),l.isTraditionalAnchor(b)&&(b="./"+b),b=b.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},l.store=f?f.store("History.store")||{}:{},l.store.idToState=l.store.idToState||{},l.store.urlToId=l.store.urlToId||{},l.store.stateToId=l.store.stateToId||{},l.idToState=l.idToState||{},l.stateToId=l.stateToId||{},l.urlToId=l.urlToId||{},l.storedStates=l.storedStates||[],l.savedStates=l.savedStates||[],l.getState=function(a,b){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!0);var c=l.getLastSavedState();return!c&&b&&(c=l.createStateObject()),a&&(c=l.cloneObject(c),c.url=c.cleanUrl||c.url),c},l.getIdByState=function(a){var b=l.extractId(a.url);if(!b){var c=l.getStateString(a);if("undefined"!=typeof l.stateToId[c])b=l.stateToId[c];else if("undefined"!=typeof l.store.stateToId[c])b=l.store.stateToId[c];else{for(;;)if(b=String(Math.floor(1e3*Math.random())),"undefined"==typeof l.idToState[b]&&"undefined"==typeof l.store.idToState[b])break;l.stateToId[c]=b,l.idToState[b]=a}}return b},l.normalizeState=function(a){if(a&&"object"==typeof a||(a={}),"undefined"!=typeof a.normalized)return a;a.data&&"object"==typeof a.data||(a.data={});var b={};b.normalized=!0,b.title=a.title||"",b.url=l.getFullUrl(l.unescapeString(a.url||d.location.href)),b.hash=l.getShortUrl(b.url),b.data=l.cloneObject(a.data),b.id=l.getIdByState(b),b.cleanUrl=b.url.replace(/\??\&_suid.*/,""),b.url=b.cleanUrl;var c=!l.isEmptyObject(b.data);return(b.title||c)&&(b.hash=l.getShortUrl(b.url).replace(/\??\&_suid.*/,""),/\?/.test(b.hash)||(b.hash+="?"),b.hash+="&_suid="+b.id),b.hashedUrl=l.getFullUrl(b.hash),(l.emulated.pushState||l.bugs.safariPoll)&&l.hasUrlDuplicate(b)&&(b.url=b.hashedUrl),b},l.createStateObject=function(a,b,c){var d={data:a,title:b,url:c};return d=l.normalizeState(d)},l.getStateById=function(a){a=String(a);var c=l.idToState[a]||l.store.idToState[a]||b;return c},l.getStateString=function(a){var b=l.normalizeState(a),c={data:b.data,title:a.title,url:a.url},d=k.stringify(c);return d},l.getStateId=function(a){var b=l.normalizeState(a),c=b.id;return c},l.getHashByState=function(a){var b,c=l.normalizeState(a);return b=c.hash},l.extractId=function(a){var b,c,d;return c=/(.*)\&_suid=([0-9]+)$/.exec(a),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1},l.isTraditionalAnchor=function(a){var b=!/[\/\?\.]/.test(a);return b},l.extractState=function(a,b){var c=null;b=b||!1;var d=l.extractId(a);if(d&&(c=l.getStateById(d)),!c){var e=l.getFullUrl(a);d=l.getIdByUrl(e)||!1,d&&(c=l.getStateById(d)),c||!b||l.isTraditionalAnchor(a)||(c=l.createStateObject(null,null,e))}return c},l.getIdByUrl=function(a){var c=l.urlToId[a]||l.store.urlToId[a]||b;return c},l.getLastSavedState=function(){return l.savedStates[l.savedStates.length-1]||b},l.getLastStoredState=function(){return l.storedStates[l.storedStates.length-1]||b},l.hasUrlDuplicate=function(a){var b=!1,c=l.extractState(a.url);return b=c&&c.id!==a.id},l.storeState=function(a){return l.urlToId[a.url]=a.id,l.storedStates.push(l.cloneObject(a)),a},l.isLastSavedState=function(a){var b=!1;if(l.savedStates.length){var c=a.id,d=l.getLastSavedState(),e=d.id;b=c===e}return b},l.saveState=function(a){return l.isLastSavedState(a)?!1:(l.savedStates.push(l.cloneObject(a)),!0)},l.getStateByIndex=function(a){var b=null;return b="undefined"==typeof a?l.savedStates[l.savedStates.length-1]:0>a?l.savedStates[l.savedStates.length+a]:l.savedStates[a]},l.getHash=function(){var a=l.unescapeHash(d.location.hash);return a},l.unescapeString=function(b){for(var c,d=b;;){if(c=a.unescape(encodeURIComponent(d)),c===d)break;d=c}return d},l.unescapeHash=function(a){var b=l.normalizeHash(a);return b=l.unescapeString(b)},l.normalizeHash=function(a){var b=a.replace(/[^#]*#/,"").replace(/#.*/,"");return b},l.setHash=function(a,b){if(b!==!1&&l.busy())return l.pushQueue({scope:l,callback:l.setHash,args:arguments,queue:b}),!1;var c=l.escapeHash(a);l.busy(!0);var e=l.extractState(a,!0);if(e&&!l.emulated.pushState)l.pushState(e.data,e.title,e.url,!1);else if(d.location.hash!==c)if(l.bugs.setHash){var f=l.getPageUrl();l.pushState(null,null,f+"#"+c,!1)}else d.location.hash=c;return l},l.escapeHash=function(b){var c=l.normalizeHash(b);return c=a.escape(c),l.bugs.hashEscape||(c=c.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),c},l.getHashByUrl=function(a){var b=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return b=l.unescapeHash(b)},l.setTitle=function(a){var b=a.title;if(!b){var c=l.getStateByIndex(0);c&&c.url===a.url&&(b=c.title||l.options.initialTitle)}try{d.getElementsByTagName("title")[0].innerHTML=b.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return d.title=b,l},l.queues=[],l.busy=function(a){if("undefined"!=typeof a?l.busy.flag=a:"undefined"==typeof l.busy.flag&&(l.busy.flag=!1),!l.busy.flag){h(l.busy.timeout);var b=function(){if(!l.busy.flag)for(var a=l.queues.length-1;a>=0;--a){var c=l.queues[a];if(0!==c.length){var d=c.shift();l.fireQueueItem(d),l.busy.timeout=g(b,l.options.busyDelay)}}};l.busy.timeout=g(b,l.options.busyDelay)}return l.busy.flag},l.fireQueueItem=function(a){return a.callback.apply(a.scope||l,a.args||[])},l.pushQueue=function(a){return l.queues[a.queue||0]=l.queues[a.queue||0]||[],l.queues[a.queue||0].push(a),l},l.queue=function(a,b){return"function"==typeof a&&(a={callback:a}),"undefined"!=typeof b&&(a.queue=b),l.busy()?l.pushQueue(a):l.fireQueueItem(a),l},l.clearQueue=function(){return l.busy.flag=!1,l.queues=[],l},l.stateChanged=!1,l.doubleChecker=!1,l.doubleCheckComplete=function(){return l.stateChanged=!0,l.doubleCheckClear(),l},l.doubleCheckClear=function(){return l.doubleChecker&&(h(l.doubleChecker),l.doubleChecker=!1),l},l.doubleCheck=function(a){return l.stateChanged=!1,l.doubleCheckClear(),l.bugs.ieDoubleCheck&&(l.doubleChecker=g(function(){return l.doubleCheckClear(),l.stateChanged||a(),!0},l.options.doubleCheckInterval)),l},l.safariStatePoll=function(){var b,c=l.extractState(d.location.href);if(!l.isLastSavedState(c))return b=c,b||(b=l.createStateObject()),l.Adapter.trigger(a,"popstate"),l},l.back=function(a){return a!==!1&&l.busy()?(l.pushQueue({scope:l,callback:l.back,args:arguments,queue:a}),!1):(l.busy(!0),l.doubleCheck(function(){l.back(!1)}),m.go(-1),!0)},l.forward=function(a){return a!==!1&&l.busy()?(l.pushQueue({scope:l,callback:l.forward,args:arguments,queue:a}),!1):(l.busy(!0),l.doubleCheck(function(){l.forward(!1)}),m.go(1),!0)},l.go=function(a,b){var c;if(a>0)for(c=1;a>=c;++c)l.forward(b);else{if(!(0>a))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(c=-1;c>=a;--c)l.back(b)}return l},l.saveState(l.storeState(l.extractState(d.location.href,!0))),f&&(l.onUnload=function(){var a,b=f.store("History.store")||{};b.idToState=b.idToState||{},b.urlToId=b.urlToId||{},b.stateToId=b.stateToId||{};for(a in l.idToState)l.idToState.hasOwnProperty(a)&&(b.idToState[a]=l.idToState[a]);for(a in l.urlToId)l.urlToId.hasOwnProperty(a)&&(b.urlToId[a]=l.urlToId[a]);for(a in l.stateToId)l.stateToId.hasOwnProperty(a)&&(b.stateToId[a]=l.stateToId[a]);l.store=b,f.store("History.store",b)},l.intervalList.push(i(l.onUnload,l.options.storeInterval)),l.Adapter.bind(a,"beforeunload",l.onUnload),l.Adapter.bind(a,"unload",l.onUnload)),l.emulated.pushState){var n=function(){};l.pushState=l.pushState||n,l.replaceState=l.replaceState||n}else l.onPopState=function(b){l.doubleCheckComplete();var c=l.getHash();if(c){var e=l.extractState(c||d.location.href,!0);return e?l.replaceState(e.data,e.title,e.url,!1):(l.Adapter.trigger(a,"anchorchange"),l.busy(!1)),l.expectedStateId=!1,!1}var f=!1;return b=b||{},"undefined"==typeof b.state&&("undefined"!=typeof b.originalEvent&&"undefined"!=typeof b.originalEvent.state?b.state=b.originalEvent.state||!1:"undefined"!=typeof b.event&&"undefined"!=typeof b.event.state&&(b.state=b.event.state||!1)),b.state=b.state||!1,f=b.state?l.getStateById(b.state):l.expectedStateId?l.getStateById(l.expectedStateId):l.extractState(d.location.href),f||(f=l.createStateObject(null,null,d.location.href)),l.expectedStateId=!1,l.isLastSavedState(f)?(l.busy(!1),!1):(l.storeState(f),l.saveState(f),l.setTitle(f),l.Adapter.trigger(a,"statechange"),l.busy(!1),!0)},l.Adapter.bind(a,"popstate",l.onPopState),l.pushState=function(b,c,d,e){if(l.getHashByUrl(d)&&l.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&l.busy())return l.pushQueue({scope:l,callback:l.pushState,args:arguments,queue:e}),!1;l.busy(!0);var f=l.createStateObject(b,c,d);return l.isLastSavedState(f)?l.busy(!1):(l.storeState(f),l.expectedStateId=f.id,m.pushState(f.id,f.title,f.url),l.Adapter.trigger(a,"popstate")),!0},l.replaceState=function(b,c,d,e){if(l.getHashByUrl(d)&&l.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&l.busy())return l.pushQueue({scope:l,callback:l.replaceState,args:arguments,queue:e}),!1;l.busy(!0);var f=l.createStateObject(b,c,d);return l.isLastSavedState(f)?l.busy(!1):(l.storeState(f),l.expectedStateId=f.id,m.replaceState(f.id,f.title,f.url),l.Adapter.trigger(a,"popstate")),!0},l.bugs.safariPoll&&l.intervalList.push(i(l.safariStatePoll,l.options.safariPollInterval)),("Apple Computer, Inc."===e.vendor||"Mozilla"===(e.appCodeName||""))&&(l.Adapter.bind(a,"hashchange",function(){l.Adapter.trigger(a,"popstate")}),l.getHash()&&l.Adapter.onDomLoad(function(){l.Adapter.trigger(a,"hashchange")}))},l.init()}(window);