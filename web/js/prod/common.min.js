(function(e,o,t,r){t.ajaxSetup({timeout:1e4,statusCode:{404:function(){var e=this.url,o={event:"ajax_error",type:"404 ошибка",ajaxUrl:e};r.utils.logError(o),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","404 ошибка, страница не найдена"])},401:function(){t("#auth-block").length?t("#auth-block").lightbox_me({centered:!0,onLoad:function(){t("#auth-block").find("input:first").focus()}}):"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","401 ошибка, авторизуйтесь заново"])},500:function(){var e=this.url,o={event:"ajax_error",type:"500 ошибка",ajaxUrl:e};r.utils.logError(o),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","500 сервер перегружен"])},503:function(){var e=this.url,o={event:"ajax_error",type:"503 ошибка",ajaxUrl:e};r.utils.logError(o),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","503 ошибка, сервер перегружен"])},504:function(){var e=this.url,o={event:"ajax_error",type:"504 ошибка",ajaxUrl:e};r.utils.logError(o),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","504 ошибка, проверьте соединение с интернетом"])}},error:function(e,o){var t=this.url,i={event:"ajax_error",type:"неизвестная ajax ошибка",ajaxUrl:t};if("error"===e.statusText)r.utils.logError(i),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","неизвестная ajax ошибка"]);else if("timeout"===o)return}})})(this,this.document,this.jQuery,this.ENTER),function(){var e=!1,o=!1,t=function(){e?($("#mobilePhoneWrapper").hide(),$("#mobilePhoneWrapper").parent().find(".red").html(""),e=!1):($("#mobilePhoneWrapper").show(),e=!0)},r=function(){o?($("#emailWrapper").hide(),$("#emailWrapper").parent().find(".red").html(""),o=!1):($("#emailWrapper").show(),o=!0)};$(document).ready(function(){e=$(".smsCheckbox").hasClass("checked"),$("#user_mobile_phone").val()||$(".smsCheckbox").bind("click",t),o=$(".emailCheckbox").hasClass("checked"),$("#user_email").val()||$(".emailCheckbox").bind("click",r)})}(),function(e){var o=$("body"),t=e.config.clientCart,r=function r(){var e=$(this),t=e.attr("href"),r=function r(t){var r=e.data("group"),i=e.data("upsale")?e.data("upsale"):null,a=e.parents(".jsSliderItem").data("product");return t.success?(e.removeClass("mLoading"),t.product&&(t.product.isUpsale=a&&a.isUpsale?!0:!1,t.product.fromUpsale=i&&i.fromUpsale?!0:!1),$('.jsBuyButton[data-group="'+r+'"]').html("В корзине").addClass("mBought").attr("href","/cart"),o.trigger("addtocart",[t]),o.trigger("getupsale",[t,i]),o.trigger("updatespinner",[r]),void 0):!1};return $.get(t,r),!1},i=function i(){var e=$(this),o=e.attr("href");return e.hasClass("mDisabled")?!1:e.hasClass("mBought")?(document.location.href(o),!1):(e.addClass("mLoading"),e.trigger("buy"),!1)},a=function a(){var e,o,r=t.products;for(console.info("markCartButton"),e=0,o=r.length;o>e;e++)$("."+r[e].cartButton.id).html("В корзине").addClass("mBought").attr("href","/cart")};$(document).ready(function(){o.bind("markcartbutton",a),o.on("click",".jsBuyButton",i),o.on("buy",".jsBuyButton",r)})}(window.ENTER),function(e){var o=e.utils,t=o.blackBox,r=$("body"),i=function i(e,o){var t=o.product,r=o.service,i=o.warranty,a=window.location.href,n={};"undefined"!=typeof _kmq&&(t&&(n={"Add to Cart SKU":t.article,"Add to Cart SKU Quantity":t.quantity,"Add to Cart Product Name":t.name,"Add to Cart Root category":t.category[0].name,"Add to Cart Root ID":t.category[0].id,"Add to Cart Category name":t.category?t.category[t.category.length-1].name:0,"Add to Cart Category ID":t.category?t.category[t.category.length-1].id:0,"Add to Cart SKU Price":t.price,"Add to Cart Page URL":a,"Add to Cart F1 Quantity":t.serviceQuantity},_kmq.push(["record","Add to Cart",n]),t.isUpsale&&_kmq.push(["record","cart rec added from rec",{"SKU cart added from rec":t.article}]),t.fromUpsale&&_kmq.push(["record","cart recommendation added",{"SKU cart rec added":t.article}])),r&&(n={"Add F1 F1 Name":r.name,"Add F1 F1 Price":r.price,"Add F1 SKU":t.article,"Add F1 Product Name":t.name,"Add F1 Root category":t.category[0].name,"Add F1 Root ID":t.category[0].id,"Add F1 Category name":t.category?t.category[t.category.length-1].name:0,"Add F1 Category ID":t.category?t.category[t.category.length-1].id:0},_kmq.push(["record","Add F1",n])),i&&(n={"Add Warranty Warranty Name":i.name,"Add Warranty Warranty Price":i.price,"Add Warranty SKU":t.article,"Add Warranty Product Name":t.name,"Add Warranty Root category":t.category[0].name,"Add Warranty Root ID":t.category[0].id,"Add Warranty Category name":t.category?t.category[t.category.length-1].name:0,"Add Warranty Category ID":t.category?t.category[t.category.length-1].id:0},_kmq.push(["record","Add Warranty",n])))},a=function a(e,o){var t=o.product;t&&"undefined"!=typeof _gaq&&(_gaq.push(["_trackEvent","Add2Basket","product",t.article]),t.isUpsale&&_gaq.push(["_trackEvent","cart_recommendation","cart_rec_added_from_rec",t.article]),t.fromUpsale&&_gaq.push(["_trackEvent","cart_recommendation","cart_rec_added_to_cart",t.article]))},n=function n(e,o){var t=o.product,r=t.id,i=t.category?t.category[t.category.length-1].id:0,a="http://ad.adriver.ru/cgi-bin/rle.cgi?sid=182615&sz=add_basket&custom=10="+r+";11="+i+"&bt=55&pz=0&rnd=![rnd]",n=document,s=n.createElement("IMG"),d=n.body;a=a.replace(/!\[rnd\]/,Math.round(9999999*Math.random()))+"&tail256="+escape(n.referrer||"unknown"),s.style.position="absolute",s.style.width=s.style.height="0px",s.onload=s.onerror=function(){d.removeChild(s),s=d=null},s.src=a,d.insertBefore(s,d.firstChild)},s=function s(e,t){var r,i=t.product;if("object"==typeof rcApi)try{rcApi.addToBasket(i.id)}catch(a){r={event:"rcApi.addToBasket",type:"ошибка отправки данных в RetailRocket",err:a},o.logError(r)}},d=function d(e,o){o.redirect?(console.warn("redirect"),document.location.href=o.redirect):t&&t.basket().add(o)};r.on("addtocart",d),r.on("addtocart",i),r.on("addtocart",a),r.on("addtocart",n),r.on("addtocart",s)}(window.ENTER),function(e){var o=$("body"),t=$(".popupRegion"),r=$("#jscity"),i=$("#jschangecity"),a=t.find(".inputClear"),n=$(".jsChangeRegion"),s=$(".jsChangeRegionAnalytics"),d=t.find(".regionSlidesWrap"),l=t.find(".moreCity"),c=t.find(".leftArr"),u=t.find(".rightArr"),h=t.find(".regionSlides"),m=t.find(".regionSlides_slide");r.autocomplete({autoFocus:!0,appendTo:"#jscities",source:function(e,o){$.ajax({url:r.data("url-autocomplete"),dataType:"json",data:{q:e.term},success:function(e){var t=e.data.slice(0,15);o($.map(t,function(e){return{label:e.name,value:e.name,url:e.url}}))}})},minLength:2,select:function(e,o){i.data("url",o.item.url),i.removeClass("mDisabled")},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});var g=function g(){t.lightbox_me({autofocus:!0,onLoad:function(){r.val().length&&(r.putCursorAtEnd(),i.removeClass("mDisabled"))},onClose:function(){var o=n.data("region-id");e.docCookies.hasItem("geoshop")||e.docCookies.setItem("geoshop",o,31536e3,"/")}}),"/"===document.location.pathname&&(console.info("run analytics for main page"),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","citySelector","viewed"]))},f=function f(){var e=$(this),o=e.data("autoresolve-url"),t=function t(e){if(!e.data.length)return $(".popupRegion .mAutoresolve").html(""),!1;var o=e.data[0].url,t=e.data[0].name,r=e.data[0].id;return 14974===r||108136===r?!1:($(".popupRegion .mAutoresolve").length?$(".popupRegion .mAutoresolve").html('<a href="'+o+'">'+t+"</a>"):$(".popupRegion .cityInline").prepend('<div class="cityItem mAutoresolve"><a href="'+o+'">'+t+"</a></div>"),void 0)};return"undefined"!==o&&$.ajax({type:"GET",url:o,success:t}),g(),!1},p=function p(){var e=1*m.width(),o=1*h.width(),t=parseInt(h.css("left"),10);return c.show(),h.animate({left:t-e}),-o>=t-2*e&&u.hide(),!1},v=function v(){var e=1*m.width(),o=(1*h.width(),parseInt(h.css("left"),10));return u.show(),h.animate({left:o+e}),o+2*e>=0&&c.hide(),!1},y=function y(){return $(this).toggleClass("mExpand"),d.slideToggle(300),!1},_=function _(){return r.val(""),a.hide(),!1},b=function b(){$(this).val()?a.show():a.hide()},k=function k(e){"/"===document.location.pathname&&(console.info("run analytics for main page "+e),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","citySelector","selected",e]))},C=function C(){var e=$(this).text();k(e)},w=function w(){var o=$(this).data("url"),i=r.val();return k(i),o?e.location=o:t.trigger("close"),!1};i.on("click",w),l.on("click",y),a.on("click",_),u.on("click",p),c.on("click",v),r.on("keyup",b),o.on("click",".jsChangeRegion",f),s.on("click",C),e.docCookies.hasItem("geoshop")||g()}(this),function(){var e=$("input.bCustomInput"),o=$("body"),t=function t(){if($(this).is("[type=checkbox]")||$(this).is("[type=radio]")){var e=$(this),o=e.attr("id"),t=e.is("[type=checkbox]")?"checkbox":"radio",r=e.attr("name")||"",i=$('label[for="'+o+'"]');"checkbox"===t&&(e.is(":checked")?i.addClass("mChecked"):i.removeClass("mChecked")),"radio"===t&&e.is(":checked")&&($('input[name="'+r+'"]').each(function(){var e=$(this),o=e.attr("id");$('label[for="'+o+'"]').removeClass("mChecked")}),i.addClass("mChecked"))}};o.on("updateState",".bCustomInput",t),o.on("change",".bCustomInput",function(){$(this).trigger("updateState")}),e.trigger("updateState")}(),$(document).ready(function(){if($("#similarGoodsSlider").length){var e=$("#similarGoodsSlider"),o=e.find(".bSimilarGoodsSlider_eWrap"),t=e.find(".bSimilarGoodsSlider_eArrow"),r=0,i=0,a=0,n=0,s=0,d=function d(){var e=$(this),o={"Recommended Item Clicked Similar Recommendation Place":"product","Recommended Item Clicked Similar Clicked SKU":e.data("article"),"Recommended Item Clicked Similar Clicked Product Name":e.data("name"),"Recommended Item Clicked Similar Product Position":e.data("pos")};"undefined"!=typeof _kmq&&_kmq.push(["record","Recommended Item Clicked Similar",o])},l=function l(t){var s=e.find(".bSimilarGoodsSlider_eGoods");for(var d in t){var l=tmpl("similarGoodTmpl",t[d]);o.append(l)}r=s.width()+2*parseInt(s.css("paddingLeft"),10),a=s.length,n=r*a,o.width(n),a>0&&$(".bSimilarGoods").fadeIn(300,function(){i=e.width()}),4>a&&$(".bSimilarGoodsSlider_eArrow.mRight").hide()};$.getJSON($("#similarGoodsSlider").data("url"),function(e){if(!$.isEmptyObject(e)){var o=e;l(o)}}).done(function(){var t=e.find(".bSimilarGoodsSlider_eGoods");a=t.length,n=r*a,o.width(n),a>0&&$(".bSimilarGoods").fadeIn(300,function(){i=e.width()})}),t.bind("click",function(){return $(this).hasClass("mLeft")?s+=2*r:s-=2*r,i-n>=s?(s=i-n,$(".bSimilarGoodsSlider_eArrow.mRight").hide(),$(".bSimilarGoodsSlider_eArrow.mLeft").show()):s>=0?(s=0,$(".bSimilarGoodsSlider_eArrow.mLeft").hide(),$(".bSimilarGoodsSlider_eArrow.mRight").show()):t.show(),o.animate({left:s}),!1}),$(".bSimilarGoods.mProduct .bSimilarGoodsSlider_eGoods").on("click",d)}window.navigator.userAgent.indexOf("MSIE")>=0&&$(".allpageinner").on("hover",".goodsbox__inner",function(){$(this).toggleClass("hover")}),$("body").on("click",".goodsbox__inner",function(){$(this).attr("data-url")&&(window.location.href=$(this).attr("data-url"))});var c=function c(){var e=$("#_categoryData").data("category"),o={"Viewed Category Category Type":e.type,"Viewed Category Category Level":e.level,"Viewed Category Parent category":e.parent_category,"Viewed Category Category name":e.category,"Viewed Category Category ID":e.id};"undefined"!=typeof _kmq&&_kmq.push(["record","Viewed Category",o])},u=function u(){var e,o,t=$(this),r=!1,i=$("#_categoryData").data("category");e=t.parents("div.goodsbox__inner"),e.length||(e=t.parents("div.goodsboxlink")),o=e.length?e.data("add"):!1,o&&i&&(r={"Category Results Clicked Category Type":i.type,"Category Results Clicked Category Level":i.level,"Category Results Clicked Parent category":i.parent_category,"Category Results Clicked Category name":i.category,"Category Results Clicked Category ID":i.id,"Category Results Clicked SKU":o.article,"Category Results Clicked Product Name":o.name,"Category Results Clicked Page Number":o.page,"Category Results Clicked Product Position":o.position}),r&&"undefined"!=typeof _kmq&&_kmq.push(["record","Category Results Clicked",r])};$("#_categoryData").length&&(c(),$("body").delegate("div.goodsbox a","click",u));var h=function h(){var e=$("#_searchKiss").data("search"),o={"Search String":e.query,"Search Page URL":e.url,"Search Items Found":e.count};"undefined"!=typeof _kmq&&_kmq.push(["record","Search",o]);var t=function(){var o=$(this).data("add"),t={"Search Results Clicked Search String":e.query,"Search Results Clicked SKU":o.article,"Search Results Clicked Product Name":o.name,"Search Results Clicked Page Number":o.page,"Search Results Clicked Product Position":o.position};"undefined"!=typeof _kmq&&_kmq.push(["record","Search Results Clicked",t])};$(".goodsbox__inner").on("click",t),$(".goodsboxlink").on("click",t)};$("#_searchKiss").length&&h()}),function(){var e=function e(){var e=$(this).data("goto");return $(document).stop().scrollTo($("#"+e),800),!1};$(document).ready(function(){$(".jsGoToId").bind("click",e)})}(),function(){var e=function(){var e=$(this);return e.hasClass("expanded")?(e.parent().parent().find(".toHide").hide(),e.html("Все метки"),e.removeClass("expanded")):(e.parent().parent().find(".toHide").show(),e.html("Основные метки"),e.addClass("expanded")),!1};$(document).ready(function(){$(".hotlinksToggle").bind("click",e)})}(),function(){$.ajax({url:"https://jira.enter.ru/s/ru_RU-istibo/773/3/1.2.4/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=2e17c5d6",type:"get",cache:!0,dataType:"script"}),window.ATL_JQ_PAGE_PROPS={triggerFunction:function(e){$("#jira").click(function(o){o.preventDefault(),e()})}}}(),function(ENTER){var constructors=ENTER.constructors,registerMailPhoneField=$(".jsRegisterUsername"),body=$("body"),authBlock=$("#auth-block"),forgotPwdLogin=$(".jsForgotPwdLogin"),resetPwdForm=$(".jsResetPwdForm"),registerForm=$(".jsRegisterForm"),loginForm=$(".jsLoginForm"),completeRegister=$(".jsRegisterFormComplete"),showLoginFormLink=$(".jsShowLoginForm"),signinValidationConfig={fields:[{fieldNode:$(".jsSigninUsername"),require:!0,customErr:"Не указан логин"},{fieldNode:$(".jsSigninPassword"),require:!0,customErr:"Не указан пароль"}]},signinValidator=new FormValidator(signinValidationConfig),registerValidationConfig={fields:[{fieldNode:$(".jsRegisterFirstName"),require:!0,customErr:"Не указано имя"},{fieldNode:registerMailPhoneField,validBy:"isEmail",require:!0,customErr:"Некорректно введен e-mail"}]},registerValidator=new FormValidator(registerValidationConfig),forgotPwdValidationConfig={fields:[{fieldNode:forgotPwdLogin,require:!0,customErr:"Не указан email или мобильный телефон",validateOnChange:!0}]},forgotValidator=new FormValidator(forgotPwdValidationConfig);constructors.Login=function(){"use strict";function Login(){return this instanceof Login?(this.form=null,body.on("click",".registerAnotherWayBtn",$.proxy(this.registerAnotherWay,this)),body.on("click",".bAuthLink",this.openAuth),$(".jsLoginForm, .jsRegisterForm, .jsResetPwdForm").data("redirect",!0).on("submit",$.proxy(this.formSubmit,this)),body.on("click",".jsForgotPwdTrigger, .jsRememberPwdTrigger",this.forgotFormToggle),body.on("click","#bUserlogoutLink",this.logoutLinkClickLog),showLoginFormLink.length&&(loginForm.hide(),body.on("click",".jsShowLoginForm",this.showLoginForm)),void 0):new Login}return Login.prototype.showError=function(e,o){var t=$("ul.error_list",this.form);return void 0!==o&&o(),t.length?t.html("<li>"+e+"</li>"):$(".bFormLogin__ePlaceTitle",this.form).after($('<ul class="error_list" />').append("<li>"+e+"</li>")),!1},Login.prototype.formErrorHandler=function(e){var o=this.getFormValidator(),t=$('[name="'+this.getFormName()+"["+e.field+']"]'),r=function r(){o._unmarkFieldError($(this))};return console.warn("Ошибка в поле"),o._markFieldError(t,e.message),t.bind("focus",r),!1},Login.serverErrorHandler={"default":function(e){return console.log("Обработчик ошибки"),e.error&&e.error.message?(this.showError(e.error.message,function(){document.location.href=e.redirect}),!1):(document.location.href=e.redirect,void 0)},0:function(e){var o=null;if(console.warn("Обработка ошибок формы"),e.redirect)return this.showError(e.error.message,function(){document.location.href=e.redirect}),void 0;$("ul.error_list",this.form).length&&$("ul.error_list",this.form).html("");for(var t=e.form.error.length-1;t>=0;t--)o=e.form.error[t],console.warn(o),"global"!==o.field&&null!==o.message?$.proxy(this.formErrorHandler,this)(o):"global"===o.field&&null!==o.message&&this.showError(o.message);return!1}},Login.prototype.checkEmail=function(){return registerMailPhoneField.hasClass("jsRegisterPhone")?!1:!0},Login.prototype.registerAnotherWay=function(){var e=$(".registerAnotherWay"),o=$(".registerAnotherWayBtn");return registerMailPhoneField.val(""),this.checkEmail()?(e.html("Ваш мобильный телефон:"),o.html("Ввести e-mail"),registerMailPhoneField.addClass("jsRegisterPhone"),registerValidator.setValidate(registerMailPhoneField,{validBy:"isPhone",customErr:"Некорректно введен телефон"}),$.mask.definitions.n="[0-9]",registerMailPhoneField.mask("+7 (nnn) nnn-nn-nn")):(e.html("Ваш e-mail:"),o.html("У меня нет e-mail"),registerMailPhoneField.removeClass("jsRegisterPhone"),registerValidator.setValidate(registerMailPhoneField,{validBy:"isEmail",customErr:"Некорректно введен e-mail"}),registerMailPhoneField.unmask()),!1},Login.prototype.openAuth=function(){return authBlock.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){authBlock.find("input:first").focus()}}),!1},Login.prototype.submitBtnLoadingDisplay=function(e){if(e.length){var o=e.val(),t=e.data("loading-value");e.attr("disabled","disabled"===e.attr("disabled")?!1:!0).val(t).data("loading-value",o)}return!1},Login.prototype.getFormValidator=function(){return eval(this.getFormName()+"Validator")},Login.prototype.getFormName=function(){return this.form.hasClass("jsLoginForm")?"signin":this.form.hasClass("jsRegisterForm")?"register":this.form.hasClass("jsResetPwdForm")?"forgot":""},Login.prototype.formSubmit=function(e){e.preventDefault(),this.form=$(e.target);var o=this.form.serializeArray(),t=this.getFormValidator(),r=$(".jsSubmit",this.form),i=this.getUrlParams(),a=function(e){return e.error?(console.warn("Form has error"),Login.serverErrorHandler.hasOwnProperty(e.error.code)?(console.log("Есть обработчик"),$.proxy(Login.serverErrorHandler[e.error.code],this)(e)):(console.log("Стандартный обработчик"),Login.serverErrorHandler["default"](e)),this.submitBtnLoadingDisplay(r),!1):($.proxy(this.formSubmitLog,this),forgotPwdLogin.length&&forgotPwdLogin.is(":visible")&&(this.submitBtnLoadingDisplay(r),forgotPwdLogin.hide(),$(".jsForgotPwdLoginLabel",this.form).hide(),r.hide(),this.showError(e.notice.message)),console.log(this.form.data("redirect")),console.log(e.data.link),this.form.data("redirect")?e.data.link!==void 0?(console.info("try to redirect to2 "+e.data.link),console.log(typeof e.data.link),document.location.href=e.data.link,console.log("try reload...."),document.location.reload()):(completeRegister.html(e.message),completeRegister.show(),registerForm.hide(),this.showLoginForm()):authBlock.trigger("close"),$("#order-form").length&&($("#user-block").html('Привет, <strong><a href="'+e.data.link+'">'+e.data.user.first_name+"</a></strong>"),$("#order_recipient_first_name").val(e.data.user.first_name),$("#order_recipient_last_name").val(e.data.user.last_name),$("#order_recipient_phonenumbers").val(e.data.user.mobile_phone.slice(1)),$("#qiwi_phone").val(e.data.user.mobile_phone.slice(1))),void 0)},n=function(){this.submitBtnLoadingDisplay(r),o.push({name:"redirect_to",value:i.redirect_to?i.redirect_to:window.location.href}),$.post(this.form.attr("action"),o,$.proxy(a,this),"json")};return t.validate({onInvalid:function(e){console.warn("invalid"),console.log(e)},onValid:$.proxy(n,this)}),!1},Login.prototype.showLoginForm=function(){showLoginFormLink.hide(),loginForm.slideDown(300),$.scrollTo(loginForm,500)},Login.prototype.forgotFormToggle=function(){return resetPwdForm.is(":visible")?(resetPwdForm.hide(),loginForm.show()):(resetPwdForm.show(),loginForm.hide()),!1},Login.prototype.formSubmitLog=function(){var e="";"signin"===this.getFormName()?("undefined"!=typeof _gaq&&(e=-1!==this.form.find(".jsSigninUsername").val().search("@")?"email":"mobile",_gaq.push(["_trackEvent","Account","Log in",e,window.location.href])),"undefined"!=typeof _kmq&&_kmq.push(["identify",this.form.find(".jsSigninUsername").val()])):"register"===this.getFormName()?("undefined"!=typeof _gaq&&(e=this.checkEmail()?"email":"mobile",_gaq.push(["_trackEvent","Account","Create account",e])),"undefined"!=typeof _kmq&&_kmq.push(["identify",this.form.find(".jsRegisterUsername").val()])):"forgot"===this.getFormName()&&"undefined"!=typeof _gaq&&(e=-1!==this.form.find(".jsForgotPwdLogin").val().search("@")?"email":"mobile",_gaq.push(["_trackEvent","Account","Forgot password",e]))},Login.prototype.logoutLinkClickLog=function(){"undefined"!=typeof _kmq&&_kmq.push(["clearIdentity"])},Login.prototype.getUrlParams=function(){var e,o,t={},r=window.location.search.substring(1).split("&");for(o=0;r.length>o;o++)e=r[o].split("="),t[e[0]]=e[1]===void 0?"":e[1];return t},Login}(),$(document).ready(function(){new ENTER.constructors.Login})}(window.ENTER),$(document).ready(function(){function e(e){return"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","CategoryClick",e.data,window.location.pathname]),!0}$("body").on("click",".bSubscibe",function(){return $(this).hasClass("checked")?($(this).removeClass("checked"),$(this).find(".subscibe").removeAttr("checked"),$(this).find('input[name="subscribe"]').val(0)):($(this).addClass("checked"),$(this).find(".subscibe").attr("checked","checked"),$(this).find('input[name="subscribe"]').val(1)),!1}),$(".bMainMenuLevel-1__eLink").bind("click","Верхнее меню",e),$(".bMainMenuLevel-2__eLink").bind("click","Верхнее меню",e),$(".bMainMenuLevel-3__eLink").bind("click","Верхнее меню",e),$(".breadcrumbs").first().find("a").bind("click","Хлебные крошки сверху",e),$(".breadcrumbs-footer").find("a").bind("click","Хлебные крошки снизу",e),$(".bCtg__eMore").bind("click",function(e){e.preventDefault();var o=$(this);o.parent().find("li.hf").slideToggle();var t=o.find("a");t.text("еще..."==t.text()?"скрыть":"еще...")}),$(".product_buy-container").each(function(){var e=$(this).data("order");"object"!=typeof e||$.isEmptyObject(e)||$.ajax({url:$(this).data("url"),data:e,type:"POST",timeout:2e4})}),$(".searchtextClear").length&&($(".searchtextClear").each(function(){$(this).val().length?$(this).removeClass("vh"):$(this).addClass("vh")}),$(".searchtextClear").click(function(){$(this).siblings(".searchtext").val(""),$(this).addClass("vh"),$("#searchAutocomplete").length&&$("#searchAutocomplete").html("")})),function(){$(".bGoodsList .bGoodsList__eItem").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$(".bigcarousel-brand .goodsbox").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}()}),function(){var e=function e(e,o){var t=$(".bSubscribeLightboxPopupNotNow"),r=$(".bSubscribeLightboxPopup"),i=$(".bSubscribeLightboxPopup__eInput"),a=$(".bSubscribeLightboxPopup__eBtn"),n=function n(){var e=i.val(),o=$(this).data("url");return a.hasClass("mDisabled")?!1:($.post(o,{email:e},function(e){return e.success?(r.html('<span class="bSubscribeLightboxPopup__eTitle mType">Спасибо! подтверждение подписки отправлено на указанный e-mail</span>'),window.docCookies.setItem("subscribed",1,15768e4,"/"),setTimeout(function(){r.slideUp(300)},3e3),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Account","Emailing sign up","Page top"]),void 0):!1}),!1)},s=function s(){r.slideDown(300),a.bind("click",n),$(".bSubscribeLightboxPopup__eNotNow").bind("click",function(){var e=$(this).data("url");return r.slideUp(300,d),window.docCookies.setItem("subscribed",0,15768e4,"/"),$.post(e),!1})},d=function d(){t.slideDown(300),t.bind("click",function(){$(this).slideUp(300),s()})},l=new FormValidator({fields:[{fieldNode:i,require:!0,customErr:"Не указан e-mail",validBy:"isEmail"}]});return i.placeholder(),l.validate({onValid:function(){i.removeClass("mError"),a.removeClass("mDisabled")},onInvalid:function(){a.addClass("mDisabled"),i.addClass("mError")}}),o.show?(s(),void 0):(o.agreed||d(),!1)};$("body").bind("showsubscribe",e)}(),function(){var e=$("body"),o=$("div.searchbox form"),t=o.find("input.searchtext"),r=$("#searchAutocomplete"),i=$(".bSearchSuggest__eRes"),a=-1,n=0,s={},d=null,l=function l(){var e=i.eq(a).attr("href"),o=i.eq(a).hasClass("bSearchSuggest__eCategoryRes")?"suggest_category":"suggest_product";"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Search",o,e])},c=function c(e){var o=e.which,a=t.attr("value"),l=function l(e){s[a]=e,r.html(e),i=$(".bSearchSuggest__eRes"),n=i.length},c=function c(){var e="/search/autocomplete?q="+encodeURI(a);$.ajax({type:"GET",url:e,success:l})};return o>=37&&40>=o||27===o||13===o?!1:0===a.length?(r.empty(),!1):(clearTimeout(d),s[a]?(l(s[a]),!1):(d=setTimeout(c,300),void 0))},u=function u(){var e=t.val().replace(/(^\s*)|(\s*$)/g,"").replace(/(\s+)/g," ");t.val(e)},h=function h(e){var o=e.which,t=function t(){i.removeClass("hover").eq(a).addClass("hover")},s=function s(){a-1>=0?(a--,t()):(a=-1,i.removeClass("hover"),$(this).focus())},d=function d(){n-1>=a+1&&(a++,t())},c=function c(){var e=i.eq(a).attr("href");l(),document.location.href=e};return 38===o?(s(),!1):40===o?(d(),!1):27===o?(r.empty(),!1):13===o&&(u(),-1!==a)?(c(),!1):void 0},m=function m(){var e=t.attr("value");return 0===e.length?!1:(u(),void 0)},g=function g(){r.show()},f=function f(e){var o=e.target.className;o.indexOf("bSearchSuggest")+1||o.indexOf("searchtext")+1||r.hide()},p=function p(){var e=0;i.removeClass("hover"),e=$(this).addClass("hover").index(),a=e-1},v=function v(){var e=$(this).text(),o=t.val();return o&&(e=o+" "+e),t.val(e+" ").focus()};$(document).ready(function(){t.bind("keydown",h),t.bind("keyup",c),t.bind("focus",g),o.bind("submit",m),t.placeholder(),e.bind("click",f),e.on("mouseenter",".bSearchSuggest__eRes",p),e.on("click",".bSearchSuggest__eRes",l),e.on("click",".sHint_value",v)})}(),function(){var e=300,o=600,t=15,r=null,i=null,a=!1,n=null,s=null,d=null,l=null,c=null,u={x:0,y:0},h={x:0,y:0},m={x:0,y:0},g={x:0,y:0},f=function(e){r=new Date,i=e,$(".bMainMenuLevel-2__eItem").removeClass("hover"),e.addClass("hover")},p=function(){var o=$(this);r=new Date,a=!0,setTimeout(function(){a&&new Date-r>e&&f(o)},e+20)},v=function(){var e=$(this);e.removeClass("hover"),a=!1},y=function(){u={x:g.x,y:g.y-$(window).scrollTop()},h={x:c.left-t,y:c.top-$(window).scrollTop()},m={x:c.left-t,y:c.top+c.height-$(window).scrollTop()}},_=function(){var e=(u.x-g.x)*(h.y-u.y)-(h.x-u.x)*(u.y-g.y),o=(h.x-g.x)*(m.y-h.y)-(m.x-h.x)*(h.y-g.y),r=(m.x-g.x)*(u.y-m.y)-(u.x-m.x)*(m.y-g.y);return e>=0&&o>=0&&r>=0||0>=e&&0>=o&&0>=r||g.x>=h.x&&g.x<=h.x+t&&g.y>=h.y&&g.y<=m.y?!0:!1},b=function(e){g={x:e.pageX,y:e.pageY-$(window).scrollTop()};var o=$(this);s&&o.attr("class")===s.attr("class")&&(L(o),n=new Date),x(o)},k=function(e){s=e,e.addClass("hover"),n=new Date,L(e)},C=function(){var e=$(this);x(e),e.addClass("hoverNowLvl2"),n&&o>=new Date-n&&_()&&setTimeout(function(){e.hasClass("hoverNowLvl2")&&new Date-n>o&&x(e)},o+20)},w=function(){var e=$(this);e.removeClass("hoverNowLvl2")},x=function(e){n?(!_()||n&&new Date-n>o&&_())&&(s.removeClass("hover"),k(e)):k(e)},L=function(e){d=S(e),l=S(e.find(".bMainMenuLevel-3"));var o=e.find(".bMainMenuLevel-2__eTitle")[0].offsetWidth;c={top:l.top,left:l.left+o,width:l.width-o,height:l.height},y()},S=function(e){var o=$(e).width(),t=$(e).height();e=e[0];for(var r=0,i=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)r+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:i,left:r,width:o,height:t}};$(".bMainMenuLevel-1__eItem").mouseenter(p),$(".bMainMenuLevel-1__eItem").mouseleave(v),$(".bMainMenuLevel-2__eItem").mouseenter(C),$(".bMainMenuLevel-2__eItem").mousemove(b),$(".bMainMenuLevel-2__eItem").mouseleave(w)}(),function(){var e=$("#upper"),o=!1,t=function t(){$(window).scrollTop()>600&&!o?(o=!0,e.animate({marginTop:"0"},400)):600>$(window).scrollTop()&&o&&(o=!1,e.animate({marginTop:"-55px"},400))},r=function r(){return $(window).scrollTo("0px",400),!1};$(window).scroll(t),e.bind("click",r)}(),function(e){var o,t,r=e.config,i=e.utils,a=r.clientCart,n=i.extendApp("ENTER.userBar"),s=n.userBarFixed=$(".fixedTopBar.mFixed"),d=n.userBarStatic=$(".fixedTopBar.mStatic"),l=s.find(".fixedTopBar__upLink"),c=s.data("value"),u=$("body"),h=$(window),m=!1,g=$("<div>").css({position:"fixed",display:"none",width:"100%",height:"100%",top:0,left:0,zIndex:900,background:"black",opacity:.4});n.showOverlay=!1;var f=function f(){s.slideDown()},p=function p(){s.slideUp()},v=function v(){var e=h.scrollTop();m||(e>=t?f():p())},y=function y(){return $.scrollTo(o,500),e.catalog.filter.openFilter(),!1},_=function _(e,o){console.info("userbar::updateUserInfo"),console.log(o);var t,r=s.find(".fixedTopBar__logIn"),i=d.find(".fixedTopBar__logIn"),a=$("#userbar_user_tmpl"),n=a.data("partial");o&&o.name&&o.link&&(t=Mustache.render(a.html(),o,n),i.removeClass("mLogin"),r.removeClass("mLogin"),i.html(t),r.html(t))},b=function b(){console.info("userbar::showBuyInfo");var e,o,t=s.find(".fixedTopBar__cart"),r=s.find(".fixedTopBar__logIn"),d=$("#buyinfo_tmpl"),l=d.data("partial"),c="mOpenedPopup",h={};h.products=i.cloneObject(a.products),h.showTransparent=!!(h.products.length>3);var p=function p(){var o=t.find(".hintDd");return o.removeClass("mhintDdOn"),r.removeClass(c),t.removeClass(c),e.slideUp(300,function(){v(),e.remove(),m=!1}),n.showOverlay?(g.fadeOut(300,function(){g.off("click"),g.remove(),n.showOverlay=!1}),!1):void 0};h.products.reverse(),console.log(h),o=Mustache.render(d.html(),h,l),e=$(o).css({left:-129}),e.find(".cartList__item").eq(0).addClass("mHover"),r.addClass(c),t.addClass(c),t.append(e),n.showOverlay||(u.append(g),g.fadeIn(300),n.showOverlay=!0),e.slideDown(300),f(),m=!0,g.on("click",p)},k=function k(e,o){console.info("userbar::updateBasketInfo"),console.log(o),console.log(a);var t,r=s.find(".fixedTopBar__cart"),n=d.find(".fixedTopBar__cart"),l=$("#userbar_cart_tmpl"),c=l.data("partial");console.log("vars inited"),o.hasProducts=!1,o.showTransparent=!1,o&&o.quantity&&o.sum&&(0!==a.products.length&&(o.hasProducts=!0,o.products=i.cloneObject(a.products),o.products.reverse()),a.products.length>3&&(o.showTransparent=!0),o.sum=printPrice(o.sum),t=Mustache.render(l.html(),o,c),n.removeClass("mEmpty"),r.removeClass("mEmpty"),n.html(t),r.html(t))},C=function C(e,o,t){console.info("userbar::showUpsell");var r,i=s.find(".fixedTopBar__cart"),a=i.find(".hintDd"),n=function n(e){if(console.log(e),e.success){if(console.info('Получены рекомендации "С этим товаром также покупают" от RetailRocket'),a.find(".bGoodsSlider").remove(),r=$(e.content)[0],a.append(r),a.addClass("mhintDdOn"),$(r).goodsSlider(),!o.product.article)return console.warn("Не получен article продукта"),void 0;console.log("Трекинг товара при показе блока рекомендаций"),_gaq&&_gaq.push(["_trackEvent","cart_recommendation","cart_rec_shown",o.product.article]),_kmq&&_kmq.push(["record","cart recommendation shown",{"SKU cart rec shown":o.product.article}])}};console.log(t),t.url&&$.ajax({type:"GET",url:t.url,success:n})},w=function w(){var e=$(this).parents(".jsSliderItem").data("product");return e.article?(console.log("Трекинг при клике по товару из списка рекомендаций"),_gaq&&_gaq.push(["_trackEvent","cart_recommendation","cart_rec_clicked",e.article]),_kmq&&_kmq.push(["record","cart recommendation clicked",{"SKU cart rec clicked":e.article}]),void 0):(console.warn("Не получен article продукта"),void 0)
};console.info("Init userbar module"),console.log(c),u.on("click",".jsUpsaleProduct",w),u.on("userLogged",_),u.on("basketUpdate",k),u.on("addtocart",b),u.on("getupsale",C),s.length&&(o=$(c.target),l.length&&l.on("click",y),o.length&&(t=o.offset().top+s.height(),h.on("scroll",v)))}(window.ENTER);