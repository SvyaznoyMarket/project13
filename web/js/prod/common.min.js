!function(a,b){ENTER.DeliveryPoints=function(c){var d,e=this,f=!1,g=ENTER.OrderV3?ENTER.OrderV3.map:ENTER.OrderV31Click.map;return e.searchInput=b.observable(),e.searchAutocompleteList=b.observableArray(),e.searchAutocompleteListVisible=b.observable(!1),e.searchAutocompleteListClicked=!1,e.enableAutocompleteListVisible=function(){e.searchAutocompleteListVisible(!0)},e.disableAutocompleteListVisible=function(){e.searchAutocompleteListVisible(!1)},e.limitedSearchInput=b.computed(e.searchInput).extend({throttle:500}),e.limitedSearchInput.subscribe(function(a){var b=.5,c=[[d[0][0]-b,d[0][1]-b],[d[1][0]+b,d[1][1]+b]];if("undefined"!=typeof window.ymaps&&0!=a.length)return e.searchAutocompleteList.removeAll(),e.searchAutocompleteListVisible(!1),f?void(f=!1):void ymaps.geocode(a,{boundedBy:c,strictBounds:!0}).then(function(a){a.geoObjects.each(function(a){e.searchAutocompleteList.push({name:a.properties.get("name")+", "+a.properties.get("description"),bounds:a.geometry.getBounds()})}),e.searchAutocompleteListVisible(!0)},function(a){})}),e.autocompleteNavigation=function(b,c){var d=c.which,f=a(".jsDeliverySuggestLi"),g=a(".deliv-suggest__list"),h="deliv-suggest__i--active",i=f.index(f.filter("."+h));switch(f.removeClass(h),d){case 13:if(i>-1)return e.autocompleteItemClick(f.eq(i).data("element")),!1;break;case 38:-1==i&&(i=e.searchAutocompleteList.length),f.eq(i-1).addClass(h),g.scrollTo("."+h);break;case 40:f.eq(i+1).addClass(h),g.scrollTo("."+h)}return!0},e.clearSearchInput=function(){e.searchInput(""),e.searchAutocompleteList.removeAll()},e.autocompleteItemClick=function(a){g.setCenter(a.bounds[0],14),f=!0,e.searchInput(a.name),e.searchAutocompleteListVisible(!1)},e.availablePoints=b.observableArray([]),e.choosenTokens=b.observableArray([]),e.choosenCosts=b.observableArray([]),e.choosenDates=b.observableArray([]),e.latitudeMin=b.observable(),e.latitudeMax=b.observable(),e.longitudeMin=b.observable(),e.longitudeMax=b.observable(),e.pointsText=b.computed(function(){switch(e.choosenTokens().length){case 0:return"Все точки";case 1:return a.grep(e.availablePoints(),function(a){return e.choosenTokens()[0]==a.token})[0].dropdownName;case 2:case 3:case 4:return e.choosenTokens().length+" точки";default:return e.choosenTokens().length+" точек"}}),e.costsText=b.computed(function(){return 1==e.choosenCosts().length?0==e.choosenCosts()[0]?"Бесплатно":e.choosenCosts()[0]+'&nbsp;<span class="rubl">p</span>':"Стоимость"}),e.datesText=b.computed(function(){return 1==e.choosenDates().length?a.grep(e.availablePoints(),function(a){return e.choosenDates()[0]==a.nearestDay})[0].humanNearestDay:"Дата"}),e.points=b.computed(function(){var b,c=e.choosenTokens(),d=e.choosenCosts(),f=e.choosenDates();return b=a.grep(e.availablePoints(),function(a){return c.length&&-1==c.indexOf(a.token)?!1:d.length&&-1==d.indexOf(a.cost)?!1:f.length&&-1==f.indexOf(a.nearestDay)?!1:e.isPointInBounds(a)}),b.sort(function(a,b){return a.nearestDay!=b.nearestDay?a.nearestDay<b.nearestDay?-1:1:a.cost!=b.cost?a.cost-b.cost:(a.blockName!=b.blockName,0)})}),e.isPointInBounds=function(a){return e.latitudeMin()<a.latitude&&e.longitudeMin()<a.longitude&&e.latitudeMax()>a.latitude&&e.longitudeMax()>a.longitude},e.choosenTokens.subscribe(function(b){var c=ENTER.OrderV3?ENTER.OrderV3.map:ENTER.OrderV31Click.map;c.geoObjects.each(function(c){0==b.length?c.options.set("visible",!0):c.options.set("visible",-1!==a.inArray(c.properties.get("enterToken"),b))})}),a.each(c,function(b,c){a.each(c,function(a,b){e.availablePoints.push(b),"undefined"==typeof d?d=[[b.latitude,b.longitude],[b.latitude,b.longitude]]:(b.latitude<d[0][0]&&(d[0][0]=b.latitude),b.latitude>d[1][0]&&(d[1][0]=b.latitude),b.longitude<d[0][1]&&(d[0][1]=b.longitude),b.longitude>d[1][1]&&(d[1][1]=b.longitude))})}),window.map=e,e},ENTER.Placemark=function(b,c){var d,e="undefined"==typeof c?!0:c,f="<b>Адрес:</b> "+b.address;if(!b.latitude||!b.longitude)throw"Не указаны координаты точки";return b.regtime&&(f+="<br /> <b>Время работы:</b> "+b.regtime),f+=a("<button />",{text:"Выбрать","class":"btnLightGrey bBtnLine btnView jsChangePoint",style:"display: block","data-id":b.id,"data-token":b.token,"data-blockname":b.orderToken})[0].outerHTML,d=new ymaps.Placemark([b.latitude,b.longitude],{balloonContentHeader:b.name,balloonContentBody:f,hintContent:b.name,enterToken:b.token},{balloonMaxWidth:200,iconLayout:"default#image",iconImageHref:b.marker.iconImageHref,iconImageSize:b.marker.iconImageSize,iconImageOffset:b.marker.iconImageOffset,visible:e,zIndex:"shops"==b.token?1e3:0})}}(jQuery,ko),$(function(a){function b(){var b=this;return b.searchInput=ko.observable(""),b.searchFocus=ko.observable(!1),b.searchResults=ko.observableArray(),b.advancedSearch=ko.observable(f),b.searchCategoryVisible=ko.observable(!1),b.currentCategory=ko.observable(null),b.searchResultCategories=ko.observableArray(),b.searchResultProducts=ko.observableArray(),b.isNoSearchResult=ko.computed(function(){return 0==b.searchResultCategories().length&&0==b.searchResultProducts().length}),b.toggleCategoryVisibility=function(){b.searchCategoryVisible(!b.searchCategoryVisible())},b.searchResultNavigation=function(c,d){var e=d.which,f=a(".jsSearchbarResults a"),g="searchdd_lk_iact",h=f.index(f.filter("."+g));if(!b.isNoSearchResult())switch(f.removeClass(g),e){case 13:if(h>-1)return window.location.href=f.eq(h).attr("href"),!1;break;case 38:-1==h&&(h=b.searchResults.length),f.eq(h-1).addClass(g);break;case 40:f.eq(h+1).addClass(g)}return!0},b.categoryClick=function(c,d){var e=a(d.target).data("value");b.currentCategory(e),b.toggleCategoryVisibility()},b.categoryReset=function(){b.currentCategory(null),b.toggleCategoryVisibility()},b.searchResultsVisibility=ko.computed(function(){return b.searchFocus()}).extend({throttle:200}),ko.computed(function(){var c=b.searchInput(),e={q:c};null!=b.currentCategory()&&(e.catId=b.currentCategory().id),c.length<3||a.get(d,e).done(function(a){b.searchResultCategories(a.result.categories),b.searchResultProducts(a.result.products)}).fail(function(){})}).extend({throttle:200}),b}var c=a(document.body),d="/search/autocomplete",e=JSON.parse(docCookies.getItem("switch")),f=e&&"on"==e.adv_search;c.find(".jsKnockoutSearch").each(function(){ko.applyBindings(new b,this)}),c.on("click",".jsSearchSuggestCategory",function(b){b.preventDefault(),c.trigger("trackGoogleEvent",[{category:"search_string",action:"suggest",label:"category",hitCallback:a(this).attr("href")}])}),c.on("click",".jsSearchSuggestProduct",function(b){b.preventDefault(),c.trigger("trackGoogleEvent",[{category:"search_string",action:"suggest",label:"item",hitCallback:a(this).attr("href")}])}),c.on("click",".jsEnterprizeInSearchBarButton",function(b){b.preventDefault(),c.trigger("trackGoogleEvent",[{category:"search_enterprize",action:"click",hitCallback:a(this).attr("href")}])})}(jQuery)),function(a){ko.bindingHandlers.buyButtonBinding={update:function(b,c){var d=ko.unwrap(c()),e=a(b),f=e.data("product-id"),g=e.data("in-shop-stock-only"),h=e.data("in-shop-showroom-only"),i=e.data("is-buyable"),j=e.data("status-id"),k=e.data("noUpdate"),l=e.data("is-slot"),m=e.data("color-class")||"",n=e.data("sender"),o=e.data("sender2");n=n&&"object"==typeof n?{sender:n}:{},o=o&&"string"==typeof o?{sender2:o}:{},"undefined"==typeof i||i?"undefined"!=typeof j&&5==j?e.text("Нет").addClass("mDisabled").removeClass("mShopsOnly").removeClass("mBought").addClass("js-orderButton jsBuyButton").attr("href","#"):"undefined"!=typeof l&&l?e.text("Как купить?").removeClass("mDisabled").removeClass("mShopsOnly").removeClass("mBought").addClass("btn btn--slot js-orderButton js-slotButton").attr("href","#"):"undefined"!=typeof g&&g&&ENTER.config.pageConfig.user.region.forceDefaultBuy?e.text("Купить").removeClass("mDisabled").removeClass("mShopsOnly").removeClass("mBought").addClass("js-orderButton jsOneClickButton-new").addClass(m).removeClass("jsBuyButton").attr("href",ENTER.utils.generateUrl("cart.oneClick.product.set",a.extend({productId:f},n,o))):ENTER.utils.getObjectWithElement(d,"id",f)&&!k?e.text("В корзине").removeClass("mDisabled").removeClass("mShopsOnly").addClass("mBought").removeClass("js-orderButton").removeClass("jsBuyButton").attr("href",ENTER.utils.generateUrl("cart")):e.hasClass("mBought")&&e.text("Купить").removeClass("mDisabled").removeClass("mShopsOnly").removeClass("mBought").addClass("js-orderButton jsBuyButton").addClass(m).attr("href",ENTER.utils.generateUrl("cart.product.set",a.extend({productId:f},n,o))):e.text("undefined"!=typeof h&&h?"На витрине":"Нет").addClass("mDisabled").removeClass("mShopsOnly").removeClass("mBought").addClass("js-orderButton jsBuyButton").attr("href","#")}},ko.bindingHandlers.buySpinnerBinding={update:function(b,c){var d=ko.unwrap(c()),e=a(b);e.removeClass("mDisabled").find("input").attr("disabled",!1),a.each(d,function(a,b){this.id==e.data("product-id")&&(e.addClass("mDisabled"),e.find("input").val(b.quantity()).attr("disabled",!0))})}},ko.bindingHandlers.compareButtonBinding={update:function(b,c){var d,e=ko.unwrap(c()),f=a(b),g=f.data("id"),h=f.data("type-id"),i="";-1!=ENTER.config.pageConfig.location.indexOf("listing")?i="listing":-1!=ENTER.config.pageConfig.location.indexOf("product")&&(i="product"),ENTER.utils.getObjectWithElement(e,"id",g)?f.addClass("btnCmpr-act").find("a.btnCmpr_lk").addClass("btnCmpr_lk-act").attr("href",ENTER.utils.generateUrl("compare.delete",{productId:g})).find("span").text("Убрать из сравнения"):f.removeClass("btnCmpr-act").find("a.btnCmpr_lk").removeClass("btnCmpr_lk-act").attr("href",ENTER.utils.generateUrl("compare.add",{productId:g,location:i})).find("span").text("Добавить к сравнению"),d=a.grep(e,function(a){return h==a.typeId}),d.length>1?f.find(".btnCmpr_more").show().find(".btnCmpr_more_qn").text(d.length):f.find(".btnCmpr_more").hide()}},ko.bindingHandlers.compareListBinding={update:function(b,c){var d=ko.unwrap(c()),e=a(b),f=e.data("id"),g="";-1!=ENTER.config.pageConfig.location.indexOf("listing")?g="listing":-1!=ENTER.config.pageConfig.location.indexOf("product")&&(g="product"),ENTER.utils.getObjectWithElement(d,"id",f)?e.addClass("btnCmprb-act").attr("href",ENTER.utils.generateUrl("compare.delete",{productId:f})):e.removeClass("btnCmprb-act").attr("href",ENTER.utils.generateUrl("compare.add",{productId:f,location:g}))}}}(jQuery),$(function(){function a(a){var b={};return $.each(a,function(a,c){b[a]=c}),b.quantity=ko.observable(a.quantity),b}function b(){var b={};return b.name=ko.observable(),b.firstName=ko.observable(),b.lastName=ko.observable(),b.link=ko.observable(),b.isEnterprizeMember=ko.observable(),b.isUpdated=ko.observable(!1),b.cart=ko.observableArray(),b.cartSum=ko.computed(function(){var a=0;return $.each(b.cart(),function(b,c){a+=c.price*c.quantity()}),a}),b.compare=ko.observableArray(),b.isProductInCompare=function(a){return 0==$.grep(b.compare,function(b){return b.id==$(a).data("id")}).length},b.update=function(d){d.user&&(d.user.name&&b.name(d.user.name),d.user.firstName&&b.firstName(d.user.firstName),d.user.lastName&&b.lastName(d.user.lastName),d.user.link&&b.link(d.user.link),d.user.isEnterprizeMember&&b.isEnterprizeMember(d.user.isEnterprizeMember)),d.cartProducts&&$.isArray(d.cartProducts)&&$.each(d.cartProducts,function(c,d){b.cart.unshift(a(d))}),d.compare&&$.each(d.compare,function(a,c){b.compare.push(c)}),b.isUpdated(!0),c.trigger("userModelUpdate")},b.productQuantityUpdate=function(a,c){$.each(b.cart(),function(b,d){a==d.id&&d.quantity(c)})},b.removeProductByID=function(a){b.cart.remove(function(b){return b.id==a})},b.infoIconVisible=ko.observable(!1),b.infoBlock_1Visible=ko.computed(function(){return ENTER.config.pageConfig.selfDeliveryTest&&ENTER.config.pageConfig.selfDeliveryLimit>b.cartSum()}),b.infoBlock_2Visible=ko.computed(function(){return ENTER.config.pageConfig.selfDeliveryTest&&ENTER.config.pageConfig.selfDeliveryLimit<=b.cartSum()&&docCookies.hasItem("enter_ab_self_delivery_view_info")}),b.minOrderSum=ENTER.config.pageConfig.minOrderSum,b.isMinOrderSumVisible=ko.computed(function(){return b.minOrderSum!==!1&&b.minOrderSum>b.cartSum()}),b}var c=$(document.body),d="_authorized";ENTER.UserModel=b(),$(".js-topbarfix, .js-topbarfixBuy, .js-WidgetBuy, .js-listing, .js-jewelListing, .js-gridListing, .js-lineListing, .js-slider, .jsKnockoutCart").each(function(){ko.applyBindings(ENTER.UserModel,this)}),function(){ENTER.UserModel.update(ENTER.config.userInfo),docCookies.hasItem(d)||(ENTER.config.userInfo&&ENTER.config.userInfo.user&&"undefined"!=typeof ENTER.config.userInfo.user.id?docCookies.setItem(d,1,3600,"/"):docCookies.setItem(d,0,3600,"/"))}(),c.on("catalogLoadingComplete",function(){$(".js-listing, .js-jewelListing").each(function(){ko.cleanNode(this),ko.applyBindings(ENTER.UserModel,this)})}),c.on("addtocart",function(b,c){c.redirect?document.location.href=c.redirect:(ENTER.UserModel.cart.removeAll(),$.each(c.cart.products,function(b,c){ENTER.UserModel.cart.unshift(a(c))}))}),c.on("removeFromCart",function(a,b){b.id&&window.rrApiOnReady&&window.rrApiOnReady.push(function(){window.rrApi.removeFromBasket(b.id)})}),c.on("mouseover",".btnBuy-inf",function(){docCookies.hasItem("enter_ab_self_delivery_view_info")||(docCookies.setItem("enter_ab_self_delivery_view_info",!0),ENTER.UserModel.cartSum()<ENTER.config.pageConfig.selfDeliveryLimit&&c.trigger("trackGoogleEvent",["Платный_самовывоз","увидел всплывашку платный самовывоз","всплывающая корзина"]),ENTER.UserModel.cartSum()>=ENTER.config.pageConfig.selfDeliveryLimit&&c.trigger("trackGoogleEvent",["Платный_самовывоз","самовывоз бесплатно","всплывающая корзина"])),ENTER.UserModel.infoIconVisible(!1)}),c.on("showUserCart",function(a){$(a.target);ENTER.config.pageConfig.selfDeliveryTest&&ENTER.UserModel.infoIconVisible()?c.trigger("trackGoogleEvent",["Платный_самовывоз","увидел подсказку","всплывающая корзина"]):ENTER.config.pageConfig.selfDeliveryTest&&!ENTER.UserModel.infoIconVisible()&&c.trigger("trackGoogleEvent",["Платный_самовывоз","не увидел подсказку","всплывающая корзина"]),ENTER.config.pageConfig.selfDeliveryTest&&!docCookies.hasItem("enter_ab_self_delivery_view_info")&&ENTER.UserModel.cartSum()<ENTER.config.pageConfig.selfDeliveryLimit&&ENTER.UserModel.infoIconVisible(!0),ENTER.config.pageConfig.selfDeliveryTest&&ENTER.UserModel.infoBlock_2Visible()&&!ENTER.UserModel.infoIconVisible()&&c.trigger("trackGoogleEvent",["Платный_самовывоз","самовывоз бесплатно","всплывающая корзина"])}),c.on("showUserCart",function(){ENTER.UserModel.minOrderSum!==!1&&(ENTER.UserModel.isMinOrderSumVisible()?c.trigger("trackGoogleEvent",["pickup","no",ENTER.UserModel.minOrderSum-ENTER.UserModel.cartSum()+""]):c.trigger("trackGoogleEvent",["pickup","yes"]))}),c.on("userModelUpdate",function(a){ENTER.config.pageConfig.selfDeliveryTest&&!docCookies.hasItem("enter_ab_self_delivery_view_info")&&ENTER.UserModel.cartSum()<ENTER.config.pageConfig.selfDeliveryLimit&&ENTER.UserModel.infoIconVisible(!0)}),c.on("click",".jsAbSelfDeliveryLink",function(a){var b=a.target.href;b&&(a.preventDefault(),c.trigger("trackGoogleEvent",{category:"Платный_самовывоз",action:"добрать товар",label:"всплывающая корзина",hitCallback:function(){window.location.href=b}}))})}),function(a,b,c,d){c.ajaxSetup({timeout:2e4,statusCode:{404:function(){this.url;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","404 ошибка, страница не найдена"])},401:function(){c("#auth-block").length?c("#auth-block").lightbox_me({centered:!0,onLoad:function(){c("#auth-block").find("input:first").focus()}}):"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","401 ошибка, авторизуйтесь заново"])},500:function(){this.url;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","500 сервер перегружен"])},503:function(){this.url;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","503 ошибка, сервер перегружен"])},504:function(){this.url;"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","504 ошибка, проверьте соединение с интернетом"])}},error:function(a,b,c){this.url;if("error"===a.statusText)"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Errors","Ajax Errors","неизвестная ajax ошибка"]);else if("timeout"===b)return}})}(this,this.document,this.jQuery,this.ENTER),function(a){var b=a(document.body),c=this.ga,d=this._gaq,e=function(){return"function"==typeof c&&"function"==typeof c.getAll&&0!=c.getAll().length},f=function(){return"object"==typeof d},g=function(a,b){var g={};arguments.length>=2&&"string"==typeof b&&(g.page=arguments[1],"string"==typeof g.page&&"/"!=g.page.substr(0,1)&&(g.page="/"+g.page),arguments[2]&&(g.title=arguments[2])),e()&&(c("send","pageview",g),c("secondary.send","pageview",g)),f()&&d.push(["_trackPageview",g.page])},h=function(b,g){var h={},i={hitType:"event"},j=["_trackEvent"],k=["category","action","label","value","nonInteraction","hitCallback"];if(2==arguments.length&&"object"==typeof g)a.each(k,function(a,b){g.hasOwnProperty(b)&&(h[b]=g[b])});else if(arguments.length>2&&"string"==typeof g)for(var l=1,m=arguments.length;m>l;l++)h[k[l-1]]=arguments[l];a.each(k,function(a,b){if(h.hasOwnProperty(b))switch(b){case"category":h[b]=h[b].slice(0,150);break;case"action":case"label":h[b]=h[b].slice(0,500);break;case"value":h[b]=parseInt(h[b].slice,10);break;case"nonInteraction":h[b]=Boolean(h[b])}}),f()&&(j.push(h.category,h.action),j.push(h.label?h.label:null),j.push(h.value?h.value:null),h.nonInteraction&&j.push(h.nonInteraction),d.push(j)),e()?(i.eventCategory=h.category,i.eventAction=h.action,h.label&&(i.eventLabel=h.label),h.value&&(i.eventValue=h.value),"function"==typeof h.hitCallback?i.hitCallback=h.hitCallback:"string"==typeof h.hitCallback&&(i.hitCallback=function(){window.location.href=h.hitCallback}),h.nonInteraction&&c("set","nonInteraction",!0),c("send",i),c("secondary.send",i)):"function"==typeof h.hitCallback?h.hitCallback():"string"==typeof h.hitCallback&&(window.location.href=h.hitCallback)},i=function(a){if(this.id=a.id?a.id:!1,this.affiliation=a.affiliation,this.total=a.total,this.shipping=a.shipping?a.shipping:"0",this.tax=a.tax?a.tax:"0",this.city=a.city?a.city:"",!this.id)throw"Некорректный ID транзакции";if(!this.total)throw"Некорректная сумма заказа";return this.toObject=function(){return{id:this.id,affiliation:this.affiliation,revenue:this.total,shipping:this.shipping,tax:this.tax}},this.toArray=function(){return[this.id,this.affiliation,this.total,this.tax,this.shipping,this.city]},this},j=function(a,b){if(this.id=b?String(b):"",this.name=a.name?String(a.name):"",this.category=a.category?String(a.category):"",this.sku=a.sku?String(a.sku):"",this.price=a.price?String(a.price):"",this.quantity=a.quantity?String(a.quantity):"",!this.id)throw"Некорректный ID товара";if(!this.name)throw"Некорректное название товара";if(!this.price)throw"Некорректная цена товара";if(!this.quantity)throw"Некорректное количество товара";return this.toObject=function(){return{id:this.id,name:this.name,sku:this.sku,category:this.category,price:this.price,quantity:this.quantity}},this.toArray=function(){return[this.id,this.sku,this.name,this.category,this.price,this.quantity]},this},k=function(b,g){var h,k;try{h=new i(g.transaction),k=a.map(g.products,function(a){return new j(a,h.id)}),f()&&(d.push(["_addTrans"].concat(h.toArray())),a.each(k,function(a,b){d.push(["_addItem"].concat(b.toArray()))}),d.push(["_trackTrans"])),e()&&(c("require","ecommerce","ecommerce.js"),c("ecommerce:addTransaction",h.toObject()),c("secondary.ecommerce:addTransaction",h.toObject()),a.each(k,function(a,b){c("ecommerce:addItem",b.toObject()),c("secondary.ecommerce:addItem",b.toObject())}),c("ecommerce:send"),c("secondary.ecommerce:send"))}catch(l){}};b.on("trackGooglePageview",g),b.on("trackGoogleEvent",h),b.on("trackGoogleTransaction",k)}(jQuery),function(a){var b=$("body");b.on("click",".jsBuyButton",function(c){var d=$(c.currentTarget);b.trigger("TL_buyButton_clicked"),d.hasClass("mDisabled")&&c.preventDefault(),d.hasClass("mBought")&&(document.location.href(d.attr("href")),c.preventDefault()),d.addClass("mLoading");var e=d.attr("href"),f=a.utils.analytics.productPageSenders.get(d),g=a.utils.analytics.productPageSenders2.get(d);if(f&&JSON.stringify(f)!=JSON.stringify(d.data("sender")))for(var h in f)f.hasOwnProperty(h)&&(e=a.utils.setURLParam("sender["+h+"]",f[h],e));g&&g!=d.data("sender2")&&(e=a.utils.setURLParam("sender2",g,e)),$.ajax({url:e,type:"GET",success:function(a){var c=d.data("upsale")?d.data("upsale"):null,e=d.parents(".jsSliderItem").data("product");a.success&&(d.removeClass("mLoading"),a.product&&(a.product.isUpsale=e&&e.isUpsale?!0:!1,a.product.fromUpsale=c&&c.fromUpsale?!0:!1),a.location=d.data("location"),b.trigger("addtocart",[a,c]))},error:function(){d.removeClass("mLoading")}}),c.preventDefault()}),b.on("addtocart",function(c,d){var e=function(c,d){var e=d.product,f=function(){"undefined"!=typeof window.ga&&e.hasOwnProperty("isTchiboProduct")&&e.isTchiboProduct&&ga("tchiboTracker.send","event","Add2Basket",e.name,e.article)};if(e&&"undefined"!=typeof _gaq){f(),a.utils.sendAdd2BasketGaEvent(e.article,e.price,e.isOnlyFromPartner,e.isSlot,d.sender?d.sender.name:"");try{var g=d.sender;if(g&&"retailrocket"==g.name){var h="";a.config.pageConfig.product&&(a.config.pageConfig.product.isSlot?h="(marketplace-slot)":a.config.pageConfig.product.isOnlyFromPartner&&(h="(marketplace)")),b.trigger("trackGoogleEvent",["RR_взаимодействие "+h,"Добавил в корзину",g.position])}}catch(i){}}},f=function(a,b){var c=b.product;if("object"==typeof rcApi)try{rcApi.addToBasket(c.id)}catch(d){}};try{if(d.product&&(e(c,d),f(c,d)),d.products)for(var g in d.products)e(c,$.extend({},d,{product:d.products[g]}))}catch(h){}})}(window.ENTER),$(function(){var a,b,c="topbarfix_cmpr_popup-show";$("body").on("click",".jsCompareLink, .jsCompareListLink",function(d){var e=d.currentTarget.href,f=$(d.currentTarget),g=f.data("id"),h=f.hasClass("btnCmprb-act"),i=f.data("is-slot"),j=f.data("is-only-from-partner"),k="";-1!=ENTER.config.pageConfig.location.indexOf("listing")?k="listing":-1!=ENTER.config.pageConfig.location.indexOf("product")&&(k="product"),$(this).hasClass("jsCompareListLink")&&(e=h?ENTER.utils.generateUrl("compare.delete",{productId:g}):ENTER.utils.generateUrl("compare.add",{productId:g,location:k})),d.preventDefault(),$.ajax({url:e,success:function(d){if(d.compare&&(ENTER.UserModel.compare.removeAll(),$.each(d.compare,function(a,b){ENTER.UserModel.compare.push(b)}),!h)){if(!a){var e=ENTER.userBar.userBarFixed;a=$(".js-compare-addPopup",e),$(".js-compare-addPopup-closer",a).click(function(){a.removeClass(c)}),$(".js-topbarfixLogin, .js-topbarfixNotEmptyCart",e).mouseover(function(){a.removeClass(c)}),$("html").click(function(){a.removeClass(c)}),$(a).click(function(a){a.stopPropagation()}),$(document).keyup(function(b){27==b.keyCode&&a.removeClass(c)})}b&&clearTimeout(b),b=setTimeout(function(){a.removeClass(c)},2e3),$(".js-compare-addPopup-image",a).attr("src",d.product.imageUrl),$(".js-compare-addPopup-prefix",a).text(d.product.prefix),$(".js-compare-addPopup-webName",a).text(d.product.webName),ENTER.userBar.show(!0,function(){a.addClass(c)}),function(){var a;a=i?"marketplace-slot":j?"marketplace":"enter",k&&$("body").trigger("trackGoogleEvent",["Compare_добавление",a,k])}()}}})})}),function(){ENTER.counters={callGetIntentCounter:function(a){"undefined"==typeof __GetI&&(__GetI=[]),function(){var b={type:a.type,site_id:"267"};void 0!==a.productId&&(b.product_id=a.productId),void 0!==a.productPrice&&(b.product_price=a.productPrice),void 0!==a.categoryId&&(b.category_id=a.categoryId),void 0!==a.orderId&&(b.transaction_id=a.orderId),void 0!==a.orderProducts&&(b.order=a.orderProducts),void 0!==a.orderRevenue&&(b.revenue=a.orderRevenue),__GetI.push(b);var c="undefined"==typeof __GetI_domain?"px.adhigh.net":__GetI_domain,d=("https:"==document.location.protocol?"https://":"http://")+c+"/p.js",e=document.createElement("script");e.type="text/javascript",e.src=d;var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f)}()},callRetailRocketCounter:function(a,b){function c(c){try{if(c&&c.id&&(rrPartnerUserId=c.id),d.hasOwnProperty(a)){var e={userId:c?c.id||!1:null,hasUserEmail:c&&c.email?!0:!1};d[a](b,e)}}catch(f){}}var d={product:function(a,b){var c=function(){try{rcApi.view(a,b.userId?b:void 0)}catch(c){}};rrApiOnReady.push(c)},"product.category":function(a,b){var c=function(){try{rcApi.categoryView(a,b.userId?b:void 0)}catch(c){}};rrApiOnReady.push(c)},"order.complete":function(a,b){b.userId&&(a.userId=b.userId,a.hasUserEmail=b.hasUserEmail);var c=function(){try{rcApi.order(a)}catch(b){}};rrApiOnReady.push(c)}};ENTER.config.userInfo===!1?c():ENTER.config.userInfo?c(ENTER.config.userInfo.user):setTimeout(function(){ENTER.config.userInfo?c(ENTER.config.userInfo.user):setTimeout(arguments.callee,100)},100)}}}(),$(function(){function a(a){if(a.is("[type=checkbox]")||a.is("[type=radio]")){var b=a.attr("id"),c=a.is("[type=checkbox]")?"checkbox":"radio",d=a.attr("name")||"",e=$('label[for="'+b+'"]');e.length||(e=a.closest("label")),"checkbox"===c&&(a.is(":checked")?e.addClass("mChecked"):e.removeClass("mChecked")),"radio"===c&&(a.is(":checked")?($('input[name="'+d+'"]').each(function(){var a=$(this),b=a.attr("id"),c=$('label[for="'+b+'"]');c.length||(c=a.closest("label")),c.removeClass("mChecked")}),e.addClass("mChecked")):e.removeClass("mChecked"))}}var b=$("input.bCustomInput, .js-customInput"),c=$("body");c.on("change",".bCustomInput, .js-customInput",function(b){a($(b.currentTarget))}),b.each(function(b,c){a($(c))})}),function(){var a=function(){var a=$(this).data("goto");return $(document).stop().scrollTo($("#"+a),800),!1};$(document).ready(function(){$(".jsGoToId").bind("click",a)})}(),function(){$.ajax({url:"https://jira.enter.ru/s/ru_RU-istibo/773/3/1.2.4/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=2e17c5d6",type:"get",cache:!0,dataType:"script"}),window.ATL_JQ_PAGE_PROPS={triggerFunction:function(a){$("#jira").click(function(b){b.preventDefault(),a()})}}}(),$(function(){function a(a,c,d){var e=this;e.productId=a.id,e.productPrefix=a.prefix,e.productWebname=a.webname,e.productImageUrl=a.imageUrl,e.products=ko.observableArray([]),e.isBaseKit=ko.computed(function(){var b=!0;return ko.utils.arrayForEach(e.products(),function(c){a.kitProducts[c.id].count!=c.count()&&(b=!1)}),b}),e.totalPrice=ko.computed(function(){var a=0;return ko.utils.arrayForEach(e.products(),function(b){a+=parseInt(b.count())*parseInt(b.price)}),window.printPrice(a)}),e.totalCount=ko.computed(function(){var a=0;return ko.utils.arrayForEach(e.products(),function(b){a+=parseInt(b.count())}),a}),e.buyLink=ko.computed(function(){var a="/cart/set-products?",b=0;return ko.utils.arrayForEach(e.products(),function(c){c.count()>0&&(a+="product["+b+"][id]="+c.id+"&product["+b+"][quantity]="+c.count()+"&",b+=1)}),c&&(a+=$.param({sender:c})+"&"),d&&(a+=$.param({sender2:d})+"&"),a=a.slice(0,-1)}),e.dataUpsale=function(a){var b="/ajax/upsale/"+a;return ko.toJSON({url:b,fromUpsale:!1})},e.addProduct=function(a){e.products.push(new b(a))},e.populateWithObj=function(a){e.products($.map(a,function(a){return new b(a)})),e.products.sort(function(a,b){return a.line==b.line?0:a.line<b.line?-1:1})},e.resetToBaseKit=function(){e.populateWithObj(a.kitProducts)},e.populateWithObj(a.kitProducts)}function b(a){var b=this;b.id=a.id,b.url=a.url,b.name=a.name,b.price=a.price,b.image=a.image,b.height=a.height,b.width=a.width,b.depth=a.depth,b.count=ko.observable(a.count),b.maxCount=ko.observable(1/0),b.prettyPrice=ko.computed(function(){return window.printPrice(parseInt(b.price)*parseInt(b.count()))}),b.prettyItemPrice=ko.computed(function(){return window.printPrice(parseInt(b.price))}),b.deliveryDate=ko.observable(a.deliveryDate),b.plusClick=function(){b.maxCount()>b.count()&&b.count()<99&&(b.count(parseInt(b.count())+1),$.post("/ajax/product/delivery",{product:[{id:b.id,quantity:b.count()}]},function(a){a.success?b.deliveryDate(a.product[0].delivery[0].date.value):(b.count(b.count()-1),b.maxCount(b.count()))}))},b.minusClick=function(){b.count()>0&&b.count(b.count()-1)},b.countKeydown=function(a,b){b.stopPropagation();var c=b.target.selectionStart-b.target.selectionEnd!=0;if(38===b.which)return a.plusClick(),!1;if(40===b.which)return a.minusClick(),!1;if(39===b.which||37===b.which)return!0;if(b.which>=48&&b.which<=57||b.which>=96&&b.which<=105||8===b.which||46===b.which){if(!c){if(a.count().toString().length<2&&(8==b.which||46==b.which))return!1;if(a.count().toString().length>1&&8!=b.which&&46!=b.which)return!1}return!0}return!1},b.countKeyUp=function(a,c){return""===b.count()&&b.count(1),!1}}var c=$("body"),d=!1;c.on("click",".js-kitButton",function(b){if(b.preventDefault(),!d){var e=$(b.currentTarget);d=!0,$.ajax({url:ENTER.utils.generateUrl("product.kit",{productUi:e.data("product-ui")}),type:"POST",dataType:"json",closeClick:!1,success:function(b){$(".bCountSection").goodsCounter("destroy");var d=$(Mustache.render($("#tpl-cart-kitForm").html()));d.lightbox_me({autofocus:!0,destroyOnClose:!0}),ko.applyBindings(new a(b.product,ENTER.utils.analytics.productPageSenders.get(e),ENTER.utils.analytics.productPageSenders2.get(e)),d[0]),c.one("addtocart",function(){d.trigger("close.lme")})},complete:function(){d=!1}})}})}),$(document).ready(function(){var a={lastPartner:"",cookie:[]};try{a=$.parseJSON($("#lastPartnerJSON").html())}catch(b){}$(document.body).on("click",function(){a.lastPartner&&docCookies.setItem("last_partner",a.lastPartner,2592e3,"/"),$.each(a.cookie,function(a,b){docCookies.setItem(b.name,b.value,"undefined"!=typeof b.time?b.time:2592e3,"/")})})}),$(function(a){function b(b){$(".js-registerForm-socnetLink").each(function(c,d){var e=$(d);e.attr("href",a.utils.setURLParam("subscribe",b?"1":null,e.attr("href")))})}var c=$("#auth-block"),d=!0;$("body").on("click",".bAuthLink",function(e){if(e.preventDefault(),d){d=!1;var f=$(".js-registerForm-subscribe");a.config.userInfo.user.isSubscribedToActionChannel||f.attr("checked","checked"),b(f.length&&f[0].checked),f.change(function(a){b(a.currentTarget.checked)}),c.on("changeState",function(a,b){var c=$(this);if(b){var d=c.attr("data-state")?"state_"+c.attr("data-state"):null,e="state_"+b;d&&c.removeClass(d),c.addClass(e),c.attr("data-state",b)}$(".js-resetForm, .js-authForm, .js-registerForm").trigger("clearError")}),c.find(".js-link").on("click",function(a){var b=$(a.target),c=$(b.data("value").target),d=b.data("value").state;c.trigger("changeState",[d])}),$(".js-resetForm, .js-authForm, .js-registerForm").on("submit",function(a){var b=$(a.target),c=b.serializeArray();$.post(b.attr("action"),c).done(function(a){function d(a){for(var b=0;b<c.length;b++)if(c[b].name==a)return c[b].value;return null}if(b.hasClass("js-registerForm")&&d("subscribe")&&"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","subscription","subscribe_registration",d("register[email]")]),a.data&&a.data.link)return window.location.href=a.data.link?a.data.link:window.location.href,!0;b.trigger("clearError");var e=a.message;!e&&a.notice&&a.notice.message&&(e=a.notice.message),e&&b.find(".js-message").html(e),a.form&&a.form.error&&$.each(a.form.error,function(a,c){b.trigger("fieldError",[c])})}),a.preventDefault()}).on("fieldError",function(a,b){var c=$(a.target),d=c.find('[name*="'+b.field+'"]');d.length&&(d.prev(".js-fieldError").remove(),b.message&&d.before('<div class="js-fieldError bErrorText"><div class="bErrorText__eInner">'+b.message+"</div></div>"))}).on("clearError",function(){var a=$(this);a.find(".js-message").html(""),a.find("input").each(function(b,c){a.trigger("fieldError",[{field:$(c).attr("name")}])})}).on("focus","input",function(){var a=$(this);a.closest("form").trigger("fieldError",[{field:a.attr("name")}])}),$.mask.definitions.n="[0-9]",$(".js-registerForm .js-phoneField").mask("+7 (nnn) nnn-nn-nn");

}c.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){c.find("input:first").focus()},onClose:function(){c.trigger("changeState",["default"])}})})}(window.ENTER)),function(a){{var b,c,d,e=a(document.body),f=a("nav");a(".jsHamburgerIcon")}b=function(){var a="cachedData";return lscache&&"function"==typeof lscache.supported&&lscache.supported()?lscache:{set:function(b,c,d,e){e.data(a,c)},get:function(b,c){return c.data(a)?c.data(a):!1},remove:function(b,c){c.data(a,!1)}}},d=function(b,c){var d=b.find(".jsMenuRecommendation");a.each(c,function(a,b){try{if(!b.categoryId)return;var c=d.filter('[data-parent-category-id="'+b.categoryId+'"]');c.html(b.content)}catch(e){}})},c=new b,f.on("mouseenter",".navsite2_i",function(){a(this).find(".menuImgLazy").each(function(){a(this).attr("src",a(this).data("src"))})}),f.on("mouseenter",".navsite_i",function(){var b,e,f=a(this),g=f.data("recommendUrl"),h="xhrLoading",i=10;"string"==typeof g&&!f.data(h)==!0&&(b=-1===g.indexOf("?")?g:g.substring(0,g.indexOf("?")),c.get(b,f)?d(f,c.get(b,f)):(e=a.get(g),f.data(h,!0),e.done(function(a){var e=a.productBlocks;e&&(c.set(b,e,i,f),d(f,e))}).fail(function(){c.remove(b,f)}).always(function(){f.data(h,!1)})))}),e.on("click",".jsRecommendedItemInMenu",function(b){b.stopPropagation();try{var c=a(this),d=c.attr("href"),f="_blank"==c.attr("target"),g=c.data("sender");e.trigger("TLT_processDOMEvent",[b]),e.trigger("trackGoogleEvent",{category:"RR_взаимодействие",action:"Перешел на карточку товара",label:g?g.position:null,hitCallback:f?null:function(){d&&setTimeout(function(){window.location.href=d},90)}}),c.trigger("TL_recommendation_clicked")}catch(h){}}),e.on("click",".jsHamburgerIcon",function(){f.toggleClass("show")})}(jQuery),function(){var a=!1;$("body").on("click",".jsOneClickButton-new",function(b){function c(){ENTER.OrderV31Click.functions.initAddress(),ENTER.OrderV31Click.functions.initYandexMaps(),ENTER.OrderV31Click.functions.initDelivery(),ENTER.OrderV31Click.functions.initValidate()}function d(a){$(".js-order-oneclick-delivery-toggle-btn").on("click",function(a){var b=$(a.currentTarget),c=$(".js-order-oneclick-delivery-toggle-btn-note"),d=$(".js-order-oneclick-delivery-toggle");b.toggleClass("orderU_lgnd-tggl-cur"),d.toggle(),c.toggleClass("orderU_lgnd_tgglnote-cur"),$("body").trigger("trackUserAction",["2 Способ получения"])});var b=$("#js-order-content");if($(".shopsPopup").find(".close").trigger("click"),$(".jsOneClickCompletePage").remove(),$("#jsOneClickContentPage").show(),$.mask.definitions.x="[0-9]",$.mask.placeholder="_",$.mask.autoclear=!1,$.map($("#jsOneClickContent").find("input"),function(a,b){"undefined"!=typeof $(a).data("mask")&&$(a).mask($(a).data("mask"))}),f.length){var c=$.parseJSON(b.data("param"));c.quantity=e.data("quantity"),c.shopId=e.data("shop"),b.data("shop",c.shopId),f.lightbox_me({centered:!0,sticky:!1,closeSelector:".close",removeOtherOnCreate:!1,closeClick:!1,closeEsc:!1,onLoad:function(){$("#OrderV3ErrorBlock").empty().hide(),$(".jsOrderV3PhoneField").focus()},onClose:function(){a&&(f.remove(),$(".jsOneClickForm").remove()),$(".jsNewPoints").remove(),ENTER.OrderV31Click.koModels=[],ENTER.OrderV31Click.map.destroy()}}),$.ajax({url:b.data("url"),type:"POST",data:c,dataType:"json",beforeSend:function(){b.fadeOut(500)},closeClick:!1}).fail(function(a){var b=$.parseJSON(a.responseText);b.result&&b.result.errorContent&&$("#OrderV3ErrorBlock").html($(b.result.errorContent).html()).show()}).done(function(a){b.empty().html($(a.result.page).html()),a.result.warn&&$("#OrderV3ErrorBlock").text(a.result.warn).show(),$.each($(".jsNewPoints"),function(a,b){var c=ENTER.OrderV31Click,d=JSON.parse($(this).find("script.jsMapData").html()),e=new ENTER.DeliveryPoints(d.points,c.map);c.koModels.push(e),ko.applyBindings(e,b)}),ENTER.OrderV31Click.functions.initAddress(),b.find("input[name=address]").focus()}).always(function(){b.stop(!0,!0).fadeIn(200),$("body").trigger("trackUserAction",["0 Вход"])})}}if(b.preventDefault(),!a){var e=$(b.currentTarget),f=$("#jsOneClickContent");f.length?(d(!1),c()):(a=!0,$.ajax({url:ENTER.utils.generateUrl("orderV3OneClick.form",{productUid:e.data("product-ui"),sender:ENTER.utils.analytics.productPageSenders.get(e),sender2:ENTER.utils.analytics.productPageSenders2.get(e)}),type:"POST",dataType:"json",closeClick:!1,success:function(a){$("body").append(a.form),f=$("#jsOneClickContent"),d(!0),c()},complete:function(){a=!1}}))}})}(),function(a){var b=function(b,c,d,e){var f=this;f.inputVars={domID:b,totalPages:c,visPages:d?d:10,activePage:e?e:1};var g=a("#"+f.inputVars.domID),h=g.width(),i=h*f.inputVars.visPages/f.inputVars.totalPages,j=i/f.inputVars.visPages,k=h/f.inputVars.visPages,l=Math.round(f.inputVars.visPages/2),m=function(b){var c=Math.round(b/j);a(".bPaginator_eWrap",g).css("left",-(k*c))},n=function(){var b=!1,c=0,d=0;a(".bPaginatorSlider",g).bind("mousedown",function(e){c=e.pageX,d=parseInt(a(".bPaginatorSlider_eFill",g).css("left"),10),b=!0}),a(".bPaginatorSlider",g).bind("mouseup",function(){b=!1}),g.bind("mouseout",function(){b=!1}),a(".bPaginatorSlider",g).bind("mousemove",function(e){if(b){var f=d+(e.pageX-c);f>=0&&h-i>=f&&(a(".bPaginatorSlider_eFill",g).css("left",d+(e.pageX-c)),m(f))}})},o=function(){g.append('<div class="bPaginator_eWrap"></div>'),g.append('<div class="bPaginatorSlider"><div class="bPaginatorSlider_eWrap"><div class="bPaginatorSlider_eFill" style="width:'+i+'px"></div></div></div>');for(var b=0;b<f.inputVars.totalPages;b++)a(".bPaginator_eWrap",g).append('<a class="bPaginator_eLink" href="#'+b+'">'+(b+1)+"</a>"),b+1===f.inputVars.activePage&&a(".bPaginator_eLink",g).eq(b).addClass("active");var c=a(".bPaginator_eLink",g).width();a(".bPaginator_eLink",g).css({marginLeft:(k-c-2)/2,marginRight:(k-c-2)/2}),a(".bPaginator_eWrap",g).addClass("clearfix").width(k*f.inputVars.totalPages)};f.setActive=function(b){var c=parseInt(a(".bPaginator_eWrap",g).css("left"),10),d=parseInt(a(".bPaginatorSlider_eFill",g).css("left"),10),e=-1*Math.round(c/k),h=-(l-(b-e));a(".bPaginator_eLink",g).removeClass("active"),a(".bPaginator_eLink",g).eq(b).addClass("active"),c-h*k>0?(c=0,d=0):b>f.inputVars.totalPages-l?(c=Math.round(f.inputVars.totalPages-f.inputVars.visPages)*k*-1,d=Math.round(f.inputVars.totalPages-f.inputVars.visPages)*j):(c-=h*k,d+=h*j),a(".bPaginator_eWrap").animate({left:c}),a(".bPaginatorSlider_eFill",g).animate({left:d})},o(),n()};if(a("#promoCatalog").length){var c,d,e,f,g=a("body"),h=a("#promoCatalog"),i=h.data("slides"),j=i.length,k=new b("promoCatalogPaginator",j,12,1),l=void 0!==h.data("use-interval")?h.data("use-interval"):!1,m=null,n=0,o=0,p=void 0!==h.data("use-hash")?h.data("use-hash"):!0,q=500,r=void 0!==h.data("use-carousel")?h.data("use-carousel"):!1,s=0,t=!1,u="undefined"!=typeof h.data("analytics-config")?h.data("analytics-config"):!1,v="undefined"!=typeof h.data("category-token")?h.data("category-token"):"",w=!1,x=function(){var b,c;for(r&&(a(".bPromoCatalogSlider_eArrow.mArLeft").show(),a(".bPromoCatalogSlider_eArrow.mArRight").show()),b=0;b<i.length;b++){c=tmpl("slide_tmpl",i[b]),a(c).length&&(c=a(c).attr("id","slide_id_"+b));var d=a(c).appendTo(".bPromoCatalogSliderWrap");ko.applyBindings(ENTER.UserModel,d[0]),""===a(".bPromoCatalogSliderWrap_eSlideLink").eq(b).attr("href")&&a(".bPromoCatalogSliderWrap_eSlideLink").eq(b).removeAttr("href"),a(".bPromoCatalogNav").append('<a id="promoCatalogSlide'+b+'" href="#'+b+'" class="bPromoCatalogNav_eLink">'+(1*b+1)+"</a>")}e=a(".bPromoCatalogSliderWrap_eSlide").width(),f=a(".bPromoCatalogSliderWrap").width(e*j+(470-e/2))},y=function F(a){var b=3e3,c=0;l&&(void 0==a?a=0:c=q,i.hasOwnProperty(a)&&i[a].hasOwnProperty("time")&&(b=i[a].time),b+=c,m=setTimeout(function(){a++,r||a>=j&&(a=0),D(a),F(a)},b))},z=function(){m&&clearTimeout(m)},A=function(b){var c=a(this).hasClass("mArLeft")?"-1":"1",d=o+1*c;return b.preventDefault(),t?!1:(z(),D(d),void y(d))},B=function(b){var c;return b.preventDefault(),a(this).hasClass("active")?!1:t?!1:(c=1*a(this).attr("href").slice(1),z(),r?C(c):D(c),void y(c))},C=function(b){var c,d=a(".jsPromoCatalogSliderWrap"),e=a(".bPromoCatalogSliderWrap_eSlide",d);void 0===b&&(b=0),c=e.index(a("#slide_id_"+b,d)),D(c)},D=function(b){var c,f=a(".bPromoCatalogSlider_eArrow.mArLeft"),g=a(".bPromoCatalogSlider_eArrow.mArRight"),h=a(".jsPromoCatalogSliderWrap"),i=function(){var b=a(".bPromoCatalogSliderWrap_eSlide",h);c=b.last(),b.last().remove(),h.prepend(c),h.css({left:h.position().left-e})},l=function(){var b=a(".bPromoCatalogSliderWrap_eSlide",h);c=b.first(),b.first().remove(),h.append(c),h.css({left:h.position().left+e})};d=b,o=b,r?(b>j-1?(l(),s++,b=0,o=j-1):0>b&&(i(),s--,b=j-1,o=0),d=a(".jsPromoCatalogSliderWrap .bPromoCatalogSliderWrap_eSlide").eq(o).attr("id").replace("slide_id_","")):(0===b?f.hide():f.show(),b===j-1?g.hide():g.show()),t=!0,a(".bPromoCatalogSliderWrap").animate({left:-(e*o)},q,function(){t=!1}),k.setActive(d),p&&(window.location.hash="slide"+(1*d+1))},E={init:function(){if(E.isAnalyticsEnabled){var b=function(){var b,c,d=a(this),e=d.parent(".bPromoCatalogSliderWrap_eSlide");e.length&&e.attr("id")&&(b=e.attr("id").replace("slide_id_",""),c=i[b])},c=function(){var b,c,d,e,f=a(this),g=f.parents(".bPromoCatalogSliderWrap_eSlide");g.length&&g.attr("id")&&(b=g.attr("id"),c=b.replace("slide_id_",""),d=i[c],e=a(".mTchiboSlider #"+b+" .prodItem > a").index(this))};E.checkRule("collection_click")&&g.on("click",".mTchiboSlider .bPromoCatalogSliderWrap_eSlideLink",b),E.checkRule("product_click")&&g.on("click",".mTchiboSlider .prodItem > a",c),E.pageVisibility()}},pageVisibility:function(){var a,b,c=function(){w=document[a]?!0:!1};E.isAnalyticsEnabled&&u.hasOwnProperty("use_page_visibility")&&1==u.use_page_visibility&&("undefined"!=typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange"),c(),"undefined"==typeof document.addEventListener||"undefined"==typeof a||document.addEventListener(b,c,!1))},isAnalyticsEnabled:function(){return u&&u.hasOwnProperty("enabled")&&1==u.enabled},checkRule:function(a){return E.isAnalyticsEnabled&&"undefined"!=typeof a&&u.hasOwnProperty(a)&&1==u[a].enabled&&(1==u[a].tchiboOnly&&"tchibo"===v||1!=u[a].tchiboOnly)?!0:!1}};a(function(){x(),E.init(),g.on("click",".bPromoCatalogSlider_eArrow",A),g.on("click",".bPaginator_eLink",B),p&&(c=window.location.hash,c.indexOf("slide")+1&&(n=parseInt(c.slice(6),10)-1,D(n))),y(n)})}}(jQuery),function(a){function b(){return Boolean(parseInt(docCookies.getItem("geoshop")))}function c(b,c){a.ajax({url:i.data("autocomplete-url"),dataType:"json",data:{q:b},success:function(a){c&&c(a.data.slice(0,15))}})}var d,e,f,g,h=a("body"),i=a(".jsRegionPopup");d=function(){0==i.length?a.get("/region/init").done(function(b){b.result&&(i=a(b.result),h.append(i),f(i.find("#jscity")),e())}):e(),"/"===document.location.pathname&&h.trigger("trackGoogleEvent",[{category:"citySelector",action:"viewed",nonInteraction:!0}])},g=function(a,b){h.trigger("trackGoogleEvent",{category:"citySelector",action:"selected",label:a,hitCallback:b})},e=function(){var c=i.data("autoresolve-url"),d=a(".jsAutoresolve",i);null==c||d.length||a.ajax({type:"GET",url:c,success:function(b){if(!b.data.length)return d.html(""),!1;var c=b.data[0].url,e=b.data[0].name,f=b.data[0].id;return 14974===f||108136===f?!1:void(d.length?d.html('<a href="'+c+'">'+e+"</a>"):a(".jsCityInline",i).prepend('<div class="cityItem mAutoresolve jsAutoresolve"><a href="'+c+'">'+e+"</a></div>"))}}),i.lightbox_me({autofocus:!0,onLoad:function(){i.find("#jscity").putCursorAtEnd()},onClose:function(){b()||docCookies.setItem("geoshop",i.data("current-region-id"),31536e3,"/")}})},f=function(b){var d=i.find("#jschangecity");b.autocomplete({autoFocus:!0,appendTo:"#jscities",source:function(b,d){c(b.term,function(b){d(a.map(b,function(a){return{label:a.name,value:a.name,url:a.url}}))})},minLength:2,select:function(a,b){d.data("url",b.item.url).removeClass("mDisabled").removeAttr("disabled")},open:function(){a(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){a(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})},h.on("click",".jsChangeRegion",function(a){a.preventDefault(),d()}),h.on("click",".jsRegionListMoreCity",function(b){b.preventDefault(),a(this).toggleClass("mExpand"),i.find(".jsRegionSlidesWrap").slideToggle(300)}),h.on("click",".jsRegionInputClear",function(a){a.preventDefault(),i.find("#jscity").val(""),i.find("#jschangecity").addClass("mDisabled").attr("disabled","disabled")}),h.on("click",".jsRegionArrow",function(){var b,c=a(this).data("dir"),d=i.find(".jsRegionSlidesHolder"),e=i.find(".jsRegionArrowLeft"),f=i.find(".jsRegionArrowRight"),g=d.width(),h=i.find(".jsRegionOneSlide").width();d.animate({left:c+"="+h},function(){b=parseInt(d.css("left"),10),0>b&&e.show(),0==b&&e.hide(),h-b==g&&f.hide(),g>h-b&&f.show()})}),h.on("click","#jschangecity",function(b){b.preventDefault();var d=a(this).data("url"),e=i.find("#jscity"),f=e.val();d?g(f,d):(ENTER.utils.trim(e[0].defaultValue)!=ENTER.utils.trim(f)&&c(f,function(a){a[0]&&a[0].url&&(location=a[0].url)}),i.trigger("close"))}),h.on("click",".jsChangeRegionLink",function(b){g(a(this).text(),a(this).attr("href")),b.preventDefault()}),b()||d()}(jQuery),function(){var a;$.ajaxSetup({error:function(b,c,d){if(403==b.status){if(a=$("#auth-block"),!a.length)return;a.lightbox_me({centered:!0,autofocus:!0,onLoad:function(){a.find("input:first").focus()}})}}})}(),function(){var a=$("body"),b="subscribed",c=function(a){var c=$(".bSubscribeLightboxPopup"),d=$(".bSubscribeLightboxPopup__eInput"),e=$(".bSubscribeLightboxPopup__eBtn"),f={show:!window.docCookies.hasItem(b),agreed:1===window.docCookies.getItem(b)},g=new FormValidator({fields:[{fieldNode:d,customErr:"Неправильный емейл",require:!0,validBy:"isEmail"}]}),h=function(){var a=d.val(),b=$(this).data("url"),f=function(a){return a.success?(c.html('<span class="bSubscribeLightboxPopup__eTitle mType">Спасибо! подтверждение подписки отправлено на указанный e-mail</span>'),window.docCookies.setItem("subscribed",1,15768e4,"/"),setTimeout(function(){c.slideUp(300)},3e3),void("undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","Account","Emailing sign up","Page top"]))):!1};return e.hasClass("mDisabled")?!1:(g.validate({onInvalid:function(a){},onValid:function(){$.post(b,{email:a},f)}}),!1)},i=function(){var a=$(".bSubscribeLightboxPopup__eNotNow"),b=function(a){a.preventDefault(),c.slideUp(300),window.docCookies.setItem("subscribed",0,15768e4,"/")};c.slideDown(300),e.bind("click",h),a.off("click"),a.bind("click",b)};return d.placeholder(),f.show?void i():!1};a.bind("showsubscribe",c),a.trigger("showsubscribe")}(),function(){$(".js-siteVersionSwitcher").click(function(a){a.preventDefault();var b=window.location.host,c=b.split(".");c.length>2&&(b=c[c.length-2]+"."+c[c.length-1]);var d=$(a.currentTarget).data("config");document.cookie=d.cookieName+"=1; expires="+new Date(Date.now()+1e3*d.cookieLifetime).toUTCString()+"; domain="+b+"; path=/",location=a.currentTarget.href})}(),$(document).ready(function(){var a=$("body");a.on("click",".jsRecommendedItem",function(b){try{var c=$(this),d=$(b.target),e=c.attr("href"),f=c.attr("target"),g=c.parents(".js-slider"),h=g.length?g.data("slider").sender:null;if(a.trigger("TLT_processDOMEvent",[b]),!d.hasClass("js-orderButton")){var i="";ENTER.config.pageConfig.product&&(ENTER.config.pageConfig.product.isSlot?i="_marketplace-slot":ENTER.config.pageConfig.product.isOnlyFromPartner&&(i="_marketplace")),a.trigger("trackGoogleEvent",{category:"RR_взаимодействие"+i,action:"Перешел на карточку товара",label:h?h.position:null,hitCallback:"_blank"==f?null:e})}b.stopPropagation()}catch(j){}}),a.on("click",".jsRecommendedSliderNav",function(b){try{var c=$(this),d=c.parents(".js-slider"),e=d.length?d.data("slider").sender:null,f="";ENTER.config.pageConfig.product&&(ENTER.config.pageConfig.product.isSlot?f="(marketplace-slot)":ENTER.config.pageConfig.product.isOnlyFromPartner&&(f="(marketplace)")),a.trigger("trackGoogleEvent",["RR_взаимодействие "+f,"Пролистывание",e.position])}catch(g){}});try{$(".js-slider").each(function(a,b){var c=$(b).data("slider"),d=docCookies.getItem("product_viewed")||"";"viewed"==c.type&&"string"==typeof d&&(c.rrviewed=ENTER.utils.arrayUnique(d.split(",")),$(b).data("slider",c))})}catch(b){}a.on("mouseenter",".slideItem_i",function(a){var b=$(this),c=b.parents(".js-slider").find(".slideItem_flt");c.length&&(c.find(".slideItem_flt_i").text(b.data("product").name),c.addClass("slideItem_flt-show"),c.offset({left:b.offset().left}))}),a.on("mouseleave",".slideItem_i",function(a){var b=$(this),c=b.parents(".js-slider").find(".slideItem_flt");c.length&&(c.find(".slideItem_flt_i").text(""),c.removeClass("slideItem_flt-show"))})}),$(function(){var a=$("body"),b="lbl-error",c=(ENTER.config.pageConfig.user.region.name,ENTER.utils.getCategoryPath()),d=function(a){var c=a.closest(".js-slotButton-popup-element");c.find(".js-slotButton-popup-element-field").addClass(b),c.find(".js-slotButton-popup-element-error").show()},e=function(a){var c=a.closest(".js-slotButton-popup-element");c.find(".js-slotButton-popup-element-field").removeClass(b),c.find(".js-slotButton-popup-element-error").hide()},f=function(a,b){var c=$(".js-slotButton-popup-phone",a);return/\+7\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(c.val().replace(/\s+/g,""))?(e(c),!0):(b||d(c),!1)},g=function(a,b){var c=$(".js-slotButton-popup-email",a);return 0==c.val().length||ENTER.utils.validateEmail(c.val())?(e(c),!0):(b||d(c),!1)},h=function(a,b){var c=$(".js-slotButton-popup-confirm",a);return c[0].checked?(e(c),!0):(b||d(c),!1)},i=function(a){var b=!0;return f(a)||(b=!1),g(a)||(b=!1),h(a)||(b=!1),b};a.on("click",".js-slotButton",function(b){b.preventDefault();var d=$(this),e=ENTER.utils.analytics.productPageSenders.get(d),j=ENTER.utils.analytics.productPageSenders2.get(d),k=d.data("product-article"),l=d.data("product-price"),m=$(Mustache.render($("#tpl-cart-slot-form").html(),{orderCreateUrl:ENTER.utils.generateUrl("order.slot.create"),full:d.data("full"),partnerName:d.data("partner-name"),partnerOfferUrl:d.data("partner-offer-url"),productUrl:d.data("product-url"),productId:d.data("product-id"),sender:JSON.stringify(e),sender2:j,userPhone:String(ENTER.utils.Base64.decode(ENTER.config.userInfo.user.mobile||"")).replace(/^8/,"+7"),userEmail:ENTER.config.userInfo.user.email||"",userName:ENTER.config.userInfo.user.firstName||""})),n=$("form",m),o=$(".js-slotButton-popup-errors",n),p=$(".js-slotButton-popup-phone",n),q=$(".js-slotButton-popup-email",n),r=$(".js-slotButton-popup-name",n),s=$(".js-slotButton-popup-confirm",n),t=$(".js-slotButton-popup-goToProduct",n);m.lightbox_me({centered:!0,sticky:!0,closeClick:!1,closeEsc:!1,closeSelector:".js-slotButton-popup-close",destroyOnClose:!0}),$.mask.definitions.x="[0-9]",$.mask.placeholder="_",$.mask.autoclear=!1,$.map($("input",m),function(a,b){var c=$(a);"undefined"!=typeof c.data("mask")&&c.mask(c.data("mask"))}),p.blur(function(){f(n)}),p.keyup(function(){f(n,!0)}),q.blur(function(){g(n)}),q.keyup(function(){g(n,!0)}),s.click(function(){h(n,!0)}),n.submit(function(b){if(b.preventDefault(),o.empty().hide(),!i(n))return void a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","7_1 Оформить ошибка",c]);var d=$(".js-slotButton-popup-submitButton",n);d.attr("disabled","disabled"),$.ajax({type:"POST",url:n.attr("action"),data:n.serializeArray(),success:function(b){return b.error?(o.text(b.error).show(),void a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","7_1 Оформить ошибка",c])):(n.after($(Mustache.render($("#tpl-cart-slot-form-result").html(),{orderNumber:b.orderNumber}))),n.remove(),$(".js-slotButton-popup-okButton",m).click(function(){m.trigger("close")}),a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","7 Оформить успешно",c]),void("function"==typeof ENTER.utils.sendOrderToGA&&b.orderAnalytics&&ENTER.utils.sendOrderToGA(b.orderAnalytics)))},error:function(){o.text("Ошибка при создании заявки").show(),a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","7_1 Оформить ошибка",c])},complete:function(){d.removeAttr("disabled")}})}),ENTER.utils.sendAdd2BasketGaEvent(k,l,!0,!0,(d.data("sender")||{}).name),a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","1 Вход",c]),p.focus(function(){a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","2 Телефон",c])}),q.focus(function(){a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","3 Email",c])}),r.focus(function(){a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","4 Имя",c])}),s.click(function(b){b.currentTarget.checked&&a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","5 Оферта",c])}),t.click(function(b){a.trigger("trackGoogleEvent",["Воронка_marketplace-slot","6 Перейти в карточку",c])}),p.focus()})}),function(){if(/catalog\/tchibo/.test(document.location.href)&&window.history&&window.history.replaceState){var a=window.history;$(window).on("beforeunload",function(){a.replaceState({pageYOffset:pageYOffset},"")}),a&&a.state&&a.state.pageYOffset&&window.scrollTo(0,a.state.pageYOffset)}}(),function(){function a(){var a=ENTER.UserModel.cart().length;!e&&c.scrollTop()>f&&(!g||a)?(e=!0,d.animate({marginTop:"0"},400)):e&&(c.scrollTop()<f||g&&!a)&&(e=!1,d.animate({marginTop:"-55px"},400))}var b=$("body"),c=$(window),d=$(".js-upper"),e=!1,f=d.data("offset"),g=d.data("showWhenFullCartOnly");if("string"==typeof f){var h=$(f);h.length&&(f=h.offset().top)}d.bind("click",function(){return c.scrollTo("0px",400),!1}),c.scroll(a),b.on("closeBuyInfo showBuyInfo",function(){a()}),a()}(),function(a){function b(a,b){$.each(q,function(){this.removeClass(r)}),a?o.show(0,b||function(){}):o.slideDown(),o.length&&p.css("visibility","hidden")}function c(){o.slideUp(),p.css("visibility","visible")}function d(d){w||(k&&k.length&&v.scrollTop()>=k.offset().top&&!d&&(!y||a.UserModel.cart().length)?b():c())}function e(){return $.scrollTo(l,500),a.catalog.filter.openFilter(),!1}function f(){function a(){var a=$(".topbarfix_cartOn");a.length&&a.slideUp(300,function(){a.removeAttr("style")})}function b(){return x&&n.showOverlay?void x.fadeOut(100,function(){x.off("click"),x.remove(),n.showOverlay=!1,w=!1,d()}):void d()}var c=o.find(".topbarfix_cart"),e=o.find(".topbarfix_log"),f="mOpenedPopup",g=c.find(".hintDd");return u.trigger("closeBuyInfo"),g.hasClass("mhintDdOn")?(g.removeClass("mhintDdOn"),e.removeClass(f),c.removeClass(f),a(),b(),!1):(a(),void b())}function g(a,c,d){u.trigger("showBuyInfo"),$.each(q,function(){this.removeClass(r)});var e=$(".topbarfix_cartOn");!n.showOverlay&&x&&(u.append(x),x.fadeIn(300),n.showOverlay=!0,x.on("click",f)),a?e.slideDown(300):e.show(),b(!0),d&&i(c,d),w=!0,$(document.body).trigger("showUserCart")}function h(){var b=$(this);return $.ajax({type:"GET",url:b.attr("href"),success:function(b,c){b.success&&(a.UserModel.removeProductByID(b.product.id),$(".js-basketLineDeleteLink-"+b.product.id).click(),0==a.UserModel.cart().length?f():g(),u.trigger("removeFromCart",[b.product]))}}),!1}function i(b,c){function d(c){if(c.success&&n.showOverlay&&(g.find(".js-slider").remove(),e=$(c.content)[0],g.append(e),g.addClass("mhintDdOn"),$(e).goodsSlider(),ko.applyBindings(a.UserModel,e),b.product&&b.product.article&&c.data))try{rrApi.recomTrack(c.data.method,c.data.id,c.data.recommendations)}catch(d){}}var e,f=o.find(".topbarfix_cart"),g=f.find(".hintDd");if(c.url){var h=c.url,i="";a.config.pageConfig.product&&(a.config.pageConfig.product.isSlot?i="slot":a.config.pageConfig.product.isOnlyFromPartner&&(i="marketplace")),i&&(h=a.utils.setURLParam("sender2",i,h)),$.ajax({type:"GET",url:h,success:d})}}function j(a,b,c){if(a.stopPropagation(),!q[b]){var d=$(".js-compare-popup",c);$(".js-compare-popup-closer",d).click(function(){d.removeClass(r)}),$(".js-topbarfixLogin, .js-topbarfixNotEmptyCart",c).mouseover(function(){d.removeClass(r)}),$("html").click(function(){d.removeClass(r)}),$(d).click(function(a){a.stopPropagation()}),$(document).keyup(function(a){27==a.keyCode&&d.removeClass(r)}),q[b]=d}$(".mhintDdOn").length||q[b].addClass(r)}var k,l,m=a.utils,n=m.extendApp("ENTER.userBar"),o=n.userBarFixed=$(".js-topbar-fixed"),p=n.userBarStatic=$(".js-topbar-static"),q={},r="topbarfix_cmpr_popup-show",s=o.find(".js-userbar-upLink"),t=o.data("value"),u=$("body"),v=$(window),w=!1,x=$("<div>").css({position:"fixed",display:"none",width:"100%",height:"100%",top:0,left:0,zIndex:900,background:"black",opacity:.4}),y=t&&t.showWhenFullCartOnly;n.showOverlay=!1,n.show=b,u.on("click",".jsCartDelete",h),$(".js-noProductsForCompareLink",o).click(function(a){j(a,"fixed",o)}),$(".js-noProductsForCompareLink",p).click(function(a){j(a,"static",p)}),o.length?("/cart"!==window.location.pathname&&u.on("addtocart",g),k=$(t.target),l=t.filterTarget?$(t.filterTarget):k,s.length&&s.on("click",e),k.length?v.on("scroll",function(){d()}):v.on("scroll",function(){d(!0)}),d()):(x.remove(),x=!1)}(window.ENTER);