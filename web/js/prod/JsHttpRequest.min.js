function JsHttpRequest(){var t=this;t.onreadystatechange=null,t.readyState=0,t.responseText=null,t.responseXML=null,t.status=200,t.statusText="OK",t.responseJS=null,t.caching=!1,t.loader=null,t.session_name="PHPSESSID",t._ldObj=null,t._reqHeaders=[],t._openArgs=null,t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%"},t.abort=function(){with(this){if(_ldObj&&_ldObj.abort&&_ldObj.abort(),_cleanup(),0==readyState)return;if(1==readyState&&!_ldObj)return readyState=0,void 0;_changeReadyState(4,!0)}},t.open=function(_2,_3,_4,_5,_6){with(this){_3.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)&&(this.loader=RegExp.$2?RegExp.$2:null,_2=RegExp.$3,_3=RegExp.$4);try{(document.location.search.match(RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)")))&&(_3+=(_3.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1))}catch(e){}return _openArgs={method:(_2||"").toUpperCase(),url:_3,asyncFlag:_4,username:null!=_5?_5:"",password:null!=_6?_6:""},_ldObj=null,_changeReadyState(1,!0),!0}},t.send=function(e){if(this.readyState){this._changeReadyState(1,!0),this._ldObj=null;var t=[],a=[];if(this._hash2query(e,null,t,a)){var r=null;if(this.caching&&!a.length){r=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+t+"#"+this._openArgs.method;var o=JsHttpRequest.CACHE[r];if(o)return this._dataReady(o[0],o[1]),!1}var n=(this.loader||"").toLowerCase();if(n&&!JsHttpRequest.LOADERS[n])return this._error("unk_loader",n);var i=[],s=JsHttpRequest.LOADERS;for(var l in s){var d=s[l].loader;if(d&&(!n||l==n)){var u=new d(this);JsHttpRequest.extend(u,this._openArgs),JsHttpRequest.extend(u,{queryText:t.join("&"),queryElem:a,id:(new Date).getTime()+""+JsHttpRequest.COUNT++,hash:r,span:null});var p=u.load();if(!p)return this._ldObj=u,JsHttpRequest.PENDING[u.id]=this,!0;if(n)return this._error(p);i[i.length]="- "+l.toUpperCase()+": "+this._l(p)}}return l?this._error("no_loader_matched",i.join("\n")):this._error("no_loaders")}}},t.getAllResponseHeaders=function(){with(this)return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[]},t.getResponseHeader=function(_13){with(this)return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(_13):null},t.setRequestHeader=function(_14,_15){with(this)_reqHeaders[_reqHeaders.length]=[_14,_15]},t._dataReady=function(_16,js){with(this)caching&&_ldObj&&(JsHttpRequest.CACHE[_ldObj.hash]=[_16,js]),responseText=responseXML=_16,responseJS=js,null!==js?(status=200,statusText="OK"):(status=500,statusText="Internal Server Error"),_changeReadyState(2),_changeReadyState(3),_changeReadyState(4),_cleanup()},t._l=function(e){for(var t=0,a=0,r=this._errors[e[0]];(a=r.indexOf("%",a))>=0;){var o=e[++t]+"";r=r.substring(0,a)+o+r.substring(a+1,r.length),a+=1+o.length}return r},t._error=function(e){throw e=this._l("string"==typeof e?arguments:e),e="JsHttpRequest: "+e,window.Error?"test"==Error(1,"test").description?Error(1,e):Error(e):e},t._hash2query=function(e,t,a,r){if(null==t&&(t=""),"object"==(""+typeof e).toLowerCase()){var o=!1;e&&e.parentNode&&e.parentNode.appendChild&&e.tagName&&"FORM"==e.tagName.toUpperCase()&&(e={form:e});for(var n in e){var i=e[n];if(!(i instanceof Function)){var s=t?t+"["+this.escape(n)+"]":this.escape(n),l=i&&i.parentNode&&i.parentNode.appendChild&&i.tagName;if(l){var d=i.tagName.toUpperCase();if("FORM"==d)o=!0;else if("INPUT"!=d&&"TEXTAREA"!=d&&"SELECT"!=d)return this._error("inv_form_el",i.name||"",i.tagName);r[r.length]={name:s,e:i}}else if(i instanceof Object)this._hash2query(i,s,a,r);else{if(null===i)continue;i===!0&&(i=1),i===!1&&(i=""),a[a.length]=s+"="+this.escape(""+i)}if(o&&r.length>1)return this._error("must_be_single_el")}}}else a[a.length]=e;return!0},t._cleanup=function(){var e=this._ldObj;if(e){JsHttpRequest.PENDING[e.id]=!1;var t=e.span;if(t){e.span=null;var a=function(){t.parentNode.removeChild(t)};JsHttpRequest.setTimeout(a,50)}}},t._changeReadyState=function(s,_2c){with(this)_2c&&(status=statusText=responseJS=null,responseText=""),readyState=s,onreadystatechange&&onreadystatechange()},t.escape=function(e){return escape(e).replace(RegExp("\\+","g"),"%2B")}}JsHttpRequest.COUNT=0,JsHttpRequest.MAX_URL_LEN=2e3,JsHttpRequest.CACHE={},JsHttpRequest.PENDING={},JsHttpRequest.LOADERS={},JsHttpRequest._dummy=function(){},JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout},JsHttpRequest.setTimeout=function(e,t){if(window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s,"string"==typeof e)a=window.JsHttpRequest_tmp(e,t);else{var a=null,r=function(){e(),delete JsHttpRequest.TIMEOUTS[a]};a=window.JsHttpRequest_tmp(r,t),JsHttpRequest.TIMEOUTS[a]=r}return window.JsHttpRequest_tmp=null,a},JsHttpRequest.clearTimeout=function(e){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c,delete JsHttpRequest.TIMEOUTS[e];var t=window.JsHttpRequest_tmp(e);return window.JsHttpRequest_tmp=null,t},JsHttpRequest.query=function(e,t,a,r){var o=new this;o.caching=!r,o.onreadystatechange=function(){4==o.readyState&&a(o.responseJS,o.responseText)},o.open(null,e,!0),o.send(t)},JsHttpRequest.dataReady=function(e){var t=this.PENDING[e.id];if(delete this.PENDING[e.id],t)t._dataReady(e.text,e.js);else if(t!==!1)throw"dataReady(): unknown pending id: "+e.id},JsHttpRequest.extend=function(e,t){for(var a in t)e[a]=t[a]},JsHttpRequest.LOADERS.xml={loader:function(req){JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryElem.length)return["xml_no_form_upl"];if(this.url.match(RegExp("^([a-z]+://[^\\/]+)(.*)","i"))&&RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase())return["xml_no_diffdom",RegExp.$1];var xr=null;if(window.XMLHttpRequest)try{xr=new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{xr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(!xr)try{xr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}if(!xr)return["xml_no"];var _40=window.ActiveXObject||xr.setRequestHeader;if(this.method||(this.method=_40&&this.queryText.length?"POST":"GET"),"GET"==this.method){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.queryText="",this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN]}else if("POST"==this.method&&!_40)return["xml_no_headers"];this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";var id=this.id;if(xr.onreadystatechange=function(){if(4==xr.readyState){xr.onreadystatechange=JsHttpRequest._dummy,req.status=null;try{req.status=xr.status,req.responseText=xr.responseText}catch(e){}if(req.status){try{var _42=req.responseText||"{ js: null, text: null }";eval("JsHttpRequest._tmp = function(id) { var d = "+_42+"; d.id = id; JsHttpRequest.dataReady(d); }")}catch(e){return req._error("js_invalid",req.responseText)}JsHttpRequest._tmp(id),JsHttpRequest._tmp=null}}},xr.open(this.method,this.url,!0,this.username,this.password),_40){for(var i=0;req._reqHeaders.length>i;i++)xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);xr.setRequestHeader("Content-Type","application/octet-stream")}return xr.send(this.queryText),this.span=null,this.xr=xr,null},this.getAllResponseHeaders=function(){return this.xr.getAllResponseHeaders()},this.getResponseHeader=function(e){return this.xr.getResponseHeader(e)},this.abort=function(){this.xr.abort(),this.xr=null}}},JsHttpRequest.LOADERS.script={loader:function(e){JsHttpRequest.extend(e._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-"+"script",this.queryText="",this.method||(this.method="GET"),"GET"!==this.method)return["script_only_get"];if(this.queryElem.length)return["script_no_form"];if(this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var e=this,t=document,a=null,r=t.body;if(window.opera){this.span=a=t.createElement("SPAN"),a.style.display="none",r.insertBefore(a,r.lastChild),a.innerHTML="Workaround for IE.<script></script>";var o=function(){a=a.getElementsByTagName("SCRIPT")[0],a.language="JavaScript",a.setAttribute?a.setAttribute("src",e.url):a.src=e.url}}else{this.span=a=t.createElement("SCRIPT");var o=function(){a.language="JavaScript",a.setAttribute?a.setAttribute("src",e.url):a.src=e.url,r.insertBefore(a,r.lastChild)}}return JsHttpRequest.setTimeout(o,10),null}}},JsHttpRequest.LOADERS.form={loader:function(e){JsHttpRequest.extend(e._errors,{form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'}),this.load=function(){var e=this;if(e.method||(e.method="POST"),e.url+=(e.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+e.id+"-"+"form","GET"==e.method){if(e.queryText&&(e.url+=(e.url.indexOf("?")>=0?"&":"?")+e.queryText),e.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var t=e.url.split("?",2);e.url=t[0],e.queryText=t[1]||""}var a=null,r=!1;if(e.queryElem.length){if("FORM"==e.queryElem[0].e.tagName.toUpperCase())a=e.queryElem[0].e,r=!0,e.queryElem=[];else{a=e.queryElem[0].e.form;for(var o=0;e.queryElem.length>o;o++){var n=e.queryElem[o].e;if(!n.form)return["form_el_not_belong",n.name];if(n.form!=a)return["form_el_belong_diff",n.name]}}if("POST"==e.method){var i="multipart/form-data",s=a.attributes.encType&&a.attributes.encType.nodeValue||a.attributes.enctype&&a.attributes.enctype.value||a.enctype;if(s!=i)return["form_el_inv_enctype",i,s]}}var l=a&&(a.ownerDocument||a.document)||document,d="jshr_i_"+e.id,u=e.span=l.createElement("DIV");u.style.position="absolute",u.style.display="none",u.style.visibility="hidden",u.innerHTML=(a?"":"<form"+("POST"==e.method?' enctype="multipart/form-data" method="post"':"")+"></form>")+'<iframe name="'+d+'" id="'+d+'" style="width:0px; height:0px; overflow:hidden; border:none"></iframe>',a||(a=e.span.firstChild),l.body.insertBefore(u,l.body.lastChild);var p=function(e,t){var a=[],r=e;if(e.mergeAttributes){var r=l.createElement("form");r.mergeAttributes(e,!1)}for(var o=0;t.length>o;o++){var n=t[o][0],i=t[o][1];"target"==n?(a[a.length]=[n,r.target],r.target=i):(a[a.length]=[n,r.getAttribute(n)],r.setAttribute(n,i))}return e.mergeAttributes&&e.mergeAttributes(r,!1),a},c=function(){top.JsHttpRequestGlobal=JsHttpRequest;var t=[];if(!r)for(var o=0,n=a.elements.length;n>o;o++)t[o]=a.elements[o].name,a.elements[o].name="";for(var i=e.queryText.split("&"),o=i.length-1;o>=0;o--){var s=i[o].split("=",2),u=l.createElement("INPUT");u.type="hidden",u.name=unescape(s[0]),u.value=null!=s[1]?unescape(s[1]):"",a.appendChild(u)}for(var o=0;e.queryElem.length>o;o++)e.queryElem[o].e.name=e.queryElem[o].name;var c=p(a,[["action",e.url],["method",e.method],["onsubmit",null],["target",d]]);a.submit(),p(a,c);for(var o=0;i.length>o;o++)a.lastChild.parentNode.removeChild(a.lastChild);if(!r)for(var o=0,n=a.elements.length;n>o;o++)a.elements[o].name=t[o]};return JsHttpRequest.setTimeout(c,100),null}}};