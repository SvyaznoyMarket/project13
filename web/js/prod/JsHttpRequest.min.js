function JsHttpRequest(){var t=this;t.onreadystatechange=null,t.readyState=0,t.responseText=null,t.responseXML=null,t.status=200,t.statusText="OK",t.responseJS=null,t.caching=!1,t.loader=null,t.session_name="PHPSESSID",t._ldObj=null,t._reqHeaders=[],t._openArgs=null,t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%"},t.abort=function(){with(this){if(_ldObj&&_ldObj.abort&&_ldObj.abort(),_cleanup(),0==readyState)return;if(1==readyState&&!_ldObj)return readyState=0,void 0;_changeReadyState(4,!0)}},t.open=function(_2,_3,_4,_5,_6){with(this){_3.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)&&(this.loader=RegExp.$2?RegExp.$2:null,_2=RegExp.$3,_3=RegExp.$4);try{(document.location.search.match(RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)")))&&(_3+=(_3.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1))}catch(e){}return _openArgs={method:(_2||"").toUpperCase(),url:_3,asyncFlag:_4,username:null!=_5?_5:"",password:null!=_6?_6:""},_ldObj=null,_changeReadyState(1,!0),!0}},t.send=function(e){if(this.readyState){this._changeReadyState(1,!0),this._ldObj=null;var t=[],r=[];if(this._hash2query(e,null,t,r)){var s=null;if(this.caching&&!r.length){s=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+t+"#"+this._openArgs.method;var n=JsHttpRequest.CACHE[s];if(n)return this._dataReady(n[0],n[1]),!1}var a=(this.loader||"").toLowerCase();if(a&&!JsHttpRequest.LOADERS[a])return this._error("unk_loader",a);var i=[],o=JsHttpRequest.LOADERS;for(var l in o){var u=o[l].loader;if(u&&(!a||l==a)){var d=new u(this);JsHttpRequest.extend(d,this._openArgs),JsHttpRequest.extend(d,{queryText:t.join("&"),queryElem:r,id:(new Date).getTime()+""+JsHttpRequest.COUNT++,hash:s,span:null});var p=d.load();if(!p)return this._ldObj=d,JsHttpRequest.PENDING[d.id]=this,!0;if(a)return this._error(p);i[i.length]="- "+l.toUpperCase()+": "+this._l(p)}}return l?this._error("no_loader_matched",i.join("\n")):this._error("no_loaders")}}},t.getAllResponseHeaders=function(){with(this)return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[]},t.getResponseHeader=function(_13){with(this)return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(_13):null},t.setRequestHeader=function(_14,_15){with(this)_reqHeaders[_reqHeaders.length]=[_14,_15]},t._dataReady=function(_16,js){with(this)caching&&_ldObj&&(JsHttpRequest.CACHE[_ldObj.hash]=[_16,js]),responseText=responseXML=_16,responseJS=js,null!==js?(status=200,statusText="OK"):(status=500,statusText="Internal Server Error"),_changeReadyState(2),_changeReadyState(3),_changeReadyState(4),_cleanup()},t._l=function(e){for(var t=0,r=0,s=this._errors[e[0]];(r=s.indexOf("%",r))>=0;){var n=e[++t]+"";s=s.substring(0,r)+n+s.substring(r+1,s.length),r+=1+n.length}return s},t._error=function(e){throw e=this._l("string"==typeof e?arguments:e),e="JsHttpRequest: "+e,window.Error?"test"==Error(1,"test").description?Error(1,e):Error(e):e},t._hash2query=function(e,t,r,s){if(null==t&&(t=""),"object"==(""+typeof e).toLowerCase()){var n=!1;e&&e.parentNode&&e.parentNode.appendChild&&e.tagName&&"FORM"==e.tagName.toUpperCase()&&(e={form:e});for(var a in e){var i=e[a];if(!(i instanceof Function)){var o=t?t+"["+this.escape(a)+"]":this.escape(a),l=i&&i.parentNode&&i.parentNode.appendChild&&i.tagName;if(l){var u=i.tagName.toUpperCase();if("FORM"==u)n=!0;else if("INPUT"!=u&&"TEXTAREA"!=u&&"SELECT"!=u)return this._error("inv_form_el",i.name||"",i.tagName);s[s.length]={name:o,e:i}}else if(i instanceof Object)this._hash2query(i,o,r,s);else{if(null===i)continue;i===!0&&(i=1),i===!1&&(i=""),r[r.length]=o+"="+this.escape(""+i)}if(n&&s.length>1)return this._error("must_be_single_el")}}}else r[r.length]=e;return!0},t._cleanup=function(){var e=this._ldObj;if(e){JsHttpRequest.PENDING[e.id]=!1;var t=e.span;if(t){e.span=null;var r=function(){t.parentNode.removeChild(t)};JsHttpRequest.setTimeout(r,50)}}},t._changeReadyState=function(s,_2c){with(this)_2c&&(status=statusText=responseJS=null,responseText=""),readyState=s,onreadystatechange&&onreadystatechange()},t.escape=function(e){return escape(e).replace(RegExp("\\+","g"),"%2B")}}JsHttpRequest.COUNT=0,JsHttpRequest.MAX_URL_LEN=2e3,JsHttpRequest.CACHE={},JsHttpRequest.PENDING={},JsHttpRequest.LOADERS={},JsHttpRequest._dummy=function(){},JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout},JsHttpRequest.setTimeout=function(e,t){if(window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s,"string"==typeof e)r=window.JsHttpRequest_tmp(e,t);else{var r=null,s=function(){e(),delete JsHttpRequest.TIMEOUTS[r]};r=window.JsHttpRequest_tmp(s,t),JsHttpRequest.TIMEOUTS[r]=s}return window.JsHttpRequest_tmp=null,r},JsHttpRequest.clearTimeout=function(e){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c,delete JsHttpRequest.TIMEOUTS[e];var t=window.JsHttpRequest_tmp(e);return window.JsHttpRequest_tmp=null,t},JsHttpRequest.query=function(e,t,r,s){var n=new this;n.caching=!s,n.onreadystatechange=function(){4==n.readyState&&r(n.responseJS,n.responseText)},n.open(null,e,!0),n.send(t)},JsHttpRequest.dataReady=function(e){var t=this.PENDING[e.id];if(delete this.PENDING[e.id],t)t._dataReady(e.text,e.js);else if(t!==!1)throw"dataReady(): unknown pending id: "+e.id},JsHttpRequest.extend=function(e,t){for(var r in t)e[r]=t[r]},JsHttpRequest.LOADERS.xml={loader:function(req){JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryElem.length)return["xml_no_form_upl"];if(this.url.match(RegExp("^([a-z]+://[^\\/]+)(.*)","i"))&&RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase())return["xml_no_diffdom",RegExp.$1];var xr=null;if(window.XMLHttpRequest)try{xr=new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{xr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(!xr)try{xr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}if(!xr)return["xml_no"];var _40=window.ActiveXObject||xr.setRequestHeader;if(this.method||(this.method=_40&&this.queryText.length?"POST":"GET"),"GET"==this.method){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.queryText="",this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN]}else if("POST"==this.method&&!_40)return["xml_no_headers"];this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";var id=this.id;if(xr.onreadystatechange=function(){if(4==xr.readyState){xr.onreadystatechange=JsHttpRequest._dummy,req.status=null;try{req.status=xr.status,req.responseText=xr.responseText}catch(e){}if(req.status){try{var _42=req.responseText||"{ js: null, text: null }";eval("JsHttpRequest._tmp = function(id) { var d = "+_42+"; d.id = id; JsHttpRequest.dataReady(d); }")}catch(e){return req._error("js_invalid",req.responseText)}JsHttpRequest._tmp(id),JsHttpRequest._tmp=null}}},xr.open(this.method,this.url,!0,this.username,this.password),_40){for(var i=0;req._reqHeaders.length>i;i++)xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);xr.setRequestHeader("Content-Type","application/octet-stream")}return xr.send(this.queryText),this.span=null,this.xr=xr,null},this.getAllResponseHeaders=function(){return this.xr.getAllResponseHeaders()},this.getResponseHeader=function(e){return this.xr.getResponseHeader(e)},this.abort=function(){this.xr.abort(),this.xr=null}}},JsHttpRequest.LOADERS.script={loader:function(e){JsHttpRequest.extend(e._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-"+"script",this.queryText="",this.method||(this.method="GET"),"GET"!==this.method)return["script_only_get"];if(this.queryElem.length)return["script_no_form"];if(this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var e=this,t=document,r=null,s=t.body;if(window.opera){this.span=r=t.createElement("SPAN"),r.style.display="none",s.insertBefore(r,s.lastChild),r.innerHTML="Workaround for IE.<script></script>";var n=function(){r=r.getElementsByTagName("SCRIPT")[0],r.language="JavaScript",r.setAttribute?r.setAttribute("src",e.url):r.src=e.url}}else{this.span=r=t.createElement("SCRIPT");var n=function(){r.language="JavaScript",r.setAttribute?r.setAttribute("src",e.url):r.src=e.url,s.insertBefore(r,s.lastChild)}}return JsHttpRequest.setTimeout(n,10),null}}},JsHttpRequest.LOADERS.form={loader:function(e){JsHttpRequest.extend(e._errors,{form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'}),this.load=function(){var e=this;if(e.method||(e.method="POST"),e.url+=(e.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+e.id+"-"+"form","GET"==e.method){if(e.queryText&&(e.url+=(e.url.indexOf("?")>=0?"&":"?")+e.queryText),e.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var t=e.url.split("?",2);e.url=t[0],e.queryText=t[1]||""}var r=null,s=!1;if(e.queryElem.length){if("FORM"==e.queryElem[0].e.tagName.toUpperCase())r=e.queryElem[0].e,s=!0,e.queryElem=[];else{r=e.queryElem[0].e.form;for(var n=0;e.queryElem.length>n;n++){var a=e.queryElem[n].e;if(!a.form)return["form_el_not_belong",a.name];if(a.form!=r)return["form_el_belong_diff",a.name]}}if("POST"==e.method){var i="multipart/form-data",o=r.attributes.encType&&r.attributes.encType.nodeValue||r.attributes.enctype&&r.attributes.enctype.value||r.enctype;if(o!=i)return["form_el_inv_enctype",i,o]}}var l=r&&(r.ownerDocument||r.document)||document,u="jshr_i_"+e.id,d=e.span=l.createElement("DIV");d.style.position="absolute",d.style.display="none",d.style.visibility="hidden",d.innerHTML=(r?"":"<form"+("POST"==e.method?' enctype="multipart/form-data" method="post"':"")+"></form>")+'<iframe name="'+u+'" id="'+u+'" style="width:0px; height:0px; overflow:hidden; border:none"></iframe>',r||(r=e.span.firstChild),l.body.insertBefore(d,l.body.lastChild);var p=function(e,t){var r=[],s=e;if(e.mergeAttributes){var s=l.createElement("form");s.mergeAttributes(e,!1)}for(var n=0;t.length>n;n++){var a=t[n][0],i=t[n][1];"target"==a?(r[r.length]=[a,s.target],s.target=i):(r[r.length]=[a,s.getAttribute(a)],s.setAttribute(a,i))}return e.mergeAttributes&&e.mergeAttributes(s,!1),r},h=function(){top.JsHttpRequestGlobal=JsHttpRequest;var t=[];if(!s)for(var n=0,a=r.elements.length;a>n;n++)t[n]=r.elements[n].name,r.elements[n].name="";for(var i=e.queryText.split("&"),n=i.length-1;n>=0;n--){var o=i[n].split("=",2),d=l.createElement("INPUT");d.type="hidden",d.name=unescape(o[0]),d.value=null!=o[1]?unescape(o[1]):"",r.appendChild(d)}for(var n=0;e.queryElem.length>n;n++)e.queryElem[n].e.name=e.queryElem[n].name;var h=p(r,[["action",e.url],["method",e.method],["onsubmit",null],["target",u]]);r.submit(),p(r,h);for(var n=0;i.length>n;n++)r.lastChild.parentNode.removeChild(r.lastChild);if(!s)for(var n=0,a=r.elements.length;a>n;n++)r.elements[n].name=t[n]};return JsHttpRequest.setTimeout(h,100),null}}};