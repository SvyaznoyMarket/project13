function JsHttpRequest(){var t=this;t.onreadystatechange=null,t.readyState=0,t.responseText=null,t.responseXML=null,t.status=200,t.statusText="OK",t.responseJS=null,t.caching=!1,t.loader=null,t.session_name="PHPSESSID",t._ldObj=null,t._reqHeaders=[],t._openArgs=null,t._errors={inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check JsHttpRequest.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%"},t.abort=function(){with(this){if(_ldObj&&_ldObj.abort&&_ldObj.abort(),_cleanup(),0==readyState)return;if(1==readyState&&!_ldObj)return void(readyState=0);_changeReadyState(4,!0)}},t.open=function(_2,_3,_4,_5,_6){with(this){_3.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)&&(this.loader=RegExp.$2?RegExp.$2:null,_2=RegExp.$3,_3=RegExp.$4);try{(document.location.search.match(RegExp("[&?]"+session_name+"=([^&?]*)"))||document.cookie.match(RegExp("(?:;|^)\\s*"+session_name+"=([^;]*)")))&&(_3+=(_3.indexOf("?")>=0?"&":"?")+session_name+"="+this.escape(RegExp.$1))}catch(e){}return _openArgs={method:(_2||"").toUpperCase(),url:_3,asyncFlag:_4,username:null!=_5?_5:"",password:null!=_6?_6:""},_ldObj=null,_changeReadyState(1,!0),!0}},t.send=function(a){if(this.readyState){this._changeReadyState(1,!0),this._ldObj=null;var b=[],c=[];if(this._hash2query(a,null,b,c)){var d=null;if(this.caching&&!c.length){d=this._openArgs.username+":"+this._openArgs.password+"@"+this._openArgs.url+"|"+b+"#"+this._openArgs.method;var e=JsHttpRequest.CACHE[d];if(e)return this._dataReady(e[0],e[1]),!1}var f=(this.loader||"").toLowerCase();if(f&&!JsHttpRequest.LOADERS[f])return this._error("unk_loader",f);var g=[],h=JsHttpRequest.LOADERS;for(var i in h){var j=h[i].loader;if(j&&(!f||i==f)){var k=new j(this);JsHttpRequest.extend(k,this._openArgs),JsHttpRequest.extend(k,{queryText:b.join("&"),queryElem:c,id:(new Date).getTime()+""+JsHttpRequest.COUNT++,hash:d,span:null});var l=k.load();if(!l)return this._ldObj=k,JsHttpRequest.PENDING[k.id]=this,!0;if(f)return this._error(l);g[g.length]="- "+i.toUpperCase()+": "+this._l(l)}}return i?this._error("no_loader_matched",g.join("\n")):this._error("no_loaders")}}},t.getAllResponseHeaders=function(){with(this)return _ldObj&&_ldObj.getAllResponseHeaders?_ldObj.getAllResponseHeaders():[]},t.getResponseHeader=function(_13){with(this)return _ldObj&&_ldObj.getResponseHeader?_ldObj.getResponseHeader(_13):null},t.setRequestHeader=function(_14,_15){with(this)_reqHeaders[_reqHeaders.length]=[_14,_15]},t._dataReady=function(_16,js){with(this)caching&&_ldObj&&(JsHttpRequest.CACHE[_ldObj.hash]=[_16,js]),responseText=responseXML=_16,responseJS=js,null!==js?(status=200,statusText="OK"):(status=500,statusText="Internal Server Error"),_changeReadyState(2),_changeReadyState(3),_changeReadyState(4),_cleanup()},t._l=function(a){for(var b=0,c=0,d=this._errors[a[0]];(c=d.indexOf("%",c))>=0;){var e=a[++b]+"";d=d.substring(0,c)+e+d.substring(c+1,d.length),c+=1+e.length}return d},t._error=function(a){throw a=this._l("string"==typeof a?arguments:a),a="JsHttpRequest: "+a,window.Error?"test"==Error(1,"test").description?Error(1,a):Error(a):a},t._hash2query=function(a,b,c,d){if(null==b&&(b=""),"object"==(""+typeof a).toLowerCase()){var e=!1;a&&a.parentNode&&a.parentNode.appendChild&&a.tagName&&"FORM"==a.tagName.toUpperCase()&&(a={form:a});for(var f in a){var g=a[f];if(!(g instanceof Function)){var h=b?b+"["+this.escape(f)+"]":this.escape(f),i=g&&g.parentNode&&g.parentNode.appendChild&&g.tagName;if(i){var j=g.tagName.toUpperCase();if("FORM"==j)e=!0;else if("INPUT"!=j&&"TEXTAREA"!=j&&"SELECT"!=j)return this._error("inv_form_el",g.name||"",g.tagName);d[d.length]={name:h,e:g}}else if(g instanceof Object)this._hash2query(g,h,c,d);else{if(null===g)continue;g===!0&&(g=1),g===!1&&(g=""),c[c.length]=h+"="+this.escape(""+g)}if(e&&d.length>1)return this._error("must_be_single_el")}}}else c[c.length]=a;return!0},t._cleanup=function(){var a=this._ldObj;if(a){JsHttpRequest.PENDING[a.id]=!1;var b=a.span;if(b){a.span=null;var c=function(){b.parentNode.removeChild(b)};JsHttpRequest.setTimeout(c,50)}}},t._changeReadyState=function(s,_2c){with(this)_2c&&(status=statusText=responseJS=null,responseText=""),readyState=s,onreadystatechange&&onreadystatechange()},t.escape=function(a){return escape(a).replace(RegExp("\\+","g"),"%2B")}}JsHttpRequest.COUNT=0,JsHttpRequest.MAX_URL_LEN=2e3,JsHttpRequest.CACHE={},JsHttpRequest.PENDING={},JsHttpRequest.LOADERS={},JsHttpRequest._dummy=function(){},JsHttpRequest.TIMEOUTS={s:window.setTimeout,c:window.clearTimeout},JsHttpRequest.setTimeout=function(a,b){if(window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.s,"string"==typeof a)c=window.JsHttpRequest_tmp(a,b);else{var c=null,d=function(){a(),delete JsHttpRequest.TIMEOUTS[c]};c=window.JsHttpRequest_tmp(d,b),JsHttpRequest.TIMEOUTS[c]=d}return window.JsHttpRequest_tmp=null,c},JsHttpRequest.clearTimeout=function(a){window.JsHttpRequest_tmp=JsHttpRequest.TIMEOUTS.c,delete JsHttpRequest.TIMEOUTS[a];var b=window.JsHttpRequest_tmp(a);return window.JsHttpRequest_tmp=null,b},JsHttpRequest.query=function(a,b,c,d){var e=new this;e.caching=!d,e.onreadystatechange=function(){4==e.readyState&&c(e.responseJS,e.responseText)},e.open(null,a,!0),e.send(b)},JsHttpRequest.dataReady=function(a){var b=this.PENDING[a.id];if(delete this.PENDING[a.id],b)b._dataReady(a.text,a.js);else if(b!==!1)throw"dataReady(): unknown pending id: "+a.id},JsHttpRequest.extend=function(a,b){for(var c in b)a[c]=b[c]},JsHttpRequest.LOADERS.xml={loader:function(req){JsHttpRequest.extend(req._errors,{xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryElem.length)return["xml_no_form_upl"];if(this.url.match(RegExp("^([a-z]+://[^\\/]+)(.*)","i"))&&RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase())return["xml_no_diffdom",RegExp.$1];var xr=null;if(window.XMLHttpRequest)try{xr=new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{xr=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(!xr)try{xr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}if(!xr)return["xml_no"];var _40=window.ActiveXObject||xr.setRequestHeader;if(this.method||(this.method=_40&&this.queryText.length?"POST":"GET"),"GET"==this.method){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.queryText="",this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN]}else if("POST"==this.method&&!_40)return["xml_no_headers"];this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+(req.caching?"0":this.id)+"-xml";var id=this.id;if(xr.onreadystatechange=function(){if(4==xr.readyState){xr.onreadystatechange=JsHttpRequest._dummy,req.status=null;try{req.status=xr.status,req.responseText=xr.responseText}catch(e){}if(req.status){try{var _42=req.responseText||"{ js: null, text: null }";eval("JsHttpRequest._tmp = function(id) { var d = "+_42+"; d.id = id; JsHttpRequest.dataReady(d); }")}catch(e){return req._error("js_invalid",req.responseText)}JsHttpRequest._tmp(id),JsHttpRequest._tmp=null}}},xr.open(this.method,this.url,!0,this.username,this.password),_40){for(var i=0;req._reqHeaders.length>i;i++)xr.setRequestHeader(req._reqHeaders[i][0],req._reqHeaders[i][1]);xr.setRequestHeader("Content-Type","application/octet-stream")}return xr.send(this.queryText),this.span=null,this.xr=xr,null},this.getAllResponseHeaders=function(){return this.xr.getAllResponseHeaders()},this.getResponseHeader=function(a){return this.xr.getResponseHeader(a)},this.abort=function(){this.xr.abort(),this.xr=null}}},JsHttpRequest.LOADERS.script={loader:function(a){JsHttpRequest.extend(a._errors,{script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented"}),this.load=function(){if(this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.url+=(this.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+this.id+"-script",this.queryText="",this.method||(this.method="GET"),"GET"!==this.method)return["script_only_get"];if(this.queryElem.length)return["script_no_form"];if(this.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var a=this,b=document,c=null,d=b.body;if(window.opera){this.span=c=b.createElement("SPAN"),c.style.display="none",d.insertBefore(c,d.lastChild),c.innerHTML="Workaround for IE.<script></script>";var e=function(){c=c.getElementsByTagName("SCRIPT")[0],c.language="JavaScript",c.setAttribute?c.setAttribute("src",a.url):c.src=a.url}}else{this.span=c=b.createElement("SCRIPT");var e=function(){c.language="JavaScript",c.setAttribute?c.setAttribute("src",a.url):c.src=a.url,d.insertBefore(c,d.lastChild)}}return JsHttpRequest.setTimeout(e,10),null}}},JsHttpRequest.LOADERS.form={loader:function(a){JsHttpRequest.extend(a._errors,{form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'}),this.load=function(){var a=this;if(a.method||(a.method="POST"),a.url+=(a.url.indexOf("?")>=0?"&":"?")+"JsHttpRequest="+a.id+"-form","GET"==a.method){if(a.queryText&&(a.url+=(a.url.indexOf("?")>=0?"&":"?")+a.queryText),a.url.length>JsHttpRequest.MAX_URL_LEN)return["url_too_long",JsHttpRequest.MAX_URL_LEN];var b=a.url.split("?",2);a.url=b[0],a.queryText=b[1]||""}var c=null,d=!1;if(a.queryElem.length){if("FORM"==a.queryElem[0].e.tagName.toUpperCase())c=a.queryElem[0].e,d=!0,a.queryElem=[];else{c=a.queryElem[0].e.form;for(var e=0;a.queryElem.length>e;e++){var f=a.queryElem[e].e;if(!f.form)return["form_el_not_belong",f.name];if(f.form!=c)return["form_el_belong_diff",f.name]}}if("POST"==a.method){var g="multipart/form-data",h=c.attributes.encType&&c.attributes.encType.nodeValue||c.attributes.enctype&&c.attributes.enctype.value||c.enctype;if(h!=g)return["form_el_inv_enctype",g,h]}}var i=c&&(c.ownerDocument||c.document)||document,j="jshr_i_"+a.id,k=a.span=i.createElement("DIV");k.style.position="absolute",k.style.display="none",k.style.visibility="hidden",k.innerHTML=(c?"":"<form"+("POST"==a.method?' enctype="multipart/form-data" method="post"':"")+"></form>")+'<iframe name="'+j+'" id="'+j+'" style="width:0px; height:0px; overflow:hidden; border:none"></iframe>',c||(c=a.span.firstChild),i.body.insertBefore(k,i.body.lastChild);var l=function(a,b){var c=[],d=a;if(a.mergeAttributes){var d=i.createElement("form");d.mergeAttributes(a,!1)}for(var e=0;b.length>e;e++){var f=b[e][0],g=b[e][1];"target"==f?(c[c.length]=[f,d.target],d.target=g):(c[c.length]=[f,d.getAttribute(f)],d.setAttribute(f,g))}return a.mergeAttributes&&a.mergeAttributes(d,!1),c},m=function(){top.JsHttpRequestGlobal=JsHttpRequest;var b=[];if(!d)for(var e=0,f=c.elements.length;f>e;e++)b[e]=c.elements[e].name,c.elements[e].name="";for(var g=a.queryText.split("&"),e=g.length-1;e>=0;e--){var h=g[e].split("=",2),k=i.createElement("INPUT");k.type="hidden",k.name=unescape(h[0]),k.value=null!=h[1]?unescape(h[1]):"",c.appendChild(k)}for(var e=0;a.queryElem.length>e;e++)a.queryElem[e].e.name=a.queryElem[e].name;var m=l(c,[["action",a.url],["method",a.method],["onsubmit",null],["target",j]]);c.submit(),l(c,m);for(var e=0;g.length>e;e++)c.lastChild.parentNode.removeChild(c.lastChild);if(!d)for(var e=0,f=c.elements.length;f>e;e++)c.elements[e].name=b[e]};return JsHttpRequest.setTimeout(m,100),null}}};