$(document).ready(function(){function H(a,b,c){var d=[],a=a+("/"+c+"/"+(s?"compact":"expanded")),e=s?$("div.goodslist"):$("div.goodsline:last");e.after("<div id='ajaxgoods' class='bNavLoader'><div class='bNavLoader__eIco'><img src='/images/ajar.gif'></div><div class='bNavLoader__eM'><p class='bNavLoader__eText'>Подождите немного</p><p class='bNavLoader__eText'>Идет загрузка</p></div></div>");a+="?"+b;$("#sorting").length&&d.push({name:"sort",value:$("#sorting").data("sort")});$.get(a,d,function(a){""!=
a&&!a.data&&(t=!0,s?e.append(a):e.after(a));$("#ajaxgoods").remove();if($("#dlvrlinks").length){var b=[];$("<div>").html(a).find("div.boxhover, div.goodsboxlink").each(function(){var a=$(this).data("cid")||0;a&&b.push(a)});n.post(h.data("calclink"),b)}})}function y(){$.getJSON("/region/init",function(a){if(!a.success)return!1;for(var a=a.data,b=$('<div class="bCityPopupWrap">').html('<div class="hideblock bCityPopup"><i title="Закрыть" class="close">Закрыть</i><div class="title">Привет! Из какого вы города?</div></div></div>'),
c=0,d=a.length;c<d;c++)if(!("undefined"===typeof a[c].link||"undefined"===typeof a[c].name)){var e=$("<div>").append($("<a>").attr("href",a[c].link).text(a[c].name));"undefined"!==typeof a[c].is_active?(e.addClass("bCityPopup__eCurrent"),b.find(".title").after(e)):(e.addClass("bCityPopup__eBlock"),b.find("div:first").append(e))}b.css("display","none").appendTo($("body"));z()})}function z(){$(".bCityPopupWrap").lightbox_me({centered:!0})}function A(){B||($(".product_filter-block input:submit").removeClass("mDisabled"),
B=!0)}function C(a){if($(a).data("run")){var b=1*$(a).position().left+1*$(a).width()/2-15,a=$("#extramenu-root-"+$(a).attr("id").replace(/\D+/,""));a.length&&""!=a.find("dl").html().replace(/\s/g,"")&&a.show().find(".corner").css("left",b)}}function D(a){var b=this,c=1,d=1*a.width,e=1*a.viswidth,g=isNaN($(a.times).html())?Math.ceil(d/e):1*$(a.times).html(),j=2,f=!1;this.notify=function(){$(a.crnt).html(c);1==c?$(a.prev).addClass("disabled"):$(a.prev).removeClass("disabled");c==g?$(a.next).addClass("disabled"):
$(a.next).removeClass("disabled")};var h=function(){var b=$(a.wrap).find(".goodsbox");$(b).hide();for(var d=(c-1)*e;d<c*e;d++)b.eq(d).show()};$(a.next).bind("click",function(){if(c<g&&!f){if(c+1==g){var k=$(a.wrap).find(".goodsbox");$(k).hide();for(var l=k.length,m=d%e?d%e:e,i=1;i<=m;i++)k.eq(l-i).show();c++}else c+1>=j&&($(a.next).css("opacity","0.4"),f=!0,k=[],$("form.product_filter-block").length&&(k=$("form.product_filter-block").serializeArray()),k.push({name:"page",value:j+1}),$.get($(a.prev).attr("data-url"),
k,function(b){j++;$(a.next).css("opacity","1");f=!1;var c=$("<div>");$(c).html(b);$(c).find(".goodsbox").css("display","none");$(a.wrap).html($(a.wrap).html()+c.html())})),c++,h();b.notify()}return!1});$(a.prev).click(function(){1<c&&(c--,h(),b.notify());return!1})}function o(){var a=this;this.self="";this.other=[];this.formatPrice=function(a){return"undefined"===typeof a||null===a?"":0<a?", "+a+' <span class="rubl">p</span>':", бесплатно"};this.post=function(b,c){$.post(b,{ids:c},function(b){if(!("success"in
b)||!b.success||0===b.data.length)return!1;for(var e=0;e<c.length;e++)if(b.data[c[e]]){for(var g in b.data[c[e]]){var j=b.data[c[e]][g];switch(j.token){case "self":a.self=j.date;break;default:a.other.push({date:j.date,price:j.price})}}a.processHTML(c[e]);a.self="";a.other=[]}})}}var u={calcParams:function(){addate=new Date},adfoxbground:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==typeof afReferrer&&(afReferrer=escape(document.referrer)):
afReferrer="";var b=new Date,c=escape(document.location),d=Math.floor(1E6*Math.random());$("#adfoxbground").html('<div id="AdFox_banner_'+d+'"></div><div style="visibility:hidden; position:absolute;"><iframe id="AdFox_iframe_'+d+'" width=1 height=1 marginwidth=0 marginheight=0 scrolling=no frameborder=0></iframe></div>');AdFox_getCodeScript(1,d,"http://ads.adfox.ru/171829/prepareCode?pp=g&amp;ps=vto&amp;p2=enlz&amp;pct=a&amp;plp=a&amp;pli=a&amp;pop=a&amp;pr="+a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+
b.getDay()+"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+"&amp;dl="+c+"&amp;pr1="+d)},adfox400counter:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==typeof afReferrer&&(afReferrer=escape(document.referrer)):afReferrer="";var b=new Date,a='<script type="text/javascript" src="http://ads.adfox.ru/171829/prepareCode?p1=biewf&amp;p2=engb&amp;pct=a&amp;pfc=a&amp;pfb=a&amp;pr='+a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+b.getDay()+
"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+'"><\/script>';$("#adfox400counter").html(a)},adfox400:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==typeof afReferrer&&(afReferrer=escape(document.referrer)):afReferrer="";var b=new Date,c=escape(document.location),d=Math.floor(1E6*Math.random());$("#adfox400").html('<div id="AdFox_banner_'+d+'"></div><div style="visibility:hidden; position:absolute;"><iframe id="AdFox_iframe_'+
d+'" width=1 height=1 marginwidth=0 marginheight=0 scrolling=no frameborder=0></iframe></div>');AdFox_getCodeScript(1,d,"http://ads.adfox.ru/171829/prepareCode?pp=g&amp;ps=vto&amp;p2=engb&amp;pct=a&amp;plp=a&amp;pli=a&amp;pop=a&amp;pr="+a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+b.getDay()+"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+"&amp;dl="+c+"&amp;pr1="+d)},adfox215:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==
typeof afReferrer&&(afReferrer=escape(document.referrer)):afReferrer="";var b=new Date,c=escape(document.location),d=Math.floor(1E6*Math.random());$("#adfox215").html('<div id="AdFox_banner_'+d+'"></div><div style="visibility:hidden; position:absolute;"><iframe id="AdFox_iframe_'+d+'" width=1 height=1 marginwidth=0 marginheight=0 scrolling=no frameborder=0></iframe></div>');AdFox_getCodeScript(1,d,"http://ads.adfox.ru/171829/prepareCode?pp=g&amp;ps=vto&amp;p2=emud&amp;pct=a&amp;plp=a&amp;pli=a&amp;pop=a&amp;pr="+
a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+b.getDay()+"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+"&amp;dl="+c+"&amp;pr1="+d)},adfox683:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==typeof afReferrer&&(afReferrer=escape(document.referrer)):afReferrer="";var b=new Date,c=escape(document.location),d=Math.floor(1E6*Math.random());$("#adfox683").html('<div id="AdFox_banner_'+d+'"></div><div style="visibility:hidden; position:absolute;"><iframe id="AdFox_iframe_'+
d+'" width=1 height=1 marginwidth=0 marginheight=0 scrolling=no frameborder=0></iframe></div>');AdFox_getCodeScript(1,d,"http://ads.adfox.ru/171829/prepareCode?pp=g&amp;ps=vto&amp;p2=emue&amp;pct=a&amp;plp=a&amp;pli=a&amp;pop=a&amp;pr="+a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+b.getDay()+"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+"&amp;dl="+c+"&amp;pr1="+d)},adfox683counter:function(){if("undefined"==typeof a)var a=Math.floor(1E6*Math.random());"undefined"!=typeof document.referrer?"undefined"==
typeof afReferrer&&(afReferrer=escape(document.referrer)):afReferrer="";var b=new Date,a='<script type="text/javascript" src="http://ads.adfox.ru/171829/prepareCode?pp=g&amp;ps=bdto&amp;p2=emue&amp;pct=a&amp;plp=a&amp;pli=a&amp;pop=a&amp;pr='+a+"&amp;pt=b&amp;pd="+b.getDate()+"&amp;pw="+b.getDay()+"&amp;pv="+b.getHours()+"&amp;prr="+afReferrer+'"><\/script>';$("#adfox683counter").html(a)}};$.each($(".adfoxWrapper"),function(){console.info(this.id,this.id+""in u);if(this.id+""in u)u[this.id]()});if(document.location.search.match(/admitad_uid/)){var p=
parse_url(document.location.search);docCookies.setItem(!1,"admitad_uid",p.admitad_uid,31536E3,"/")}var f=new brwsr;if(f.isAndroid||f.isOSX4){f.isOpera&&$(".lightbox").hide();$(".lightbox").css("position","absolute");var l=f.isOSX4?window.innerHeight:document.documentElement.clientHeight,p=f.isOSX4?window.innerWidth:document.documentElement.clientWidth;f.isOSX4&&$(".lightbox").css("top",window.pageYOffset+l-41);if(90===Math.abs(window.orientation))var E=l-41,F=p-41;else F=l-41,E=p-41;window.addEventListener("orientationchange",
v,!1);window.addEventListener("scroll",v,!1);window.onscroll=v;var v=function(){window.pageYOffset?(l=f.isOSX4?window.innerHeight:document.documentElement.clientHeight,$(".lightbox").css("top",window.pageYOffset+l-41)):$(".lightbox").css("top",90===Math.abs(window.orientation)?E:F)}}$(".open_auth-link").bind("click",function(a){a.preventDefault();a=$(this);window.open(a.attr("href"),"oauthWindow","status = 1, width = 540, height = 420").focus()});$("#auth-link").click(function(){$("#auth-block").lightbox_me({centered:!0,
onLoad:function(){$("#auth-block").find("input:first").focus()}});return!1});(function(a){a.fn.warnings=function(){var b=a('<strong id="ruschars" class="pswwarning">RUS</strong>');b.css({border:"1px solid red",color:"red","border-radius":"3px","background-color":"#fff",position:"absolute",height:"16px",padding:"1px 3px","margin-top":"2px"});var c=b.clone().attr("id","capslock").html("CAPS LOCK").css("marginLeft","-78px");a(this).keypress(function(b){var e=String.fromCharCode(b.which);e.toUpperCase()===
e&&e.toLowerCase()!==e&&!b.shiftKey?a("#capslock").length||a(this).after(c):a("#capslock").length&&a("#capslock").remove()});a(this).keyup(function(){/[а-яА-ЯёЁ]/.test(a(this).val())?a("#ruschars").length||(a("#capslock").length?b.css("marginLeft","-116px"):b.css("marginLeft","-36px"),a(this).after(b)):a("#ruschars").length&&a("#ruschars").remove()})}})(jQuery);$("#signin_password").warnings();$("#login-form, #register-form").data("redirect",!0).bind("submit",function(a){a.preventDefault();var b=
$(this);b.find('[type="submit"]:first').attr("disabled",!0).val("login-form"==b.attr("id")?"Вхожу...":"Регистрируюсь...");a=b.serializeArray();a.redirect_to=b.find('[name="redirect_to"]:first').val();$.ajax({type:"POST",url:b.attr("action"),data:a,success:function(a){a.success?b.data("redirect")?a.url?window.location=a.url:(b.unbind("submit"),b.submit()):($("#auth-block").trigger("close"),PubSub.publish("authorize",a.user)):b.html($(a.data.content).html())}})});$("#forgot-pwd-trigger").live("click",
function(){$("#reset-pwd-form").show();$("#reset-pwd-key-form").hide();$("#login-form").hide();return!1});$("#remember-pwd-trigger,#remember-pwd-trigger2").click(function(){$("#reset-pwd-form").hide();$("#reset-pwd-key-form").hide();$("#login-form").show();return!1});$("#reset-pwd-form, #auth_forgot-form").submit(function(){var a=$(this);a.find(".error_list").html("Запрос отправлен. Идет обработка...");a.find(".whitebutton").attr("disabled","disabled");$.post(a.prop("action"),a.serializeArray(),function(b){!0===
b.success?(b=$("#reset-pwd-form > div"),b.find("input").remove(),b.find(".pb5").remove(),b.find(".error_list").html("Новый пароль был вам выслан по почте или смс!")):(b=""!==b.error?b.error:"Вы ввели неправильные данные",a.find(".error_list").text(b))},"json");return!1});var t=!0,s=$("div.goodslist").length;$("div.allpager").length&&($("div.allpager").each(function(){function a(){t&&$(window).scrollTop()+800>$(document).height()-$(window).height()&&(t=!1,g+e>d&&H(b,c,d%g?d%g:d),d+=1)}var b=$(this).data("url"),
c=$(this).data("filter"),d=""!==$(this).data("page")?1*$(this).data("page")+1:2,e=d-1,g=parseInt("0"+$(this).data("lastpage"),10);location.href.match(/sort=/)&&location.href.match(/page=/)?$(this).bind("click",function(){docCookies.setItem(!1,"infScroll",1,2419200,"/");location.href=location.href.replace(/page=\d+/,"")}):$(this).bind("click",function(){docCookies.setItem(!1,"infScroll",1,2419200,"/");var b=$("div.pageslist:first li:first");b.hasClass("current")&&(b=b.next());var c=b.find("a").html("<span>123</span>").addClass("borderedR");
c.attr("href",c.attr("href").replace(/page=\d+/,""));$("div.pageslist li").remove();$("div.pageslist ul").append(b).find("a").bind("click",function(){docCookies.removeItem("infScroll")});$("div.allpager").addClass("mChecked");a();$(window).scroll(a)})}),docCookies.hasItem("infScroll")&&$("div.allpager:first").trigger("click"));$("body").append('<div style="display:none"><img src="/images/error_ajax.gif" alt=""/></div>');var m=function(a){a='<div id="ajaxerror" class="popup"><i class="close" title="Закрыть">Закрыть</i><div class="popupbox width650 height170"><h2 class="pouptitle">Непредвиденная ошибка</h2><div class="clear"></div><div class="fl"><div class="font16 pb20 width345"> Что-то произошло, но мы постараемся это починить :) Попробуйте повторить ваше последнее действие еще раз.<br/>Причина ошибки: '+
a+' </div></div><div class="clear"></div><div style="position:absolute; right:30px; top: 20px; margin-bottom:20px;"><img src="/images/error_ajax.gif" width="" height="" alt=""/></div></div></div>\t';$("body").append($(a));$("#ajaxerror").lightbox_me({centered:!0,onClose:function(){$("#ajaxerror").remove()}})};$.ajaxSetup({timeout:1E4,statusCode:{404:function(){m(" 404 ошибка, страница не найдена")},401:function(){$("#auth-block").length?$("#auth-block").lightbox_me({centered:!0,onLoad:function(){$("#auth-block").find("input:first").focus()}}):
m(" 401 ошибка, авторизуйтесь заново")},500:function(){m(" сервер перегружен")},503:function(){m(" 503 ошибка, сервер перегружен")},504:function(){m(" 504 ошибка, проверьте соединение с интернетом")}},error:function(a){"error"==a.statusText&&console.error(" неизвестная ajax ошибка")}});$("body").delegate("#jsregion, .jsChangeRegion","click",function(){$(this).data("run")?$(".bCityPopupWrap").length&&z():($(this).data("run",!0),y());return!1});docCookies.hasItem("geoshop")||y();$(".serviceblock").length&&
($(".info h3").css("cursor","pointer").click(function(){$(this).parent().find("> div").toggle()}),1===$(".info h3").length&&$(".info h3").trigger("click"));$(".form input[type=checkbox],.form input[type=radio]").prettyCheckboxes();$("#rotator").length&&($("#rotator").jshowoff({speed:8E3,controls:!1}),$(".jshowoff-slidelinks a").wrapInner("<span/>"));$(".fm").toggle(function(){$(this).parent().find(".hf").slideDown();$(this).html("скрыть")},function(){$(this).parent().find(".hf").slideUp();$(this).html("еще...")});
$("#plus10").length&&(10>$("#filter_product_type-form li").length?$("#plus10").hide():$("#plus10").html("еще "+($("#filter_product_type-form .hf").length%10+1)+" из "+$("#filter_product_type-form li").length),$("#plus10").click(function(){$("#filter_product_type-form .hf").slice(0,10).removeClass("hf");$("#filter_product_type-form .hf").length||$(this).parent().hide();return!1}));$(".search-form").bind("submit",function(a){a.preventDefault();var b=$(this);2>b.find('input:[name="q"]').val().length||
"Поиск среди 20 000 товаров"===b.find('input:[name="q"]').val()||(a=b.serializeArray(),$.ajax({type:"GET",url:b.attr("action"),data:a,success:function(a){a.success?(b.unbind("submit"),b.submit()):($(a.data.content).appendTo("body"),$("#search_popup-block").lightbox_me({centered:!0}))}}))});$(".bCtg__eMore").bind("click",function(a){a.preventDefault();a=$(this);a.parent().find("li.hf").slideToggle();a=a.find("a");a.text("еще..."==a.text()?"скрыть":"еще...")});$(".bigfilter dt").click(function(){$(this).next(".bigfilter dd").slideToggle(200);
$(this).toggleClass("current");return!1});$(".f1list dt B").click(function(){$(this).parent("dt").next(".f1list dd").slideToggle(200);$(this).toggleClass("current");return!1});$(".tagslist dt").click(function(){$(this).next(".tagslist dd").slideToggle(200);$(this).toggleClass("current");return!1});$(".product_filter-block input:submit").addClass("mDisabled");var B=!1;$(".product_filter-block").change(function(){A()});var i=$(".filter .filterlink:first"),q=$(".filter .filterlist");f.isTouch?i.click(function(){i.hide();
q.show();return!1}):(i.mouseenter(function(){i.hide();q.show()}),q.mouseleave(function(){q.hide();i.show()}));var w=0;$(".product_filter-block").bind("change",function(a){a=$(a.target);a.is("input")&&-1!=$.inArray(a.attr("type"),["radio","checkbox"])&&a.trigger("preview")}).bind("preview",function(a){var b=$(a.target),c=$(this);w++;a=c.serializeArray();a.redirect_to=c.find('[name="redirect_to"]:first').val();$.ajax({type:"GET",url:c.data("action-count"),data:a,success:function(a){w--;if(!(0<w)&&a.success){$(".product_count-block").remove();
switch(a.data%10){case 1:ending="ь";break;case 2:case 3:case 4:ending="и";break;default:ending="ей"}switch(a.data%100){case 11:case 12:case 13:case 14:ending="ей"}var e=null,e=b.is("div")?b:b.parent().find("> label").first();e.after('<div class="filterresult product_count-block" style="display:block; padding: 4px; margin-top: -30px; cursor: pointer;"><i class="corner"></i>Выбрано '+a.data+" модел"+ending+"<br /><a>Показать</a></div>");$(".product_count-block").hover(function(){$(this).stopTime("hide")},
function(){$(this).oneTime(2E3,"hide",function(){$(this).remove()})}).click(function(){c.submit()}).trigger("mouseout")}}})});$(".sliderbox").each(function(){var a=$(".filter-range",this),b=$(this).parent(),c=1*$(".slider-from",$(this).next()).val(),d=1*$(".slider-to",$(this).next()).val(),e=$(".slider-interval",$(this).next()),g=b.find("input:first"),f=b.find("input:eq(1)");e.html(printPrice(g.val())+" - "+printPrice(f.val()));b=/price/.test(g.attr("id"))?10:1;3>=d-c&&10!=b&&(b=0.1);a.slider({range:!0,
step:b,min:c,max:d,values:[g.val(),f.val()],slide:function(a,b){e.html(printPrice(b.values[0])+" - "+printPrice(b.values[1]));g.val(b.values[0]);f.val(b.values[1])},change:function(){0<parseFloat(f.val())&&(g.parent().trigger("preview"),A())}})});$(".goodsbar .link1").bind("click.css",function(){$(this).addClass("link1active")});$(".topmenu").length&&$.get("/category/main_menu",function(a){$(".bHeader").append(a)});var G=null,x=0;f.isTouch?$(".topmenu a.bToplink").bind("click",function(){if($(this).data("run"))return!0;
$(".extramenu").hide();$(".topmenu a.bToplink").each(function(){$(this).data("run",!1)});$(this).data("run",!0);C(this);return!1}):$(".topmenu a.bToplink").bind({mouseenter:function(){$(".extramenu").hide();var a=this;$(a).data("run",!0);x=$(a).attr("id").replace(/\D+/,"");G=setTimeout(function(){C(a)},300)},mouseleave:function(){$(this).data("run")&&(clearTimeout(G),$(this).data("run",!1))}});$(document).click(function(a){x&&1==a.which&&$("#extramenu-root-"+x+"").data("run",!1).hide()});$(".extramenu").click(function(a){a.stopPropagation()});
$(".error_list").length&&$(".basketheader").length&&$.scrollTo($(".error_list:first"),300);$(".carouseltitle").each(function(){$(this).hasClass("carbig")?new D({prev:$(this).find(".back"),next:$(this).find(".forvard"),crnt:$(this).find("span:first"),times:$(this).find("span:eq(1)"),width:$(this).find(".scroll").data("quantity"),wrap:$(this).find("~ .bigcarousel").first(),viswidth:5}):$(this).find(".jshm").length&&new D({prev:$(this).find(".back"),next:$(this).find(".forvard"),crnt:$(this).find(".none"),
times:$(this).find("span:eq(1)"),width:$(this).find(".jshm").html().replace(/\D/g,""),wrap:$(this).find("~ .carousel").first(),viswidth:3})});if($("#dlvrlinks").length){var h=$("#dlvrlinks");o.prototype.processHTML=function(a){var b=this.self,c=this.other,d=$("div[data-cid="+a+"]").parent(),a=$("<ul>");b&&$("<li>").html("Возможен самовывоз "+b).appendTo(a);for(b=0;b<c.length;b++){var e="Доставка "+c[b].date,e=e+(c[b].price?this.formatPrice(c[b].price):"");$("<li>").html(e).appendTo(a)}c=d.find("div.extrainfo ul");
c.html(c.html()+a.html())};var r=[];$("div.boxhover, div.goodsboxlink").each(function(){var a=$(this).data("cid")||0;a&&r.push(a)});var n=new o;n.post(h.data("calclink"),r)}if($(".delivery-info").length)h=$(".delivery-info"),o.prototype.processHTML=function(){var a=this.self,b=this.other,c="<h4>Как получить заказ?</h4><ul>";a&&(c+="<li><h5>Можно заказать сейчас и самостоятельно забрать в магазине "+a+'</h5><div>&mdash; <a target="blank" href="'+h.data("shoplink")+'">В каких магазинах ENTER можно забрать?</a></div></li>');
0<b.length&&(c+="<li><h5>Можно заказать сейчас с доставкой</h5>");for(a=0;a<b.length;a++)c+="<div>&mdash; Можем доставить "+b[a].date+this.formatPrice(b[a].price)+"</div>";h.html(c+"</ul>")},r=[h.attr("id").replace("product-id-","")],n=new o,n.post(h.data("calclink"),r)});
