$(document).ready(function(){function n(e,n){if(!e)return;if(!e.longitude||!e.latitude)return;var r=this,i={iconImageHref:"/images/marker.png",iconImageSize:[39,59],iconImageOffset:[-19,-57]};r.yandex=function(){var t=[e.latitude,e.longitude],r=new ymaps.Map(n,{center:t,zoom:16});r.controls.add("zoomControl");var s=new ymaps.Placemark(t,{},i);r.geoObjects.add(s)},r.google=function(){var t={zoom:16,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},r=new google.maps.LatLng(e.latitude,e.longitude);t.center=r;var s=new google.maps.Map(document.getElementById(n),t),o=new google.maps.Marker({position:r,map:s,icon:i.iconImageHref})},t==="yandex"?PubSub.subscribe("yandexIsReady",function(){r[t]()}):r.google()}var e=$(".bMap__eScrollWrap");e.delegate("div.map-image-link","click",function(t){if($(this).hasClass("first")&&$("div.map-360-link",e).length){$("div.map-360-link",e).trigger("click");return}$(this).hasClass("mChecked")||($("div.mChecked",$(this).parent()).removeClass("mChecked"),$(this).addClass("mChecked"))}),$("div.map-360-link",e).length&&e.delegate("div.map-360-link","click",function(e){$("div.mChecked",$(".bMap__eScrollWrap")).removeClass("mChecked");if(!$("#map-container embed").length){var t=$(this),n=$("#map-panorama").data();embedpano({swf:n.swf,xml:n.xml,target:"map-container",wmode:"transparent"})}e.stopPropagation()}),e.delegate("div.map-google-link","click",function(t){$("div.mChecked",e).removeClass("mChecked");if(!$("#map-container div").length)var r=$(this),i={latitude:$('[name="shop[latitude]"]').val(),longitude:$('[name="shop[longitude]"]').val()},s=new n(i,"map-container")});var t="yandex";t==="yandex"&&ymaps.ready(function(){PubSub.publish("yandexIsReady"),ymaps.isReady=!0}),$("div.map-google-link:first",e).trigger("click");if($("#map-markers").length){function r(e){$("#map-info_window-container").html(tmpl("infowindowtmpl",e))}var i=calcMCenter($("#map-markers").data("content"));t==="yandex"?PubSub.subscribe("yandexIsReady",function(){window.regionMap=new MapYandexWithShops(i,$("#infowindowtmpl"),"region_map-container"),window.regionMap.showMarkers($("#map-markers").data("content"))}):(window.regionMap=new MapGoogleWithShops(i,$("#map-info_window-container"),"region_map-container",r),window.regionMap.showMarkers($("#map-markers").data("content")))}$("#region-select").bind("change",function(){window.location=$(this).find("option:selected").data("url")})});