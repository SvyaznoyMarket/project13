$(document).ready(function(){var e=$(".bMap__eScrollWrap");e.delegate("div.map-image-link","click",function(t){if($(this).hasClass("first")&&$("div.map-360-link",e).length){$("div.map-360-link",e).trigger("click");return}$(this).hasClass("mChecked")||($("div.mChecked",$(this).parent()).removeClass("mChecked"),$(this).addClass("mChecked"))}),$("div.map-360-link",e).length&&e.delegate("div.map-360-link","click",function(e){$("div.mChecked",$(".bMap__eScrollWrap")).removeClass("mChecked");if(!$("#map-container embed").length){var t=$(this),n=$("#map-panorama").data();embedpano({swf:n.swf,xml:n.xml,target:"map-container",wmode:"transparent"})}e.stopPropagation()}),e.delegate("div.map-google-link","click",function(t){$("div.mChecked",e).removeClass("mChecked");if(!$("#map-container div").length){var n=$(this),r={latitude:$('[name="shop[latitude]"]').val(),longitude:$('[name="shop[longitude]"]').val()};$.when(MapInterface.ready("yandex",{yandex:$("#infowindowtmpl"),google:$("#map-info_window-container")})).done(function(){MapInterface.onePoint(r,"map-container")})}}),$("div.map-google-link:first",e).trigger("click");if($("#map-markers").length){var t=$("#map-markers").data("content"),n=!1,r={timer:null,id:0};$(".bMapShops__eMapCityList ul").delegate("li","hover",function(){var e=$(this).attr("ref");r.timer&&clearTimeout(r.timer),e&&e!=r.id&&(r.id=e,r.timer=setTimeout(function(){window.regionMap.showInfobox(e)},350))});function i(e){var t={};for(var n in e)t[e[n].id]=e[n];return t}function s(){}var o=function(){$(".bMapShops__eTitle").click(function(){return $(".bMapShops__eMapCityList_city ul").fadeOut(500,function(){$(".bMapShops__eMapCityList_city ul").empty(),window.regionMap.showCluster(t)}),!1}),$(".bMapShops__eMapCityList_city").click(function(){$(".bMapShops__eMapCityList_city ul").fadeOut(500,function(){$(".bMapShops__eMapCityList_city ul").empty()});if(n)$(this).removeClass("chosedCity"),$(".bMapShops__eMapCityList_city").show(),n=!1;else{var e=[];for(var r in t)if(t[r].region_id==$(this).attr("ref")){var s=tmpl("shopInCity",t[r]);$(this).find("ul").append(s),e.push(t[r])}if(e.length){$(".bMapShops__eMapCityList_city").hide(),$(this).addClass("chosedCity").show();var o=$(".chosedCity").offset().top;$(".bMapShops__eMapCityList").scroll(function(){var e=$(".chosedCity").offset().top;$(".chosedCity .cityName").css("top",o-e)}),$(this).find("ul").fadeIn(500,function(){window.regionMap.showMarkers(i(e))})}else alert("В этом городе пока еще нет наших магазинов");n=!0}})};function u(e){$("#map-info_window-container").html(tmpl("infowindowtmpl",e))}var a=calcMCenter(t),f=function(){window.regionMap.showCluster(t),o()};$.when(MapInterface.ready("yandex",{yandex:$("#infowindowtmpl"),google:$("#map-info_window-container")})).done(function(){MapInterface.init(a,"region_map-container",f,u)})}});