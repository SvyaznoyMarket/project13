var menuDelay=350,lastHover=null,dropMenuWidth=230,currentMenuItemDimensions=null,menuLevel2Dimensions=null,menuLevel3Dimensions=null,hoverMainMenu=!1,checkedItem=null,pointA={x:0,y:0},pointB={x:0,y:0},pointC={x:0,y:0},cursorNow={x:0,y:0};$("body").append("<div id='tl' style='z-index:10000;position:fixed;top:0;left:0;background-color:red;width:10px;height:10px;'>&nbsp;</div>"),$("body").append("<div id='tt' style='z-index:10000;position:fixed;top:0;left:0;background-color:green;width:10px;height:10px;'>&nbsp;</div>"),$("body").append("<div id='tb' style='z-index:10000;position:fixed;top:0;left:0;background-color:blue;width:10px;height:10px;'>&nbsp;</div>");var tl=$("#tl"),tt=$("#tt"),tb=$("#tb");getTriangleS=function(e,t,i){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),o=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)),n=(r+a+o)/2,s=Math.sqrt(n*(n-r)*(n-a)*(n-o));return s},menuCheckTriangle=function(){var e=(pointA.x-cursorNow.x)*(pointB.y-pointA.y)-(pointB.x-pointA.x)*(pointA.y-cursorNow.y),t=(pointB.x-cursorNow.x)*(pointC.y-pointB.y)-(pointC.x-pointB.x)*(pointB.y-cursorNow.y),i=(pointC.x-cursorNow.x)*(pointA.y-pointC.y)-(pointA.x-pointC.x)*(pointC.y-cursorNow.y);return e>=0&&t>=0&&i>=0||0>=e&&0>=t&&0>=i?!0:!1},menuMove=function(e){cursorNow={x:e.pageX,y:e.pageY-$(window).scrollTop()};var t=$(this);t.attr("class")==checkedItem.attr("class")&&(buildTriangle(t),lastHover=new Date),checkHover(t),tl.css("left",cursorNow.x-30+"px"),tl.css("top",cursorNow.y+"px")},createTriangle=function(){pointA={x:cursorNow.x,y:cursorNow.y-$(window).scrollTop()},pointB={x:menuLevel3Dimensions.left,y:menuLevel3Dimensions.top-$(window).scrollTop()},pointC={x:menuLevel3Dimensions.left,y:menuLevel3Dimensions.top+menuLevel3Dimensions.height-$(window).scrollTop()},tt.css("left",pointB.x-30+"px"),tt.css("top",pointB.y+"px"),tb.css("left",pointC.x-30+"px"),tb.css("top",pointC.y+"px")},checkItem=function(e){console.log("checkedItem"),menuCheckTriangle()?(console.log("входит"),activateItem(e)):(console.log("не входит"),checkedItem.removeClass("hover"))},activateItem=function(e){checkedItem=e,e.addClass("hover"),lastHover=new Date,buildTriangle(e)},menuHoverIn=function(){var e=$(this);checkHover(e)},checkHover=function(e){0==pointA.x&&0==pointA.y?activateItem(e):(!menuCheckTriangle()||lastHover&&new Date-lastHover>menuDelay&&menuCheckTriangle())&&(checkedItem.removeClass("hover"),activateItem(e))},buildTriangle=function(e){currentMenuItemDimensions=getDimensions(e),menuLevel2Dimensions=getDimensions(e.parent()),menuLevel3Dimensions={top:menuLevel2Dimensions.top,left:menuLevel2Dimensions.left+dropMenuWidth,width:menuLevel2Dimensions.width-dropMenuWidth,height:menuLevel2Dimensions.height},createTriangle()},getDimensions=function(e){var t=$(e).width(),i=$(e).height();e=e[0];for(var r=0,a=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)r+=e.offsetLeft-e.scrollLeft,a+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:a,left:r,width:t,height:i}},$(".bMainMenuLevel-2__eItem").mouseenter(menuHoverIn),$(".bMainMenuLevel-2__eItem").mousemove(menuMove);