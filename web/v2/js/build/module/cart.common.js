define(["jquery","underscore","module/config","module/widget"],function(t,e,n){var a=t("body"),o=function(n){n.stopPropagation();var a=t(n.target),o=a.data(),r=t(a.data("widgetSelector"));console.info("addProductToCart",a,r,o),o.url&&(t.post(o.url,o.value,function(n){e.isObject(n.result.widgets)&&e.each(n.result.widgets,function(e,n){n&&t(n).trigger("render",e)})}),n.preventDefault())},r=function(n){n.stopPropagation();var a=t(n.target),o=a.data(),r=t(a.data("spinnerSelector"));if(console.info("deleteProductFromCart",a,o),o.url&&(t.post(o.url,o.value,function(n){if(e.isObject(n.result.widgets)&&e.each(n.result.widgets,function(e,n){n&&t(n).trigger("render",e)}),a.data("parentContainerSelector")){var o=a.parents(a.data("parentContainerSelector"));o.length&&o.slideUp(300,function(){o.remove()})}}),n.preventDefault(),r.length)){var i=r.data("timer");try{clearTimeout(i)}catch(c){console.warn(c)}}},i=function(n,a){n.stopPropagation();var r=t(n.target),i=t(r),c=i.data("value"),u=t(i.data("widgetSelector")),d=parseInt(u.data("timer"));if(console.info("changeProductQuantity",i,a),e.isFinite(d)&&d>0){try{clearTimeout(d)}catch(l){console.warn(l)}d=setTimeout(function(){o(n)},600),u.data("timer",d)}if(!e.isFinite(a)||0>=a){var l={code:"invalid",message:"Количество должно быть большим нуля"};return console.info("changeProductQuantityData:js-buyButton",l,a,i),l}c.product.quantity=a},c=function(e){e.stopPropagation();var n=t(e.target),a=t(n.data("widgetSelector")),o=t(n.data("buttonSelector")),r=o.data("value");console.info("incSpinnerValue",n,o,a),r&&(o.trigger("changeProductQuantityData",r.product.quantity+1),a.trigger("renderValue",r.product)),n.blur()},u=function(e){e.stopPropagation();var n=t(e.target),a=t(n.data("widgetSelector")),o=t(n.data("buttonSelector")),r=o.data("value");console.info("decSpinnerValue",n,o),r&&(o.trigger("changeProductQuantityData",r.product.quantity-1),a.trigger("renderValue",r.product)),n.blur()},d=function(e){e.stopPropagation();var n=t(e.target),a=t(n.data("widgetSelector")),o=t(n.data("buttonSelector")),r=o.data("value");console.info("changeSpinnerValue",n,o);var i=n.val();""!=i&&(o.trigger("changeProductQuantityData",parseInt(i)),r&&a.trigger("renderValue",r.product))},l=function(e,n){e.stopPropagation();var a=t(e.target);console.info("renderSpinnerValue",a,n),a.find(".js-buySpinner-value").val(n.quantity)},g=function(e){e.stopPropagation();var a=t(e.target);a.is(":checked")?t.cookie(n.credit.cookieName,1,{expires:7}):t.removeCookie(n.credit.cookieName),e.preventDefault()},s=function(e){e.stopPropagation(),t.removeCookie(n.credit.cookieName),e.preventDefault()},p=function(e){1==t.cookie(n.credit.cookieName)?e.attr("checked",!0):e.removeAttr("checked")};a.on("click",".js-buyButton",o).on("changeProductQuantityData",".js-buyButton",i).on("click",".js-deleteButton",r),a.on("click dblclick contextmenu",".js-buySpinner-inc",c).on("click dblclick contextmenu",".js-buySpinner-dec",u).on("change keyup",".js-buySpinner-value",d).on("renderValue",".js-buySpinner",l).on("changeProductQuantityData",".js-buySpinner-value",i),a.on("change",".js-creditButton",g).on("change",".js-creditButton-remove",s),p(t(".js-creditButton"))});