define(["jquery","underscore","module/config","module/widget"],function(t,e,a){var n=t("body"),r=function(a){a.stopPropagation();var n=t(a.target),r=n.data(),o=t(n.data("widgetSelector"));console.info("addProductToCart",n,o,r),r.url&&(t.post(r.url,r.value,function(a){e.isObject(a.result.widgets)&&e.each(a.result.widgets,function(e,a){a&&t(a).trigger("render",e)})}),a.preventDefault())},o=function(a){a.stopPropagation();var n=t(a.target),r=n.data(),o=t(n.data("spinnerSelector"));if(console.info("deleteProductFromCart",n,r),r.url&&(t.post(r.url,r.value,function(a){if(a.redirect&&-1!==a.redirect.indexOf("/")&&(window.location.href=a.redirect),e.isObject(a.result)&&e.isObject(a.result.widgets)&&e.each(a.result.widgets,function(e,a){a&&t(a).trigger("render",e)}),n.data("parentContainerSelector")){var r=n.parents(n.data("parentContainerSelector"));r.length&&r.slideUp(300,function(){r.remove()})}}),a.preventDefault(),o.length)){var i=o.data("timer");try{clearTimeout(i)}catch(c){console.warn(c)}}},i=function(a,n){a.stopPropagation();var o=t(a.target),i=t(o),c=i.data("value"),u=t(i.data("widgetSelector")),d=parseInt(u.data("timer"));if(console.info("changeProductQuantity",i,n),e.isFinite(d)&&d>0){try{clearTimeout(d)}catch(l){console.warn(l)}d=setTimeout(function(){r(a)},600),u.data("timer",d)}if(!e.isFinite(n)||0>=n){var l={code:"invalid",message:"Количество должно быть большим нуля"};return console.info("changeProductQuantityData:js-buyButton",l,n,i),l}if(c.product.quantity=n,i.hasClass("js-quickBuyButton")){var s=i.attr("href").replace(/\d+$/,n);i.attr("href",s)}},c=function(e){e.stopPropagation();var a=t(e.target),n=t(a.data("widgetSelector")),r=t(a.data("buttonSelector")),o=r.data("value");console.info("incSpinnerValue",a,r,n),o&&(r.trigger("changeProductQuantityData",o.product.quantity+1),n.trigger("renderValue",o.product)),a.blur()},u=function(e){e.stopPropagation();var a=t(e.target),n=t(a.data("widgetSelector")),r=t(a.data("buttonSelector")),o=r.data("value");console.info("decSpinnerValue",a,r),o&&(r.trigger("changeProductQuantityData",o.product.quantity-1),n.trigger("renderValue",o.product)),a.blur()},d=function(e){e.stopPropagation();var a=t(e.target),n=t(a.data("widgetSelector")),r=t(a.data("buttonSelector")),o=r.data("value");console.info("changeSpinnerValue",a,r);var i=a.val();""!=i&&(r.trigger("changeProductQuantityData",parseInt(i)),o&&n.trigger("renderValue",o.product))},l=function(e,a){e.stopPropagation();var n=t(e.target);console.info("renderSpinnerValue",n,a),n.find(".js-buySpinner-value").val(a.quantity)},s=function(e){e.stopPropagation();var n=t(e.target);n.is(":checked")?t.cookie(a.credit.cookieName,1,{expires:7}):t.removeCookie(a.credit.cookieName),e.preventDefault()},g=function(e){e.stopPropagation(),t.removeCookie(a.credit.cookieName),e.preventDefault()},p=function(e){1==t.cookie(a.credit.cookieName)?e.attr("checked",!0):e.removeAttr("checked")};n.on("click",".js-buyButton",r).on("changeProductQuantityData",".js-buyButton",i).on("changeProductQuantityData",".js-quickBuyButton",i).on("click",".js-deleteButton",o),n.on("click dblclick contextmenu",".js-buySpinner-inc",c).on("click dblclick contextmenu",".js-buySpinner-dec",u).on("change keyup",".js-buySpinner-value",d).on("renderValue",".js-buySpinner",l).on("changeProductQuantityData",".js-buySpinner-value",i),n.on("change",".js-creditButton",s).on("change",".js-creditButton-remove",g),p(t(".js-creditButton"))});