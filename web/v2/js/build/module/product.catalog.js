define(["jquery","underscore","mustache"],function(e,t){var a=e("body"),r=e(".js-productList-container"),o=function(t){t.stopPropagation();var a=e(t.target),o=r.data("value");console.info("setFilter",a),a.is(":radio, :checkbox")?a.is(":checked")?o[a.attr("name")]=a.val():delete o[a.attr("name")]:a.is(":text")&&(o[a.attr("name")]=a.val()),o.page=1,d(t,{clear:!0})},c=function(a){a.stopPropagation();var o=e(a.target),c=o.data("name"),n=r.data("value");if(console.info("deleteFilter",a,n,c),c){t.each(n,function(e,t){return t==c?(delete n[c],!0):void 0});var i=e(".js-productFilter-set").filter('[name="'+c+'"]');i.length&&(i.is(":radio, :checkbox")?i.removeAttr("checked"):i.is(":text")&&(i.val(i.data("value")),i.trigger("change"))),n.page=1,d(a,{clear:!0}),a.preventDefault()}},n=function(a){a.stopPropagation();var o=r.data("value"),c=r.data("reset");console.info("clearFilter",a,o),c.sort=o.sort,r.data("value",t.extend({},c)),e(".js-productFilter-set").each(function(t,a){var r=e(a);r.is(":radio, :checkbox")?r.removeAttr("checked"):r.is(":text")&&(r.val(r.data("value")),r.trigger("change"))}),o.page=1,d(a,{clear:!0}),a.preventDefault()},i=function(a){a.stopPropagation();var o=e(a.target),c=o.data("value"),n=r.data("value");console.info("setSorting",o),t.isObject(c)&&(t.each(c,function(e,t){n[t]=e}),n.page=1,d(a,{clear:!0}),a.preventDefault())},l=function(e){e.stopPropagation(),console.info("loadMoreProducts",e),d(e,{clear:!1}),e.preventDefault()},d=function(o,c){var n=e(".js-productList-more"),i=r.data("url"),l=r.data("value");c=t.extend({clear:!1},c),console.info("loadProduct",n,r,l),i&&!0!==n.data("disabled")&&(e.get(i,l).done(function(e){t.isObject(e.result)&&l&&r.length&&(!0===c.clear&&r.empty(),l.page=e.result.page,l.count=e.result.count,l.count<=l.page*l.limit?n.hide():n.show(),t.each(e.result.productCards,function(e){r.append(e)}),t.isObject(e.result.widgets)&&(a.data("widget",e.result.widgets),a.trigger("render")))}).always(function(){n.data("disabled",!1)}),n.data("disabled",!0))};a.on("click dblclick",".js-productList-more",l).on("change",".js-productFilter-set",o).on("click",".js-productFilter-delete",c).on("click",".js-productFilter-clear",n).on("click",".js-productFilter-sort",i)});