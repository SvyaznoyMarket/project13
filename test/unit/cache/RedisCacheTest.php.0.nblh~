<?php

include(dirname(__FILE__).'/../../bootstrap/unit.php');

$configuration = ProjectConfiguration::getApplicationConfiguration('main', 'dev', true);

//$t = new lime_test(1);

//$context = sfContext::createInstance($configuration);
new sfDatabaseManager($configuration);

$cache = new myRedisCache(array(
  'prefix' => 'test',
));

$data = array(
  'product-1/d08d5e34552a41f765c9982006138e79' => array('name' => 'product-1', 'price' => 10200, 'tags' => array('product-1', 'category-1')),
  'product-2/d08d5e34552a41f765c9982006138e79' => array('name' => 'product-2', 'price' => 9300, 'tags' => array('product-2', 'category-1')),
  'product-3/d08d5e34552a41f765c9982006138e79' => array('name' => 'product-3', 'price' => 56000, 'tags' => array('product-3', 'category-2')),
  'category-1/d08d5e34552a41f765c9982006138e79' => array('name' => 'category-1', 'tags' => array('category-1')),
  'category-2/d08d5e34552a41f765c9982006138e79' => array('name' => 'category-2', 'tags' => array('category-2')),
);

/*
foreach ($data as $k => $v)
{
  $cache->set($k, $v);

  foreach ($v['tags'] as $tag)
  {
    $cache->addTag($tag, $k);
  }
}
*/

/*
foreach (range(0, 30000) as $i)
{
  $k = 'product-'.$i.'/'.uniqid();
  $cache->set($k, array('name' => 'product-'.$i, 'price' => 10000));

  $cache->addTag('product-all', $k);
  $cache->addTag('product-'.$i, $k);
}
*/

//$result = $cache->getByTag('category-1', 'product-3');
//$cache->removeByTag('category-1', 'product-3');

myDebug::dump($cache->removeByTag('product-3'););