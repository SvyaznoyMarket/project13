CREATE TABLE accessory_product (id BIGINT AUTO_INCREMENT, master_id BIGINT NOT NULL, slave_id BIGINT NOT NULL, INDEX master_id_idx (master_id), INDEX slave_id_idx (slave_id), PRIMARY KEY(id)) COMMENT = 'Аксессуар товара' ENGINE = INNODB;
CREATE TABLE creator (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) COMMENT = 'Производитель' ENGINE = INNODB;
CREATE TABLE product (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, type_id BIGINT NOT NULL, creator_id BIGINT NOT NULL, category_id BIGINT NOT NULL, view_show TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Показывать товар по прямой ссылке?', view_list TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Показывать товар в списке категорий?', description text COMMENT 'Описание товара', rating DECIMAL(18, 14) DEFAULT 0 NOT NULL COMMENT 'Рейтинг товара', INDEX type_id_idx (type_id), INDEX creator_id_idx (creator_id), INDEX category_id_idx (category_id), PRIMARY KEY(id)) COMMENT = 'Товар' ENGINE = INNODB;
CREATE TABLE product_category (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, filter_group_id BIGINT, INDEX filter_group_id_idx (filter_group_id), PRIMARY KEY(id)) COMMENT = 'Категория товара' ENGINE = INNODB;
CREATE TABLE product_comment (id BIGINT AUTO_INCREMENT, product_id BIGINT NOT NULL, user_id BIGINT NOT NULL, content VARCHAR(255) NOT NULL COMMENT 'Текст комментария', helpful INT DEFAULT 0 NOT NULL COMMENT 'Количество полезных оценок отзыва', unhelpful INT DEFAULT 0 NOT NULL COMMENT 'Количество бесполезных оценок отзыва', INDEX product_id_idx (product_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) COMMENT = 'Комментарии товара' ENGINE = INNODB;
CREATE TABLE product_filter (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, type VARCHAR(10) NOT NULL, group_id BIGINT NOT NULL, property_id BIGINT NOT NULL, is_multiple TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Фильтр имеет несколько значений?', position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки', INDEX group_id_idx (group_id), INDEX property_id_idx (property_id), PRIMARY KEY(id)) COMMENT = 'Фильтр товара' ENGINE = INNODB;
CREATE TABLE product_filter_group (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) COMMENT = 'Группа фильтров товаров' ENGINE = INNODB;
CREATE TABLE product_photo (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, resource VARCHAR(255) NOT NULL, product_id BIGINT NOT NULL, view_show TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Показывать фото в карточке товара?', view_list TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'показывать фото в списке товаров?', INDEX product_id_idx (product_id), PRIMARY KEY(id)) COMMENT = 'Фото товара' ENGINE = INNODB;
CREATE TABLE product_property (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, type VARCHAR(10) DEFAULT 'string' NOT NULL COMMENT 'Тип свойства: строка, значение из справочника (опция свойства), текст', is_multiple TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Свойство имеет несколько значений?', pattern VARCHAR(255) DEFAULT '%value% %unit%' COMMENT 'Шаблон для создания значения свойства с единицей измерения для отображения', PRIMARY KEY(id)) COMMENT = 'Свойство товара' ENGINE = INNODB;
CREATE TABLE product_property_group (id BIGINT AUTO_INCREMENT, name VARCHAR(255), product_type_id BIGINT NOT NULL, position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки', INDEX product_type_id_idx (product_type_id), PRIMARY KEY(id)) COMMENT = 'Группа свойств товара' ENGINE = INNODB;
CREATE TABLE product_property_option (id BIGINT AUTO_INCREMENT, property_id BIGINT NOT NULL, value VARCHAR(255) NOT NULL COMMENT 'Значение опции', unit VARCHAR(255) COMMENT 'Единица измерения', position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки', INDEX property_id_idx (property_id), PRIMARY KEY(id)) COMMENT = 'Опции свойства товара' ENGINE = INNODB;
CREATE TABLE product_property_relation (id BIGINT AUTO_INCREMENT, name VARCHAR(255), product_id BIGINT NOT NULL, property_id BIGINT NOT NULL, option_id BIGINT, value_integer BIGINT, value_float DECIMAL(10, 4), value_string VARCHAR(255), value_text TEXT, value VARCHAR(255) COMMENT 'Значение свойства для отображения', unit VARCHAR(255) COMMENT 'Единица измерения', INDEX product_id_idx (product_id), INDEX property_id_idx (property_id), INDEX option_id_idx (option_id), PRIMARY KEY(id)) COMMENT = 'Связь продукта и свойства продукта' ENGINE = INNODB;
CREATE TABLE product_type (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) COMMENT = 'Тип товара' ENGINE = INNODB;
CREATE TABLE product_type_property_relation (id BIGINT AUTO_INCREMENT, name VARCHAR(255), product_type_id BIGINT NOT NULL, property_id BIGINT NOT NULL, group_id BIGINT, position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки', group_position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки в группе свойств товара', view_show TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Показывать свойство в карточке товара?', view_list TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Показывать свойство в списке товаров?', INDEX product_type_id_idx (product_type_id), INDEX property_id_idx (property_id), INDEX group_id_idx (group_id), PRIMARY KEY(id)) COMMENT = 'Связь типов и свойств товара' ENGINE = INNODB;
CREATE TABLE region (id BIGINT AUTO_INCREMENT, root_id BIGINT NOT NULL, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, type VARCHAR(10) NOT NULL COMMENT 'Тип региона: страна, административная единица, город', lft INT, rgt INT, level SMALLINT, PRIMARY KEY(id)) COMMENT = 'Регион' ENGINE = INNODB;
CREATE TABLE shop (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, region_id BIGINT NOT NULL, INDEX region_id_idx (region_id), PRIMARY KEY(id)) COMMENT = 'Магазин' ENGINE = INNODB;
CREATE TABLE similar_product (id BIGINT AUTO_INCREMENT, master_id BIGINT NOT NULL, slave_id BIGINT NOT NULL, group_id BIGINT NOT NULL, is_manual TINYINT(1) DEFAULT '0' NOT NULL COMMENT 'Аналогичный товар создан вручную?', INDEX master_id_idx (master_id), INDEX slave_id_idx (slave_id), INDEX group_id_idx (group_id), PRIMARY KEY(id)) COMMENT = 'Аналогичный товар' ENGINE = INNODB;
CREATE TABLE similar_product_group (id BIGINT AUTO_INCREMENT, product_type_id BIGINT NOT NULL, name VARCHAR(255) NOT NULL, INDEX product_type_id_idx (product_type_id), PRIMARY KEY(id)) COMMENT = 'Группа аналогичного товара' ENGINE = INNODB;
CREATE TABLE similar_product_property (id BIGINT AUTO_INCREMENT, group_id BIGINT NOT NULL, property_id BIGINT NOT NULL, INDEX group_id_idx (group_id), INDEX property_id_idx (property_id), PRIMARY KEY(id)) COMMENT = 'Свойства аналогичного товара' ENGINE = INNODB;
CREATE TABLE stock (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, type VARCHAR(10) NOT NULL, region_id BIGINT NOT NULL, shop_id BIGINT, INDEX region_id_idx (region_id), INDEX shop_id_idx (shop_id), PRIMARY KEY(id)) COMMENT = 'Склад' ENGINE = INNODB;
CREATE TABLE tag (id BIGINT AUTO_INCREMENT, token VARCHAR(255) NOT NULL UNIQUE, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) COMMENT = 'Тег' ENGINE = INNODB;
CREATE TABLE tag_product_category_relation (tag_id BIGINT, product_category_id BIGINT, PRIMARY KEY(tag_id, product_category_id)) COMMENT = 'Связь тега и категории товара' ENGINE = INNODB;
CREATE TABLE tag_product_relation (tag_id BIGINT, product_id BIGINT, PRIMARY KEY(tag_id, product_id)) COMMENT = 'Связь тега и товара' ENGINE = INNODB;
CREATE TABLE user (id BIGINT AUTO_INCREMENT, login VARCHAR(255) NOT NULL UNIQUE, first_name VARCHAR(255) NOT NULL COMMENT 'Имя', last_name VARCHAR(255) NOT NULL COMMENT 'Фамилия', middle_name VARCHAR(255) NOT NULL COMMENT 'Отчество', photo VARCHAR(255) COMMENT 'Фото пользователя', PRIMARY KEY(id)) COMMENT = 'Пользователь' ENGINE = INNODB;
CREATE TABLE user_product_tag (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, user_id BIGINT NOT NULL, product_id BIGINT NOT NULL, position INT DEFAULT 1 NOT NULL COMMENT 'Порядок сортировки', INDEX user_id_idx (user_id), INDEX product_id_idx (product_id), PRIMARY KEY(id)) COMMENT = 'Пользовательские теги к товару' ENGINE = INNODB;
ALTER TABLE accessory_product ADD CONSTRAINT accessory_product_slave_id_product_id FOREIGN KEY (slave_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE accessory_product ADD CONSTRAINT accessory_product_master_id_product_id FOREIGN KEY (master_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE product ADD CONSTRAINT product_type_id_product_type_id FOREIGN KEY (type_id) REFERENCES product_type(id) ON DELETE RESTRICT;
ALTER TABLE product ADD CONSTRAINT product_creator_id_creator_id FOREIGN KEY (creator_id) REFERENCES creator(id) ON DELETE RESTRICT;
ALTER TABLE product ADD CONSTRAINT product_category_id_product_category_id FOREIGN KEY (category_id) REFERENCES product_category(id) ON DELETE RESTRICT;
ALTER TABLE product_category ADD CONSTRAINT product_category_filter_group_id_product_filter_group_id FOREIGN KEY (filter_group_id) REFERENCES product_filter_group(id) ON DELETE SET NULL;
ALTER TABLE product_comment ADD CONSTRAINT product_comment_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE product_comment ADD CONSTRAINT product_comment_product_id_product_id FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE product_filter ADD CONSTRAINT product_filter_property_id_product_property_id FOREIGN KEY (property_id) REFERENCES product_property(id) ON DELETE CASCADE;
ALTER TABLE product_filter ADD CONSTRAINT product_filter_group_id_product_filter_group_id FOREIGN KEY (group_id) REFERENCES product_filter_group(id) ON DELETE CASCADE;
ALTER TABLE product_photo ADD CONSTRAINT product_photo_product_id_product_id FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE product_property_group ADD CONSTRAINT product_property_group_product_type_id_product_type_id FOREIGN KEY (product_type_id) REFERENCES product_type(id) ON DELETE CASCADE;
ALTER TABLE product_property_option ADD CONSTRAINT product_property_option_property_id_product_property_id FOREIGN KEY (property_id) REFERENCES product_property(id) ON DELETE CASCADE;
ALTER TABLE product_property_relation ADD CONSTRAINT product_property_relation_property_id_product_property_id FOREIGN KEY (property_id) REFERENCES product_property(id) ON DELETE CASCADE;
ALTER TABLE product_property_relation ADD CONSTRAINT product_property_relation_product_id_product_id FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE product_property_relation ADD CONSTRAINT product_property_relation_option_id_product_property_option_id FOREIGN KEY (option_id) REFERENCES product_property_option(id) ON DELETE SET NULL;
ALTER TABLE product_type_property_relation ADD CONSTRAINT product_type_property_relation_property_id_product_property_id FOREIGN KEY (property_id) REFERENCES product_property(id) ON DELETE CASCADE;
ALTER TABLE product_type_property_relation ADD CONSTRAINT product_type_property_relation_product_type_id_product_type_id FOREIGN KEY (product_type_id) REFERENCES product_type(id) ON DELETE CASCADE;
ALTER TABLE product_type_property_relation ADD CONSTRAINT pgpi FOREIGN KEY (group_id) REFERENCES product_property_group(id) ON DELETE SET NULL;
ALTER TABLE shop ADD CONSTRAINT shop_region_id_region_id FOREIGN KEY (region_id) REFERENCES region(id) ON DELETE RESTRICT;
ALTER TABLE similar_product ADD CONSTRAINT similar_product_slave_id_product_id FOREIGN KEY (slave_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE similar_product ADD CONSTRAINT similar_product_master_id_product_id FOREIGN KEY (master_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE similar_product ADD CONSTRAINT similar_product_group_id_similar_product_group_id FOREIGN KEY (group_id) REFERENCES similar_product_group(id) ON DELETE CASCADE;
ALTER TABLE similar_product_group ADD CONSTRAINT similar_product_group_product_type_id_product_type_id FOREIGN KEY (product_type_id) REFERENCES product_type(id) ON DELETE RESTRICT;
ALTER TABLE similar_product_property ADD CONSTRAINT similar_product_property_property_id_product_property_id FOREIGN KEY (property_id) REFERENCES product_property(id) ON DELETE CASCADE;
ALTER TABLE similar_product_property ADD CONSTRAINT similar_product_property_group_id_similar_product_group_id FOREIGN KEY (group_id) REFERENCES similar_product_group(id) ON DELETE CASCADE;
ALTER TABLE stock ADD CONSTRAINT stock_shop_id_shop_id FOREIGN KEY (shop_id) REFERENCES shop(id) ON DELETE SET NULL;
ALTER TABLE stock ADD CONSTRAINT stock_region_id_region_id FOREIGN KEY (region_id) REFERENCES region(id) ON DELETE RESTRICT;
ALTER TABLE tag_product_category_relation ADD CONSTRAINT tppi FOREIGN KEY (product_category_id) REFERENCES product_category(id) ON DELETE CASCADE;
ALTER TABLE tag_product_category_relation ADD CONSTRAINT tag_product_category_relation_tag_id_tag_id FOREIGN KEY (tag_id) REFERENCES tag(id) ON DELETE CASCADE;
ALTER TABLE tag_product_relation ADD CONSTRAINT tag_product_relation_tag_id_tag_id FOREIGN KEY (tag_id) REFERENCES tag(id) ON DELETE CASCADE;
ALTER TABLE tag_product_relation ADD CONSTRAINT tag_product_relation_product_id_product_id FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE;
ALTER TABLE user_product_tag ADD CONSTRAINT user_product_tag_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_product_tag ADD CONSTRAINT user_product_tag_product_id_product_id FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE;
