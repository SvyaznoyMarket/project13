PaymentMethod:
  options:
    comment: 'Способ оплаты'
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }
    is_active:         { type: boolean, notnull: true, default: false, comment: 'Способ оплаты активен?' }

DeliveryType:
  options:
    comment: 'Тип доставки'
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }
    is_active:         { type: boolean, notnull: true, default: false, comment: 'Тип доставки активен?' }

Order:
  options:
    comment: 'Заказ пользователя'
  columns:
    id:                     { type: integer(20), autoincrement: true, primary: true }
    token:                  { type: string(64), unique: true, notnull: true, notblank: true, comment: 'Номер заказа' }
    user_id:                { type: integer(20), notnull: false, default: null }
    payment_method_id:      { type: integer(20), notnull: false, default: null }
    sum:                    { type: 'decimal(12,2)', notnull: true, default: 0, comment: 'Стоимость заказа' }
    person_type:            { type: enum, length: 10, values: [individual, legal], notnull: false, default: null }
    region_id:              { type: integer(20), notnull: false, default: null }
    receipt_type:           { type: enum, length: 10, values: [pickup, delivery], notnull: false, default: null, comment: 'Тип получения: доставка или самовывоз' }
    shop_id:                { type: integer(20), notnull: false, default: null }
    delivery_type_id:       { type: integer(20), notnull: false, default: null } # стандартная, экспресс
    delivered_at:           { type: timestamp, format: Y-m-d H:m:i, comment: 'Дата доставки' }
    address:                { type: string, notnull: false, default: null, comment: 'Адрес доставки или получения' }
    recipient_first_name:   { type: string(255), notnull: false, default: null, comment: 'Имя получателя' }
    recipient_last_name:    { type: string(255), notnull: false, default: null, comment: 'Фамилия получателя' }
    recipient_middle_name:  { type: string(255), notnull: false, default: null, comment: 'Отчество получателя' }
    recipient_phonenumbers: { type: string(255), notnull: false, default: null, comment: 'Телефоны получателя' }
    step:                   { type: integer(4), notnull: false, default: null, comment: 'Шаг заказа' }
  relations:
    User:                   { class: User, foreignAlias: Order, local: user_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }
    PaymentMethod:          { class: PaymentMethod, foreignAlias: Order, local: payment_method_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }
    Shop:                   { class: Shop, foreignAlias: Order, local: shop_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }
    DeliveryType:           { class: DeliveryType, foreignAlias: Order, local: delivery_type_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }
    Region:                 { class: Region, autoComplete: false, local: region_id, foreign: id, type: one, onDelete: SET NULL }

OrderProductRelation:
  options:
    comment: 'Связь заказа и товара'
  columns:
    order_id:          { type: integer(20), notnull: true }
    product_id:        { type: integer(20), notnull: true }
    price:             { type: 'decimal(12,2)', notnull: true, default: 0, comment: 'Цена товара в корзине' }
    quantity:          { type: integer(4), notnull: true, comment: 'Количество товара в корзине' }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
  relations:
    Order:             { class: Order, foreignAlias: ProductRelation, local: order_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Product:           { class: Product, foreignAlias: OrderRelation, local: product_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
