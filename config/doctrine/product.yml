Creator:
  options:
    comment: 'Производитель'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    core_id:           { type: integer(20), notnull: false, default: null, comment: 'ид записи в Core' }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }

ProductFilterGroup:
  options:
    comment: 'Группа фильтров товаров'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: true, notblank: true }

ProductFilter:
  options:
    comment: 'Фильтр товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: true, notblank: true }
    type:              { type: enum, length: 10, values: [choice, range], notnull: true }
    group_id:          { type: integer(20), notnull: true }
    property_id:       { type: integer(20), notnull: true }
    is_multiple:       { type: boolean, notnull: true, default: false, comment: 'Фильтр имеет несколько значений?' }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
  relations:
    Group:             { class: ProductFilterGroup, foreignAlias: Filter, local: group_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Property:          { class: ProductProperty, foreignAlias: ProductFilter, local: property_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductCategory:
  options:
    comment: 'Категория товара'
  actAs:
    NestedSet:     { hasManyRoots: true, rootColumnName: root_id }
    Timestampable: ~
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    core_id:           { type: integer(20), notnull: false, default: null, comment: 'ид записи в Core' }
    core_parent_id:    { type: integer(20), notnull: false, default: null, comment: 'ид родителя записи в Core' }
    root_id:           { type: integer(20), notnull: false, default: null }
    lft:               { type: integer(20), notnull: false, default: null }
    rgt:               { type: integer(20), notnull: false, default: null }
    level:             { type: integer(4), notnull: false, default: null }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }
    filter_group_id:   { type: integer(20), notnull: false, default: null }
  relations:
    FilterGroup:       { class: ProductFilterGroup, foreignAlias: Category, local: filter_group_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }
    ProductType:       { class: ProductType, foreignAlias: ProductCategory, refClass: ProductCategoryTypeRelation, local: product_category_id, foreign: product_type_id, type: many, foreignType: many }

ProductType:
  options:
    comment: 'Тип товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: true, notblank: true }
    rating_type_id:    { type: integer(20), notnull: false, default: null }
  relations:
    RatingType:        { class: ProductRatingType, foreignAlias: ProductType, local: rating_type_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }

ProductCategoryTypeRelation:
  options:
    comment: 'Связь типов и категорий товара'
  actAs: [ Timestampable ]
  columns:
    product_category_id: { type: integer(20), primary: true, notnull: true }
    product_type_id:   { type: integer(20), primary: true, notnull: true }
  relations:
    ProductCategory:   { class: ProductCategory, foreignAlias: ProductTypeRelation, local: product_category_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    ProductType:       { class: ProductType, foreignAlias: ProductCategoryRelation, local: product_type_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductProperty:
  options:
    comment: 'Свойство товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    core_id:           { type: integer(20), notnull: false, default: null, comment: 'ид записи в Core' }
    name:              { type: string(255), notnull: true, notblank: true }
    type:              { type: enum, length: 10, values: [ string, select, integer, float, text ], notnull: true, default: string, comment: 'Тип свойства: строка, значение из справочника (опция свойства), текст' }
    is_multiple:       { type: boolean, notnull: true, default: false, comment: 'Свойство имеет несколько значений?' }
    unit:              { type: string(255), notnull: false, default: null, comment: 'Единица измерения' }
    pattern:           { type: string(255), notnull: false, default: '%value% %unit%', comment: 'Шаблон для создания значения свойства с единицей измерения для отображения' }
  relations:
    ProductType:       { class: ProductType, foreignAlias: Property, refClass: ProductTypePropertyRelation, local: property_id, foreign: product_type_id, type: many, foreignType: many }
    Group:             { class: ProductPropertyGroup, foreignAlias: Property, refClass: ProductTypePropertyRelation, local: property_id, foreign: group_id, type: many, foreignType: many }

ProductPropertyGroup:
  options:
    comment: 'Группа свойств товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: false, default: null }
    product_type_id:   { type: integer(20), notnull: true }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
  relations:
    ProductType:       { class: ProductType, foreignAlias: PropertyGroup, local: product_type_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductTypePropertyRelation:
  options:
    comment: 'Связь типов и свойств товара'
  actAs: [ Timestampable ]
  columns:
    product_type_id:   { type: integer(20), primary: true, notnull: true }
    property_id:       { type: integer(20), primary: true, notnull: true }
    group_id:          { type: integer(20), notnull: false, default: null }
    name:              { type: string(255), notnull: false, default: null }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
    group_position:    { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки в группе свойств товара' }
    view_show:         { type: boolean, notnull: true, default: false, comment: 'Показывать свойство в карточке товара?' }
    view_list:         { type: boolean, notnull: true, default: false, comment: 'Показывать свойство в списке товаров?' }
  relations:
    ProductType:       { class: ProductType, foreignAlias: PropertyRelation, local: product_type_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Property:          { class: ProductProperty, foreignAlias: ProductTypeRelation, local: property_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Group:             { class: ProductPropertyGroup, foreignAlias: PropertyRelation, local: group_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }

ProductPropertyOption:
  options:
    comment: 'Опции свойства товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    property_id:       { type: integer(20), notnull: true }
    value:             { type: string(255), notnull: true, notblank: true, comment: 'Значение опции' }
    unit:              { type: string(255), notnull: false, default: null, comment: 'Единица измерения' }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
  relations:
    Property:          { class: ProductProperty, foreignAlias: Option, local: property_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

Product:
  options:
    comment: 'Товар'
  actAs: [ Timestampable ]
  listeners: [ myDoctrineRecordListener ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    core_id:           { type: integer(20), notnull: false, default: null, comment: 'ид записи в Core' }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }
    type_id:           { type: integer(20), notnull: true }
    creator_id:        { type: integer(20), notnull: true }
    category_id:       { type: integer(20), notnull: true }
    group_id:          { type: integer(20), notnull: false, default: NULL }
    view_show:         { type: boolean, notnull: true, default: false, comment: 'Показывать товар по прямой ссылке?' }
    view_list:         { type: boolean, notnull: true, default: false, comment: 'Показывать товар в списке категорий?' }
    is_instock:        { type: boolean, notnull: true, default: false }
    description:       { type: text, notnull: false, default: null, comment: 'Описание товара' }
    rating:            { type: 'decimal(18,14)', notnull: true, default: 0, comment: 'Рейтинг товара' }
    price:             { type: 'decimal(12,2)', notnull: true, default: 0, comment: 'Цена товара' }
  relations:
    Type:              { class: ProductType, foreignAlias: Product, local: type_id, foreign: id, type: one, foreignType: many, onDelete: RESTRICT }
    Creator:           { class: Creator, foreignAlias: Product, local: creator_id, foreign: id, type: one, foreignType: many, onDelete: RESTRICT }
    Category:          { class: ProductCategory, foreignAlias: Product, local: category_id, foreign: id, type: one, foreignType: many, onDelete: RESTRICT }
    Group:             { class: ProductGroup, foreignAlias: Product, local: group_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }

ProductPropertyRelation:
  options:
    comment: 'Связь продукта и свойства продукта'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: false, default: null }
    product_id:        { type: integer(20), notnull: true }
    property_id:       { type: integer(20), notnull: true }
    option_id:         { type: integer(20), notnull: false, default: null }
    value_integer:     { type: integer(20), notnull: false, default: null }
    value_float:       { type: 'decimal(10,4)', notnull: false, default: null }
    value_string:      { type: string(255), notnull: false, default: null }
    value_text:        { type: string, notnull: false, default: null }
    value:             { type: string(255), notnull: false, default: null, comment: 'Значение свойства для отображения' }
    unit:              { type: string(255), notnull: false, default: null, comment: 'Единица измерения' }
  relations:
    Product:           { class: Product, foreignAlias: PropertyRelation, local: product_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Property:          { class: ProductProperty, foreignAlias: ProductRelation, local: property_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    Option:            { class: ProductPropertyOption, foreignAlias: ProductPropertyRelation, local: option_id, foreign: id, type: one, foreignType: many, onDelete: SET NULL }

ProductPhoto:
  options:
    comment: 'Фото товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255), notnull: true, notblank: true }
    resource:          { type: string(255), notnull: true, notblank: true }
    product_id:        { type: integer(20), notnull: true }
    view_show:         { type: boolean, notnull: true, default: false, comment: 'Показывать фото в карточке товара?' }
    view_list:         { type: boolean, notnull: true, default: false, comment: 'показывать фото в списке товаров?' }
  relations:
    Product:           { class: Product, foreignAlias: Photo, local: product_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductComment:
  options:
    comment: 'Комментарии товара'
  actAs:
    NestedSet:     { hasManyRoots: true, rootColumnName: product_id }
    Timestampable: ~
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    core_id:           { type: integer(20), notnull: false, default: null, comment: 'ид записи в Core' }
    product_id:        { type: integer(20), notnull: true }
    lft:               { type: integer(20), notnull: true }
    rgt:               { type: integer(20), notnull: true }
    level:             { type: integer(4), notnull: true }
    user_id:           { type: integer(20), notnull: false, default: null }
    content:           { type: string(255), notnull: true, notblank: true, comment: 'Текст комментария' }
    helpful:           { type: integer(4), notnull: true, default: 0, comment: 'Количество полезных оценок отзыва' }
    unhelpful:         { type: integer(4), notnull: true, default: 0, comment: 'Количество бесполезных оценок отзыва' }
  relations:
    Product:           { class: Product, foreignAlias: Comment, local: product_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    User:              { class: User, foreignAlias: Comment, local: user_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductGroup:
  options:
    comment: 'Группировка товаров'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    name:              { type: string(255) }
  relations:
    Property:          { foreignAlias: ProductGroup, class: ProductProperty, refClass: ProductGroupPropertyRelation }

ProductGroupPropertyRelation:
  options:
    comment: 'Связь группы товаров и свойст, которые будут различны у этой группы'
  actAs: [ Timestampable ]
  columns:
    product_property_id:  { type: integer(20), notnull: true }
    product_group_id:     { type: integer(20), notnull: true }
  relations:
    Property:             { class: ProductProperty, foreignAlias: ProductGroupRelation, local: product_property_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
    ProductGroup:         { class: ProductGroup, foreignAlias: ProductGroupRelation, local: product_group_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }

ProductRatingType:
  options:
    comment: 'Тип рейтинга товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }

ProductRatingTypeProperty:
  options:
    comment: 'Свойства типа рейтинга товара'
  actAs: [ Timestampable ]
  columns:
    id:                { type: integer(20), autoincrement: true, primary: true }
    type_id:           { type: integer(20), notnull: true }
    token:             { type: string(255), unique: true, notnull: true, notblank: true }
    name:              { type: string(255), notnull: true, notblank: true }
    position:          { type: integer(4), notnull: true, default: 1, comment: 'Порядок сортировки' }
  relations:
    Type:              { class: ProductRatingType, foreignAlias: Property, local: type_id, foreign: id, type: one, foreignType: many, onDelete: CASCADE }
